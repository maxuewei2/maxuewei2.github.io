<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[开始使用GitHub Pages]]></title>
      <url>http://maxuewei2.git.io/2016/10/28/FirstPost/</url>
      <content type="html"><![CDATA[<p>开始使用GitHub Pages，并使用Hexo。</p>
<ul>
<li>2016.10.28 22:17<a id="more"></a></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[近期学到的]]></title>
      <url>http://maxuewei2.git.io/2016/10/22/%E8%BF%91%E6%9C%9F%E5%AD%A6%E5%88%B0%E7%9A%84/</url>
      <content type="html"><![CDATA[<h4 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h4><p>　　编辑器使用Remarkable</p>
<p>　　语法，参考Remarkable帮助里的Tutorial</p>
<a id="more"></a>
<h4 id="Mathjax"><a href="#Mathjax" class="headerlink" title="Mathjax"></a>Mathjax</h4><p><a href="http://mlworks.cn/posts/introduction-to-mathjax-and-latex-expression/" target="_blank" rel="external">Mathjax语法简介</a></p>
<h4 id="Sphinx"><a href="#Sphinx" class="headerlink" title="Sphinx"></a>Sphinx</h4><p>使用docstring生成APIdoc</p>
<p>　　<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$sphinx</span>-apidoc -o /home/me/outdir -F /home/me/code</div></pre></td></tr></table></figure></p>
<p>　　　<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cd</span> /home/me/outdir</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$gedit</span> conf.py</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line">sys.path.insert(<span class="number">0</span>, os.path.abspath(<span class="string">'../..'</span>))</div><div class="line">....</div><div class="line">....</div></pre></td></tr></table></figure>
<h4 id="reStructuredText"><a href="#reStructuredText" class="headerlink" title="reStructuredText"></a>reStructuredText</h4><p><a href="http://zh-sphinx-doc.readthedocs.io/en/latest/rest.html" target="_blank" rel="external">reStructuredText语法简介</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[重定向]]></title>
      <url>http://maxuewei2.git.io/2016/09/12/%E9%87%8D%E5%AE%9A%E5%90%91/</url>
      <content type="html"><![CDATA[<p>Linux 终端:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cat testin.txt|./<span class="built_in">test</span></div><div class="line"></div><div class="line">./<span class="built_in">test</span>&gt;testout.txt</div><div class="line"></div><div class="line">cat testin.txt|./<span class="built_in">test</span>&gt;testout.txt</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>Windows cmd:　　　　<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">　　test.exe&lt;testin.txt</div><div class="line"></div><div class="line">　　test.exe&gt;testout.txt</div><div class="line"></div><div class="line">　　test.exe&lt;testin.txt&gt;testout.txt</div></pre></td></tr></table></figure></p>
<p>C代码：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">freopen(<span class="string">"testin.txt"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line"></div><div class="line">fclose(<span class="built_in">stdin</span>);</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">freopen(<span class="string">"testout.txt"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line"></div><div class="line">fclose(<span class="built_in">stdout</span>);</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CCF考试]]></title>
      <url>http://maxuewei2.git.io/2016/09/11/CCF%E8%AE%B0%E5%BD%95/</url>
      <content type="html"><![CDATA[<p>第八次CCF考试记录<br><a id="more"></a></p>
<p>代码还不知道对不对，过两天出成绩。</p>
<blockquote>
<p>成绩出来了，310分。</p>
<p>100+100+100+10+0；</p>
</blockquote>
<p>考试13:27开始，17:30结束，提交第4题后不再答题，只是检查前四题的代码</p>
<p>第一次提交：<br>1 13:34<br>2 14:00左右<br>3 15:32<br>4 16:56<br>5</p>
<p>最后一次提交：<br>1 13:34<br>2 16:06<br>3 15:32<br>4 16:56<br>5</p>
<p>代码行数（不算空行，算无用的include，算注释掉的部分）<br>1 23<br>2 50<br>3 101<br>4 71<br>5<br>共 245 行</p>
<h3 id="源代码："><a href="#源代码：" class="headerlink" title="源代码："></a>源代码：</h3><p>1<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;n;</div><div class="line">    <span class="keyword">int</span> * a=<span class="keyword">new</span> <span class="keyword">int</span>[n];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">        <span class="built_in">cin</span>&gt;&gt;a[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> m=<span class="number">-99999</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</div><div class="line">        <span class="keyword">int</span> t=a[i]-a[i<span class="number">-1</span>];</div><div class="line">        t=t&gt;<span class="number">0</span>?t:<span class="number">0</span>-t;</div><div class="line">        m=m&lt;t?t:m;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;m;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> * a=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">20</span>];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</div><div class="line">        a[i]=<span class="number">5</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> n,t;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;n;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">        <span class="built_in">cin</span>&gt;&gt;t;</div><div class="line">        <span class="keyword">int</span> flag=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(a[i]&gt;=t)&#123;</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;t;j++)&#123;</div><div class="line">                    <span class="built_in">cout</span>&lt;&lt;i*<span class="number">5</span>+<span class="number">5</span>-a[i]+j+<span class="number">1</span>&lt;&lt;<span class="string">" "</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">                a[i]-=t;</div><div class="line">                flag=<span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(flag==<span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</div><div class="line">                <span class="keyword">if</span>(a[i]-t&gt;<span class="number">0</span>)&#123;</div><div class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;t;j++)&#123;</div><div class="line">                        <span class="built_in">cout</span>&lt;&lt;i*<span class="number">5</span>+<span class="number">5</span>-a[i]+j+<span class="number">1</span>&lt;&lt;<span class="string">" "</span>;</div><div class="line">                    &#125;</div><div class="line">                    a[i]-=t;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;a[i];j++)&#123;</div><div class="line">                        <span class="built_in">cout</span>&lt;&lt;i*<span class="number">5</span>+<span class="number">5</span>-a[i]+j+<span class="number">1</span>&lt;&lt;<span class="string">" "</span>;</div><div class="line">                    &#125;</div><div class="line">                    t-=a[i];</div><div class="line">                    a[i]=<span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">delete</span> []a;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>3<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">struct</span> suicong&#123;</div><div class="line">    <span class="keyword">int</span> hth;</div><div class="line">    <span class="keyword">int</span> att;</div><div class="line">    suicong(<span class="keyword">int</span> h,<span class="keyword">int</span> a)&#123;</div><div class="line">        hth=h;</div><div class="line">        att=a;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">struct</span> ying&#123;</div><div class="line">    <span class="keyword">int</span> hth;</div><div class="line">    <span class="keyword">int</span> att;</div><div class="line">    ying()&#123;</div><div class="line">        hth=<span class="number">30</span>;</div><div class="line">        att=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</div><div class="line">    <span class="built_in">vector</span>&lt;suicong&gt;* war=<span class="keyword">new</span> <span class="built_in">vector</span>&lt;suicong&gt;[<span class="number">2</span>];</div><div class="line">    <span class="comment">//vector&lt;suicong&gt; war0;</span></div><div class="line">    <span class="comment">//vector&lt;suicong&gt; war1;</span></div><div class="line">    <span class="comment">//suicong* ying0=new suicong(30,0,1);</span></div><div class="line">    <span class="comment">//suicong* ying1=new suicong(30,0,1);</span></div><div class="line">    ying ying[<span class="number">2</span>];</div><div class="line">    <span class="comment">//war[0].push_back(*ying0);</span></div><div class="line">    <span class="comment">//war[1].push_back(*ying1);</span></div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;n;</div><div class="line">    <span class="keyword">int</span> t=<span class="number">0</span>;</div><div class="line">    <span class="comment">//int y[2];</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">        <span class="built_in">string</span> str;</div><div class="line">        <span class="built_in">cin</span>&gt;&gt;str;</div><div class="line">        <span class="keyword">if</span>(str==<span class="string">"summon"</span>)&#123;</div><div class="line">            <span class="keyword">int</span> p,h,a;</div><div class="line">            <span class="built_in">cin</span>&gt;&gt;p&gt;&gt;a&gt;&gt;h;</div><div class="line">            suicong* temp=<span class="keyword">new</span> suicong(h,a);</div><div class="line">            war[t].insert(war[t].begin()+p<span class="number">-1</span>,*temp);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(str==<span class="string">"attack"</span>)&#123;</div><div class="line">            <span class="keyword">int</span> d,a;</div><div class="line">            <span class="built_in">cin</span>&gt;&gt;a&gt;&gt;d;</div><div class="line">            <span class="keyword">if</span>(d==<span class="number">0</span>)&#123;</div><div class="line">                ying[<span class="number">1</span>-t].hth-=war[t].at(a<span class="number">-1</span>).att;</div><div class="line">                war[t].at(a<span class="number">-1</span>).hth-=ying[<span class="number">1</span>-t].att;</div><div class="line">                <span class="keyword">if</span>(war[t].at(a<span class="number">-1</span>).hth&lt;=<span class="number">0</span>)&#123;</div><div class="line">                    war[t].erase(war[t].begin()+a<span class="number">-1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span>&#123;</div><div class="line">                <span class="comment">//cout&lt;&lt;t&lt;&lt;" "&lt;&lt;war[t].size()&lt;&lt;" "&lt;&lt;war[1-t].size();</span></div><div class="line">                war[<span class="number">1</span>-t].at(d<span class="number">-1</span>).hth-=war[t].at(a<span class="number">-1</span>).att;</div><div class="line">                war[t].at(a<span class="number">-1</span>).hth-=war[<span class="number">1</span>-t].at(d<span class="number">-1</span>).att;</div><div class="line">                <span class="keyword">if</span>(war[t].at(a<span class="number">-1</span>).hth&lt;=<span class="number">0</span>)&#123;</div><div class="line">                    war[t].erase(war[t].begin()+a<span class="number">-1</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(war[<span class="number">1</span>-t].at(d<span class="number">-1</span>).hth&lt;=<span class="number">0</span>)&#123;</div><div class="line">                    war[<span class="number">1</span>-t].erase(war[<span class="number">1</span>-t].begin()+d<span class="number">-1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(str==<span class="string">"end"</span>)&#123;</div><div class="line">            t=<span class="number">1</span>-t;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*cout&lt;&lt;0&lt;&lt;" "&lt;&lt;ying[0].hth&lt;&lt;" "&lt;&lt;war[0].size()&lt;&lt;" ";</span></div><div class="line">        for(int i=0;i&lt;war[0].size();i++)&#123;</div><div class="line">            cout&lt;&lt;war[0].at(i).hth&lt;&lt;" ";</div><div class="line">        &#125;cout&lt;&lt;endl;</div><div class="line">        cout&lt;&lt;1&lt;&lt;" "&lt;&lt;ying[1].hth&lt;&lt;" "&lt;&lt;war[1].size()&lt;&lt;" ";</div><div class="line">        for(int i=0;i&lt;war[1].size();i++)&#123;</div><div class="line">            cout&lt;&lt;war[1].at(i).hth&lt;&lt;" ";</div><div class="line">        &#125;cout&lt;&lt;endl;*/</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(ying[<span class="number">0</span>].hth&lt;=<span class="number">0</span>)&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;<span class="keyword">else</span></div><div class="line">    <span class="keyword">if</span>(ying[<span class="number">1</span>].hth&lt;=<span class="number">0</span>)&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="number">1</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;ying[<span class="number">0</span>].hth&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;war[<span class="number">0</span>].size()&lt;&lt;<span class="string">" "</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;war[<span class="number">0</span>].size();i++)&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;war[<span class="number">0</span>].at(i).hth&lt;&lt;<span class="string">" "</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;ying[<span class="number">1</span>].hth&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;war[<span class="number">1</span>].size()&lt;&lt;<span class="string">" "</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;war[<span class="number">1</span>].size();i++)&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;war[<span class="number">1</span>].at(i).hth&lt;&lt;<span class="string">" "</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4</p>
<blockquote>
<p>此代码是错误的<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">struct</span> road&#123;</div><div class="line">    <span class="keyword">int</span> to;</div><div class="line">    <span class="keyword">int</span> len;</div><div class="line">    road(<span class="keyword">int</span> t,<span class="keyword">int</span> l)&#123;</div><div class="line">        to=t;len=l;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">struct</span> city&#123;</div><div class="line">    <span class="comment">//int num;</span></div><div class="line">    <span class="keyword">int</span> pre=<span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> tlen=<span class="number">999999999</span>;</div><div class="line">    <span class="built_in">vector</span>&lt;road&gt; v;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addroad</span><span class="params">(<span class="keyword">int</span> t,<span class="keyword">int</span> len)</span></span>&#123;</div><div class="line">        road* r=<span class="keyword">new</span> road(t,len);</div><div class="line">        v.push_back(*r);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(city* cs,<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;cs[i].v.size();k++)&#123;</div><div class="line">        <span class="keyword">if</span>(cs[i].v.at(k).to==j)<span class="keyword">return</span> cs[i].v.at(k).len;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n,m;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;n&gt;&gt;m;</div><div class="line">    city* cs=<span class="keyword">new</span> city[n+<span class="number">1</span>];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</div><div class="line">        <span class="keyword">int</span> a,b,c;</div><div class="line">        <span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b&gt;&gt;c;</div><div class="line">        cs[a].addroad(b,c);</div><div class="line">        cs[b].addroad(a,c);</div><div class="line">    &#125;</div><div class="line">    cs[<span class="number">1</span>].tlen=<span class="number">0</span>;</div><div class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</div><div class="line">    q.push(<span class="number">1</span>);</div><div class="line">    <span class="keyword">while</span>(!q.empty())&#123;</div><div class="line">        <span class="keyword">int</span> t=q.front();</div><div class="line">        q.pop();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;cs[t].v.size();i++)&#123;</div><div class="line">            <span class="keyword">if</span>(cs[cs[t].v.at(i).to].tlen&gt;cs[t].tlen+cs[t].v.at(i).len)&#123;</div><div class="line">                cs[cs[t].v.at(i).to].tlen=cs[t].tlen+cs[t].v.at(i).len;</div><div class="line">                cs[cs[t].v.at(i).to].pre=t;</div><div class="line">                q.push(cs[t].v.at(i).to);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(cs[cs[t].v.at(i).to].tlen==cs[t].tlen+cs[t].v.at(i).len)&#123;</div><div class="line">                <span class="keyword">if</span>(get(cs,cs[cs[t].v.at(i).to].pre,cs[t].v.at(i).to)&gt;cs[t].v.at(i).len)&#123;</div><div class="line">                    cs[cs[t].v.at(i).to].tlen=cs[t].tlen+cs[t].v.at(i).len;</div><div class="line">                    cs[cs[t].v.at(i).to].pre=t;</div><div class="line">                    q.push(cs[t].v.at(i).to);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="comment">/*    for(int i=0;i&lt;n+1;i++)&#123;</span></div><div class="line">        cout&lt;&lt;i&lt;&lt;" "&lt;&lt;cs[i].pre&lt;&lt;" "&lt;&lt;get(cs,i,cs[i].pre)&lt;&lt;endl;</div><div class="line">    &#125;*/</div><div class="line">    <span class="keyword">int</span> ll=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n+<span class="number">1</span>;i++)&#123;</div><div class="line">        ll+=get(cs,i,cs[i].pre);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;ll;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li>2016.9.11 晚8:40</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[简单的词法分析和语法分析（C++实现，CodeBlocks+GCC编译）]]></title>
      <url>http://maxuewei2.git.io/2016/07/13/%E7%AE%80%E5%8D%95%E7%9A%84%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90%E5%92%8C%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90/</url>
      <content type="html"><![CDATA[<h3 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h3><p>　　分析的语言是SNL语言，详见《编译程序的设计与实现》（ 刘磊、金英、张晶、张荷花、单郸编著）</p>
<p>　　词法分析就是实现了词法分析的自动机</p>
<p>　　语法分析使用递归下降法</p>
<a id="more"></a>
<h3 id="运行结果："><a href="#运行结果：" class="headerlink" title="运行结果："></a>运行结果：</h3><p>　　词法分析 得到TokenList</p>
<p>　　语法分析 输出语法树</p>
<p>　　</p>
<h4 id="运行输出："><a href="#运行输出：" class="headerlink" title="运行输出："></a>运行输出：</h4><p><img src="/imgs/cifafenxi.png" alt="shuchu"></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><p>main.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div><div class="line">815</div><div class="line">816</div><div class="line">817</div><div class="line">818</div><div class="line">819</div><div class="line">820</div><div class="line">821</div><div class="line">822</div><div class="line">823</div><div class="line">824</div><div class="line">825</div><div class="line">826</div><div class="line">827</div><div class="line">828</div><div class="line">829</div><div class="line">830</div><div class="line">831</div><div class="line">832</div><div class="line">833</div><div class="line">834</div><div class="line">835</div><div class="line">836</div><div class="line">837</div><div class="line">838</div><div class="line">839</div><div class="line">840</div><div class="line">841</div><div class="line">842</div><div class="line">843</div><div class="line">844</div><div class="line">845</div><div class="line">846</div><div class="line">847</div><div class="line">848</div><div class="line">849</div><div class="line">850</div><div class="line">851</div><div class="line">852</div><div class="line">853</div><div class="line">854</div><div class="line">855</div><div class="line">856</div><div class="line">857</div><div class="line">858</div><div class="line">859</div><div class="line">860</div><div class="line">861</div><div class="line">862</div><div class="line">863</div><div class="line">864</div><div class="line">865</div><div class="line">866</div><div class="line">867</div><div class="line">868</div><div class="line">869</div><div class="line">870</div><div class="line">871</div><div class="line">872</div><div class="line">873</div><div class="line">874</div><div class="line">875</div><div class="line">876</div><div class="line">877</div><div class="line">878</div><div class="line">879</div><div class="line">880</div><div class="line">881</div><div class="line">882</div><div class="line">883</div><div class="line">884</div><div class="line">885</div><div class="line">886</div><div class="line">887</div><div class="line">888</div><div class="line">889</div><div class="line">890</div><div class="line">891</div><div class="line">892</div><div class="line">893</div><div class="line">894</div><div class="line">895</div><div class="line">896</div><div class="line">897</div><div class="line">898</div><div class="line">899</div><div class="line">900</div><div class="line">901</div><div class="line">902</div><div class="line">903</div><div class="line">904</div><div class="line">905</div><div class="line">906</div><div class="line">907</div><div class="line">908</div><div class="line">909</div><div class="line">910</div><div class="line">911</div><div class="line">912</div><div class="line">913</div><div class="line">914</div><div class="line">915</div><div class="line">916</div><div class="line">917</div><div class="line">918</div><div class="line">919</div><div class="line">920</div><div class="line">921</div><div class="line">922</div><div class="line">923</div><div class="line">924</div><div class="line">925</div><div class="line">926</div><div class="line">927</div><div class="line">928</div><div class="line">929</div><div class="line">930</div><div class="line">931</div><div class="line">932</div><div class="line">933</div><div class="line">934</div><div class="line">935</div><div class="line">936</div><div class="line">937</div><div class="line">938</div><div class="line">939</div><div class="line">940</div><div class="line">941</div><div class="line">942</div><div class="line">943</div><div class="line">944</div><div class="line">945</div><div class="line">946</div><div class="line">947</div><div class="line">948</div><div class="line">949</div><div class="line">950</div><div class="line">951</div><div class="line">952</div><div class="line">953</div><div class="line">954</div><div class="line">955</div><div class="line">956</div><div class="line">957</div><div class="line">958</div><div class="line">959</div><div class="line">960</div><div class="line">961</div><div class="line">962</div><div class="line">963</div><div class="line">964</div><div class="line">965</div><div class="line">966</div><div class="line">967</div><div class="line">968</div><div class="line">969</div><div class="line">970</div><div class="line">971</div><div class="line">972</div><div class="line">973</div><div class="line">974</div><div class="line">975</div><div class="line">976</div><div class="line">977</div><div class="line">978</div><div class="line">979</div><div class="line">980</div><div class="line">981</div><div class="line">982</div><div class="line">983</div><div class="line">984</div><div class="line">985</div><div class="line">986</div><div class="line">987</div><div class="line">988</div><div class="line">989</div><div class="line">990</div><div class="line">991</div><div class="line">992</div><div class="line">993</div><div class="line">994</div><div class="line">995</div><div class="line">996</div><div class="line">997</div><div class="line">998</div><div class="line">999</div><div class="line">1000</div><div class="line">1001</div><div class="line">1002</div><div class="line">1003</div><div class="line">1004</div><div class="line">1005</div><div class="line">1006</div><div class="line">1007</div><div class="line">1008</div><div class="line">1009</div><div class="line">1010</div><div class="line">1011</div><div class="line">1012</div><div class="line">1013</div><div class="line">1014</div><div class="line">1015</div><div class="line">1016</div><div class="line">1017</div><div class="line">1018</div><div class="line">1019</div><div class="line">1020</div><div class="line">1021</div><div class="line">1022</div><div class="line">1023</div><div class="line">1024</div><div class="line">1025</div><div class="line">1026</div><div class="line">1027</div><div class="line">1028</div><div class="line">1029</div><div class="line">1030</div><div class="line">1031</div><div class="line">1032</div><div class="line">1033</div><div class="line">1034</div><div class="line">1035</div><div class="line">1036</div><div class="line">1037</div><div class="line">1038</div><div class="line">1039</div><div class="line">1040</div><div class="line">1041</div><div class="line">1042</div><div class="line">1043</div><div class="line">1044</div><div class="line">1045</div><div class="line">1046</div><div class="line">1047</div><div class="line">1048</div><div class="line">1049</div><div class="line">1050</div><div class="line">1051</div><div class="line">1052</div><div class="line">1053</div><div class="line">1054</div><div class="line">1055</div><div class="line">1056</div><div class="line">1057</div><div class="line">1058</div><div class="line">1059</div><div class="line">1060</div><div class="line">1061</div><div class="line">1062</div><div class="line">1063</div><div class="line">1064</div><div class="line">1065</div><div class="line">1066</div><div class="line">1067</div><div class="line">1068</div><div class="line">1069</div><div class="line">1070</div><div class="line">1071</div><div class="line">1072</div><div class="line">1073</div><div class="line">1074</div><div class="line">1075</div><div class="line">1076</div><div class="line">1077</div><div class="line">1078</div><div class="line">1079</div><div class="line">1080</div><div class="line">1081</div><div class="line">1082</div><div class="line">1083</div><div class="line">1084</div><div class="line">1085</div><div class="line">1086</div><div class="line">1087</div><div class="line">1088</div><div class="line">1089</div><div class="line">1090</div><div class="line">1091</div><div class="line">1092</div><div class="line">1093</div><div class="line">1094</div><div class="line">1095</div><div class="line">1096</div><div class="line">1097</div><div class="line">1098</div><div class="line">1099</div><div class="line">1100</div><div class="line">1101</div><div class="line">1102</div><div class="line">1103</div><div class="line">1104</div><div class="line">1105</div><div class="line">1106</div><div class="line">1107</div><div class="line">1108</div><div class="line">1109</div><div class="line">1110</div><div class="line">1111</div><div class="line">1112</div><div class="line">1113</div><div class="line">1114</div><div class="line">1115</div><div class="line">1116</div><div class="line">1117</div><div class="line">1118</div><div class="line">1119</div><div class="line">1120</div><div class="line">1121</div><div class="line">1122</div><div class="line">1123</div><div class="line">1124</div><div class="line">1125</div><div class="line">1126</div><div class="line">1127</div><div class="line">1128</div><div class="line">1129</div><div class="line">1130</div><div class="line">1131</div><div class="line">1132</div><div class="line">1133</div><div class="line">1134</div><div class="line">1135</div><div class="line">1136</div><div class="line">1137</div><div class="line">1138</div><div class="line">1139</div><div class="line">1140</div><div class="line">1141</div><div class="line">1142</div><div class="line">1143</div><div class="line">1144</div><div class="line">1145</div><div class="line">1146</div><div class="line">1147</div><div class="line">1148</div><div class="line">1149</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMOFRESERVED 22</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMOFSYMBOLS 20</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RES 0</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ID 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NUM 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SYM 3</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> STR 4</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PLUS 100</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SUB 101</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MUL 102</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DIV 103</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LT 104</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LBRACK 105</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RBRACK 106</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LSQUBRACK 107</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RSQUBRACK 108</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> POINT 109</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SEMI 110</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LBRACE 111</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RBRACE 112</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> EOFF 113</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BLANK 114</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> QUO 115</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> EQU 116</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INDEX 117</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ASSI 118</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> COM 119</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> uint unsigned</span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> Token &#123;</div><div class="line">    <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">int</span> ptr;</div><div class="line">    <span class="keyword">int</span> linenum;</div><div class="line">&#125; Token;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> Node &#123;</div><div class="line">    <span class="keyword">char</span> *desc;</div><div class="line">    <span class="built_in">vector</span>&lt;Node*&gt; children;</div><div class="line">    Node(<span class="keyword">const</span> <span class="keyword">char</span>* str) &#123;</div><div class="line">        desc=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">30</span>];</div><div class="line">        <span class="built_in">strcpy</span>(desc,str);</div><div class="line">    &#125;</div><div class="line">&#125; Node;</div><div class="line"></div><div class="line"><span class="built_in">vector</span>&lt;Token&gt;* tokens;</div><div class="line"><span class="keyword">int</span> Token_n=<span class="number">0</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span>* reserved_words[NUMOFRESERVED]= &#123;<span class="string">"begin"</span>,<span class="string">"end"</span>,<span class="string">"program"</span>,<span class="string">"var"</span>,</div><div class="line">                                            <span class="string">"type"</span>,<span class="string">"procedure"</span>,<span class="string">"while"</span>,<span class="string">"endwh"</span>,</div><div class="line">                                            <span class="string">"integer"</span>,<span class="string">"char"</span>,<span class="string">"array"</span>,<span class="string">"of"</span>,</div><div class="line">                                            <span class="string">"intc"</span>,<span class="string">"record"</span>,<span class="string">"if"</span>,<span class="string">"then"</span>,</div><div class="line">                                            <span class="string">"else"</span>,<span class="string">"fi"</span>,<span class="string">"do"</span>,<span class="string">"write"</span>,</div><div class="line">                                            <span class="string">"read"</span>,<span class="string">"return"</span></div><div class="line">                                           &#125;;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span>* symbol_table[NUMOFSYMBOLS]= &#123;<span class="string">"+"</span>,<span class="string">"-"</span>,<span class="string">"*"</span>,<span class="string">"/"</span>,<span class="string">"&lt;"</span>,</div><div class="line">                                                <span class="string">"("</span>,<span class="string">")"</span>,<span class="string">"["</span>,<span class="string">"]"</span>,<span class="string">"."</span>,</div><div class="line">                                                <span class="string">";"</span>,<span class="string">"&#123;"</span>,<span class="string">"&#125;"</span>,<span class="string">"EOF"</span>,<span class="string">"BLANK"</span>,</div><div class="line">                                                <span class="string">"\'"</span>,<span class="string">"="</span>,<span class="string">".."</span>,<span class="string">":="</span>,<span class="string">","</span></div><div class="line">                                               &#125;;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">syntaxError</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* message)</span></span>;</div><div class="line"><span class="function">Node* <span class="title">MatchRES</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* expected)</span></span>;</div><div class="line"><span class="function">Node* <span class="title">MatchSYM</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> expected)</span></span>;</div><div class="line"><span class="function">Node* <span class="title">MatchID</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">MatchNUM</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isRES</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* res)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isSYM</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> res)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isID</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isNUM</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isLineEnd</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Program</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProgramHead</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">DeclarePart</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeDec</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeDeclaration</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeDecList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeDecMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeId</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeName</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">BaseType</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">StructureType</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ArrayType</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">RecType</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FieldDecList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FieldDecMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">IdList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">IdMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarDec</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarDeclaration</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarDecList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarDecMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarIdList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarIdMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProcDec</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProcDeclaration</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ParamList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ParamDecList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ParamMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Param</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FormList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FidMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProcDecPart</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProcBody</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProgramBody</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">StmList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">StmMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Stm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">AssCall</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">AssignmentRest</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ConditionalStm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">LoopStm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">InputStm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">OutputStm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ReturnStm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">CallStmRest</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ActParamList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ActParamMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Exp</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Term</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">OtherFactor</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">OtherTerm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Factor</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Variable</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VariMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FieldVar</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FieldVarMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Parse</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">CmpOp</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">AddOp</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">MultOp</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_tree</span><span class="params">(Node* root,<span class="keyword">int</span> depth,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;* v,<span class="keyword">bool</span> islast)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="built_in">vector</span>&lt;Node* &gt;&amp; children,Node* node)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(node!=<span class="literal">NULL</span>) &#123;</div><div class="line">        children.push_back(node);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> COMMENT_ERROR -1000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> STR_ERROR -1001</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SYM_ERROR -1002</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NOT_REC_SYMBOL -1003</span></div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">char</span>*&gt; ID_table;</div><div class="line"><span class="built_in">vector</span>&lt;uint&gt; NUM_table;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">char</span>*&gt; STR_table;</div><div class="line"><span class="keyword">int</span> ID_n=<span class="number">0</span>,NUM_n=<span class="number">0</span>,STR_n=<span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> num_of_lines=<span class="number">1</span>;</div><div class="line">FILE * file;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/***************************************************************************************/</span></div><div class="line"><span class="comment">/*****************                   词法分析                          *****************/</span></div><div class="line"><span class="comment">/***************************************************************************************/</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">handle_error</span><span class="params">(<span class="keyword">int</span> error_num,<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"行号:%d \t"</span>,num_of_lines);</div><div class="line">    <span class="keyword">switch</span>(error_num) &#123;</div><div class="line">    <span class="keyword">case</span> COMMENT_ERROR:</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"注释未结束 \t"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> SYM_ERROR:</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"出现未定义的符号，您想输入的是\":=\"吗? \t"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> STR_ERROR:</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"字符串未结束 \t"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> NOT_REC_SYMBOL:</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"出现未定义的符号 \t"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%s\n"</span>,str);</div><div class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">char</span> <span class="title">getNextChar</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">char</span> c;</div><div class="line">    c=fgetc(file);</div><div class="line">    <span class="keyword">return</span> c;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ungetNextChar</span><span class="params">()</span> </span>&#123;</div><div class="line">    fseek(file,<span class="number">-1</span>,SEEK_CUR);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">reservedLookup</span><span class="params">(<span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;NUMOFRESERVED; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(str,reserved_words[i])==<span class="number">0</span>)<span class="keyword">return</span> i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">str_to_num</span><span class="params">(<span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(str);</div><div class="line">    <span class="keyword">int</span> n=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        n=n*<span class="number">10</span>+str[i]-<span class="string">'0'</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> n;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">addIDTable</span><span class="params">(<span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    ID_table.push_back(str);</div><div class="line">    <span class="keyword">return</span> ID_n++;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">addNUMTable</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</div><div class="line">    NUM_table.push_back(num);</div><div class="line">    <span class="keyword">return</span> NUM_n++;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">addSTRTable</span><span class="params">(<span class="keyword">char</span>* str )</span> </span>&#123;</div><div class="line">    STR_table.push_back(str);</div><div class="line">    <span class="keyword">return</span> STR_n++;</div><div class="line">&#125;</div><div class="line"><span class="function">Token <span class="title">scan</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> symbols[<span class="number">12</span>]= &#123;<span class="string">'+'</span>,<span class="string">'-'</span>,<span class="string">'*'</span>,<span class="string">'/'</span>,<span class="string">'&lt;'</span>,<span class="string">'('</span>,<span class="string">')'</span>,<span class="string">'['</span>,<span class="string">']'</span>,<span class="string">';'</span>,<span class="string">'='</span>,<span class="string">','</span>&#125;;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> symbols_n[<span class="number">12</span>]= &#123;PLUS,SUB,MUL,DIV,LT,LBRACK,RBRACK,LSQUBRACK,RSQUBRACK,SEMI,EQU,COM&#125;;</div><div class="line">    Token t;</div><div class="line">    t.linenum=num_of_lines;</div><div class="line">    <span class="keyword">char</span>* str=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">256</span>];</div><div class="line">    <span class="built_in">strcpy</span>(str,<span class="string">""</span>);<span class="comment">//字符串要初始化，不然有乱码</span></div><div class="line">    <span class="keyword">char</span> c[<span class="number">2</span>]= &#123;<span class="string">'a'</span>,<span class="string">'\0'</span>&#125;;</div><div class="line">    c[<span class="number">0</span>]=getNextChar();</div><div class="line">LS0:</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'a'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'z'</span>)<span class="keyword">goto</span> LS1;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'A'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'Z'</span>)<span class="keyword">goto</span> LS1;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'0'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'9'</span>)<span class="keyword">goto</span> LS2;</div><div class="line">    <span class="keyword">int</span> indexofsym;</div><div class="line">    <span class="keyword">for</span>(indexofsym=<span class="number">0</span>; indexofsym&lt;<span class="number">12</span>; indexofsym++) &#123;</div><div class="line">        <span class="keyword">if</span>(c[<span class="number">0</span>]==symbols[indexofsym]) &#123;</div><div class="line">            <span class="keyword">goto</span> LS3;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'.'</span>)<span class="keyword">goto</span> LS4;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'&#123;'</span>)<span class="keyword">goto</span> LS5;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">':'</span>)<span class="keyword">goto</span> LS6;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'\''</span>)<span class="keyword">goto</span> LS7;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'\n'</span>)<span class="keyword">goto</span> LS8;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==EOF)<span class="keyword">goto</span> LS9;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'\t'</span>||c[<span class="number">0</span>]==<span class="string">' '</span>)<span class="keyword">goto</span> LS10;</div><div class="line">    <span class="keyword">goto</span> OTHER;</div><div class="line">LS1:</div><div class="line">    <span class="built_in">strcat</span>(str,c);</div><div class="line">    c[<span class="number">0</span>]=getNextChar();</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'a'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'z'</span>)<span class="keyword">goto</span> LS1;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'A'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'Z'</span>)<span class="keyword">goto</span> LS1;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'0'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'9'</span>)<span class="keyword">goto</span> LS1;</div><div class="line">    ungetNextChar();</div><div class="line">    <span class="keyword">int</span> nres;</div><div class="line">    <span class="keyword">if</span>(nres=reservedLookup(str),nres!=<span class="number">-1</span>) &#123;</div><div class="line">        t.id=RES;</div><div class="line">        t.ptr=nres;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        t.id=ID;</div><div class="line">        t.ptr=addIDTable(str);</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">LS2:</div><div class="line">    <span class="built_in">strcat</span>(str,c);</div><div class="line">    c[<span class="number">0</span>]=getNextChar();</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'0'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'9'</span>)<span class="keyword">goto</span> LS2;</div><div class="line">    ungetNextChar();</div><div class="line">    t.id=NUM;</div><div class="line">    t.ptr=addNUMTable(str_to_num(str));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">LS3:</div><div class="line">    t.ptr=symbols_n[indexofsym];</div><div class="line">    t.id=SYM;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">LS4:</div><div class="line">    <span class="built_in">strcat</span>(str,c);</div><div class="line">    c[<span class="number">0</span>]=getNextChar();</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'.'</span>) &#123;</div><div class="line">        t.id=SYM;</div><div class="line">        t.ptr=INDEX;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        t.id=SYM;</div><div class="line">        t.ptr=POINT;</div><div class="line">        ungetNextChar();</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">LS5:</div><div class="line">    <span class="keyword">while</span>(c[<span class="number">0</span>]=getNextChar(),c[<span class="number">0</span>]!=EOF&amp;&amp;c[<span class="number">0</span>]!=<span class="string">'&#125;'</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'\n'</span>||c[<span class="number">0</span>]==<span class="string">'\r'</span>)num_of_lines++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'&#125;'</span>) &#123;</div><div class="line">        c[<span class="number">0</span>]=getNextChar();</div><div class="line">        <span class="keyword">goto</span> LS0;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        handle_error(COMMENT_ERROR,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">LS6:</div><div class="line">    <span class="built_in">strcat</span>(str,c);</div><div class="line">    c[<span class="number">0</span>]=getNextChar();</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'='</span>) &#123;</div><div class="line">        t.id=SYM;</div><div class="line">        t.ptr=ASSI;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        handle_error(SYM_ERROR,<span class="string">"符号为 \':\'"</span>);</div><div class="line">    &#125;</div><div class="line">LS7:</div><div class="line">    <span class="keyword">while</span>(c[<span class="number">0</span>]=getNextChar(),c[<span class="number">0</span>]!=EOF&amp;&amp;c[<span class="number">0</span>]!=<span class="string">'\''</span>) &#123;</div><div class="line">        <span class="built_in">strcat</span>(str,c);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'\''</span>) &#123;</div><div class="line">        t.id=STR;</div><div class="line">        t.ptr=addSTRTable(str);</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        handle_error(STR_ERROR,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">LS8:</div><div class="line">    t.id=<span class="number">-1</span>;</div><div class="line">    num_of_lines++;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">LS9:</div><div class="line">    t.id=SYM;</div><div class="line">    t.ptr=EOFF;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">LS10:</div><div class="line">    t.id=<span class="number">-1</span>;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">OTHER:</div><div class="line">    handle_error(NOT_REC_SYMBOL,c);</div><div class="line">    t.id=<span class="number">-1</span>;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_token</span><span class="params">(Token t)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(t.id==STR) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"&lt;%d %s %s&gt; \n"</span>,t.linenum,<span class="string">"STR"</span>,STR_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==NUM) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"&lt;%d %s %d&gt; \n"</span>,t.linenum,<span class="string">"NUM"</span>,NUM_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==ID) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"&lt;%d %s %s&gt; \n"</span>,t.linenum,<span class="string">"ID"</span>,ID_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==RES) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"&lt;%d %s %s&gt; \n"</span>,t.linenum,<span class="string">"RES"</span>,reserved_words[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==SYM) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"&lt;%d %s %s&gt; \n"</span>,t.linenum,<span class="string">"SYM"</span>,symbol_table[t.ptr<span class="number">-100</span>]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"><span class="built_in">vector</span>&lt;Token&gt;*  getTokenlist(<span class="keyword">const</span> <span class="keyword">char</span>* filename) &#123;</div><div class="line">    tokens-&gt;clear();</div><div class="line">    file=fopen(filename,<span class="string">"r"</span>);</div><div class="line">    Token temp;</div><div class="line">    <span class="keyword">while</span>(temp=scan(),!(temp.id==SYM&amp;&amp;temp.ptr==EOFF)) &#123;</div><div class="line">        <span class="keyword">if</span>(temp.id!=<span class="number">-1</span>) &#123;</div><div class="line">            tokens-&gt;push_back(temp);</div><div class="line">            <span class="keyword">if</span>(temp.id==RES&amp;&amp;<span class="built_in">strcmp</span>(<span class="string">"end"</span>,reserved_words[temp.ptr])==<span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">char</span> c;</div><div class="line">                <span class="keyword">if</span>(c=getNextChar(),c==<span class="string">'.'</span>) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    ungetNextChar();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    fclose(file);</div><div class="line">    <span class="keyword">return</span> tokens;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_Token_list</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> len=tokens-&gt;size();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        show_token(tokens-&gt;at(i));</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">write_token</span><span class="params">(FILE* file,Token t)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(t.id==STR) &#123;</div><div class="line">        <span class="built_in">fprintf</span>(file,<span class="string">"&lt;%s %s&gt; \n"</span>,<span class="string">"STR"</span>,STR_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==NUM) &#123;</div><div class="line">        <span class="built_in">fprintf</span>(file,<span class="string">"&lt;%s %d&gt; \n"</span>,<span class="string">"NUM"</span>,NUM_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==ID) &#123;</div><div class="line">        <span class="built_in">fprintf</span>(file,<span class="string">"&lt;%s %s&gt; \n"</span>,<span class="string">"ID"</span>,ID_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==RES) &#123;</div><div class="line">        <span class="built_in">fprintf</span>(file,<span class="string">"&lt;%s %s&gt; \n"</span>,<span class="string">"RES"</span>,reserved_words[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==SYM) &#123;</div><div class="line">        <span class="built_in">fprintf</span>(file,<span class="string">"&lt;%s %s&gt; \n"</span>,<span class="string">"SYM"</span>,symbol_table[t.ptr<span class="number">-100</span>]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_Token_list</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* filename)</span> </span>&#123;</div><div class="line">    FILE* f=fopen(filename,<span class="string">"w"</span>);</div><div class="line">    <span class="keyword">int</span> len=tokens-&gt;size();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        write_token(f,tokens-&gt;at(i));</div><div class="line">    &#125;</div><div class="line">    fclose(f);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/***************************************************************************************/</span></div><div class="line"><span class="comment">/*****************                   语法分析                          *****************/</span></div><div class="line"><span class="comment">/***************************************************************************************/</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">syntaxError</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* message)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(message,<span class="string">"outofrange"</span>)==<span class="number">0</span>) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"出现越界错误"</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"   Token_n:%d    tokens-&gt;size:%d\n"</span>,Token_n,tokens-&gt;size());</div><div class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"行号：%d    %s"</span>,tokens-&gt;at(Token_n).linenum,message);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"当前token："</span>);</div><div class="line">    show_token(tokens-&gt;at(Token_n));</div><div class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MatchRES</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* expected)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id,ptr=tokens-&gt;at(Token_n).ptr;</div><div class="line">    <span class="keyword">if</span>(id==RES&amp;&amp;<span class="built_in">strcmp</span>(expected,reserved_words[ptr])==<span class="number">0</span>) &#123;</div><div class="line">        Node*t =<span class="keyword">new</span> Node(expected);</div><div class="line">        Token_n++;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span>* message=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">100</span>];</div><div class="line">    <span class="built_in">strcpy</span>(message,<span class="string">"match res error.\nexpect: "</span>);</div><div class="line">    <span class="built_in">strcat</span>(message,expected);</div><div class="line">    <span class="built_in">strcat</span>(message,<span class="string">"\n"</span>);</div><div class="line">    syntaxError(message);</div><div class="line">    <span class="keyword">delete</span> message;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MatchNUM</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==NUM) &#123;</div><div class="line">        Node* t= <span class="keyword">new</span> Node(<span class="string">"NUM"</span>);</div><div class="line">        Token_n++;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"match num error\n"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MatchSTR</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==STR) &#123;</div><div class="line">        Node* t= <span class="keyword">new</span> Node(<span class="string">"STR"</span>);</div><div class="line">        Token_n++;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"match str error\n"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MatchID</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==ID) &#123;</div><div class="line">        Node* t =<span class="keyword">new</span> Node(<span class="string">"ID"</span>);</div><div class="line">        Token_n++;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"match id error\n"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MatchSYM</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> expected)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id,ptr=tokens-&gt;at(Token_n).ptr;</div><div class="line">    <span class="keyword">if</span>(id==SYM&amp;&amp;ptr==expected) &#123;</div><div class="line">        Node* t =<span class="keyword">new</span> Node(symbol_table[ptr<span class="number">-100</span>]);</div><div class="line">        Token_n++;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span>* message=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">100</span>];</div><div class="line">    <span class="built_in">strcpy</span>(message,<span class="string">"match symbol error.\nexpect: "</span>);</div><div class="line">    <span class="built_in">strcat</span>(message,symbol_table[expected<span class="number">-100</span>]);</div><div class="line">    <span class="built_in">strcat</span>(message,<span class="string">"\n"</span>);</div><div class="line">    syntaxError(message);</div><div class="line">    <span class="keyword">delete</span> message;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isRES</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* res)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id,ptr=tokens-&gt;at(Token_n).ptr;</div><div class="line">    <span class="keyword">if</span>(id==RES&amp;&amp;<span class="built_in">strcmp</span>(reserved_words[ptr],res)==<span class="number">0</span>)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isSYM</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> res)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id,ptr=tokens-&gt;at(Token_n).ptr;</div><div class="line">    <span class="keyword">if</span>(id==SYM&amp;&amp;ptr==res)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isID</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==ID)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isNUM</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==NUM)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isSTR</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==STR)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Program</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Program"</span>);</div><div class="line">    add(t-&gt;children,ProgramHead());</div><div class="line">    add(t-&gt;children,DeclarePart());</div><div class="line">    add(t-&gt;children,ProgramBody());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProgramHead</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ProgramHead"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"program"</span>));</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">Node* <span class="title">DeclarePart</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"DeclarePart"</span>);</div><div class="line">    add(t-&gt;children,TypeDeclaration());</div><div class="line">    add(t-&gt;children,VarDeclaration());</div><div class="line">    add(t-&gt;children,ProcDeclaration());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeDec</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"TypeDec"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"type"</span>));</div><div class="line">    add(t-&gt;children,TypeDecList());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeDeclaration</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"type"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"TypeDeclaration"</span>);</div><div class="line">        add(t-&gt;children,TypeDec());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeDecList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"TypeDecList"</span>);</div><div class="line">    add(t-&gt;children,TypeId());</div><div class="line">    add(t-&gt;children,MatchSYM(EQU));</div><div class="line">    add(t-&gt;children,TypeName());</div><div class="line">    add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">    add(t-&gt;children,TypeDecMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeDecMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isID()) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"TypeDecMore"</span>);</div><div class="line">        add(t-&gt;children,TypeDecList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeId</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"TypeId"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeName</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"TypeName"</span>);</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)) &#123;</div><div class="line">        add(t-&gt;children,BaseType());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"array"</span>)||isRES(<span class="string">"record"</span>)) &#123;</div><div class="line">        add(t-&gt;children,StructureType());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">BaseType</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"BaseType"</span>);</div><div class="line">        add(t-&gt;children,MatchRES(<span class="string">"integer"</span>));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"char"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"BaseType"</span>);</div><div class="line">        add(t-&gt;children,MatchRES(<span class="string">"char"</span>));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"not a base type\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">StructureType</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"array"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"StructureType"</span>);</div><div class="line">        add(t-&gt;children,ArrayType());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"record"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"StructureType"</span>);</div><div class="line">        add(t-&gt;children,RecType());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ArrayType</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ArrayType"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"array"</span>));</div><div class="line">    add(t-&gt;children,MatchSYM(LSQUBRACK));</div><div class="line">    add(t-&gt;children,MatchNUM());</div><div class="line">    add(t-&gt;children,MatchSYM(INDEX));</div><div class="line">    add(t-&gt;children,MatchNUM());</div><div class="line">    add(t-&gt;children,MatchSYM(RSQUBRACK));</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"of"</span>));</div><div class="line">    add(t-&gt;children,BaseType());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">RecType</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"RecType"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"record"</span>));</div><div class="line">    add(t-&gt;children,FieldDecList());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"end"</span>));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FieldDecList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"FieldDecList"</span>);</div><div class="line">        add(t-&gt;children,BaseType());</div><div class="line">        add(t-&gt;children,IdList());</div><div class="line">        add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">        add(t-&gt;children,FieldDecMore());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"array"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"FieldDecList"</span>);</div><div class="line">        add(t-&gt;children,ArrayType());</div><div class="line">        add(t-&gt;children,IdList());</div><div class="line">        add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">        add(t-&gt;children,FieldDecMore());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"field declare list error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FieldDecMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)||isRES(<span class="string">"array"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"FieldDecMore"</span>);</div><div class="line">        add(t-&gt;children,FieldDecList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">IdList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"IdList"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,IdMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">IdMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(COM)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"IdMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(COM));</div><div class="line">        add(t-&gt;children,IdList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarDec</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"VarDec"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"var"</span>));</div><div class="line">    add(t-&gt;children,VarDecList());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarDeclaration</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"var"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"VarDeclaration"</span>);</div><div class="line">        add(t-&gt;children,VarDec());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarDecList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"VarDecList"</span>);</div><div class="line">    add(t-&gt;children,TypeName());</div><div class="line">    add(t-&gt;children,VarIdList());</div><div class="line">    add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">    add(t-&gt;children,VarDecMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarDecMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)||isRES(<span class="string">"array"</span>)||isRES(<span class="string">"record"</span>)||isID()) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"VarDecMore"</span>);</div><div class="line">        add(t-&gt;children,VarDecList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarIdList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"VarIdList"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,VarIdMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarIdMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(COM)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"VarIdMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(COM));</div><div class="line">        add(t-&gt;children,VarIdList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProcDec</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ProcDec"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"procedure"</span>));</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,MatchSYM(LBRACK));</div><div class="line">    add(t-&gt;children,ParamList());</div><div class="line">    add(t-&gt;children,MatchSYM(RBRACK));</div><div class="line">    add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">    add(t-&gt;children,DeclarePart());</div><div class="line">    add(t-&gt;children,ProcBody());</div><div class="line">    add(t-&gt;children,ProcDeclaration());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProcDeclaration</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"procedure"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"ProcDeclaration"</span>);</div><div class="line">        add(t-&gt;children,ProcDec());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ParamList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)||isRES(<span class="string">"array"</span>)||isRES(<span class="string">"record"</span>)||isID()||isRES(<span class="string">"var"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"ParamList"</span>);</div><div class="line">        add(t-&gt;children,ParamDecList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ParamDecList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ParamDecList"</span>);</div><div class="line">    add(t-&gt;children,Param());</div><div class="line">    add(t-&gt;children,ParamMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ParamMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(SEMI)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"ParamMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">        add(t-&gt;children,ParamDecList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Param</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)||isRES(<span class="string">"array"</span>)||isRES(<span class="string">"record"</span>)||isID()) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"Param"</span>);</div><div class="line">        add(t-&gt;children,TypeName());</div><div class="line">        add(t-&gt;children,FormList());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"var"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"Param"</span>);</div><div class="line">        add(t-&gt;children,MatchRES(<span class="string">"var"</span>));</div><div class="line">        add(t-&gt;children,TypeName());</div><div class="line">        add(t-&gt;children,FormList());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"param error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FormList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"FormList"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,FidMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FidMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(COM)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"FidMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(COM));</div><div class="line">        add(t-&gt;children,FormList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProcDecPart</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ProcDecPart"</span>);</div><div class="line">    add(t-&gt;children,DeclarePart());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProcBody</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ProcBody"</span>);</div><div class="line">    add(t-&gt;children,ProgramBody());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProgramBody</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ProgramBody"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"begin"</span>));</div><div class="line">    add(t-&gt;children,StmList());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"end"</span>));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">StmList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"StmList"</span>);</div><div class="line">    add(t-&gt;children,Stm());</div><div class="line">    add(t-&gt;children,StmMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">StmMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(SEMI)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"StmMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">        add(t-&gt;children,StmList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Stm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Stm"</span>);</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"if"</span>)) &#123;</div><div class="line">        add(t-&gt;children,ConditionalStm());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"while"</span>)) &#123;</div><div class="line">        add(t-&gt;children,LoopStm());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"read"</span>)) &#123;</div><div class="line">        add(t-&gt;children,InputStm());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"write"</span>)) &#123;</div><div class="line">        add(t-&gt;children,OutputStm());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"return"</span>)) &#123;</div><div class="line">        add(t-&gt;children,ReturnStm());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isID()) &#123;</div><div class="line">        add(t-&gt;children,MatchID());</div><div class="line">        add(t-&gt;children,AssCall());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">delete</span> t;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">AssCall</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(LSQUBRACK)||isSYM(POINT)||isSYM(ASSI)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"AssCall"</span>);</div><div class="line">        add(t-&gt;children,AssignmentRest());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(LBRACK)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"AssCall"</span>);</div><div class="line">        add(t-&gt;children,CallStmRest());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"ass call error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">AssignmentRest</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"AssignmentRest"</span>);</div><div class="line">    <span class="keyword">if</span>(isSYM(LSQUBRACK)||isSYM(POINT)) &#123;</div><div class="line">        add(t-&gt;children,VariMore());</div><div class="line">    &#125;</div><div class="line">    add(t-&gt;children,MatchSYM(ASSI));</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ConditionalStm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ConditionalStm"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"if"</span>));</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    <span class="keyword">if</span>(isSYM(LT))add(t-&gt;children,MatchSYM(LT));</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(isSYM(EQU))add(t-&gt;children,MatchSYM(EQU));</div><div class="line">    <span class="keyword">else</span> syntaxError(<span class="string">"condition error\n"</span>);</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"then"</span>));</div><div class="line">    add(t-&gt;children,StmList());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"else"</span>));</div><div class="line">    add(t-&gt;children,StmList());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"fi"</span>));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">LoopStm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"LoopStm"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"while"</span>));</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    <span class="keyword">if</span>(isSYM(LT))add(t-&gt;children,MatchSYM(LT));</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(isSYM(EQU))add(t-&gt;children,MatchSYM(EQU));</div><div class="line">    <span class="keyword">else</span> syntaxError(<span class="string">"condition error\n"</span>);</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"do"</span>));</div><div class="line">    add(t-&gt;children,StmList());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"endwh"</span>));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">InputStm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"InputStm"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"read"</span>));</div><div class="line">    add(t-&gt;children,MatchSYM(LBRACK));</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,MatchSYM(RBRACK));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">OutputStm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"OutputStm"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"write"</span>));</div><div class="line">    add(t-&gt;children,MatchSYM(LBRACK));</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    add(t-&gt;children,MatchSYM(RBRACK));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ReturnStm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ReturnStm"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"return"</span>));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">CallStmRest</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"CallStmRest"</span>);</div><div class="line">    add(t-&gt;children,MatchSYM(LBRACK));</div><div class="line">    add(t-&gt;children,ActParamList());</div><div class="line">    add(t-&gt;children,MatchSYM(RBRACK));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ActParamList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(LBRACK)||isNUM()||isID()) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"ActParamList"</span>);</div><div class="line">        add(t-&gt;children,Exp());</div><div class="line">        add(t-&gt;children,ActParamMore());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ActParamMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(COM)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"ActParamMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(COM));</div><div class="line">        add(t-&gt;children,ActParamList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Exp</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Exp"</span>);</div><div class="line">    add(t-&gt;children,Term());</div><div class="line">    add(t-&gt;children,OtherTerm());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">OtherTerm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(PLUS)||isSYM(SUB)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"OtherTerm"</span>);</div><div class="line">        add(t-&gt;children,AddOp());</div><div class="line">        add(t-&gt;children,Exp());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Term</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Term"</span>);</div><div class="line">    add(t-&gt;children,Factor());</div><div class="line">    add(t-&gt;children,OtherFactor());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">OtherFactor</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(MUL)||isSYM(DIV)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"OtherFactor"</span>);</div><div class="line">        add(t-&gt;children,MultOp());</div><div class="line">        add(t-&gt;children,Term());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Factor</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Factor"</span>);</div><div class="line">    <span class="keyword">if</span>(isNUM()) &#123;</div><div class="line">        add(t-&gt;children,MatchNUM());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSTR()) &#123;</div><div class="line">        add(t-&gt;children,MatchSTR());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(LBRACK)) &#123;</div><div class="line">        add(t-&gt;children,MatchSYM(LBRACK));</div><div class="line">        add(t-&gt;children,Exp());</div><div class="line">        add(t-&gt;children,MatchSYM(RBRACK));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isID()) &#123;</div><div class="line">        add(t-&gt;children,Variable());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">delete</span> t;</div><div class="line">    syntaxError(<span class="string">"factor error\n"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Variable</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Variable"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,VariMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VariMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(LSQUBRACK)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"VariMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(LSQUBRACK));</div><div class="line">        add(t-&gt;children,Exp());</div><div class="line">        add(t-&gt;children,MatchSYM(RSQUBRACK));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(POINT)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"VariMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(POINT));</div><div class="line">        add(t-&gt;children,FieldVar());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FieldVar</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"FieldVar"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,FieldVarMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FieldVarMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(LSQUBRACK)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"FieldVarMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(LSQUBRACK));</div><div class="line">        add(t-&gt;children,Exp());</div><div class="line">        add(t-&gt;children,MatchSYM(RSQUBRACK));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">CmpOp</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(LT)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"CmpOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(LT));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(EQU)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"CmpOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(EQU));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"cmpop error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">AddOp</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(PLUS)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"AddOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(PLUS));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(SUB)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"AddOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(SUB));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"cmpop error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MultOp</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(MUL)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"MultOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(MUL));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(DIV)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"MultOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(DIV));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"cmpop error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Parse</span><span class="params">()</span> </span>&#123;</div><div class="line">    num_of_lines=<span class="number">1</span>;</div><div class="line">    Node* root=Program();</div><div class="line">    <span class="keyword">return</span> root;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_tree</span><span class="params">(Node* root,<span class="keyword">int</span> depth,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;* v,<span class="keyword">bool</span> islast)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(root==<span class="literal">NULL</span>)<span class="keyword">return</span> ;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;depth; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(v-&gt;at(i)==<span class="number">1</span>)<span class="built_in">printf</span>(<span class="string">" │"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"  "</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(islast) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">" └─%s"</span>,root-&gt;desc);</div><div class="line">        v-&gt;at(depth)=<span class="number">0</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">" ├─%s"</span>,root-&gt;desc);</div><div class="line">    <span class="keyword">if</span>(depth+<span class="number">1</span>==(<span class="keyword">int</span>)v-&gt;size())v-&gt;push_back(<span class="number">1</span>);</div><div class="line">    v-&gt;at(depth+<span class="number">1</span>)=<span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> len=root-&gt;children.size();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(i==len<span class="number">-1</span>)show_tree(root-&gt;children.at(i),depth+<span class="number">1</span>,v,<span class="literal">true</span>);</div><div class="line">        <span class="keyword">else</span> show_tree(root-&gt;children.at(i),depth+<span class="number">1</span>,v,<span class="literal">false</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    tokens=<span class="keyword">new</span> <span class="built_in">vector</span>&lt;Token&gt;();</div><div class="line">    getTokenlist(<span class="string">"cs1.txt"</span>);</div><div class="line">    save_Token_list(<span class="string">"tokens.txt"</span>);</div><div class="line">    <span class="comment">//打印显示</span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"TOKENS:\n\n"</span>);</div><div class="line">    show_Token_list();</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"\n\n\n\n语法树:\n\n"</span>);</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;* v=<span class="keyword">new</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;();</div><div class="line">    v-&gt;push_back(<span class="number">0</span>);</div><div class="line">    show_tree(Parse(),<span class="number">0</span>,v,<span class="literal">true</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>cs1.txt<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">&#123;冒泡排序&#125;</div><div class="line">&#123;输入m,表示要排序的数的个数；接着输入m个整数；</div><div class="line"> 输出从小到大排序后的结果&#125;</div><div class="line"></div><div class="line">program  p</div><div class="line">var  <span class="built_in">integer</span>  i,j,num;</div><div class="line">      array[1..20] of  <span class="built_in">integer</span> a;</div><div class="line"></div><div class="line">procedure  q(<span class="built_in">integer</span> num);</div><div class="line">var  <span class="built_in">integer</span> i,j,k;</div><div class="line">     <span class="built_in">integer</span> t;</div><div class="line">begin</div><div class="line">  i:=<span class="string">'lklklk'</span>;</div><div class="line">  j:=1;</div><div class="line">  <span class="keyword">while</span> i &lt; num <span class="keyword">do</span></div><div class="line">     j:=num-i+1;</div><div class="line">     k:=1;</div><div class="line">     <span class="keyword">while</span> k&lt;j  <span class="keyword">do</span></div><div class="line">         <span class="keyword">if</span> a[k+1] &lt; a[k]</div><div class="line">         <span class="keyword">then</span>  t:=a[k];</div><div class="line">           a[k]:=a[k+1];</div><div class="line">           a[k+1]:=t</div><div class="line">         <span class="keyword">else</span>  t:=0</div><div class="line">         <span class="keyword">fi</span>;</div><div class="line">     k:=k+1</div><div class="line">     endwh;</div><div class="line">  i:=i+1</div><div class="line">  endwh</div><div class="line">end</div><div class="line"></div><div class="line">begin</div><div class="line">   <span class="built_in">read</span>(num);</div><div class="line">   i:=1;</div><div class="line">   <span class="keyword">while</span> i&lt;(num+1)  <span class="keyword">do</span></div><div class="line">     <span class="built_in">read</span>(j);</div><div class="line">     a[i]:=j;</div><div class="line">     i:=i+1</div><div class="line">   endwh;</div><div class="line">   q(num);</div><div class="line">   i:=1;</div><div class="line">   <span class="keyword">while</span>  i&lt;(num+1) <span class="keyword">do</span></div><div class="line">       write(a[i]);</div><div class="line">       i:=i+1</div><div class="line">   endwh</div><div class="line">end.</div></pre></td></tr></table></figure></p>
<ul>
<li>代码写于大三下6月份，编译原理课程设计</li>
<li>随笔写于2016.7.13</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[聊天室（Java实现）]]></title>
      <url>http://maxuewei2.git.io/2016/07/03/ChatRoom/</url>
      <content type="html"><![CDATA[<p>&ensp;<br>&ensp;<br>&ensp;</p>
<h2 id="功能："><a href="#功能：" class="headerlink" title="功能："></a>功能：</h2><h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p>　　　　若用户账号不存在，弹出错误</p>
<p>　　　　若用户密码错误，弹出错误</p>
<p>　　　　若用户账号已在线，弹出错误<br><a id="more"></a><br><img src="/imgs/chatroom1.png" alt="denglu1"><br><img src="/imgs/chatroom2.png" alt="denglu1"><br><img src="/imgs/chatroom3.png" alt="denglu1"></p>
<p> 　　　　　</p>
<p>　　　　　　</p>
<h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><p>　　　　若用户已注册，弹出错误<br><img src="/imgs/chatroom4.png" alt="denglu1"><br><img src="/imgs/chatroom5.png" alt="denglu1">
 　　　　　　　　</p>
<p>　　　　　　　　</p>
<h3 id="聊天室"><a href="#聊天室" class="headerlink" title="聊天室"></a>聊天室</h3><p>　　　　多人聊天，类似QQ里的群。</p>
<p>　　　　点击右侧的在线用户，可进行一对一聊天。<br><img src="/imgs/chatroom6.png" alt="denglu1"></p>
<h3 id="一对一聊天"><a href="#一对一聊天" class="headerlink" title="一对一聊天"></a>一对一聊天</h3><p>　　　　在聊天室中点击在线用户可进入此窗口。</p>
<p>　　　　发送消息后，对方会收到消息，并弹出一对一聊天窗口 。<br><img src="/imgs/chatroom7.png" alt="denglu1">　　　　　　
　　　　　　</p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h2 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h2><p>　　　　服务端的IP和端口固定。（代码中使用127.0.0.1作为服务端的IP）</p>
<p>　　　　客户端通过该IP和端口访问服务器。</p>
<p>　　　　客户端向服务器发送消息，服务器根据消息做出不同的处理，并可能向其他客户端发送消息。</p>
<p>　　　　每个客户端都有一个客户端server进程，以接收服务端发来的消息。</p>
<p>　　　　初始化客户端时，启动客户端server进程，监听任意一个可用端口。用户登录时，将本地账户、密码、本地的server进程端口发给服务端，服务端检验用户合法性，若合　法，则更新该账户的IP地址和端口。以后服务端即可向该IP发送消息。</p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><p> 　　项目工程结构：</p>
<p>　　　　<br><img src="/imgs/chatroom8.png" alt="denglu1">　　　　　　</p>
<p><strong>Server</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomutil;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.PrintWriter;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</div><div class="line">    <span class="keyword">protected</span> ServerSocket sSocket;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Server</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">listen</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            Socket ots = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                ots = sSocket.accept();</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                ChatRoomUtil.showErrorBox(<span class="string">"服务器Accept错误"</span>);</div><div class="line">                System.exit(-<span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">            Thread hThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> handleThread(ots));</div><div class="line">            hThread.start();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 处理消息的进程 的内部类</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">handleThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">        Socket ots;</div><div class="line">        handleThread(Socket ots) &#123;</div><div class="line">            <span class="keyword">this</span>.ots = ots;</div><div class="line">        &#125;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            handleMessage(ots);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">handle</span><span class="params">(Socket ots,String rMessage)</span></span>;<span class="comment">//处理函数，输入收到的消息，返回要发送的消息</span></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">handleMessage</span><span class="params">(Socket ots)</span> </span>&#123;</div><div class="line">        StringBuffer buffer=<span class="keyword">new</span> StringBuffer();</div><div class="line">        BufferedReader reader=ChatRoomUtil.getMsgFromSocket(ots,buffer);<span class="comment">//获取消息</span></div><div class="line">        String rMessage = buffer.toString();</div><div class="line">        String message=handle(ots,rMessage);<span class="comment">//处理消息</span></div><div class="line">        PrintWriter writer=ChatRoomUtil.putMesgToSocket(ots, message);<span class="comment">//发送消息</span></div><div class="line">        ChatRoomUtil.closeSocket(ots,reader,writer);<span class="comment">//关闭</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ChatRoomUtil</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomutil;</div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStreamReader;</div><div class="line"><span class="keyword">import</span> java.io.PrintWriter;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatRoomUtil</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">showErrorBox</span><span class="params">(String message)</span> </span>&#123;<span class="comment">//显示错误信息对话框</span></div><div class="line">        JOptionPane.showMessageDialog(<span class="keyword">null</span>, message, <span class="string">"错误"</span>,</div><div class="line">                JOptionPane.ERROR_MESSAGE);</div><div class="line">        <span class="keyword">return</span> message;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//获取消息</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BufferedReader <span class="title">getMsgFromSocket</span><span class="params">(Socket socket,StringBuffer buffer)</span></span>&#123;</div><div class="line">        BufferedReader reader = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader = <span class="keyword">new</span> BufferedReader(</div><div class="line">                    <span class="keyword">new</span> InputStreamReader(socket.getInputStream()));</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"获取Socket输入流错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            String line = <span class="string">""</span>;</div><div class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</div><div class="line">                buffer.append(line + <span class="string">"\n"</span>);</div><div class="line">            &#125;</div><div class="line">            buffer.deleteCharAt(buffer.length()-<span class="number">1</span>);<span class="comment">//去掉最后一个回车符</span></div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"读取Socket输入流错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            socket.shutdownInput();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"关闭Socket输入时发生错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> reader;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//发送消息</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PrintWriter <span class="title">putMesgToSocket</span><span class="params">(Socket socket,String message)</span></span>&#123;</div><div class="line">        PrintWriter writer = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            writer = <span class="keyword">new</span> PrintWriter(socket.getOutputStream());</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"获取Socket输出流错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        writer.println(message);</div><div class="line">        writer.flush();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            socket.shutdownOutput();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e1) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"关闭Socket输出时发生错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> writer;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//关闭socket、输入流、输出流</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeSocket</span><span class="params">(Socket socket,BufferedReader reader,PrintWriter writer )</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"关闭Scoket输入流时发生错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        writer.close();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            socket.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"关闭Scoket输出流时发生错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ServerServer</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomserver;</div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.FileReader;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.RandomAccessFile;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> java.util.Enumeration;</div><div class="line"><span class="keyword">import</span> java.util.Hashtable;</div><div class="line"><span class="keyword">import</span> chatroomsend.Send;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"><span class="keyword">import</span> chatroomutil.Server;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerServer</span> <span class="keyword">extends</span> <span class="title">Server</span> </span>&#123;</div><div class="line">    Hashtable&lt;String, User&gt; onlineTable = <span class="keyword">new</span> Hashtable&lt;String, User&gt;();<span class="comment">// 在线用户集合</span></div><div class="line">    Hashtable&lt;String, User&gt; offlineTable = <span class="keyword">new</span> Hashtable&lt;String, User&gt;();<span class="comment">// 离线用户集合</span></div><div class="line">    <span class="comment">// 用户内部类</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">        String id;</div><div class="line">        String pwd;</div><div class="line">        String IP;</div><div class="line">        <span class="keyword">int</span> port;</div><div class="line">        User(String id, String pwd) &#123;</div><div class="line">            <span class="keyword">this</span>.id = id;</div><div class="line">            <span class="keyword">this</span>.pwd = pwd;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 发送进程内部类</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">sendThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">        String mesg;</div><div class="line">        String IP;</div><div class="line">        <span class="keyword">int</span> port;</div><div class="line">        sendThread(String IP, <span class="keyword">int</span> port, String mesg) &#123;</div><div class="line">            <span class="keyword">this</span>.IP = IP;</div><div class="line">            <span class="keyword">this</span>.port = port;</div><div class="line">            <span class="keyword">this</span>.mesg = mesg;</div><div class="line">        &#125;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">            sendClient.connect(IP, port, <span class="number">1000</span>);</div><div class="line">            sendClient.send(mesg);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServerServer</span><span class="params">(<span class="keyword">int</span> port)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        init(port);</div><div class="line">        initUsers();</div><div class="line">        listen();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> port)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            sSocket = <span class="keyword">new</span> ServerSocket(port);<span class="comment">//绑定指定端口</span></div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"服务器初始化失败，无法绑定端口。"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> port;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">initUsers</span><span class="params">()</span> </span>&#123;<span class="comment">//读取Users文件，初始化offlineTable</span></div><div class="line">        BufferedReader reader = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">"Users.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e1) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"无法找到User文件"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        String line;</div><div class="line">        String[] fa;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</div><div class="line">                fa = line.split(<span class="string">":"</span>, <span class="number">2</span>);</div><div class="line">                User f = <span class="keyword">new</span> User(fa[<span class="number">0</span>], fa[<span class="number">1</span>]);</div><div class="line">                offlineTable.put(fa[<span class="number">0</span>], f);</div><div class="line">            &#125;</div><div class="line">            reader.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"读取User文件错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">saveNewUser</span><span class="params">(String id, String pwd)</span> </span>&#123;<span class="comment">//将新用户写入Users文件最后</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            RandomAccessFile file = <span class="keyword">new</span> RandomAccessFile(<span class="string">"Users.txt"</span>, <span class="string">"rw"</span>);</div><div class="line">            file.seek(file.length());</div><div class="line">            file.writeBytes(id + <span class="string">":"</span> + pwd + <span class="string">"\r\n"</span>);</div><div class="line">            file.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"写入User文件错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"写入User文件错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function">String <span class="title">loginCheck</span><span class="params">(String id, String pwd, String IP, <span class="keyword">int</span> port)</span> </span>&#123;<span class="comment">//检查登录用户的合法性</span></div><div class="line">        System.out.println(<span class="string">"logi check"</span>);</div><div class="line">        <span class="keyword">if</span> (onlineTable.containsKey(id))</div><div class="line">            <span class="keyword">return</span> <span class="string">"alreadyonline"</span>;<span class="comment">//该用户已在线</span></div><div class="line">        User f = offlineTable.get(id);</div><div class="line">        <span class="keyword">if</span> (f == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="string">"nothisid"</span>;<span class="comment">//无此用户</span></div><div class="line">        <span class="keyword">if</span> (f.pwd.compareTo(pwd) == <span class="number">0</span>) &#123;</div><div class="line">            oneUserOnline(id, IP, port);</div><div class="line">            sendOnlinesToNewOnlineUser(id, IP, port);</div><div class="line">            sendNewOnlineUserToOnlines(id);</div><div class="line">            <span class="keyword">return</span> <span class="string">"yes"</span>;<span class="comment">//合法</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"wrong"</span>;<span class="comment">//密码错误</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">oneUserOnline</span><span class="params">(String id, String IP, <span class="keyword">int</span> port)</span> </span>&#123;<span class="comment">//一个新用户上线</span></div><div class="line">        User f = offlineTable.get(id);</div><div class="line">        offlineTable.remove(id);</div><div class="line">        onlineTable.put(id, f);</div><div class="line">        f.IP = IP;</div><div class="line">        f.port = port;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sendNewOnlineUserToOnlines</span><span class="params">(String id)</span> </span>&#123;<span class="comment">//给所有在线用户发送新上线的用户的id</span></div><div class="line">        Enumeration&lt;User&gt; fs = onlineTable.elements();</div><div class="line">        <span class="keyword">while</span> (fs.hasMoreElements()) &#123;</div><div class="line">            User f = fs.nextElement();</div><div class="line">            <span class="keyword">if</span> (f.id.compareTo(id) != <span class="number">0</span>) &#123;</div><div class="line">                Thread hThread = <span class="keyword">new</span> Thread(</div><div class="line">                        <span class="keyword">new</span> sendThread(f.IP, f.port, <span class="string">"newf"</span> + id));</div><div class="line">                hThread.start();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sendMesg</span><span class="params">(String mesg)</span> </span>&#123;<span class="comment">//向所有在线用户转发一条消息</span></div><div class="line">        Enumeration&lt;User&gt; fs = onlineTable.elements();</div><div class="line">        <span class="keyword">while</span> (fs.hasMoreElements()) &#123;</div><div class="line">            User f = fs.nextElement();</div><div class="line">            Thread hThread = <span class="keyword">new</span> Thread(</div><div class="line">                    <span class="keyword">new</span> sendThread(f.IP, f.port, <span class="string">"mesg"</span> + mesg));</div><div class="line">            hThread.start();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sendChat</span><span class="params">(String id, String mesg)</span> </span>&#123;<span class="comment">//向一个用户发送一条一对一聊天的消息</span></div><div class="line">        User f = onlineTable.get(id);</div><div class="line">        Thread hThread = <span class="keyword">new</span> Thread(</div><div class="line">                <span class="keyword">new</span> sendThread(f.IP, f.port, <span class="string">"chat"</span> + mesg));</div><div class="line">        hThread.start();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function">String <span class="title">newRegisUser</span><span class="params">(String id, String pwd)</span> </span>&#123;<span class="comment">//有新注册的用户</span></div><div class="line">        <span class="keyword">if</span> (onlineTable.containsKey(id) || offlineTable.containsKey(id)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"no"</span>;</div><div class="line">        &#125;</div><div class="line">        offlineTable.put(id, <span class="keyword">new</span> User(id, pwd));</div><div class="line">        saveNewUser(id, pwd);</div><div class="line">        <span class="keyword">return</span> <span class="string">"yes"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sendOnlinesToNewOnlineUser</span><span class="params">(String id, String IP, <span class="keyword">int</span> port)</span> </span>&#123;<span class="comment">//给新上线的用户发送所有已在线用户的id</span></div><div class="line">        <span class="keyword">if</span> (onlineTable.isEmpty() || onlineTable.size() == <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        StringBuffer strBuf = <span class="keyword">new</span> StringBuffer();</div><div class="line">        Enumeration&lt;User&gt; fs = onlineTable.elements();</div><div class="line">        <span class="keyword">while</span> (fs.hasMoreElements()) &#123;</div><div class="line">            User f = fs.nextElement();</div><div class="line">            <span class="keyword">if</span> (f.id.compareTo(id) != <span class="number">0</span>) &#123;</div><div class="line">                strBuf.append(f.id);</div><div class="line">                strBuf.append(<span class="string">";"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        String str = strBuf.toString();</div><div class="line">        Thread hThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> sendThread(IP, port, <span class="string">"newf"</span> + str));</div><div class="line">        hThread.start();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">oneUserOffline</span><span class="params">(String id)</span> </span>&#123;<span class="comment">//有一个用户下线，将其下线消息发送给所有在线用户</span></div><div class="line">        Enumeration&lt;User&gt; fs = onlineTable.elements();</div><div class="line">        <span class="keyword">while</span> (fs.hasMoreElements()) &#123;</div><div class="line">            User f = fs.nextElement();</div><div class="line">            <span class="keyword">if</span> (f.id.compareTo(id) == <span class="number">0</span>) &#123;</div><div class="line">                onlineTable.remove(id);</div><div class="line">                offlineTable.put(id, f);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                Thread hThread = <span class="keyword">new</span> Thread(</div><div class="line">                        <span class="keyword">new</span> sendThread(f.IP, f.port, <span class="string">"offl"</span> + id));</div><div class="line">                hThread.start();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">protected</span>  String <span class="title">handle</span><span class="params">(Socket ots,String rMessage)</span></span>&#123;</div><div class="line">        System.out.println(<span class="string">"handle"</span>);</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"regi"</span>)) &#123;<span class="comment">//注册</span></div><div class="line">            rMessage = rMessage.substring(<span class="string">"regi"</span>.length());</div><div class="line">            String id = rMessage.substring(<span class="number">0</span>, rMessage.indexOf(<span class="string">','</span>));</div><div class="line">            String pwd = rMessage.substring(rMessage.indexOf(<span class="string">','</span>) + <span class="number">1</span>);</div><div class="line">            <span class="keyword">return</span> newRegisUser(id, pwd);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"logi"</span>)) &#123;<span class="comment">//登录</span></div><div class="line">            System.out.println(<span class="string">"logi"</span>);</div><div class="line">            rMessage = rMessage.substring(<span class="string">"logi"</span>.length());</div><div class="line">            String id = rMessage.substring(<span class="number">0</span>, rMessage.indexOf(<span class="string">','</span>));</div><div class="line">            String pwd = rMessage.substring(rMessage.indexOf(<span class="string">','</span>) + <span class="number">1</span>,</div><div class="line">                    rMessage.lastIndexOf(<span class="string">','</span>));</div><div class="line">            String portstr = rMessage.substring(rMessage.lastIndexOf(<span class="string">','</span>) + <span class="number">1</span>);</div><div class="line">            <span class="keyword">int</span> port = <span class="keyword">new</span> Integer(portstr);</div><div class="line">            String IP = ots.getInetAddress().getHostAddress();</div><div class="line">            <span class="keyword">return</span> loginCheck(id, pwd, IP, port);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"mesg"</span>)) &#123;<span class="comment">//聊天室消息</span></div><div class="line">            String mesg = rMessage.substring((<span class="string">"mesg"</span>).length());</div><div class="line">            sendMesg(mesg);</div><div class="line">            <span class="keyword">return</span> <span class="string">"getm"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"chat"</span>)) &#123;<span class="comment">//一对一消息</span></div><div class="line">            String chat = rMessage.substring((<span class="string">"chat"</span>).length());</div><div class="line">            String id = chat.substring(<span class="number">0</span>, chat.indexOf(<span class="string">':'</span>));</div><div class="line">            String mesg = chat.substring(chat.indexOf(<span class="string">':'</span>) + <span class="number">1</span>);</div><div class="line">            sendChat(id, mesg);</div><div class="line">            <span class="keyword">return</span> <span class="string">"getm"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"offl"</span>)) &#123;<span class="comment">//下线</span></div><div class="line">            String id = rMessage.substring((<span class="string">"offl"</span>).length());</div><div class="line">            oneUserOffline(id);</div><div class="line">            <span class="keyword">return</span> <span class="string">"getm"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="string">"getm"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">new</span> ServerServer(<span class="number">65142</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>Send</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomsend;</div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.PrintWriter;</div><div class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Send</span> </span>&#123;</div><div class="line">    Socket socket;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Send</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        socket = <span class="keyword">new</span> Socket();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">connect</span><span class="params">(String IP, <span class="keyword">int</span> port, <span class="keyword">int</span> timeout)</span> </span>&#123;<span class="comment">//连接</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            socket.connect(<span class="keyword">new</span> InetSocketAddress(IP, port), timeout);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">(String message)</span> </span>&#123;</div><div class="line">        PrintWriter writer=ChatRoomUtil.putMesgToSocket(socket, message);</div><div class="line">        StringBuffer buffer=<span class="keyword">new</span> StringBuffer();</div><div class="line">        BufferedReader reader=ChatRoomUtil.getMsgFromSocket(socket,buffer);</div><div class="line">        String rMessage = buffer.toString();</div><div class="line">        ChatRoomUtil.closeSocket(socket,reader,writer);</div><div class="line">        <span class="keyword">return</span> rMessage;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>LoginBox</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomclient;</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</div><div class="line"><span class="keyword">import</span> java.awt.event.MouseEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.MouseListener;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> chatroomsend.Send;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginBox</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span>, <span class="title">MouseListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">329711894663212488L</span>;</div><div class="line">    ClientServer myServer;</div><div class="line">    String serverIP;</div><div class="line">    <span class="keyword">int</span> serverPort;</div><div class="line">    JLabel l_account = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel l_password = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel l_regist = <span class="keyword">new</span> JLabel();</div><div class="line">    JTextField j_account = <span class="keyword">new</span> JTextField();</div><div class="line">    JPasswordField j_password = <span class="keyword">new</span> JPasswordField();</div><div class="line">    JButton submit = <span class="keyword">new</span> JButton();</div><div class="line">    JButton cancel = <span class="keyword">new</span> JButton();</div><div class="line">    JLabel clearAccount = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel clearPassword = <span class="keyword">new</span> JLabel();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginBox</span><span class="params">(String ip, <span class="keyword">int</span> port)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"登录"</span>);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            myServer = <span class="keyword">new</span> ClientServer(serverIP, serverPort);</div><div class="line">            Thread myServerThread = <span class="keyword">new</span> Thread(myServer);</div><div class="line">            myServerThread.start();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"服务器进程初始化失败，无法绑定端口。"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        serverIP = ip;</div><div class="line">        serverPort = port;</div><div class="line">        setLayout(<span class="keyword">null</span>);</div><div class="line">        l_account.setVisible(<span class="keyword">true</span>);</div><div class="line">        l_account.setBounds(<span class="number">80</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">30</span>);</div><div class="line">        l_account.setText(<span class="string">"账号:"</span>);</div><div class="line">        l_password.setVisible(<span class="keyword">true</span>);</div><div class="line">        l_password.setBounds(<span class="number">80</span>, <span class="number">80</span>, <span class="number">50</span>, <span class="number">30</span>);</div><div class="line">        l_password.setText(<span class="string">"密码:"</span>);</div><div class="line">        j_account.setBounds(<span class="number">130</span>, <span class="number">40</span>, <span class="number">150</span>, <span class="number">30</span>);</div><div class="line">        j_password.setBounds(<span class="number">130</span>, <span class="number">80</span>, <span class="number">150</span>, <span class="number">30</span>);</div><div class="line">        clearAccount.setBounds(<span class="number">280</span>, <span class="number">42</span>, <span class="number">26</span>, <span class="number">26</span>);</div><div class="line">        clearPassword.setBounds(<span class="number">280</span>, <span class="number">82</span>, <span class="number">26</span>, <span class="number">26</span>);</div><div class="line">        submit.setBounds(<span class="number">100</span>, <span class="number">130</span>, <span class="number">80</span>, <span class="number">30</span>);</div><div class="line">        submit.setText(<span class="string">"登录"</span>);</div><div class="line">        cancel.setText(<span class="string">"取消"</span>);</div><div class="line">        clearAccount.setText(<span class="string">"X"</span>);</div><div class="line">        clearPassword.setText(<span class="string">"X"</span>);</div><div class="line">        clearAccount.setOpaque(<span class="keyword">true</span>);</div><div class="line">        clearPassword.setOpaque(<span class="keyword">true</span>);</div><div class="line">        clearAccount.setBackground(Color.LIGHT_GRAY);</div><div class="line">        clearPassword.setBackground(Color.LIGHT_GRAY);</div><div class="line">        clearAccount.setHorizontalAlignment(JLabel.CENTER);</div><div class="line">        clearPassword.setHorizontalAlignment(JLabel.CENTER);</div><div class="line">        submit.setBackground(Color.LIGHT_GRAY);</div><div class="line">        cancel.setBackground(Color.LIGHT_GRAY);</div><div class="line">        submit.addActionListener(<span class="keyword">this</span>);</div><div class="line">        cancel.addActionListener(<span class="keyword">this</span>);</div><div class="line">        cancel.setBounds(<span class="number">190</span>, <span class="number">130</span>, <span class="number">80</span>, <span class="number">30</span>);</div><div class="line">        l_regist.setBounds(<span class="number">270</span>, <span class="number">200</span>, <span class="number">70</span>, <span class="number">30</span>);</div><div class="line">        l_regist.setText(<span class="string">"没有账号?"</span>);</div><div class="line">        <span class="keyword">this</span>.add(l_account);</div><div class="line">        <span class="keyword">this</span>.add(l_password);</div><div class="line">        <span class="keyword">this</span>.add(j_account);</div><div class="line">        <span class="keyword">this</span>.add(j_password);</div><div class="line">        <span class="keyword">this</span>.add(submit);</div><div class="line">        <span class="keyword">this</span>.add(cancel);</div><div class="line">        <span class="keyword">this</span>.add(l_regist);</div><div class="line">        <span class="keyword">this</span>.add(clearAccount);</div><div class="line">        <span class="keyword">this</span>.add(clearPassword);</div><div class="line">        setBounds(<span class="number">480</span>, <span class="number">240</span>, <span class="number">370</span>, <span class="number">270</span>);</div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">        setResizable(<span class="keyword">false</span>);</div><div class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(EXIT_ON_CLOSE);</div><div class="line">        validate();</div><div class="line">        l_regist.addMouseListener(<span class="keyword">this</span>);</div><div class="line">        clearAccount.addMouseListener(<span class="keyword">this</span>);</div><div class="line">        clearPassword.addMouseListener(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function">String <span class="title">checkPwd</span><span class="params">(String id, String pwd)</span> </span>&#123;</div><div class="line">        Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">        sendClient.connect(serverIP, serverPort, <span class="number">1000</span>);</div><div class="line">        String ret= sendClient</div><div class="line">                .send(<span class="string">"logi"</span> + id + <span class="string">","</span> + pwd + <span class="string">","</span> + myServer.getMyServerPort());</div><div class="line">        <span class="keyword">if</span> (ret.compareTo(<span class="string">"yes"</span>) == <span class="number">0</span>) &#123;</div><div class="line">            myServer.chatRoom = <span class="keyword">new</span> ChatRoom(id, serverIP, serverPort);</div><div class="line">            dispose();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ret.compareTo(<span class="string">"wrong"</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"登录失败，密码有误。"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ret.compareTo(<span class="string">"alreadyonline"</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"登录失败，该账号已在线"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ret.compareTo(<span class="string">"nothisid"</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"登录失败，账号不存在。"</span>);</div><div class="line">            <span class="keyword">new</span> RegisBox(serverIP, serverPort,</div><div class="line">                    myServer.getMyServerPort());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</div><div class="line">        Object t = e.getSource();</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JButton.class) &#123;</div><div class="line">            JButton button = (JButton) (t);</div><div class="line">            <span class="keyword">if</span> (button.getText().compareTo(<span class="string">"登录"</span>) == <span class="number">0</span>) &#123;</div><div class="line">                String id = j_account.getText();</div><div class="line">                String pwd = String.valueOf(j_password.getPassword());</div><div class="line">                <span class="keyword">if</span> (id.compareTo(<span class="string">""</span>) == <span class="number">0</span> || pwd.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">                    ChatRoomUtil.showErrorBox(<span class="string">"账号与密码均不能为空"</span>);</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                checkPwd(id, pwd);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (button.getText().compareTo(<span class="string">"取消"</span>) == <span class="number">0</span>) &#123;</div><div class="line">                dispose();</div><div class="line">                System.exit(<span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseClicked</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().equals(l_regist)) &#123;</div><div class="line">            <span class="keyword">new</span> RegisBox(serverIP, serverPort,</div><div class="line">                    myServer.getMyServerPort());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (e.getSource().equals(clearAccount)) &#123;</div><div class="line">            j_account.setText(<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (e.getSource().equals(clearPassword)) &#123;</div><div class="line">            j_password.setText(<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mousePressed</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseReleased</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseEntered</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        Object x = e.getSource();</div><div class="line">        <span class="keyword">if</span> (x.equals(l_regist)) &#123;</div><div class="line">            JLabel l = (JLabel) x;</div><div class="line">            l.setForeground(Color.blue);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (x.equals(clearAccount) || x.equals(clearPassword)) &#123;</div><div class="line">            JLabel l = (JLabel) x;</div><div class="line">            l.setBackground(Color.GRAY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseExited</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        Object x = e.getSource();</div><div class="line">        <span class="keyword">if</span> (x.equals(l_regist)) &#123;</div><div class="line">            JLabel l = (JLabel) x;</div><div class="line">            l.setForeground(Color.BLACK);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (x.equals(clearAccount) || x.equals(clearPassword)) &#123;</div><div class="line">            JLabel l = (JLabel) x;</div><div class="line">            l.setBackground(Color.LIGHT_GRAY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        String serverIP = <span class="string">"127.0.0.1"</span>;</div><div class="line">        <span class="keyword">int</span> serverPort = <span class="number">65142</span>;</div><div class="line">        <span class="keyword">new</span> LoginBox(serverIP, serverPort);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>RegisBox</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomclient;</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> chatroomsend.Send;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisBox</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">5795626909275119718L</span>;</div><div class="line">    String serverIP;</div><div class="line">    <span class="keyword">int</span> serverPort;</div><div class="line">    <span class="keyword">int</span> myServerPort;</div><div class="line">    JLabel id_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel pwd_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel pwdCheck_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel num_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel firstName_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel lastName_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel age_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel sex_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JTextField id_text = <span class="keyword">new</span> JTextField();</div><div class="line">    JPasswordField pwd_text = <span class="keyword">new</span> JPasswordField();</div><div class="line">    JPasswordField pwdCheck_text = <span class="keyword">new</span> JPasswordField();</div><div class="line">    JTextField num_text = <span class="keyword">new</span> JTextField();</div><div class="line">    JTextField firstName_text = <span class="keyword">new</span> JTextField();</div><div class="line">    JTextField lastName_text = <span class="keyword">new</span> JTextField();</div><div class="line">    JTextField age_text = <span class="keyword">new</span> JTextField();</div><div class="line">    JComboBox sex_box = <span class="keyword">new</span> JComboBox();</div><div class="line">    JButton cancel = <span class="keyword">new</span> JButton();</div><div class="line">    JButton regis = <span class="keyword">new</span> JButton();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RegisBox</span><span class="params">(String serverIP, <span class="keyword">int</span> serverPort, <span class="keyword">int</span> myServerPort)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        <span class="keyword">this</span>.serverIP = serverIP;</div><div class="line">        <span class="keyword">this</span>.serverPort = serverPort;</div><div class="line">        <span class="keyword">this</span>.myServerPort = myServerPort;</div><div class="line">        setLayout(<span class="keyword">null</span>);</div><div class="line">        setTitle(<span class="string">"注册"</span>);</div><div class="line">        id_label.setBounds(<span class="number">60</span>, <span class="number">23</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        pwd_label.setBounds(<span class="number">60</span>, <span class="number">53</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        pwdCheck_label.setBounds(<span class="number">50</span>, <span class="number">83</span>, <span class="number">70</span>, <span class="number">20</span>);</div><div class="line">        num_label.setBounds(<span class="number">60</span>, <span class="number">113</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        firstName_label.setBounds(<span class="number">60</span>, <span class="number">143</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        lastName_label.setBounds(<span class="number">60</span>, <span class="number">173</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        age_label.setBounds(<span class="number">60</span>, <span class="number">203</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        sex_label.setBounds(<span class="number">60</span>, <span class="number">233</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        id_text.setBounds(<span class="number">130</span>, <span class="number">20</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        pwd_text.setBounds(<span class="number">130</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        pwdCheck_text.setBounds(<span class="number">130</span>, <span class="number">80</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        num_text.setBounds(<span class="number">130</span>, <span class="number">110</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        firstName_text.setBounds(<span class="number">130</span>, <span class="number">140</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        lastName_text.setBounds(<span class="number">130</span>, <span class="number">170</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        age_text.setBounds(<span class="number">130</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        sex_box.setBounds(<span class="number">130</span>, <span class="number">230</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        regis.setBounds(<span class="number">190</span>, <span class="number">270</span>, <span class="number">70</span>, <span class="number">30</span>);</div><div class="line">        cancel.setBounds(<span class="number">270</span>, <span class="number">270</span>, <span class="number">70</span>, <span class="number">30</span>);</div><div class="line">        id_label.setText(<span class="string">"账号"</span>);</div><div class="line">        pwd_label.setText(<span class="string">"密码"</span>);</div><div class="line">        pwdCheck_label.setText(<span class="string">"密码确认"</span>);</div><div class="line">        num_label.setText(<span class="string">"编号"</span>);</div><div class="line">        firstName_label.setText(<span class="string">"名"</span>);</div><div class="line">        lastName_label.setText(<span class="string">"姓"</span>);</div><div class="line">        age_label.setText(<span class="string">"年龄"</span>);</div><div class="line">        sex_label.setText(<span class="string">"性别"</span>);</div><div class="line">        sex_box.addItem(<span class="string">"男"</span>);</div><div class="line">        sex_box.addItem(<span class="string">"女"</span>);</div><div class="line">        regis.setText(<span class="string">"提交"</span>);</div><div class="line">        cancel.setText(<span class="string">"取消"</span>);</div><div class="line">        regis.setBackground(Color.LIGHT_GRAY);</div><div class="line">        cancel.setBackground(Color.LIGHT_GRAY);</div><div class="line">        sex_box.setBackground(Color.LIGHT_GRAY);</div><div class="line">        regis.addActionListener(<span class="keyword">this</span>);</div><div class="line">        cancel.addActionListener(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.add(id_label);</div><div class="line">        <span class="keyword">this</span>.add(pwd_label);</div><div class="line">        <span class="keyword">this</span>.add(pwdCheck_label);</div><div class="line">        <span class="keyword">this</span>.add(num_label);</div><div class="line">        <span class="keyword">this</span>.add(firstName_label);</div><div class="line">        <span class="keyword">this</span>.add(lastName_label);</div><div class="line">        <span class="keyword">this</span>.add(age_label);</div><div class="line">        <span class="keyword">this</span>.add(sex_label);</div><div class="line">        <span class="keyword">this</span>.add(id_text);</div><div class="line">        <span class="keyword">this</span>.add(pwd_text);</div><div class="line">        <span class="keyword">this</span>.add(pwdCheck_text);</div><div class="line">        <span class="keyword">this</span>.add(num_text);</div><div class="line">        <span class="keyword">this</span>.add(firstName_text);</div><div class="line">        <span class="keyword">this</span>.add(lastName_text);</div><div class="line">        <span class="keyword">this</span>.add(age_text);</div><div class="line">        <span class="keyword">this</span>.add(sex_box);</div><div class="line">        <span class="keyword">this</span>.add(regis);</div><div class="line">        <span class="keyword">this</span>.add(cancel);</div><div class="line">        setBounds(<span class="number">200</span>, <span class="number">200</span>, <span class="number">500</span>, <span class="number">400</span>);</div><div class="line">        validate();</div><div class="line">        setResizable(<span class="keyword">false</span>);</div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">regis</span><span class="params">(String serverIP, <span class="keyword">int</span> serverPort, String id, String pwd,</span></span></div><div class="line">            <span class="keyword">int</span> myServerPort) &#123;</div><div class="line">        Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">        sendClient.connect(serverIP, serverPort, <span class="number">1000</span>);</div><div class="line">        <span class="keyword">if</span> (sendClient.send(<span class="string">"regi"</span> + id + <span class="string">","</span> + pwd).compareTo(<span class="string">"yes"</span>) == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</div><div class="line">        String id = id_text.getText();</div><div class="line">        String pwd = String.valueOf(pwd_text.getPassword());</div><div class="line">        String pwdc = String.valueOf(pwdCheck_text.getPassword());</div><div class="line">        String fName = firstName_text.getText();</div><div class="line">        String lName = lastName_text.getText();</div><div class="line">        String age = age_text.getText();</div><div class="line">        String num = num_text.getText();</div><div class="line">        String sex = sex_box.getSelectedItem().toString();</div><div class="line">        <span class="keyword">if</span> (id.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"账号不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (pwd.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"密码不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (pwdc.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"请确认密码"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (pwd.compareTo(pwdc) != <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"两次输入的密码不符"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (num.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"编号不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (fName.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"名不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (lName.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"姓不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (age.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"年龄不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (sex.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"性别不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (regis(serverIP, serverPort, id, pwd, myServerPort)) &#123;</div><div class="line">            dispose();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"注册失败。该用户已存在"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</div><div class="line">        Object t = e.getSource();</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JButton.class) &#123;</div><div class="line">            JButton button = (JButton) (t);</div><div class="line">            <span class="keyword">if</span> (button.getText().compareTo(<span class="string">"提交"</span>) == <span class="number">0</span>) &#123;</div><div class="line">                check();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (button.getText().compareTo(<span class="string">"取消"</span>) == <span class="number">0</span>) &#123;</div><div class="line">                dispose();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ClientServer</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomclient;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"><span class="keyword">import</span> chatroomutil.Server;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientServer</span> <span class="keyword">extends</span> <span class="title">Server</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    ChatRoom chatRoom;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> myPort;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClientServer</span><span class="params">(String serverIP, <span class="keyword">int</span> serverPort)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        myPort = init();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getMyServerPort</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> myPort;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">createServerSocket</span><span class="params">(<span class="keyword">int</span> i)</span> <span class="keyword">throws</span> IOException </span>&#123;<span class="comment">//绑定端口i</span></div><div class="line">        <span class="keyword">if</span> (i &gt;= <span class="number">65536</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"ClientServer无端口可绑定"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            sSocket = <span class="keyword">new</span> ServerSocket(i);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            <span class="keyword">return</span> createServerSocket(i + <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">int</span> port = createServerSocket(<span class="number">1025</span>);</div><div class="line">        <span class="keyword">return</span> port;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">handle</span><span class="params">(Socket ots,String rMessage)</span></span>&#123;</div><div class="line">        String message = <span class="string">"getm"</span>;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"newf"</span>)) &#123;</div><div class="line">            <span class="keyword">while</span> (chatRoom == <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    Thread.sleep(<span class="number">300</span>);</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                    ChatRoomUtil.showErrorBox(<span class="string">"ClientServer在Sleep时出错"</span>);</div><div class="line">                    System.exit(-<span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            String ids = rMessage.substring((<span class="string">"newf"</span>).length());</div><div class="line">            String[] idArray = ids.split(<span class="string">";"</span>);</div><div class="line">            chatRoom.addFriend(idArray);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"offl"</span>)) &#123;</div><div class="line">            String name = rMessage.substring((<span class="string">"offl"</span>).length());</div><div class="line">            chatRoom.removeFriend(name);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"mesg"</span>)) &#123;</div><div class="line">            String mesg = rMessage.substring((<span class="string">"mesg"</span>).length());</div><div class="line">            chatRoom.addRecord(mesg);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"chat"</span>)) &#123;</div><div class="line">            String chat = rMessage.substring((<span class="string">"chat"</span>).length());</div><div class="line">            String id = chat.substring(<span class="number">0</span>, chat.indexOf(<span class="string">':'</span>));</div><div class="line">            String mesg = chat.substring(chat.indexOf(<span class="string">':'</span>) + <span class="number">1</span>);</div><div class="line">            chatRoom.dialogAddRecord(id, mesg);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> message;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        listen();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ChatRoom</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomclient;</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</div><div class="line"><span class="keyword">import</span> java.awt.event.MouseEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.MouseListener;</div><div class="line"><span class="keyword">import</span> java.awt.event.WindowAdapter;</div><div class="line"><span class="keyword">import</span> java.awt.event.WindowEvent;</div><div class="line"><span class="keyword">import</span> java.util.HashSet;</div><div class="line"><span class="keyword">import</span> java.util.Hashtable;</div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"><span class="keyword">import</span> java.util.TimerTask;</div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> javax.swing.event.CaretEvent;</div><div class="line"><span class="keyword">import</span> javax.swing.event.CaretListener;</div><div class="line"><span class="keyword">import</span> chatroomsend.Send;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatRoom</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span>, <span class="title">MouseListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">9016166784223701159L</span>;</div><div class="line">    String myId;</div><div class="line">    String serverIP;</div><div class="line">    <span class="keyword">int</span> serverPort;</div><div class="line">    JLabel chatRoomLabel = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel onlineLabel = <span class="keyword">new</span> JLabel();</div><div class="line">    JTextArea chatArea = <span class="keyword">new</span> JTextArea();</div><div class="line">    JPanel onlineArea = <span class="keyword">new</span> JPanel();</div><div class="line">    JTextArea sendArea = <span class="keyword">new</span> JTextArea(<span class="number">5</span>, <span class="number">20</span>);</div><div class="line">    JButton sendButton = <span class="keyword">new</span> JButton();</div><div class="line">    JScrollPane chatScroll = <span class="keyword">new</span> JScrollPane(chatArea);</div><div class="line">    JScrollPane onlineScroll = <span class="keyword">new</span> JScrollPane(onlineArea);</div><div class="line">    JScrollPane sendScroll = <span class="keyword">new</span> JScrollPane(sendArea);</div><div class="line">    JPanel chatPanel = <span class="keyword">new</span> JPanel();</div><div class="line">    JPanel onlinePanel = <span class="keyword">new</span> JPanel();</div><div class="line">    JPanel sendPanel = <span class="keyword">new</span> JPanel();</div><div class="line">    JPanel chatAndOnlinePanel = <span class="keyword">new</span> JPanel();</div><div class="line">    HashSet&lt;String&gt; friends = <span class="keyword">new</span> HashSet&lt;String&gt;();</div><div class="line">    Hashtable&lt;String, ChatDialog&gt; chatDialogs = <span class="keyword">new</span> Hashtable&lt;String, ChatDialog&gt;();</div><div class="line">    BorderLayout mainLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout chatLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout onlineLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout sendLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout chatAndOnlineLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    FlowLayout onlineAreaLayout = <span class="keyword">new</span> FlowLayout();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChatRoom</span><span class="params">(String id, String serverIP, <span class="keyword">int</span> port)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"聊天室   "</span> + id);</div><div class="line">        <span class="keyword">this</span>.myId = id;</div><div class="line">        <span class="keyword">this</span>.serverIP = serverIP;</div><div class="line">        <span class="keyword">this</span>.serverPort = port;</div><div class="line">        mainLayout.setVgap(<span class="number">5</span>);</div><div class="line">        sendLayout.setHgap(<span class="number">10</span>);</div><div class="line">        chatAndOnlineLayout.setHgap(<span class="number">15</span>);</div><div class="line">        onlineAreaLayout.setVgap(<span class="number">1</span>);</div><div class="line">        <span class="keyword">this</span>.setLayout(mainLayout);</div><div class="line">        chatPanel.setLayout(chatLayout);</div><div class="line">        onlinePanel.setLayout(onlineLayout);</div><div class="line">        sendPanel.setLayout(sendLayout);</div><div class="line">        chatAndOnlinePanel.setLayout(chatAndOnlineLayout);</div><div class="line">        chatArea.setLineWrap(<span class="keyword">true</span>);</div><div class="line">        sendArea.setLineWrap(<span class="keyword">true</span>);</div><div class="line">        onlineArea.setLayout(onlineAreaLayout);</div><div class="line">        onlineArea.setPreferredSize(<span class="keyword">new</span> Dimension(<span class="number">130</span>, <span class="number">200</span>));</div><div class="line">        sendButton.setText(<span class="string">"   发送    "</span>);</div><div class="line">        sendButton.setBackground(Color.LIGHT_GRAY);</div><div class="line">        sendButton.addActionListener(<span class="keyword">this</span>);</div><div class="line">        onlineLabel.setText(<span class="string">"在线好友(点击可开始聊天)"</span>);</div><div class="line">        chatRoomLabel.setText(<span class="string">"聊天"</span>);</div><div class="line">        chatArea.setEditable(<span class="keyword">false</span>);</div><div class="line">        chatArea.setBackground(<span class="keyword">new</span> Color(<span class="number">230</span>, <span class="number">230</span>, <span class="number">230</span>));</div><div class="line">        chatPanel.add(chatRoomLabel, BorderLayout.NORTH);</div><div class="line">        chatPanel.add(chatScroll, BorderLayout.CENTER);</div><div class="line">        onlinePanel.add(onlineLabel, BorderLayout.NORTH);</div><div class="line">        onlinePanel.add(onlineScroll, BorderLayout.CENTER);</div><div class="line">        sendPanel.add(sendScroll, BorderLayout.CENTER);</div><div class="line">        sendPanel.add(sendButton, BorderLayout.EAST);</div><div class="line">        chatAndOnlinePanel.add(chatPanel, BorderLayout.CENTER);</div><div class="line">        chatAndOnlinePanel.add(onlinePanel, BorderLayout.EAST);</div><div class="line">        <span class="keyword">this</span>.add(sendPanel, BorderLayout.SOUTH);</div><div class="line">        <span class="keyword">this</span>.add(chatAndOnlinePanel, BorderLayout.CENTER);</div><div class="line">        friends.add(myId);</div><div class="line">        <span class="keyword">this</span>.setBounds(<span class="number">200</span>, <span class="number">200</span>, <span class="number">600</span>, <span class="number">650</span>);</div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">        reFreshOnlineArea();</div><div class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(DO_NOTHING_ON_CLOSE);</div><div class="line">        <span class="keyword">this</span>.addWindowListener(<span class="keyword">new</span> WindowAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">windowClosing</span><span class="params">(WindowEvent e)</span> </span>&#123;<span class="comment">//点击关闭按钮时发送下线消息</span></div><div class="line">                sendOffLine();</div><div class="line">                System.exit(<span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        sendArea.addCaretListener(<span class="keyword">new</span> CaretListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">caretUpdate</span><span class="params">(CaretEvent e)</span> </span>&#123;</div><div class="line">                String str = sendArea.getText();</div><div class="line">                <span class="keyword">if</span> (str.length() &gt; <span class="number">5000</span>) &#123;</div><div class="line">                    ChatRoomUtil.showErrorBox(<span class="string">"字数过多，超出限制。"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">new</span> java.util.Timer().schedule(<span class="keyword">new</span> TimerTask() &#123;<span class="comment">//定时刷新界面</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                repaint();</div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="number">400</span>, <span class="number">400</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">reFreshOnlineArea</span><span class="params">()</span> </span>&#123;<span class="comment">//刷新当前在线用户</span></div><div class="line">        <span class="keyword">int</span> size = friends.size();</div><div class="line">        onlineArea.removeAll();</div><div class="line">        Iterator&lt;String&gt; it = friends.iterator();</div><div class="line">        <span class="keyword">while</span> (it.hasNext()) &#123;</div><div class="line">            String str = it.next();</div><div class="line">            String id = str;</div><div class="line">            JLabel label = <span class="keyword">new</span> JLabel(id);</div><div class="line">            label.addMouseListener(<span class="keyword">this</span>);</div><div class="line">            label.setPreferredSize(<span class="keyword">new</span> Dimension(<span class="number">130</span>, <span class="number">20</span>));</div><div class="line">            label.setBackground(Color.GRAY);</div><div class="line">            label.setForeground(Color.WHITE);</div><div class="line">            label.setHorizontalAlignment(JLabel.CENTER);</div><div class="line">            label.setOpaque(<span class="keyword">true</span>);</div><div class="line">            onlineArea.add(label);</div><div class="line">        &#125;</div><div class="line">        onlineArea.setPreferredSize(<span class="keyword">new</span> Dimension(<span class="number">130</span>, size * <span class="number">22</span>));</div><div class="line">        <span class="keyword">this</span>.repaint();</div><div class="line">        <span class="keyword">this</span>.validate();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sendOffLine</span><span class="params">()</span> </span>&#123;<span class="comment">//发送下线消息</span></div><div class="line">        Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">        sendClient.connect(serverIP, serverPort, <span class="number">1000</span>);</div><div class="line">        sendClient.send(<span class="string">"offl"</span> + myId);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addFriend</span><span class="params">(String[] fs)</span> </span>&#123;<span class="comment">//添加上线的用户</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fs.length; i++) &#123;</div><div class="line">            friends.add(fs[i]);</div><div class="line">        &#125;</div><div class="line">        reFreshOnlineArea();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">removeFriend</span><span class="params">(String friendID)</span> </span>&#123;<span class="comment">//移除一个用户（已下线）</span></div><div class="line">        friends.remove(friendID);</div><div class="line">        reFreshOnlineArea();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addRecord</span><span class="params">(String mesg)</span> </span>&#123;<span class="comment">//添加聊天记录</span></div><div class="line">        chatArea.append(mesg + <span class="string">"\n"</span>);</div><div class="line">        chatArea.setCaretPosition(chatArea.getText().length());</div><div class="line">        <span class="keyword">this</span>.validate();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">dialogAddRecord</span><span class="params">(String id, String mesg)</span> </span>&#123;<span class="comment">//给一对一聊天增加聊天记录</span></div><div class="line">        <span class="keyword">if</span> (chatDialogs.containsKey(id) == <span class="keyword">false</span>) &#123;</div><div class="line">            chatDialogs.put(id,</div><div class="line">                    <span class="keyword">new</span> ChatDialog(<span class="keyword">this</span>, myId, id, serverIP, serverPort));</div><div class="line">        &#125;</div><div class="line">        chatDialogs.get(id).addRecord(mesg);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">removeDialog</span><span class="params">(String id)</span> </span>&#123;<span class="comment">//移除一对一聊天</span></div><div class="line">        chatDialogs.remove(id);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">sendMessage</span><span class="params">(String mesg)</span> </span>&#123;<span class="comment">//发送群聊消息</span></div><div class="line">        Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">        sendClient.connect(serverIP, serverPort, <span class="number">1000</span>);</div><div class="line">        String getm = sendClient.send(<span class="string">"mesg"</span> + myId + <span class="string">":  \n"</span> + mesg);</div><div class="line">        <span class="keyword">return</span> getm;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JButton.class) &#123;</div><div class="line">            sendMessage(sendArea.getText());</div><div class="line">            sendArea.setText(<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseClicked</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JLabel.class) &#123;</div><div class="line">            JLabel l = (JLabel) e.getSource();</div><div class="line">            <span class="keyword">if</span> (l.getText().compareTo(myId) == <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (chatDialogs.containsKey(l.getText())) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            chatDialogs.put(l.getText(), <span class="keyword">new</span> ChatDialog(<span class="keyword">this</span>, myId, l.getText(),</div><div class="line">                    serverIP, serverPort));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseEntered</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JLabel.class) &#123;</div><div class="line">            JLabel l = (JLabel) e.getSource();</div><div class="line">            l.setBackground(Color.LIGHT_GRAY);</div><div class="line">            l.setForeground(Color.BLACK);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseExited</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JLabel.class) &#123;</div><div class="line">            JLabel l = (JLabel) e.getSource();</div><div class="line">            l.setBackground(Color.GRAY);</div><div class="line">            l.setForeground(Color.WHITE);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mousePressed</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseReleased</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ChatDialog</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomclient;</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</div><div class="line"><span class="keyword">import</span> java.awt.event.WindowAdapter;</div><div class="line"><span class="keyword">import</span> java.awt.event.WindowEvent;</div><div class="line"><span class="keyword">import</span> java.util.HashSet;</div><div class="line"><span class="keyword">import</span> java.util.TimerTask;</div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> javax.swing.event.CaretEvent;</div><div class="line"><span class="keyword">import</span> javax.swing.event.CaretListener;</div><div class="line"><span class="keyword">import</span> chatroomsend.Send;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatDialog</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1437996471885472344L</span>;</div><div class="line">    String myId;</div><div class="line">    String otsId;</div><div class="line">    String serverIP;</div><div class="line">    <span class="keyword">int</span> serverPort;</div><div class="line">    JLabel chatRoomLabel = <span class="keyword">new</span> JLabel();</div><div class="line">    JTextArea chatArea = <span class="keyword">new</span> JTextArea();</div><div class="line">    JTextArea sendArea = <span class="keyword">new</span> JTextArea(<span class="number">5</span>, <span class="number">20</span>);</div><div class="line">    JButton sendButton = <span class="keyword">new</span> JButton();</div><div class="line">    JScrollPane chatScroll = <span class="keyword">new</span> JScrollPane(chatArea);</div><div class="line">    JScrollPane sendScroll = <span class="keyword">new</span> JScrollPane(sendArea);</div><div class="line">    JPanel chatPanel = <span class="keyword">new</span> JPanel();</div><div class="line">    JPanel sendPanel = <span class="keyword">new</span> JPanel();</div><div class="line">    HashSet&lt;String&gt; friends = <span class="keyword">new</span> HashSet&lt;String&gt;();</div><div class="line">    BorderLayout mainLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout chatLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout sendLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    ChatRoom chatRoom;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChatDialog</span><span class="params">(<span class="keyword">final</span> ChatRoom chatRoom, String id, <span class="keyword">final</span> String otsId,</span></span></div><div class="line">            String serverIP, <span class="keyword">int</span> port) &#123;</div><div class="line">        <span class="keyword">super</span>(id + <span class="string">"与"</span> + otsId + <span class="string">"聊天"</span>);</div><div class="line">        <span class="keyword">this</span>.chatRoom = chatRoom;</div><div class="line">        <span class="keyword">this</span>.myId = id;</div><div class="line">        <span class="keyword">this</span>.otsId = otsId;</div><div class="line">        <span class="keyword">this</span>.serverIP = serverIP;</div><div class="line">        <span class="keyword">this</span>.serverPort = port;</div><div class="line">        mainLayout.setVgap(<span class="number">5</span>);</div><div class="line">        sendLayout.setHgap(<span class="number">10</span>);</div><div class="line">        <span class="keyword">this</span>.setLayout(mainLayout);</div><div class="line">        chatPanel.setLayout(chatLayout);</div><div class="line">        sendPanel.setLayout(sendLayout);</div><div class="line">        chatArea.setLineWrap(<span class="keyword">true</span>);</div><div class="line">        sendArea.setLineWrap(<span class="keyword">true</span>);</div><div class="line">        sendButton.setText(<span class="string">"   发送    "</span>);</div><div class="line">        sendButton.setBackground(Color.LIGHT_GRAY);</div><div class="line">        sendButton.addActionListener(<span class="keyword">this</span>);</div><div class="line">        chatRoomLabel.setText(<span class="string">"聊天"</span>);</div><div class="line">        chatArea.setEditable(<span class="keyword">false</span>);</div><div class="line">        chatArea.setBackground(<span class="keyword">new</span> Color(<span class="number">230</span>, <span class="number">230</span>, <span class="number">230</span>));</div><div class="line">        chatPanel.add(chatRoomLabel, BorderLayout.NORTH);</div><div class="line">        chatPanel.add(chatScroll, BorderLayout.CENTER);</div><div class="line">        sendPanel.add(sendScroll, BorderLayout.CENTER);</div><div class="line">        sendPanel.add(sendButton, BorderLayout.EAST);</div><div class="line">        <span class="keyword">this</span>.add(sendPanel, BorderLayout.SOUTH);</div><div class="line">        <span class="keyword">this</span>.add(chatPanel, BorderLayout.CENTER);</div><div class="line">        <span class="keyword">this</span>.setBounds(<span class="number">200</span>, <span class="number">200</span>, <span class="number">530</span>, <span class="number">600</span>);</div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(DISPOSE_ON_CLOSE);</div><div class="line">        sendArea.addCaretListener(<span class="keyword">new</span> CaretListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">caretUpdate</span><span class="params">(CaretEvent e)</span> </span>&#123;</div><div class="line">                String str = sendArea.getText();</div><div class="line">                <span class="keyword">if</span> (str.length() &gt; <span class="number">5000</span>) &#123;</div><div class="line">                    ChatRoomUtil.showErrorBox(<span class="string">"字数过多，超出限制。"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(DO_NOTHING_ON_CLOSE);</div><div class="line">        <span class="keyword">this</span>.addWindowListener(<span class="keyword">new</span> WindowAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">windowClosing</span><span class="params">(WindowEvent e)</span> </span>&#123;<span class="comment">//关闭窗口后，ChatRoom要移除该对话</span></div><div class="line">                chatRoom.removeDialog(otsId);</div><div class="line">                dispose();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">new</span> java.util.Timer().schedule(<span class="keyword">new</span> TimerTask() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                repaint();</div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="number">400</span>, <span class="number">400</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addRecord</span><span class="params">(String mesg)</span> </span>&#123;</div><div class="line">        chatArea.append(mesg + <span class="string">"\n"</span>);</div><div class="line">        chatArea.setCaretPosition(chatArea.getText().length());</div><div class="line">        <span class="keyword">this</span>.validate();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">sendMessage</span><span class="params">(String mesg)</span> </span>&#123;</div><div class="line">        Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">        sendClient.connect(serverIP, serverPort, <span class="number">1000</span>);</div><div class="line">        String getm = sendClient.send(</div><div class="line">                <span class="string">"chat"</span> + otsId + <span class="string">":"</span> + myId + <span class="string">":"</span> + myId + <span class="string">":   \n"</span> + mesg);</div><div class="line">        addRecord(myId + <span class="string">":   \n"</span> + mesg);</div><div class="line">        <span class="keyword">return</span> getm;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JButton.class) &#123;</div><div class="line">            sendMessage(sendArea.getText());</div><div class="line">            sendArea.setText(<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>Users.txt</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line">1:1</div><div class="line">2:2</div><div class="line">3:3</div><div class="line">4:4</div><div class="line">5:5</div><div class="line">6:6</div><div class="line">7:7</div><div class="line">8:8</div><div class="line">9:9</div><div class="line">10:10</div><div class="line">11:11</div><div class="line">12:12</div><div class="line">13:13</div><div class="line">14:14</div><div class="line">15:15</div><div class="line">16:16</div><div class="line">17:17</div><div class="line">18:18</div><div class="line">19:19</div><div class="line">20:20</div><div class="line">21:21</div><div class="line">22:22</div><div class="line">23:23</div><div class="line">24:24</div><div class="line">25:25</div><div class="line">26:26</div><div class="line">27:27</div><div class="line">28:28</div><div class="line">29:29</div><div class="line">30:30</div><div class="line">31:31</div><div class="line">32:32</div><div class="line">33:33</div><div class="line">34:34</div><div class="line">35:35</div><div class="line">36:36</div><div class="line">37:37</div><div class="line">38:38</div><div class="line">39:39</div><div class="line">40:40</div><div class="line">41:41</div><div class="line">42:42</div><div class="line">43:43</div><div class="line">44:44</div><div class="line">45:45</div><div class="line">46:46</div><div class="line">47:47</div><div class="line">48:48</div><div class="line">49:49</div><div class="line">50:50</div><div class="line">51:51</div><div class="line">52:52</div><div class="line">53:53</div><div class="line">54:54</div><div class="line">55:55</div><div class="line">56:56</div><div class="line">57:57</div><div class="line">58:58</div><div class="line">59:59</div><div class="line">60:60</div><div class="line">61:61</div><div class="line">62:62</div><div class="line">63:63</div><div class="line">64:64</div><div class="line">65:65</div><div class="line">66:66</div><div class="line">67:67</div><div class="line">68:68</div><div class="line">69:69</div><div class="line">70:70</div><div class="line">71:71</div><div class="line">72:72</div><div class="line">73:73</div><div class="line">74:74</div><div class="line">75:75</div><div class="line">76:76</div><div class="line">77:77</div><div class="line">78:78</div><div class="line">79:79</div><div class="line">80:80</div><div class="line">81:81</div><div class="line">82:82</div><div class="line">83:83</div><div class="line">84:84</div><div class="line">85:85</div><div class="line">86:86</div><div class="line">87:87</div><div class="line">88:88</div><div class="line">89:89</div><div class="line">90:90</div><div class="line">91:91</div><div class="line">92:92</div><div class="line">93:93</div><div class="line">94:94</div><div class="line">95:95</div><div class="line">96:96</div><div class="line">aa:aa</div><div class="line">qq:qq</div><div class="line">ww:ww</div><div class="line">ee:ee</div><div class="line">guochengxin:guochengxin</div><div class="line">huoda:huoda</div><div class="line">zhangfa:zhangfa</div><div class="line">hanyu:hanyu</div><div class="line">maxuewei:maxuewei</div><div class="line">lizeyu:lizeyu</div></pre></td></tr></table></figure></p>
<ul>
<li>写于大三下实训期间</li>
<li>随笔写于2016.7.13</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[俄罗斯方块（Win32实现，Codeblocks+GCC编译）]]></title>
      <url>http://maxuewei2.git.io/2016/05/08/%E4%BF%84%E7%BD%97%E6%96%AFC++/</url>
      <content type="html"><![CDATA[<h3 id="缘起："><a href="#缘起：" class="headerlink" title="缘起："></a>缘起：</h3><p>　　在玩Codeblocks自带的俄罗斯方块时觉得不错，然而有时间限制。所以想自己再写一个。</p>
<blockquote>
<p>后来发现在设置中是可以取消时间限制的。。。Orz</p>
</blockquote>
<a id="more"></a>
<h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p><img src="/imgs/trisc++1.png" alt="xiaoguo1"></p>
<h3 id="主要内容："><a href="#主要内容：" class="headerlink" title="主要内容："></a>主要内容：</h3><p>　　程序中有一个board数组，其中有要显示的部分，也有不显示的部分，不显示的部分都存储1。</p>
<p>　　如下图：</p>
<p><img src="/imgs/trisc++2.png" alt="neirong">   　　　　</p>
<p>　　shape采用4*4数组(shape)保存。如：<br>&gt;<br>0 0 0 0<br>0 1 0 0<br>1 1 1 0<br>0 0 0 0</p>
<p>　　另外用变量row和column保存shape数组左上角在board中的位置。</p>
<p>　　每次下落或左右移动，先对row和column做出改变，然后检测当前row和column下，shape是否重合了为1的格子，如果有重合，就说明shape出界了或者到达下落最低点，则要恢复row和column值。另外，如果是下落，还要将shape放在board上，并产生新的shape。</p>
<p>　　旋转时，先对shape数组进行旋转操作，然后检测重合，如果有重合，则反向旋转回来。</p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(UNICODE) &amp;&amp; !defined(_UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(_UNICODE) &amp;&amp; !defined(UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="comment">/*-----------------宏定义--------------------------------------------------------*/</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WIDTH 180</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEIGHT 400</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LONG_SLEEP 300</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BKCOLOR RGB(238,238,238)<span class="comment">//背景色</span></span></div><div class="line"><span class="comment">/*-----------------变量----------------------------------------------------------*/</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> shapes[<span class="number">7</span>][<span class="number">4</span>][<span class="number">4</span>];<span class="comment">//存储7个形状</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> high_score[<span class="number">4</span>]= &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;<span class="comment">//前三个元素存储最高分，最后一个元素存储此次得分</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> **shape;<span class="comment">//当前形状</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> **board;</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> M=<span class="number">15</span>;<span class="comment">//显示的列数</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> N=<span class="number">30</span>;<span class="comment">//显示的行数</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> MM=M+<span class="number">8</span>;<span class="comment">//board的列数</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> NN=N+<span class="number">4</span>;<span class="comment">//board的行数</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> LEFT=<span class="number">4</span>;<span class="comment">//显示的最左一列</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> RIGHT=LEFT+M<span class="number">-1</span>;<span class="comment">//显示的最右一列</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> TOP=<span class="number">0</span>;<span class="comment">//显示的最上一列</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> BOTTOM=N<span class="number">-1</span>;<span class="comment">//显示的最下一列</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> score=<span class="number">0</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> row=<span class="number">0</span>;<span class="comment">//形状所在行</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> column=MM/<span class="number">2</span>;<span class="comment">//形状坐在列</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">bool</span> is_pause=<span class="literal">false</span>;</div><div class="line"><span class="keyword">static</span> HBRUSH grey_brush =CreateSolidBrush (RGB(<span class="number">210</span>,<span class="number">210</span>,<span class="number">210</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH white_brush =CreateSolidBrush (RGB(<span class="number">130</span>,<span class="number">130</span>,<span class="number">130</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH bk_brush =CreateSolidBrush (BKCOLOR);</div><div class="line"><span class="keyword">static</span> HPEN hPen = CreatePen(PS_SOLID,<span class="number">1</span>,RGB(<span class="number">147</span>,<span class="number">155</span>,<span class="number">166</span>));</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> lattices_top=<span class="number">40</span>;<span class="comment">//上面留白</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> lattices_left=<span class="number">20</span>;<span class="comment">//左侧留白</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> width=WIDTH/M;<span class="comment">//每个格子的宽度</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> height=(HEIGHT-lattices_top)/N;<span class="comment">//每个格子的高度</span></div><div class="line"><span class="comment">/*-----------------函数-----------------------------------------------------------*/</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_score</span><span class="params">()</span> </span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_is_lose</span><span class="params">()</span> </span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear_up</span><span class="params">()</span> </span>;<span class="comment">//消除没有空格子的行</span></div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">down_thread_function</span><span class="params">(<span class="keyword">void</span> * args)</span> </span>;<span class="comment">//形状下落进程要执行的函数</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">exit_game</span><span class="params">(HWND hwnd)</span> </span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">give_new_shape</span><span class="params">()</span> </span>;<span class="comment">//随机生成一个新形状</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">handle_key</span><span class="params">(HWND hwnd,WPARAM wParam)</span> </span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_down_thread</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//初始化形状下落进程</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_game</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//初始化游戏程序</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_play</span><span class="params">()</span> </span>;<span class="comment">//初始化游戏数据</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_legel</span><span class="params">()</span> </span>;<span class="comment">//检测形状在当前位置是否合法（即是否重合了非空的格子）</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>;<span class="comment">//读取游戏最高分数据</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_shape</span><span class="params">()</span> </span>;<span class="comment">//从文件中加载7个形状</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">lose_game</span><span class="params">(HWND hwnd)</span> </span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_down</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//形状下落</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_lr</span><span class="params">(HWND hwnd,<span class="keyword">int</span> lr)</span> </span>;<span class="comment">//形状左右移动</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_lattice</span><span class="params">(HDC hdc,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> color)</span> </span>;<span class="comment">//显示一个格子</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_UI</span><span class="params">(HDC hdc)</span> </span>;<span class="comment">//画界面</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">reset_rc</span><span class="params">()</span> </span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rerotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>;<span class="comment">//顺时针旋转一个行列数为mn的方阵</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>;<span class="comment">//逆时针旋转一个行列数为mn的方阵</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">rotate_shape</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//旋转当前形状并更新界面</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">save_score</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//保存最高分数据</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">shape_to_ground</span><span class="params">()</span> </span>;<span class="comment">//当前形状落地之后，更新board</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sort_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>;<span class="comment">//对最高分和此次得分排序，若创造新纪录则返回true</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//更新界面，仅更新Rect区域（形状所在的那几行）内</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI_all</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//更新界面，更新整个界面</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">write_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>;<span class="comment">//写最高分数据</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*  Declare Windows procedure  */</span></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/*  Make the class name into a global variable  */</span></div><div class="line">TCHAR szClassName[ ] = _T(<span class="string">"Tris"</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span> <span class="params">(HINSTANCE hThisInstance,</span></span></div><div class="line">                    HINSTANCE hPrevInstance,</div><div class="line">                    LPSTR lpszArgument,</div><div class="line">                    <span class="keyword">int</span> nCmdShow) &#123;</div><div class="line">    HWND hwnd;               <span class="comment">/* This is the handle for our window */</span></div><div class="line">    MSG messages;            <span class="comment">/* Here messages to the application are saved */</span></div><div class="line">    WNDCLASSEX wincl;        <span class="comment">/* Data structure for the windowclass */</span></div><div class="line"></div><div class="line">    <span class="comment">/* The Window structure */</span></div><div class="line">    wincl.hInstance = hThisInstance;</div><div class="line">    wincl.lpszClassName = szClassName;</div><div class="line">    wincl.lpfnWndProc = WindowProcedure;      <span class="comment">/* This function is called by windows */</span></div><div class="line">    wincl.style = CS_DBLCLKS;                 <span class="comment">/* Catch double-clicks */</span></div><div class="line">    wincl.cbSize = <span class="keyword">sizeof</span> (WNDCLASSEX);</div><div class="line"></div><div class="line">    <span class="comment">/* Use default icon and mouse-pointer */</span></div><div class="line">    wincl.hIcon = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hIconSm = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hCursor = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW);</div><div class="line">    wincl.lpszMenuName = <span class="literal">NULL</span>;                 <span class="comment">/* No menu */</span></div><div class="line">    wincl.cbClsExtra = <span class="number">0</span>;                      <span class="comment">/* No extra bytes after the window class */</span></div><div class="line">    wincl.cbWndExtra = <span class="number">0</span>;                      <span class="comment">/* structure or the window instance */</span></div><div class="line">    <span class="comment">/* Use Windows's default colour as the background of the window */</span></div><div class="line">    wincl.hbrBackground =bk_brush;</div><div class="line">    <span class="comment">/* Register the window class, and if it fails quit the program */</span></div><div class="line">    <span class="keyword">if</span> (!RegisterClassEx (&amp;wincl))</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* The class is registered, let's create the program*/</span></div><div class="line">    hwnd = CreateWindowEx (</div><div class="line">               <span class="number">0</span>,                   <span class="comment">/* Extended possibilites for variation */</span></div><div class="line">               szClassName,         <span class="comment">/* Classname */</span></div><div class="line">               _T(<span class="string">"Tris"</span>),       <span class="comment">/* Title Text */</span></div><div class="line">               WS_OVERLAPPEDWINDOW, <span class="comment">/* default window */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* Windows decides the position */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* where the window ends up on the screen */</span></div><div class="line">               WIDTH+<span class="number">200</span>,                 <span class="comment">/* The programs width */</span></div><div class="line">               HEIGHT+<span class="number">70</span>,                 <span class="comment">/* and height in pixels */</span></div><div class="line">               HWND_DESKTOP,        <span class="comment">/* The window is a child-window to desktop */</span></div><div class="line">               <span class="literal">NULL</span>,                <span class="comment">/* No menu */</span></div><div class="line">               hThisInstance,       <span class="comment">/* Program Instance handler */</span></div><div class="line">               <span class="literal">NULL</span>                 <span class="comment">/* No Window Creation data */</span></div><div class="line">           );</div><div class="line"></div><div class="line">    <span class="comment">/* Make the window visible on the screen */</span></div><div class="line">    ShowWindow (hwnd, nCmdShow);</div><div class="line"></div><div class="line">    <span class="comment">/* Run the message loop. It will run until GetMessage() returns 0 */</span></div><div class="line">    <span class="keyword">while</span> (GetMessage (&amp;messages, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>)) &#123;</div><div class="line">        <span class="comment">/* Translate virtual-key messages into character messages */</span></div><div class="line">        TranslateMessage(&amp;messages);</div><div class="line">        <span class="comment">/* Send message to WindowProcedure */</span></div><div class="line">        DispatchMessage(&amp;messages);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/* The program return-value is 0 - The value that PostQuitMessage() gave */</span></div><div class="line">    <span class="keyword">return</span> messages.wParam;</div><div class="line">&#125;</div><div class="line"><span class="comment">//从文件中加载7个形状</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_shape</span><span class="params">()</span> </span>&#123;</div><div class="line">    FILE* f=fopen(<span class="string">"shapes.txt"</span>,<span class="string">"rb"</span>);</div><div class="line">    <span class="keyword">if</span>(f==<span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;<span class="number">4</span>; k++) &#123;</div><div class="line">                <span class="keyword">if</span>(<span class="built_in">fscanf</span>(f,<span class="string">"%d"</span>,&amp;shapes[i][j][k])!=<span class="number">1</span>) &#123;</div><div class="line">                    <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    fclose(f);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//随机生成一个新形状</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">give_new_shape</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> shape_num=rand()%<span class="number">7</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) &#123;</div><div class="line">            shape[i][j]=shapes[shape_num][i][j];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_score</span><span class="params">()</span> </span>&#123;</div><div class="line">    score+=<span class="number">100</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//消除没有空格子的行</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear_up</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=row; i&lt;=row+<span class="number">3</span>; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(i&gt;BOTTOM)<span class="keyword">continue</span>;</div><div class="line">        <span class="keyword">bool</span> there_is_blank=<span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=LEFT; j&lt;=RIGHT; j++) &#123;</div><div class="line">            <span class="keyword">if</span>(board[i][j]==<span class="number">0</span>) &#123;</div><div class="line">                there_is_blank=<span class="literal">true</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(!there_is_blank) &#123;</div><div class="line">            add_score();</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> r=i; r&gt;=<span class="number">1</span>; r--) &#123;</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> c=LEFT; c&lt;=RIGHT; c++) &#123;</div><div class="line">                    board[r][c]=board[r<span class="number">-1</span>][c];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//检测形状在当前位置是否合法（即是否重合了非空的格子）</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_legel</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) &#123;</div><div class="line">            <span class="keyword">if</span>(shape[i][j]==<span class="number">1</span>&amp;&amp;board[row+i][column+j]==<span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//逆时针旋转一个行列数为mn的方阵</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span>** a=shape;</div><div class="line">    <span class="keyword">int</span> s=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> n=mn; n&gt;=<span class="number">1</span>; n-=<span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n<span class="number">-1</span>; i++) &#123;</div><div class="line">            <span class="keyword">int</span> t=a[s+i][s];</div><div class="line">            a[s+i][s]=a[s][s+n-i<span class="number">-1</span>];</div><div class="line">            a[s][s+n-i<span class="number">-1</span>]=a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>];</div><div class="line">            a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>]=a[s+n<span class="number">-1</span>][s+i];</div><div class="line">            a[s+n<span class="number">-1</span>][s+i]=t;</div><div class="line">        &#125;</div><div class="line">        s++;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//顺时针旋转一个行列数为mn的方阵</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rerotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span>** a=shape;</div><div class="line">    <span class="keyword">int</span> s=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> n=mn; n&gt;=<span class="number">1</span>; n-=<span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n<span class="number">-1</span>; i++) &#123;</div><div class="line">            <span class="keyword">int</span> t=a[s+i][s];</div><div class="line">            a[s+i][s]=a[s+n<span class="number">-1</span>][s+i];</div><div class="line">            a[s+n<span class="number">-1</span>][s+i]=a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>];</div><div class="line">            a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>]=a[s][s+n-i<span class="number">-1</span>];</div><div class="line">            a[s][s+n-i<span class="number">-1</span>]=t;</div><div class="line">        &#125;</div><div class="line">        s++;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//显示一个格子</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_lattice</span><span class="params">(HDC hdc,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> color)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(x&lt;TOP||x&gt;BOTTOM||y&lt;LEFT||y&gt;RIGHT) &#123;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    x-=TOP;</div><div class="line">    y-=LEFT;</div><div class="line">    <span class="keyword">int</span> left=lattices_left+y*width;</div><div class="line">    <span class="keyword">int</span> right=lattices_left+y*width+width;</div><div class="line">    <span class="keyword">int</span> top=lattices_top+x*height;</div><div class="line">    <span class="keyword">int</span> bottom=lattices_top+x*height+height;</div><div class="line">    MoveToEx (hdc,left,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,top) ;</div><div class="line">    MoveToEx (hdc,left,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,left,bottom) ;</div><div class="line">    MoveToEx (hdc,left,bottom, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,bottom) ;</div><div class="line">    MoveToEx (hdc,right,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,bottom) ;</div><div class="line">    SelectObject(hdc, grey_brush);</div><div class="line">    <span class="keyword">if</span>(color==<span class="number">0</span>) &#123;</div><div class="line">        SelectObject(hdc, white_brush);</div><div class="line">    &#125;</div><div class="line">    Rectangle(hdc,left,top,right,bottom);</div><div class="line">&#125;</div><div class="line"><span class="comment">//更新界面，仅更新Rect区域（形状所在的那几行）内</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> RECT rect;</div><div class="line">    rect.left=lattices_left;</div><div class="line">    rect.right=lattices_left+M*width+width;</div><div class="line">    rect.top=lattices_top+(row<span class="number">-1</span>)*height;</div><div class="line">    rect.bottom=lattices_top+(row+<span class="number">4</span>)*height;</div><div class="line">    InvalidateRect (hwnd,&amp;rect, <span class="literal">false</span>) ;</div><div class="line">&#125;</div><div class="line"><span class="comment">//更新界面，更新整个界面</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI_all</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">false</span>) ;</div><div class="line">&#125;</div><div class="line"><span class="comment">//画界面</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_UI</span><span class="params">(HDC hdc)</span> </span>&#123;</div><div class="line">    SetBkColor(hdc,BKCOLOR);</div><div class="line">    SelectObject(hdc,hPen);  <span class="comment">//选用画笔</span></div><div class="line">    <span class="keyword">char</span> score_str[<span class="number">20</span>];</div><div class="line">    <span class="built_in">sprintf</span>(score_str,<span class="string">"Score:%d"</span>,score);</div><div class="line">    TextOut(hdc,<span class="number">10</span>,<span class="number">10</span>,score_str,<span class="built_in">strlen</span>(score_str));</div><div class="line">    <span class="built_in">sprintf</span>(score_str,<span class="string">"Highest Scores:"</span>);</div><div class="line">    TextOut(hdc,WIDTH+<span class="number">50</span>,<span class="number">50</span>,score_str,<span class="built_in">strlen</span>(score_str));</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</div><div class="line">        <span class="built_in">sprintf</span>(score_str,<span class="string">"%d"</span>,high_score[i]);</div><div class="line">        TextOut(hdc,WIDTH+<span class="number">50</span>,<span class="number">50</span>+(i+<span class="number">1</span>)*<span class="number">20</span>,score_str,<span class="built_in">strlen</span>(score_str));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=TOP; i&lt;=BOTTOM; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=LEFT; j&lt;=RIGHT; j++) &#123;</div><div class="line">            paint_lattice(hdc,i,j,board[i][j]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) &#123;</div><div class="line">            <span class="keyword">if</span>(shape[i][j]==<span class="number">1</span>)</div><div class="line">                paint_lattice(hdc,row+i,column+j,shape[i][j]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//旋转当前形状并更新界面</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">rotate_shape</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> mn=<span class="number">4</span>;</div><div class="line">    rotate_matrix(mn);</div><div class="line">    <span class="keyword">if</span>(!is_legel()) &#123;</div><div class="line">        rerotate_matrix(mn);</div><div class="line">    &#125;</div><div class="line">    update_UI(hwnd);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">reset_rc</span><span class="params">()</span> </span>&#123;</div><div class="line">    row=<span class="number">0</span>;</div><div class="line">    column=MM/<span class="number">2</span><span class="number">-2</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//读取游戏最高分数据</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>&#123;</div><div class="line">    FILE* f=fopen(<span class="string">"scores.txt"</span>,<span class="string">"r"</span>);</div><div class="line">    <span class="keyword">if</span>(f==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="built_in">fscanf</span>(f,<span class="string">"%d%d%d"</span>,&amp;a[<span class="number">0</span>],&amp;a[<span class="number">1</span>],&amp;a[<span class="number">2</span>]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//初始化游戏数据</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_play</span><span class="params">()</span> </span>&#123;</div><div class="line">    load_scores(high_score);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;NN; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;MM; j++) &#123;</div><div class="line">            board[i][j]=<span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;LEFT; j++) &#123;</div><div class="line">            board[i][j]=<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=RIGHT+<span class="number">1</span>; j&lt;MM; j++) &#123;</div><div class="line">            board[i][j]=<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=BOTTOM+<span class="number">1</span>; i&lt;NN; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;MM; j++) &#123;</div><div class="line">            board[i][j]=<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    reset_rc();</div><div class="line">    score=<span class="number">0</span>;</div><div class="line">    give_new_shape();</div><div class="line">    is_pause=<span class="literal">false</span>;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_is_lose</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(row==<span class="number">0</span>)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//对最高分和此次得分排序，若创造新纪录则返回true</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sort_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> temp=a[<span class="number">3</span>];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">3</span>; j++) &#123;</div><div class="line">            <span class="keyword">if</span>(a[j]&lt;a[j+<span class="number">1</span>]) &#123;</div><div class="line">                <span class="keyword">int</span> t=a[j];</div><div class="line">                a[j]=a[j+<span class="number">1</span>];</div><div class="line">                a[j+<span class="number">1</span>]=t;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(temp&gt;a[<span class="number">3</span>])<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//写最高分数据</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">write_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>&#123;</div><div class="line">    FILE* f=fopen(<span class="string">"scores.txt"</span>,<span class="string">"w"</span>);</div><div class="line">    <span class="keyword">if</span>(f==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="built_in">fprintf</span>(f,<span class="string">"%d\n%d\n%d\n"</span>,a[<span class="number">0</span>],a[<span class="number">1</span>],a[<span class="number">2</span>]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//保存最高分数据</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">save_score</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    high_score[<span class="number">3</span>]=score;</div><div class="line">    <span class="keyword">bool</span> made_record=sort_scores(high_score);</div><div class="line">    <span class="keyword">if</span>(write_scores(high_score)!=<span class="number">0</span>) &#123;</div><div class="line">        MessageBox(hwnd,<span class="string">"Write file error.Program will exit."</span>,<span class="string">"Error"</span>,<span class="literal">NULL</span>);</div><div class="line">        DestroyWindow(hwnd);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> made_record;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">lose_game</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(is_pause)<span class="keyword">return</span> ;</div><div class="line">    is_pause=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">char</span> message[<span class="number">200</span>]=<span class="string">"You lose the Game.\n"</span>;</div><div class="line">    <span class="keyword">char</span> title[<span class="number">50</span>]=<span class="string">"Game Over"</span>;</div><div class="line">    <span class="keyword">if</span>(save_score(hwnd)) &#123;</div><div class="line">        <span class="built_in">strcat</span>(message,<span class="string">"You have made a new record.\n"</span>);</div><div class="line">        <span class="keyword">char</span> score_str[<span class="number">100</span>];</div><div class="line">        <span class="built_in">sprintf</span>(score_str,<span class="string">"The Highest Scores:\n%d\n%d\n%d\n"</span>,high_score[<span class="number">0</span>],high_score[<span class="number">1</span>],high_score[<span class="number">2</span>]);</div><div class="line">        <span class="built_in">strcat</span>(message,score_str);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">strcat</span>(message,<span class="string">"\nPlay again?\n"</span>);</div><div class="line">    <span class="keyword">if</span>(MessageBox(hwnd,message,title,MB_YESNO)==IDYES) &#123;</div><div class="line">        init_play();</div><div class="line">        update_UI_all(hwnd);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">exit_game</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    is_pause=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">char</span> message[<span class="number">200</span>]=<span class="string">""</span>;</div><div class="line">    <span class="keyword">char</span> title[<span class="number">50</span>]=<span class="string">"Exit"</span>;</div><div class="line">    <span class="keyword">if</span>(save_score(hwnd)) &#123;</div><div class="line">        <span class="built_in">strcat</span>(message,<span class="string">"You have made a new record.\n"</span>);</div><div class="line">        <span class="keyword">char</span> score_str[<span class="number">100</span>];</div><div class="line">        <span class="built_in">sprintf</span>(score_str,<span class="string">"The Highest Scores:\n%d\n%d\n%d\n"</span>,high_score[<span class="number">0</span>],high_score[<span class="number">1</span>],high_score[<span class="number">2</span>]);</div><div class="line">        <span class="built_in">strcat</span>(message,score_str);</div><div class="line">        MessageBox(hwnd,message,title,<span class="literal">NULL</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">//当前形状落地之后，更新board</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">shape_to_ground</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) &#123;</div><div class="line">            board[row+i][column+j]=shape[i][j]==<span class="number">1</span>?<span class="number">1</span>:board[row+i][column+j];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//形状下落</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_down</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    row++;</div><div class="line">    <span class="keyword">if</span>(!is_legel()) &#123;</div><div class="line">        row--;</div><div class="line">        <span class="keyword">if</span>(check_is_lose()) &#123;</div><div class="line">            lose_game(hwnd);</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        shape_to_ground();</div><div class="line">        clear_up();</div><div class="line">        update_UI_all(hwnd);</div><div class="line">        reset_rc();</div><div class="line">        give_new_shape();</div><div class="line">    &#125;</div><div class="line">    update_UI(hwnd);</div><div class="line">&#125;</div><div class="line"><span class="comment">//进程参数结构体</span></div><div class="line"><span class="keyword">struct</span> thread_arg &#123;</div><div class="line">    HWND arg_hwnd;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//形状下落进程要执行的函数</span></div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">down_thread_function</span><span class="params">(<span class="keyword">void</span> * args)</span> </span>&#123;</div><div class="line">    thread_arg *arg=(thread_arg*)args;</div><div class="line">    HWND dhwnd=arg-&gt;arg_hwnd;</div><div class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(is_pause) &#123;</div><div class="line">            Sleep(<span class="number">300</span>);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        move_down(dhwnd);</div><div class="line">        Sleep(LONG_SLEEP);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//初始化形状下落进程</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_down_thread</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ret;</div><div class="line">    <span class="keyword">pthread_t</span> t;</div><div class="line">    thread_arg *argp=<span class="keyword">new</span> thread_arg;</div><div class="line">    argp-&gt;arg_hwnd=hwnd;</div><div class="line">    ret=pthread_create(&amp;t,<span class="literal">NULL</span>,down_thread_function,argp);</div><div class="line">    <span class="keyword">delete</span> argp;</div><div class="line">    <span class="keyword">if</span>(ret!=<span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//初始化游戏程序</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_game</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    board=<span class="keyword">new</span> <span class="keyword">int</span>*[NN];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;NN; i++) &#123;</div><div class="line">        board[i]=<span class="keyword">new</span> <span class="keyword">int</span>[MM];</div><div class="line">    &#125;</div><div class="line">    shape=<span class="keyword">new</span> <span class="keyword">int</span>*[<span class="number">4</span>];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        shape[i]=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>];</div><div class="line">    &#125;</div><div class="line">    srand(time(<span class="number">0</span>));</div><div class="line">    <span class="keyword">if</span>(load_shape()!=<span class="number">0</span>) &#123;</div><div class="line">        MessageBox(hwnd,<span class="string">"Read file error.Program will exit."</span>,<span class="string">"Error"</span>,<span class="literal">NULL</span>);</div><div class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    init_play();</div><div class="line">    update_UI_all(hwnd);</div><div class="line">    <span class="keyword">if</span>(init_down_thread(hwnd)!=<span class="number">0</span>) &#123;</div><div class="line">        MessageBox(hwnd,<span class="string">"Thread error.Program will exit."</span>,<span class="string">"Error"</span>,<span class="literal">NULL</span>);</div><div class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//形状左右移动</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_lr</span><span class="params">(HWND hwnd,<span class="keyword">int</span> lr)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> temp=column;</div><div class="line">    <span class="keyword">if</span>(lr==<span class="number">0</span>)column--;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        column++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(!is_legel()) &#123;</div><div class="line">        column=temp;</div><div class="line">    &#125;</div><div class="line">    update_UI(hwnd);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">handle_key</span><span class="params">(HWND hwnd,WPARAM wParam)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_ESCAPE) &#123;<span class="comment">//ESC退出</span></div><div class="line">        exit_game(hwnd);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_SPACE) &#123;<span class="comment">//空格暂停</span></div><div class="line">        is_pause=!is_pause;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(is_pause==<span class="literal">true</span>) &#123;</div><div class="line">        Sleep(<span class="number">300</span>);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_UP) &#123;</div><div class="line">        rotate_shape(hwnd);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_DOWN) &#123;</div><div class="line">        move_down(hwnd);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_LEFT) &#123;</div><div class="line">        move_lr(hwnd,<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_RIGHT) &#123;</div><div class="line">        move_lr(hwnd,<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*  This function is called by the Windows function DispatchMessage()  */</span></div><div class="line">HWND hwnd;</div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> HDC hdc;</div><div class="line">    <span class="keyword">static</span> HDC hdcBuffer;</div><div class="line">    <span class="keyword">static</span> HBITMAP hBitMap;</div><div class="line">    <span class="keyword">static</span> PAINTSTRUCT ps ;</div><div class="line">    <span class="keyword">switch</span> (message) &#123;                <span class="comment">/* handle the messages */</span></div><div class="line">    <span class="keyword">case</span> WM_CREATE:</div><div class="line">        init_game(hwnd);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_KEYDOWN:</div><div class="line">        handle_key(hwnd,wParam);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_DESTROY:</div><div class="line">        exit_game(hwnd);</div><div class="line">        PostQuitMessage (<span class="number">0</span>);       <span class="comment">/* send a WM_QUIT to the message queue */</span></div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_PAINT:</div><div class="line">        hdc = BeginPaint (hwnd, &amp;ps) ;</div><div class="line">        paint_UI(hdc);</div><div class="line">        EndPaint (hwnd, &amp;ps) ;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:                      <span class="comment">/* for messages that we don't deal with */</span></div><div class="line">        <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于2016年五一期间</p>
</li>
<li><p>随笔写于2016.5.8</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Java迷宫游戏]]></title>
      <url>http://maxuewei2.git.io/2016/05/08/%E8%BF%B7%E5%AE%AB/</url>
      <content type="html"><![CDATA[<h3 id="缘起："><a href="#缘起：" class="headerlink" title="缘起："></a>缘起：</h3><p>　　去年（大三上学期）比较喜欢写小游戏，于是想试着写个迷宫试一下。</p>
<h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p><img src="/imgs/maze1.jpg" alt="xiaoguo1"><br><a id="more"></a></p>
<p>按下空格显示路径：<br><img src="/imgs/maze2.jpg" alt="xiaoguo2"></p>
<h3 id="思考过程："><a href="#思考过程：" class="headerlink" title="思考过程："></a>思考过程：</h3><p>　　迷宫由一个一个格子组成，要求从入口到出口只有一条路径.</p>
<p>　　想了一下各种数据结构，似乎树是比较合适的，从根节点到每一个子节点都只有一条路径。假设入口是根节点，出口是树中某个子节点，那么，从根节点到该子节点的路径肯定是唯一的。</p>
<p>　　所以如果能构造一棵树把所有的格子都覆盖到，也就能够做出一个迷宫了。</p>
<p>　　另外还要求树的父节点和子节点必须是界面上相邻的格子。</p>
<p>　　在界面显示时，父节点和子节点之间共用的边不画，其他的边都画出来，就能画出一个迷宫。</p>
<p>　　之后就是想一下该怎么实现这样一棵树。</p>
<p>首要的两个问题：<br>&gt;</p>
<ol>
<li>树怎么表示？<br>&gt;</li>
<li>怎么构造这棵树？</li>
</ol>
<p>　　</p>
<p><strong>1.树怎么表示？</strong><br>　　假设像写二叉树一样实现这棵树，那么每个树节点里就要存储一个坐标（X,Y）表示一个格子，另外还要存储四个指针。指针中有的为空，有的不为空，不为空的指针指向子节点，子节点保存邻居格子的坐标。这样做最大的问题是无法判定是否所有的格子都在树中。也许还要用一个二维数组作标志数组。</p>
<p>　　假如用二维数组表示迷宫的格子。每个数组元素存储一个指向父节点的引用，这样也可以形成一个虚拟的树。于是就用一个N<em>N的二维数组，表示N</em>N个格子，每个数组元素(Lattice)中有一个指向父节点的引用(father)。另外，为了能方便的获取格子的坐标，还要保存坐标信息。</p>
<p><strong>2.怎么构造这棵树？</strong><br>　　首先选定一个格子作为根节点。为了让迷宫的形状够随机，我选择随机生成一个坐标作为根节点。其实，选择确定的一个坐标也可以。</p>
<p>　　然后，怎样往这棵树上增加节点呢？</p>
<p>　　在这里我走了不少弯路，一开始想的是一种现在看来类似回溯的算法（当时还不知道回溯算法。。），但是时间复杂度很高，大概当迷宫为64*64的时候，算法就不出结果了。</p>
<p>　　然后，又使用了一种扫深度搜索也是回溯描的方法，每次扫描在当前树中找一个节点，看它的邻居格子是否在树中，如果还没在树中，就将该邻居格子加入树中，如果已在树中，就看下一个邻居格子，如果该节点所有邻居格子都在树中了，就找下一个节点，继续同样的操作。另外为了让迷宫生成的随机，扫描的起始位置是随机的就可以了。但是，该方法生成的迷宫中的路径总是不够深，没有我想要的曲折深入的效果。毕竟是类似广度搜索的方法。而且，这样做总还像是靠蛮力，算法不够聪明简洁。</p>
<p>　　最后，我终于想到使用深度搜索。。大概是因为数据结构已经学过了一年，又没太练，忘了不少，所以一直没想到这个应该第一想到的方法。。</p>
<p>　　随机选择一个格子作为根节点，从它开始随机地深度搜索前进，开出一条路来，直到无路可走了，退回一步，换另一条路，再走到无路可走，回退一步，换另一条……如此循环往复，直到完全无路可走。。。其实也还是回溯。</p>
<p>　　在程序里就是以下过程（详见代码中的<code>createMaze()</code>函数）：<br>&gt;<br>　　　　随机选择一个格子作为根节点，将它压进栈里。<br>&gt;<br>　　　　然后在栈不为空的时候执行以下循环：</p>
<blockquote>
<p>&gt;<br>　　　　　　取出一个格子，将它的INTREE标志设置为1，然后将它的所有不在树中的邻居格子压进栈里（顺序随机），并且让这些邻居格子的father指向该格子。</p>
</blockquote>
<p>　　</p>
<p>　　解决了这两个问题，其余的画迷宫、显示路径、小球移动也就比较简单了。</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> maze;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.awt.Color;</div><div class="line"><span class="keyword">import</span> java.awt.Graphics;</div><div class="line"><span class="keyword">import</span> java.awt.event.KeyAdapter;</div><div class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</div><div class="line"><span class="keyword">import</span> java.util.Random;</div><div class="line"><span class="keyword">import</span> java.util.Stack;</div><div class="line"><span class="keyword">import</span> javax.swing.JFrame;</div><div class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</div><div class="line"><span class="keyword">import</span> javax.swing.JPanel;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lattice</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INTREE = <span class="number">1</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NOTINTREE = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> y = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> flag = NOTINTREE;</div><div class="line">    <span class="keyword">private</span> Lattice father = <span class="keyword">null</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Lattice</span><span class="params">(<span class="keyword">int</span> xx, <span class="keyword">int</span> yy)</span> </span>&#123;</div><div class="line">        x = xx;</div><div class="line">        y = yy;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> y;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFlag</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> flag;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> Lattice <span class="title">getFather</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> father;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFather</span><span class="params">(Lattice f)</span> </span>&#123;</div><div class="line">        father = f;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlag</span><span class="params">(<span class="keyword">int</span> f)</span> </span>&#123;</div><div class="line">        flag = f;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(<span class="string">"("</span> + x + <span class="string">","</span> + y + <span class="string">")\n"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Maze</span> <span class="keyword">extends</span> <span class="title">JPanel</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">8300339045454852626L</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> NUM, width, padding;<span class="comment">// width 每个格子的宽度和高度</span></div><div class="line">    <span class="keyword">private</span> Lattice[][] maze;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ballX, ballY;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> drawPath = <span class="keyword">false</span>;</div><div class="line">    Maze(<span class="keyword">int</span> m, <span class="keyword">int</span> wi, <span class="keyword">int</span> p) &#123;</div><div class="line">        NUM = m;</div><div class="line">        width = wi;</div><div class="line">        padding = p;</div><div class="line">        maze = <span class="keyword">new</span> Lattice[NUM][NUM];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= NUM - <span class="number">1</span>; i++)</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= NUM - <span class="number">1</span>; j++)</div><div class="line">                maze[i][j] = <span class="keyword">new</span> Lattice(i, j);</div><div class="line">        createMaze();</div><div class="line">        setKeyListener();</div><div class="line">        <span class="keyword">this</span>.setFocusable(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= NUM - <span class="number">1</span>; i++)</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= NUM - <span class="number">1</span>; j++) &#123;</div><div class="line">                maze[i][j].setFather(<span class="keyword">null</span>);</div><div class="line">                maze[i][j].setFlag(Lattice.NOTINTREE);</div><div class="line">            &#125;</div><div class="line">        ballX = <span class="number">0</span>;</div><div class="line">        ballY = <span class="number">0</span>;</div><div class="line">        drawPath = <span class="keyword">false</span>;</div><div class="line">        createMaze();</div><div class="line">        <span class="comment">// setKeyListener();</span></div><div class="line">        <span class="keyword">this</span>.setFocusable(<span class="keyword">true</span>);</div><div class="line">        repaint();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCenterX</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> padding + x * width + width / <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCenterY</span><span class="params">(<span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> padding + y * width + width / <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCenterX</span><span class="params">(Lattice p)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> padding + p.getY() * width + width / <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCenterY</span><span class="params">(Lattice p)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> padding + p.getX() * width + width / <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkIsWin</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (ballX == NUM - <span class="number">1</span> &amp;&amp; ballY == NUM - <span class="number">1</span>) &#123;</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"YOU WIN !"</span>, <span class="string">"你走出了迷宫。"</span>,</div><div class="line">                    JOptionPane.PLAIN_MESSAGE);</div><div class="line">            init();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> tx = ballX, ty = ballY;</div><div class="line">        <span class="comment">// System.out.println(c);</span></div><div class="line">        <span class="keyword">switch</span> (c) &#123;</div><div class="line">            <span class="keyword">case</span> KeyEvent.VK_LEFT :</div><div class="line">                ty--;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> KeyEvent.VK_RIGHT :</div><div class="line">                ty++;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> KeyEvent.VK_UP :</div><div class="line">                tx--;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> KeyEvent.VK_DOWN :</div><div class="line">                tx++;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> KeyEvent.VK_SPACE :</div><div class="line">                <span class="keyword">if</span> (drawPath == <span class="keyword">true</span>) &#123;</div><div class="line">                    drawPath = <span class="keyword">false</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    drawPath = <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span> :</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!isOutOfBorder(tx, ty)</div><div class="line">                &amp;&amp; (maze[tx][ty].getFather() == maze[ballX][ballY]</div><div class="line">                        || maze[ballX][ballY].getFather() == maze[tx][ty])) &#123;</div><div class="line">            ballX = tx;</div><div class="line">            ballY = ty;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setKeyListener</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.addKeyListener(<span class="keyword">new</span> KeyAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> c = e.getKeyCode();</div><div class="line">                move(c);</div><div class="line">                repaint();</div><div class="line">                checkIsWin();</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isOutOfBorder</span><span class="params">(Lattice p)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> isOutOfBorder(p.getX(), p.getY());</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isOutOfBorder</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (x &gt; NUM - <span class="number">1</span> || y &gt; NUM - <span class="number">1</span> || x &lt; <span class="number">0</span> || y &lt; <span class="number">0</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">private</span> Lattice[] getNeis(Lattice p) &#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span>[] adds = &#123;-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>&#125;;<span class="comment">// 顺序为上右下左</span></div><div class="line">        <span class="keyword">if</span> (isOutOfBorder(p)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        Lattice[] ps = <span class="keyword">new</span> Lattice[<span class="number">4</span>];<span class="comment">// 顺序为上右下左</span></div><div class="line">        <span class="keyword">int</span> xt;</div><div class="line">        <span class="keyword">int</span> yt;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++) &#123;</div><div class="line">            xt = p.getX() + adds[i];</div><div class="line">            yt = p.getY() + adds[i + <span class="number">1</span>];</div><div class="line">            <span class="keyword">if</span> (isOutOfBorder(xt, yt))</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            ps[i] = maze[xt][yt];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ps;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createMaze</span><span class="params">()</span> </span>&#123;</div><div class="line">        Random random = <span class="keyword">new</span> Random();</div><div class="line">        <span class="keyword">int</span> rx = Math.abs(random.nextInt()) % NUM;</div><div class="line">        <span class="keyword">int</span> ry = Math.abs(random.nextInt()) % NUM;</div><div class="line">        Stack&lt;Lattice&gt; s = <span class="keyword">new</span> Stack&lt;Lattice&gt;();</div><div class="line">        Lattice p = maze[rx][ry];</div><div class="line">        Lattice neis[] = <span class="keyword">null</span>;</div><div class="line">        s.push(p);</div><div class="line">        <span class="keyword">while</span> (!s.isEmpty()) &#123;</div><div class="line">            p = s.pop();</div><div class="line">            p.setFlag(Lattice.INTREE);</div><div class="line">            neis = getNeis(p);</div><div class="line">            <span class="keyword">int</span> ran = Math.abs(random.nextInt()) % <span class="number">4</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> a = <span class="number">0</span>; a &lt;= <span class="number">3</span>; a++) &#123;</div><div class="line">                ran++;</div><div class="line">                ran %= <span class="number">4</span>;</div><div class="line">                <span class="keyword">if</span> (neis[ran] == <span class="keyword">null</span> || neis[ran].getFlag() == Lattice.INTREE)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                s.push(neis[ran]);</div><div class="line">                neis[ran].setFather(p);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// changeFather(maze[0][0],null);</span></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">changeFather</span><span class="params">(Lattice p, Lattice f)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (p.getFather() == <span class="keyword">null</span>) &#123;</div><div class="line">            p.setFather(f);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            changeFather(p.getFather(), p);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clearFence</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> fx, <span class="keyword">int</span> fy, Graphics g)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> sx = padding + ((j &gt; fy ? j : fy) * width),</div><div class="line">                sy = padding + ((i &gt; fx ? i : fx) * width),</div><div class="line">                dx = (i == fx ? sx : sx + width),</div><div class="line">                dy = (i == fx ? sy + width : sy);</div><div class="line">        <span class="keyword">if</span> (sx != dx) &#123;</div><div class="line">            sx++;</div><div class="line">            dx--;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            sy++;</div><div class="line">            dy--;</div><div class="line">        &#125;</div><div class="line">        g.drawLine(sx, sy, dx, dy);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">paintComponent</span><span class="params">(Graphics g)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.paintComponent(g);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= NUM; i++) &#123;</div><div class="line">            g.drawLine(padding + i * width, padding, padding + i * width,</div><div class="line">                    padding + NUM * width);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= NUM; j++) &#123;</div><div class="line">            g.drawLine(padding, padding + j * width, padding + NUM * width,</div><div class="line">                    padding + j * width);</div><div class="line">        &#125;</div><div class="line">        g.setColor(<span class="keyword">this</span>.getBackground());</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = NUM - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = NUM - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</div><div class="line">                Lattice f = maze[i][j].getFather();</div><div class="line">                <span class="keyword">if</span> (f != <span class="keyword">null</span>) &#123;</div><div class="line">                    <span class="keyword">int</span> fx = f.getX(), fy = f.getY();</div><div class="line">                    clearFence(i, j, fx, fy, g);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        g.drawLine(padding, padding + <span class="number">1</span>, padding, padding + width - <span class="number">1</span>);</div><div class="line">        <span class="keyword">int</span> last = padding + NUM * width;</div><div class="line">        g.drawLine(last, last - <span class="number">1</span>, last, last - width + <span class="number">1</span>);</div><div class="line">        g.setColor(Color.RED);</div><div class="line">        g.fillOval(getCenterX(ballY) - width / <span class="number">3</span>, getCenterY(ballX) - width / <span class="number">3</span>,</div><div class="line">                width / <span class="number">2</span>, width / <span class="number">2</span>);</div><div class="line">        <span class="keyword">if</span> (drawPath == <span class="keyword">true</span>)</div><div class="line">            drawPath(g);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawPath</span><span class="params">(Graphics g)</span> </span>&#123;</div><div class="line">        Color PATH_COLOR = Color.ORANGE, BOTH_PATH_COLOR = Color.PINK;</div><div class="line">        <span class="keyword">if</span> (drawPath == <span class="keyword">true</span>)</div><div class="line">            g.setColor(PATH_COLOR);</div><div class="line">        <span class="keyword">else</span></div><div class="line">            g.setColor(<span class="keyword">this</span>.getBackground());</div><div class="line">        Lattice p = maze[NUM - <span class="number">1</span>][NUM - <span class="number">1</span>];</div><div class="line">        <span class="keyword">while</span> (p.getFather() != <span class="keyword">null</span>) &#123;</div><div class="line">            p.setFlag(<span class="number">2</span>);</div><div class="line">            p = p.getFather();</div><div class="line">        &#125;</div><div class="line">        g.fillOval(getCenterX(p) - width / <span class="number">3</span>, getCenterY(p) - width / <span class="number">3</span>,</div><div class="line">                width / <span class="number">2</span>, width / <span class="number">2</span>);</div><div class="line">        p = maze[<span class="number">0</span>][<span class="number">0</span>];</div><div class="line">        <span class="keyword">while</span> (p.getFather() != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (p.getFlag() == <span class="number">2</span>) &#123;</div><div class="line">                p.setFlag(<span class="number">3</span>);</div><div class="line">                g.setColor(BOTH_PATH_COLOR);</div><div class="line">            &#125;</div><div class="line">            g.drawLine(getCenterX(p), getCenterY(p), getCenterX(p.getFather()),</div><div class="line">                    getCenterY(p.getFather()));</div><div class="line">            p = p.getFather();</div><div class="line">        &#125;</div><div class="line">        g.setColor(PATH_COLOR);</div><div class="line">        p = maze[NUM - <span class="number">1</span>][NUM - <span class="number">1</span>];</div><div class="line">        <span class="keyword">while</span> (p.getFather() != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (p.getFlag() == <span class="number">3</span>)</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            g.drawLine(getCenterX(p), getCenterY(p), getCenterX(p.getFather()),</div><div class="line">                    getCenterY(p.getFather()));</div><div class="line">            p = p.getFather();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> n = <span class="number">30</span>, width = <span class="number">600</span>, padding = <span class="number">20</span>, LX = <span class="number">200</span>, LY = <span class="number">100</span>;</div><div class="line">        JPanel p = <span class="keyword">new</span> Maze(n, (width - padding - padding) / n, padding);</div><div class="line">        JFrame frame = <span class="keyword">new</span> JFrame(<span class="string">"MAZE(按空格键显示或隐藏路径)"</span>);</div><div class="line">        frame.getContentPane().add(p);</div><div class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</div><div class="line">        frame.setSize(width + padding, width + padding + padding);</div><div class="line">        frame.setLocation(LX, LY);</div><div class="line">        frame.setVisible(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>程序完成于大三上学期。</p>
</li>
<li><p>随笔写于2016.5.8</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[读文件错误]]></title>
      <url>http://maxuewei2.git.io/2016/04/29/%E8%AF%BB%E6%96%87%E4%BB%B6%E9%94%99%E8%AF%AF/</url>
      <content type="html"><![CDATA[<p>今天想写个小程序，但一开始就不顺利。</p>
<p>想从文件中读取数据，但使用 fscanf ，总是读不出任何信息。</p>
<p>最后无奈了，改用 fread 看一下能读出什么内容，发现除了开始几个字符是乱码，之后读取的数据都是正常的。</p>
<p>这个现象正是前一段时间遇到过的，因为文件编码是 UTF-8 ，所以无法读出正确的 ASCII 码。</p>
<p>马上将文件重新以 ANSI 格式编码。程序立刻正常了。<br><a id="more"></a></p>
<p><img src="/imgs/zhenggeshijieqingjingle.jpg" alt="qingjing"></p>
<p>之所以每次新建一个文本文档都是 UTF-8 编码，是去年编写网页时设置的。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[在文件夹中 的指定类型文件中 查找字符串（CodeBlocks+GCC编译，控制台程序，仅能在Windows上运行）]]></title>
      <url>http://maxuewei2.git.io/2016/04/15/findstr/</url>
      <content type="html"><![CDATA[<h3 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h3><p>　　程序使用 io.h 中的<code>_findfirst</code> 和 <code>_findnext</code> 函数遍历文件夹，故而程序只能在 Windows 下使用。　　</p>
<p>　　程序遍历当前文件夹，对其中的文件夹执行递归遍历。同时检查遍历到的文件是否属于指定类型，如果是，则将在该文件中查找指定字符串。　</p>
<p>　　在文件中查找字符串时，开辟一个与指定字符串 text （长度为len ）同样大小的字符串数组 temp 。数组上有两个指针：一个是字符串比较的开始位置 s ，一个是新字符写入的位置 d 。每从文件中读入一个字符，就写入 temp[d] ，之后 temp 从 s 到 d 与 text 从 0 到 len-1 比较，之后， s 与 d 均后移一位，再继续读入字符，写入，比较，后移。。。<br><a id="more"></a></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div></pre></td><td class="code"><pre><div class="line">#include&lt;stdio.h&gt;</div><div class="line">#include&lt;vector&gt;</div><div class="line">#include&lt;string.h&gt;</div><div class="line">#include&lt;io.h&gt;</div><div class="line">using namespace std;</div><div class="line"></div><div class="line">vector&lt;char*&gt; types;</div><div class="line">char text[256];</div><div class="line"></div><div class="line">void ls_path(char * path);</div><div class="line">bool is_in_types(char* filename);</div><div class="line">void findtext(char * filename,char* text);</div><div class="line"></div><div class="line">void solve(char* name,struct _finddata_t *f) &#123;</div><div class="line">    if(strcmp(f-&gt;name,".")==0)return ;</div><div class="line">    if(strcmp(f-&gt;name,"..")==0)return ;</div><div class="line">    char *fullpath=new char[256];</div><div class="line">    strcpy(fullpath,name);</div><div class="line">    int len=strlen(name);</div><div class="line">    fullpath[len-1]='\0';</div><div class="line">    strcat(fullpath,f-&gt;name);</div><div class="line">    if(f-&gt;attrib&amp;_A_SUBDIR) &#123;</div><div class="line">        strcat(fullpath,"/*");</div><div class="line">        ls_path(fullpath);</div><div class="line">    &#125; else &#123;</div><div class="line">        if(is_in_types(f-&gt;name)) &#123;</div><div class="line">            findtext(fullpath,text);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    delete fullpath;</div><div class="line">&#125;</div><div class="line">void ls_path(char * path) &#123;</div><div class="line">    struct _finddata_t f;</div><div class="line">    int p;</div><div class="line">    char *name=new char[260];</div><div class="line">    strcpy(name,path);</div><div class="line">    if((p=_findfirst(name, &amp;f))!=-1) &#123;</div><div class="line">        solve(name,&amp;f);</div><div class="line">        while(_findnext(p, &amp;f)==0) &#123;</div><div class="line">            solve(name,&amp;f);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    delete name;</div><div class="line">&#125;</div><div class="line">int strrncmp(char* a,const char* b,int n) &#123;//比较两字符串的最后n个字符</div><div class="line">    int len=strlen(a);</div><div class="line">    int j=0;</div><div class="line">    for(int i=len-n; i&lt;=len-1; i++) &#123;</div><div class="line">        if(a[i]!=b[j])return false;</div><div class="line">        j++;</div><div class="line">    &#125;</div><div class="line">    return j==n?true:false;</div><div class="line">&#125;</div><div class="line">bool is_in_types(char* filename) &#123;</div><div class="line">    for(int i=0; i&lt;types.size(); i++) &#123;</div><div class="line">        if(strrncmp(filename,types[i],strlen(types[i]))) &#123;</div><div class="line">            return true;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return false;</div><div class="line">&#125;</div><div class="line">bool cmp(const char* temp,const int len,const int s,const int d,const char* text) &#123;</div><div class="line">    int j=0;</div><div class="line">    for(int i=s;; i++,i%=len) &#123;</div><div class="line">        if(temp[i]!=text[j])return false;</div><div class="line">        if(i==d)break;</div><div class="line">        j++;</div><div class="line">    &#125;</div><div class="line">    return true;</div><div class="line">&#125;</div><div class="line">void findtext(char * filename,char* text) &#123;</div><div class="line">    FILE *f=fopen(filename,"r");</div><div class="line">    char c;</div><div class="line">    int linenum=0;</div><div class="line">    int len=strlen(text);</div><div class="line">    char* temp=new char[len];</div><div class="line">    int s=0,d=len-1;</div><div class="line">    while(c=fgetc(f),c!=EOF) &#123;</div><div class="line">        temp[d]=c;</div><div class="line">        if(cmp(temp,len,s,d,text))printf("文件名: %s \n行号: %d\n",filename,linenum+1);</div><div class="line">        if(c=='\n'||c=='\r'||c=='\r\n') &#123;</div><div class="line">            linenum++;</div><div class="line">        &#125;</div><div class="line">        d++;</div><div class="line">        d%=len;</div><div class="line">        s++;</div><div class="line">        s%=len;</div><div class="line">    &#125;</div><div class="line">    delete temp;</div><div class="line">    fclose(f);</div><div class="line">&#125;</div><div class="line">int main() &#123;</div><div class="line">    printf("**************************************\n");</div><div class="line">    printf("本程序在其所在文件夹中查找指定类型文件\n中是否有指定字符串，并输出所在行号。\n");</div><div class="line">    printf("              CopyRight:  maxuewei2\n");</div><div class="line">    printf("**************************************\n");</div><div class="line">    while(true) &#123;</div><div class="line">        types.clear();</div><div class="line">        printf("\n请输入要查找的字符串:\n");</div><div class="line">        while(gets(text),strcmp(text,"")==0);</div><div class="line">        printf("请输入文件类型，如‘txt’:(按两下ENTER开始查找)\n");</div><div class="line">        char t[30];</div><div class="line">        while(gets(t),strcmp(t,"")!=0) &#123;</div><div class="line">            char* tt=new char[30];</div><div class="line">            strcpy(tt,".");</div><div class="line">            strcat(tt,t);</div><div class="line">            types.push_back(tt);</div><div class="line">        &#125;</div><div class="line">        delete t;</div><div class="line">        printf("查找结果:\n");</div><div class="line">        ls_path("*");</div><div class="line">    &#125;</div><div class="line">    types.clear();</div><div class="line">    delete text;</div><div class="line">    getchar();</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="运行效果："><a href="#运行效果：" class="headerlink" title="运行效果："></a>运行效果：</h3><p><img src="/imgs/findstr.jpg" alt="xiaoguo"></p>
<ul>
<li><p>程序完成于2016.4.15</p>
</li>
<li><p>博客更新于2016.4.15</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Flappy Bird (Java实现)]]></title>
      <url>http://maxuewei2.git.io/2016/04/12/FlappyBird/</url>
      <content type="html"><![CDATA[<h3 id="运行效果："><a href="#运行效果：" class="headerlink" title="运行效果："></a>运行效果：</h3><p><img src="/imgs/flappybird1.jpg" alt="效果"><br><a id="more"></a></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> bird;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.awt.Graphics;</div><div class="line"><span class="keyword">import</span> java.awt.Image;</div><div class="line"><span class="keyword">import</span> java.awt.Toolkit;</div><div class="line"><span class="keyword">import</span> java.awt.event.KeyAdapter;</div><div class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.BufferedWriter;</div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.FileReader;</div><div class="line"><span class="keyword">import</span> java.io.FileWriter;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.Random;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.swing.JFrame;</div><div class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</div><div class="line"><span class="keyword">import</span> javax.swing.JPanel;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span>  <span class="keyword">extends</span> <span class="title">JPanel</span>  </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> WIDTH=<span class="number">288</span>;</div><div class="line">    <span class="keyword">private</span>  <span class="keyword">int</span> HEIGHT=<span class="number">512</span>+<span class="number">112</span>;</div><div class="line"><span class="comment">//    Image img;</span></div><div class="line">    <span class="keyword">private</span>  Image bg,land,pipe_up,pipe_down,bird,score_h,score_t,score_n;</div><div class="line">    <span class="keyword">private</span>  <span class="keyword">int</span> y=<span class="number">300</span>,land_x=<span class="number">0</span>,pipe_x=<span class="number">200</span>,current_y=<span class="number">0</span>,time=<span class="number">0</span>,down=<span class="number">0</span>,bg_x=<span class="number">0</span>,t=<span class="number">0</span>,score=<span class="number">0</span>,yt=-<span class="number">1</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>, c = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] pipe_ys=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>];</div><div class="line">    <span class="keyword">private</span>  Image [] score_number=<span class="keyword">new</span> Image[<span class="number">10</span>];</div><div class="line">    <span class="keyword">private</span> Random random;</div><div class="line">    Bird()&#123;</div><div class="line">        getBestScores() ;</div><div class="line">        Toolkit tool = <span class="keyword">this</span>.getToolkit();</div><div class="line">        bg= tool.getImage(<span class="string">"images/bg_day.png"</span>);</div><div class="line">        land=tool.getImage(<span class="string">"images/land.png"</span>);</div><div class="line">        pipe_up= tool.getImage(<span class="string">"images/pipe_up.png"</span>);</div><div class="line">        pipe_down= tool.getImage(<span class="string">"images/pipe_down.png"</span>);</div><div class="line">        bird= tool.getImage(<span class="string">"images/bird0_01.png"</span>);</div><div class="line">        random = <span class="keyword">new</span> Random();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">9</span>;i++)&#123;</div><div class="line">        score_number[i]= tool.getImage(<span class="string">"images/number_score_0"</span>+i+<span class="string">".png"</span>);</div><div class="line">        &#125;</div><div class="line">        init();</div><div class="line">        <span class="keyword">this</span>.addKeyListener(</div><div class="line">                <span class="keyword">new</span> KeyAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> c = e.getKeyCode();</div><div class="line">                <span class="comment">//System.out.print(c);</span></div><div class="line"></div><div class="line">                <span class="keyword">switch</span> (c) &#123;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_LEFT :</div><div class="line"></div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_RIGHT :</div><div class="line"></div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_UP :</div><div class="line">                    System.exit(<span class="number">0</span>);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_DOWN :</div><div class="line"></div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_SPACE :</div><div class="line">                        down=<span class="number">0</span>;</div><div class="line">                        <span class="keyword">if</span>(time&lt;=<span class="number">0</span>)time=<span class="number">16</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                    <span class="keyword">default</span> :</div><div class="line">                        <span class="comment">// System.out.print("hey");</span></div><div class="line"></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">this</span>.setFocusable(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line">        y=<span class="number">300</span>;</div><div class="line">        land_x=<span class="number">0</span>;</div><div class="line">        pipe_x=<span class="number">200</span>;</div><div class="line">        current_y=<span class="number">0</span>;</div><div class="line">        time=<span class="number">0</span>;</div><div class="line">        down=<span class="number">0</span>;</div><div class="line">        bg_x=<span class="number">0</span>;</div><div class="line">        t=<span class="number">0</span>;</div><div class="line">        score=<span class="number">0</span>;</div><div class="line">        yt=-<span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">3</span>;i++)&#123;</div><div class="line">            pipe_ys[i]=-<span class="number">1</span>* Math.abs(random.nextInt()) % <span class="number">150</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get_Height</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> HEIGHT;&#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get_Width</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> WIDTH;&#125;</div><div class="line">    <span class="function"><span class="keyword">private</span>  <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</div><div class="line">            moveImg();</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">            Thread.sleep(<span class="number">10</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        moveBird();</div><div class="line">        repaint();</div><div class="line">        check();</div><div class="line">        t++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span>  <span class="title">moveBird</span><span class="params">()</span></span>&#123;</div><div class="line">        time--;</div><div class="line">        <span class="keyword">if</span>(t%<span class="number">1</span>==<span class="number">0</span>)&#123;<span class="keyword">if</span>(time&gt;<span class="number">0</span>)&#123;y-=<span class="number">4</span>;&#125;&#125;</div><div class="line">        <span class="keyword">if</span>(time&lt;=-<span class="number">5</span>&amp;&amp;y&lt;=<span class="number">512</span>-<span class="number">37</span>)&#123;<span class="keyword">if</span>(t%<span class="number">3</span>==<span class="number">0</span>)&#123;down+=<span class="number">1</span>;y+=down;&#125;&#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">moveImg</span><span class="params">()</span></span>&#123;</div><div class="line">        bg_x--;</div><div class="line">        <span class="keyword">if</span>(bg_x&lt;-<span class="number">288</span>)bg_x+=<span class="number">288</span>;</div><div class="line">        land_x-=<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(land_x&lt;-<span class="number">20</span>)land_x+=<span class="number">23</span>;</div><div class="line">        pipe_x-=<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(pipe_x&lt;=-<span class="number">52</span>)&#123;</div><div class="line">            pipe_x+=<span class="number">200</span>;</div><div class="line">            <span class="keyword">int</span> ran = Math.abs(random.nextInt()) % <span class="number">200</span>;</div><div class="line">            ran=-ran;</div><div class="line">            pipe_ys[current_y]=ran;</div><div class="line">            current_y++;</div><div class="line">            current_y%=<span class="number">4</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> temp=current_y;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">3</span>;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(<span class="number">80</span>+<span class="number">34</span>&gt;=pipe_x&amp;&amp;<span class="number">80</span>&lt;=pipe_x+<span class="number">52</span>)&#123;</div><div class="line">                <span class="keyword">if</span>(yt!=current_y)&#123;score++;yt=current_y;&#125;</div><div class="line">                <span class="keyword">if</span>(y&lt;=pipe_ys[temp]+<span class="number">320</span>||y+<span class="number">25</span>&gt;=pipe_ys[temp]+<span class="number">450</span>)&#123;</div><div class="line">                    gameOver();</div><div class="line">                init();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">gameOver</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (score &gt; a) &#123;</div><div class="line">            c = b;</div><div class="line">            b = a;</div><div class="line">            a = score;</div><div class="line">            save();</div><div class="line">            <span class="comment">//System.exit(0);</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (score &gt; b) &#123;</div><div class="line">            c = b;</div><div class="line">            b = score;</div><div class="line">            save();</div><div class="line">            <span class="comment">//System.exit(0);</span></div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (score &gt; c) &#123;</div><div class="line">            c = score;</div><div class="line">            save();</div><div class="line">            <span class="comment">//System.exit(0);</span></div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"GAME OVER!\n\nBEST SCORE:\n"</span>+a+<span class="string">"\n"</span>+b+<span class="string">"\n"</span>+c, <span class="string">"你死了(按任意键再来一次)"</span>,</div><div class="line">                JOptionPane.PLAIN_MESSAGE);</div><div class="line">        <span class="comment">//System.exit(0);</span></div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getBestScores</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        BufferedReader reader = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">"score.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            a = Integer.parseInt(reader.readLine());</div><div class="line">            b = Integer.parseInt(reader.readLine());</div><div class="line">            c = Integer.parseInt(reader.readLine());</div><div class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*String bestS = new String("Best Score: " + new Integer(a).toString()</span></div><div class="line">                + "   " + new Integer(b).toString() + "   "</div><div class="line">                + new Integer(c).toString());*/</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        BufferedWriter writer = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"score.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        String d = <span class="keyword">new</span> Integer(a).toString(), e = <span class="keyword">new</span> Integer(b).toString(),</div><div class="line">                f = <span class="keyword">new</span> Integer(c).toString();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            writer.write(d);</div><div class="line">            writer.newLine();</div><div class="line">            writer.write(e);</div><div class="line">            writer.newLine();</div><div class="line">            writer.write(f);</div><div class="line">            writer.flush();</div><div class="line">            writer.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException ev) &#123;</div><div class="line">            ev.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException ev) &#123;</div><div class="line">            ev.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showScore</span><span class="params">(Graphics g)</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> score_h=score/<span class="number">100</span>,score_t=score%<span class="number">100</span>/<span class="number">10</span>,score_n=score%<span class="number">10</span>;</div><div class="line">        <span class="keyword">if</span>(score_h!=<span class="number">0</span>)&#123;g.drawImage(score_number[score_h], <span class="number">80</span>,<span class="number">20</span>,<span class="keyword">this</span>);&#125;</div><div class="line">        g.drawImage(score_number[score_t], <span class="number">80</span>+<span class="number">20</span>,<span class="number">20</span>,<span class="keyword">this</span>);</div><div class="line">        g.drawImage(score_number[score_n], <span class="number">80</span>+<span class="number">20</span>+<span class="number">20</span>,<span class="number">20</span>,<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">(Graphics g)</span> </span>&#123;<span class="comment">//Component</span></div><div class="line">        <span class="keyword">super</span>.paintComponent(g);</div><div class="line">        <span class="comment">//g.drawLine(x,y,200,200);</span></div><div class="line">        g.drawImage(bg, bg_x,<span class="number">0</span>,<span class="keyword">this</span>);</div><div class="line">        g.drawImage(bg, bg_x+<span class="number">288</span>,<span class="number">0</span>,<span class="keyword">this</span>);</div><div class="line">        <span class="comment">//g.drawImage(land_1, landx_1, HEIGHT-land_1.getHeight(this), WIDTH,WIDTH*land_1.getHeight(this)/land_1.getWidth(this), this);</span></div><div class="line"></div><div class="line">        <span class="keyword">int</span> temp=current_y;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">3</span>;i++)&#123;</div><div class="line">        g.drawImage(pipe_down,pipe_x+i*<span class="number">200</span>,pipe_ys[temp],<span class="keyword">this</span>);</div><div class="line">        g.drawImage(pipe_up,pipe_x+i*<span class="number">200</span>,pipe_ys[temp]+<span class="number">450</span>,<span class="keyword">this</span>);</div><div class="line">        g.drawImage(bird,<span class="number">80</span>,y,<span class="keyword">this</span>);</div><div class="line">        temp++;</div><div class="line">        temp%=<span class="number">4</span>;</div><div class="line">        &#125;</div><div class="line">        g.drawImage(land, land_x,<span class="number">512</span>,<span class="keyword">this</span>);</div><div class="line">        showScore(g);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        JFrame frame = <span class="keyword">new</span> JFrame(<span class="string">"（按UP键退出）"</span>);</div><div class="line">        Bird b=<span class="keyword">new</span> Bird();</div><div class="line">        frame.getContentPane()</div><div class="line">                .add(b);</div><div class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</div><div class="line">        frame.setSize(b.get_Width(),b.get_Height());</div><div class="line">        frame.setLocation(<span class="number">200</span>, <span class="number">100</span>);</div><div class="line">        frame.setVisible(<span class="keyword">true</span>);</div><div class="line">        b.move();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="素材："><a href="#素材：" class="headerlink" title="素材："></a>素材：</h3><p>bg_day.png<br><img src="/imgs/bg_day.png" alt="bg"></p>
<p>bird0_01.png<br><img src="/imgs/bird0_01.png" alt="bg"></p>
<p>land.png<br><img src="/imgs/land.png" alt="bg"></p>
<p>pipe_up.png<br><img src="/imgs/pipe_up.png" alt="bg"></p>
<p>pipe_down.png<br><img src="/imgs/pipe_down.png" alt="bg"></p>
<p>number_score_00.png~number_score_09.png    (数字均为白色，图片背景为透明。为能够在博客中显示出来，特设置为灰色背景)</p>
<div style="background-color:rgb(200,200,200)"><br><img src="/imgs/number_score_00.png" alt="bg"><br><img src="/imgs/number_score_01.png" alt="bg"><br><img src="/imgs/number_score_02.png" alt="bg"><br><img src="/imgs/number_score_03.png" alt="bg"><br><img src="/imgs/number_score_04.png" alt="bg"><br><img src="/imgs/number_score_05.png" alt="bg"><br><img src="/imgs/number_score_06.png" alt="bg"><br><img src="/imgs/number_score_07.png" alt="bg"><br><img src="/imgs/number_score_08.png" alt="bg"><br><img src="/imgs/number_score_09.png" alt="bg"><br><br></div>




















<ul>
<li><p>程序写于大三上学期。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[局域网象棋游戏（C++实现，使用Socket，界面使用Win32，CodeBlocks+GCC编译）]]></title>
      <url>http://maxuewei2.git.io/2016/03/22/%E5%B1%80%E5%9F%9F%E7%BD%91%E8%B1%A1%E6%A3%8B/</url>
      <content type="html"><![CDATA[<p>&gt;</p>
<ul>
<li>目录<ul>
<li><a href="#chengguo">成果</a><ul>
<li><a href="#xiaoguo">运行效果图</a></li>
</ul>
</li>
<li><a href="#guocheng">过程</a><ul>
<li><a href="#liangduan">1. 首先的问题是下棋的两端应该是什么样的？</a></li>
<li><a href="#cunchu">2. 接下来的问题是怎么表示，怎么存储？</a></li>
<li><a href="#tongxin">3. 然后应该怎么通信呢？</a></li>
</ul>
</li>
<li><a href="#daima">代码</a><ul>
<li><a href="#main">main.cpp</a></li>
<li><a href="#chess">chinese_chess.h</a></li>
<li><a href="#server">Server.h</a></li>
<li><a href="#client">Client.h</a></li>
</ul>
</li>
<li><a href="#end">END</a><a id="more"></a>
</li>
</ul>
</li>
</ul>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<p></p><h2 id="chengguo">成果</h2><p></p>
<h3 id="xiaoguo">运行效果图</h3>

<p>　　左边是在虚拟机里运行的，右边是在Host机上运行的。<br><img src="/imgs/xiangqi1.jpg" alt="chengguo"><br><img src="/imgs/xiangqi2.jpg" alt="chengguo"></p>
<p></p><h2 id="guocheng">过程</h2><br>　　记不起自己为什么要写这个象棋游戏的，大概是因为刚学了点儿Socket ，所以想用用，于是就写个局域网对战的象棋吧。。。<p></p>
<h3 id="liangduan">1.首先的问题是下棋的两端应该是什么样的？</h3>


<p>　　我希望下棋的两个人使用相同的程序。所以就不能像FTP一样，一个客户端，一个服务器端，而只能每个程序都是一样的，既是客户端（Client），又是服务器端（Server）。在通信时，己方的Client 向对方的Server 发送信息，对方的Client 向己方的Server 发送信息。两端都存储棋盘信息，通过通信保持棋盘信息的一致。</p>
<p>　　然后呢，应该是一端点击界面移子之后，应该能通知对方进行相同的移动。</p>
<p>　　综合以上两点，运行过程应该是这样的：</p>
<p>　　当在界面上点击棋子时，先判断当前是否轮到自己落子，如果是，则进行移动，更新界面，并通过Client 向对方Server 发送移动信息。对方Server 收到后，进行同样的移动，更新界面。</p>
<p>　　这里要求Server能随时接到对方发来的消息，所以Server的监听应该是一个额外的线程。</p>
<h3 id="cunchu">2.接下来的问题是怎么表示，怎么存储？</h3>

<p>　　棋盘，应该用二维数组存储比较好，数组坐标（以下所说的”数组坐标 “是指该二维数组中的一个(x,y)数对）对应棋盘坐标。那么数组里存储什么呢，一共有車、马、象、士、将、砲、卒七种棋子，那么设置一个棋子类作为基类，然后设置七个类继承棋子类？基类有一个move函数，每个子类重写该函数？但是移动似乎只是我程序的一小部分，这样似乎没必要。</p>
<p>　　那么存储整型数值？不同的数值代表不同的棋子？似乎可以。</p>
<p>　　那么就用7个数代替七种棋子，但是棋子有黑白色，要用一个数表示棋子类型（即是車、马或其他）和棋子颜色两个信息，那就用BLANK =8代表空子，黑方的車、马、象、士、将、砲、卒分别为1到7，白方的車、马、相、士、帅、炮、兵分别为9到15。</p>
<p>　　这样判断某数组坐标上棋子的颜色，就把其值与BLANK 比较，大于BLANK为白色，否则为黑色。</p>
<p>　　判断某数组坐标上棋子的类型，则将其值模BLANK 。</p>
<p>　　另外，因为下棋双方的视角是相反的，所以，棋盘在存储时应该是相反的，移动时的坐标也应该进行转换。</p>
<h3 id="tongxin">3.然后应该怎么通信呢？</h3>

<p>　　我希望这个程序打开后，就能找到对方，并确定谁是黑色，谁是白色。</p>
<p>　　也许可以让Client 在运行之后就对局域网进行端口扫描，然后给出正在运行此程序的IP 地址列表，让用户选择要连接到哪个，如果对方已经有了连接，则对方会拒绝此连接，如果对方没有连接，则对方程序会向对方用户提示该连接请求，如果，对方用户同意，则连接建立，否则依然是拒绝此连接。</p>
<p>　　但是，我没有采用以上所述方法（因为太复杂，我还是先做好主体工作吧=_=）</p>
<p>　　所以在程序开始运行后，会让用户输入对方的IP 地址，然后Server 开始监听。之后Client 开始向对方发出连接请求。</p>
<p>　　Server 监听时，如果收到连接请求，就看对方的IP 地址是否是用户输入的IP 地址，如果不是，说明连接请求不是用户所希望的对方发送的，那就继续监听。</p>
<p>　　Client 请求连接时，如果对方同意了，就要开始确定自己的颜色了。</p>
<p>　　确定颜色这里困扰了我很久，最后采用的解决方法是这样的：<br>&gt;<br>　　　　核心思想就是谁先发出连接请求，谁就是黑色。</p>
<blockquote>
<p>　　　　也就是在Client 连接上对方之后，要判断Server 是不是已经连接了对方，如果Server 已连接，就说明是对方先发出的连接请求，那么对方就是黑色，自己就设为白色。如果Server 没有连接，就说明自己先连接上了对方，也就是自己是黑色。</p>
</blockquote>
<p>　　以上就是编码前及编码时的大致想法。</p>
<p></p><h2 id="daima">代码</h2><p></p>
<h3 id="main">main.cpp</h3>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(UNICODE) &amp;&amp; !defined(_UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(_UNICODE) &amp;&amp; !defined(UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"chinese_chess.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Server.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Client.h"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WIDTH 400       <span class="comment">//界面宽度</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEIGHT 400      <span class="comment">//界面高度</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZERO_X 50       <span class="comment">//棋盘左边界</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZERO_Y 50       <span class="comment">//棋盘上边界</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PIECE_BKCOLOR    RGB(175,143,89)   <span class="comment">//棋子背景色</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PIECE_WH 30        <span class="comment">//棋盘每个格子的宽度和高度</span></span></div><div class="line"></div><div class="line">HWND hwnd;               <span class="comment">/* This is the handle for our window */</span></div><div class="line"><span class="keyword">char</span>* ots_ip;           <span class="comment">//存储对方IP地址的字符串</span></div><div class="line"><span class="keyword">int</span> port;</div><div class="line"><span class="keyword">bool</span> is_connect_alive=<span class="literal">false</span>;        <span class="comment">//是否连接到对方</span></div><div class="line">Board * chess_board;          <span class="comment">//棋盘</span></div><div class="line">Server *server;</div><div class="line">Client *client;</div><div class="line"><span class="keyword">int</span> chess_sx=<span class="number">-1</span>;        <span class="comment">//移动起始位置的数组坐标</span></div><div class="line"><span class="keyword">int</span> chess_sy=<span class="number">-1</span>;</div><div class="line"><span class="keyword">int</span> chess_dx=<span class="number">-1</span>;        <span class="comment">//移动目标位置的数组坐标</span></div><div class="line"><span class="keyword">int</span> chess_dy=<span class="number">-1</span>;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*  Declare Windows procedure  */</span></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/*  Make the class name into a global variable  */</span></div><div class="line">TCHAR szClassName[ ] = _T(<span class="string">"Chinese Chess"</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span> <span class="params">(HINSTANCE hThisInstance,</span></span></div><div class="line">                    HINSTANCE hPrevInstance,</div><div class="line">                    LPSTR lpszArgument,</div><div class="line">                    <span class="keyword">int</span> nCmdShow) &#123;</div><div class="line">    MSG messages;            <span class="comment">/* Here messages to the application are saved */</span></div><div class="line">    WNDCLASSEX wincl;        <span class="comment">/* Data structure for the windowclass */</span></div><div class="line"></div><div class="line">    <span class="comment">/* The Window structure */</span></div><div class="line">    wincl.hInstance = hThisInstance;</div><div class="line">    wincl.lpszClassName = szClassName;</div><div class="line">    wincl.lpfnWndProc = WindowProcedure;      <span class="comment">/* This function is called by windows */</span></div><div class="line">    wincl.style = CS_DBLCLKS;                 <span class="comment">/* Catch double-clicks */</span></div><div class="line">    wincl.cbSize = <span class="keyword">sizeof</span> (WNDCLASSEX);</div><div class="line"></div><div class="line">    <span class="comment">/* Use default icon and mouse-pointer */</span></div><div class="line">    wincl.hIcon = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hIconSm = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hCursor = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW);</div><div class="line">    wincl.lpszMenuName = <span class="literal">NULL</span>;                 <span class="comment">/* No menu */</span></div><div class="line">    wincl.cbClsExtra = <span class="number">0</span>;                      <span class="comment">/* No extra bytes after the window class */</span></div><div class="line">    wincl.cbWndExtra = <span class="number">0</span>;                      <span class="comment">/* structure or the window instance */</span></div><div class="line">    <span class="comment">/* Use Windows's default colour as the background of the window */</span></div><div class="line">    wincl.hbrBackground = (HBRUSH) COLOR_BACKGROUND;</div><div class="line"></div><div class="line">    <span class="comment">/* Register the window class, and if it fails quit the program */</span></div><div class="line">    <span class="keyword">if</span> (!RegisterClassEx (&amp;wincl))</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* The class is registered, let's create the program*/</span></div><div class="line">    hwnd = CreateWindowEx (</div><div class="line">               <span class="number">0</span>,                   <span class="comment">/* Extended possibilites for variation */</span></div><div class="line">               szClassName,         <span class="comment">/* Classname */</span></div><div class="line">               _T(<span class="string">"Chinese Chess"</span>),       <span class="comment">/* Title Text */</span></div><div class="line">               WS_OVERLAPPEDWINDOW, <span class="comment">/* default window */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* Windows decides the position */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* where the window ends up on the screen */</span></div><div class="line">               WIDTH,                 <span class="comment">/* The programs width */</span></div><div class="line">               HEIGHT,                 <span class="comment">/* and height in pixels */</span></div><div class="line">               HWND_DESKTOP,        <span class="comment">/* The window is a child-window to desktop */</span></div><div class="line">               <span class="literal">NULL</span>,                <span class="comment">/* No menu */</span></div><div class="line">               hThisInstance,       <span class="comment">/* Program Instance handler */</span></div><div class="line">               <span class="literal">NULL</span>                 <span class="comment">/* No Window Creation data */</span></div><div class="line">           );</div><div class="line"></div><div class="line">    <span class="comment">/* Make the window visible on the screen */</span></div><div class="line">    ShowWindow (hwnd, nCmdShow);</div><div class="line"></div><div class="line">    <span class="comment">/* Run the message loop. It will run until GetMessage() returns 0 */</span></div><div class="line">    <span class="keyword">while</span> (GetMessage (&amp;messages, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>)) &#123;</div><div class="line">        <span class="comment">/* Translate virtual-key messages into character messages */</span></div><div class="line">        TranslateMessage(&amp;messages);</div><div class="line">        <span class="comment">/* Send message to WindowProcedure */</span></div><div class="line">        DispatchMessage(&amp;messages);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/* The program return-value is 0 - The value that PostQuitMessage() gave */</span></div><div class="line">    <span class="keyword">return</span> messages.wParam;</div><div class="line">&#125;</div><div class="line"><span class="comment">//把数组坐标转换为界面坐标</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">xy_to_pixel</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span>*pixelx,<span class="keyword">int</span> *pixely)</span> </span>&#123;</div><div class="line">    *pixely=x*PIECE_WH+ZERO_Y;</div><div class="line">    *pixelx=y*PIECE_WH+ZERO_X;</div><div class="line">&#125;</div><div class="line"><span class="comment">//把界面坐标转换为数组坐标</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">pixel_to_xy</span><span class="params">(<span class="keyword">int</span> pixelx,<span class="keyword">int</span> pixely,<span class="keyword">int</span>*x,<span class="keyword">int</span> *y)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> r=PIECE_WH/<span class="number">2</span>;</div><div class="line">    *y=(pixelx-(ZERO_X-r))/PIECE_WH;</div><div class="line">    *x=(pixely-(ZERO_Y-r))/PIECE_WH;</div><div class="line">&#125;</div><div class="line"><span class="comment">//以数组坐标画线</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw_line</span><span class="params">(HDC hdc,<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> psx,psy,pdx,pdy;</div><div class="line">    xy_to_pixel(sx,sy,&amp;psx,&amp;psy);</div><div class="line">    xy_to_pixel(dx,dy,&amp;pdx,&amp;pdy);</div><div class="line">    MoveToEx (hdc, psx,psy, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc, pdx, pdy) ;</div><div class="line">&#125;</div><div class="line"><span class="comment">//以数组坐标画棋子</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_piece</span><span class="params">(HDC hdc,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> color,<span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> HBRUSH  piece_brush =CreateSolidBrush (PIECE_BKCOLOR);    <span class="comment">//棋子的背景色</span></div><div class="line">    <span class="keyword">if</span>(type==<span class="number">0</span>||color==BLANK)<span class="keyword">return</span> ;</div><div class="line">    <span class="keyword">int</span> px,py;</div><div class="line">    xy_to_pixel(x,y,&amp;px,&amp;py);</div><div class="line">    <span class="keyword">int</span> r=PIECE_WH/<span class="number">2</span>;</div><div class="line">    SelectObject (hdc,piece_brush ) ;</div><div class="line">    Ellipse(hdc,px-r,py-r,px+r,py+r);</div><div class="line">    <span class="keyword">char</span> *text=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">5</span>];</div><div class="line">    <span class="keyword">switch</span>(type) &#123;</div><div class="line">    <span class="keyword">case</span> JU:</div><div class="line">        <span class="built_in">strcpy</span>(text,<span class="string">"車"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> MA:</div><div class="line">        <span class="built_in">strcpy</span>(text,<span class="string">"马"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> XIANG:</div><div class="line">        <span class="keyword">if</span>(color==BLACK)<span class="built_in">strcpy</span>(text,<span class="string">"象"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">strcpy</span>(text,<span class="string">"相"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> SHI:</div><div class="line">        <span class="built_in">strcpy</span>(text,<span class="string">"士"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> JIANG:</div><div class="line">        <span class="keyword">if</span>(color==BLACK)<span class="built_in">strcpy</span>(text,<span class="string">"将"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">strcpy</span>(text,<span class="string">"帅"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> PAO:</div><div class="line">        <span class="keyword">if</span>(color==BLACK)<span class="built_in">strcpy</span>(text,<span class="string">"砲"</span>);</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="built_in">strcpy</span>(text,<span class="string">"炮"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> ZU:</div><div class="line">        <span class="keyword">if</span>(color==BLACK)<span class="built_in">strcpy</span>(text,<span class="string">"卒"</span>);</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="built_in">strcpy</span>(text,<span class="string">"兵"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">        <span class="built_in">strcpy</span>(text,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">    SetBkColor(hdc,PIECE_BKCOLOR);<span class="comment">//设置文字背景色</span></div><div class="line">    <span class="keyword">if</span>(color==BLACK) &#123;</div><div class="line">        SetTextColor(hdc,RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));       <span class="comment">//设置文字颜色</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        SetTextColor(hdc,RGB(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>));</div><div class="line">    &#125;</div><div class="line">    TextOut (hdc, px-r/<span class="number">2</span>, py-r/<span class="number">2</span>,text , <span class="built_in">strlen</span>(<span class="string">"马"</span>)) ;</div><div class="line">    <span class="keyword">delete</span> text;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">main_listen</span><span class="params">(<span class="keyword">void</span> *)</span> </span>&#123;</div><div class="line">    server-&gt;listen_message();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//创建线程，使server开始监听</span></div><div class="line"><span class="function"><span class="keyword">bool</span>  <span class="title">start_listen</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">pthread_t</span> listen_p;</div><div class="line">    <span class="keyword">int</span> ret;</div><div class="line">    ret= pthread_create( &amp;listen_p,  <span class="literal">NULL</span>, main_listen,<span class="literal">NULL</span> ); <span class="comment">//</span></div><div class="line">    <span class="keyword">if</span>( ret != <span class="number">0</span> ) &#123; <span class="comment">//创建线程成功返回0</span></div><div class="line">        <span class="comment">//printf("pthread_create error:error_code=%d\n",ret );</span></div><div class="line">        handle_error(THREAD_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">chess_connect</span><span class="params">(<span class="keyword">void</span> *)</span> </span>&#123;</div><div class="line">    server=<span class="keyword">new</span> Server();<span class="comment">//创建Server对象</span></div><div class="line">    client=<span class="keyword">new</span> Client(); <span class="comment">//创建Client对象，</span></div><div class="line">    start_listen();             <span class="comment">//创建线程，server开始监听</span></div><div class="line">    <span class="comment">//Sleep(100);</span></div><div class="line">    client-&gt;connect_to_ots();  <span class="comment">//client开始连接对方server，连接成功后返回</span></div><div class="line">    InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">pthread_t</span> connect_p;</div><div class="line">    <span class="keyword">int</span> ret;</div><div class="line">    ret= pthread_create( &amp;connect_p,  <span class="literal">NULL</span>, chess_connect,<span class="literal">NULL</span>); <span class="comment">//</span></div><div class="line">    <span class="keyword">if</span>( ret != <span class="number">0</span> ) &#123; <span class="comment">//创建线程成功返回0</span></div><div class="line">        <span class="comment">//printf("pthread_create error:error_code=%d\n",ret );</span></div><div class="line">        handle_error(THREAD_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*  This function is called by the Windows function DispatchMessage()  */</span></div><div class="line"></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> POINT mouse;</div><div class="line">    <span class="keyword">static</span> HDC hdc;</div><div class="line">    <span class="keyword">static</span> PAINTSTRUCT ps ;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> iofip=<span class="number">0</span>;     <span class="comment">//index of ots_ip</span></div><div class="line">    <span class="keyword">switch</span> (message) &#123;                <span class="comment">/* handle the messages */</span></div><div class="line">    <span class="keyword">case</span> WM_CREATE: &#123;</div><div class="line">        port=<span class="number">35536</span>;</div><div class="line">        ots_ip=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">20</span>];</div><div class="line">        <span class="built_in">strcpy</span>(ots_ip,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_KEYDOWN:<span class="comment">//识别按键，显示输入的内容（对方IP地址）</span></div><div class="line">        <span class="keyword">if</span>(wParam==<span class="number">13</span>) &#123;<span class="comment">//如果是ENTER，则初始化server、client，并开始连接，连接成功后初始化board</span></div><div class="line">            init();</div><div class="line">            Sleep(<span class="number">100</span>);</div><div class="line">            InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(wParam==VK_BACK) &#123;<span class="comment">//删除键</span></div><div class="line">            <span class="keyword">if</span>(iofip==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">            iofip--;</div><div class="line">            ots_ip[iofip]=<span class="string">'\0'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(wParam&lt;<span class="number">106</span>&amp;&amp;wParam&gt;<span class="number">95</span>) &#123;<span class="comment">//小键盘数字键</span></div><div class="line">            wParam-=<span class="number">48</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(wParam&lt;<span class="number">58</span>&amp;&amp;wParam&gt;<span class="number">47</span>) &#123;<span class="comment">//主键盘数字键</span></div><div class="line">            ots_ip[iofip]=<span class="string">'0'</span><span class="number">-48</span>+wParam;</div><div class="line">            iofip++;</div><div class="line">            ots_ip[iofip]=<span class="string">'\0'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(wParam==<span class="number">110</span>||wParam==<span class="number">229</span>) &#123;<span class="comment">//小数点键，小键盘110，主键盘229</span></div><div class="line">            ots_ip[iofip]=<span class="string">'.'</span>;</div><div class="line">            iofip++;</div><div class="line">            ots_ip[iofip]=<span class="string">'\0'</span>;</div><div class="line">        &#125;</div><div class="line">        InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_PAINT: &#123;</div><div class="line">        hdc=BeginPaint (hwnd,&amp;ps) ;</div><div class="line">        SetBkColor(hdc,RGB(<span class="number">200</span>,<span class="number">200</span>,<span class="number">200</span>));</div><div class="line">        <span class="keyword">if</span>(chess_board==<span class="literal">NULL</span>) &#123;<span class="comment">//显示输入的IP地址</span></div><div class="line">            <span class="keyword">char</span> tip[<span class="number">20</span>]=<span class="string">"请输入对方IP地址："</span>;</div><div class="line">            Rectangle(hdc,WIDTH/<span class="number">5</span><span class="number">-20</span>,HEIGHT/<span class="number">2</span><span class="number">-10</span>,WIDTH/<span class="number">5</span>*<span class="number">4</span>,HEIGHT/<span class="number">2</span>+<span class="number">20</span>);</div><div class="line">            TextOut(hdc,WIDTH/<span class="number">5</span>,HEIGHT/<span class="number">2</span><span class="number">-50</span>,tip,<span class="built_in">strlen</span>(tip));</div><div class="line">            TextOut(hdc,WIDTH/<span class="number">5</span>,HEIGHT/<span class="number">2</span>,ots_ip,<span class="built_in">strlen</span>(ots_ip));</div><div class="line">            <span class="keyword">if</span>(server!=<span class="literal">NULL</span>) &#123;             <span class="comment">//board==NULL而server!=NULL表示正在连接过程中</span></div><div class="line">                <span class="keyword">char</span> tip[<span class="number">20</span>]=<span class="string">"正在连接......"</span>;</div><div class="line">                TextOut(hdc,WIDTH/<span class="number">5</span>,HEIGHT/<span class="number">2</span>+<span class="number">50</span>,tip,<span class="built_in">strlen</span>(tip));</div><div class="line">            &#125;</div><div class="line">            EndPaint(hwnd,&amp;ps);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">char</span> text[<span class="number">10</span>]=<span class="string">"你的颜色:"</span>;</div><div class="line">        <span class="keyword">if</span>(chess_board-&gt;get_color()==BLACK) &#123;</div><div class="line">            <span class="built_in">strcat</span>(text,<span class="string">" 黑"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">strcat</span>(text,<span class="string">" 白"</span>);</div><div class="line">        &#125;</div><div class="line">        TextOut (hdc, <span class="number">0</span>, <span class="number">0</span>,text , <span class="built_in">strlen</span>(text)) ;</div><div class="line">        <span class="keyword">int</span> M=chess_board-&gt;get_M();</div><div class="line">        <span class="keyword">int</span> N=chess_board-&gt;get_N();</div><div class="line">        <span class="comment">//画棋盘</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;M; i++) &#123;</div><div class="line">            draw_line(hdc,i,<span class="number">0</span>,i,N<span class="number">-1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">            draw_line(hdc,<span class="number">0</span>,i,N/<span class="number">2</span>,i);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">            draw_line(hdc,N/<span class="number">2</span>+<span class="number">1</span>,i,N,i);</div><div class="line">        &#125;</div><div class="line">        draw_line(hdc,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>);</div><div class="line">        draw_line(hdc,<span class="number">0</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>);</div><div class="line">        draw_line(hdc,<span class="number">9</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">5</span>);</div><div class="line">        draw_line(hdc,<span class="number">7</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">5</span>);</div><div class="line">        draw_line(hdc,<span class="number">4</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>);</div><div class="line">        draw_line(hdc,<span class="number">4</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">8</span>);</div><div class="line">        <span class="comment">//画棋子</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;M; i++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">                paint_piece(hdc,i,j,chess_board-&gt;get_color(i,j),chess_board-&gt;get_type(i,j));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        EndPaint(hwnd,&amp;ps);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_LBUTTONUP: &#123;</div><div class="line">        <span class="keyword">if</span>(chess_board==<span class="literal">NULL</span>)<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">if</span>(!chess_board-&gt;is_my_turn())<span class="keyword">break</span>;<span class="comment">//当前没轮到自己下棋</span></div><div class="line">        GetCursorPos(&amp;mouse);<span class="comment">//获取鼠标的屏幕坐标</span></div><div class="line">        ScreenToClient(hwnd,&amp;mouse);<span class="comment">//转换为界面坐标</span></div><div class="line">        <span class="keyword">int</span> x,y;</div><div class="line">        pixel_to_xy(mouse.x,mouse.y,&amp;x,&amp;y);<span class="comment">//转换为数组坐标</span></div><div class="line">        <span class="keyword">if</span>(chess_board-&gt;get_color(x,y)==chess_board-&gt;get_color()) &#123;<span class="comment">//点击的是自己的棋子</span></div><div class="line">            chess_sx=x;</div><div class="line">            chess_sy=y;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(chess_sx==<span class="number">-1</span>||chess_sy==<span class="number">-1</span>) &#123;<span class="comment">//起始坐标未赋值且点击的不是自己的棋子，则break</span></div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        chess_dx=x;</div><div class="line">        chess_dy=y;</div><div class="line">        <span class="keyword">if</span>(chess_board-&gt;my_move_piece(chess_sx,chess_sy,chess_dx,chess_dy)) &#123; <span class="comment">//如果移动棋子合法</span></div><div class="line">            client-&gt;send_message(<span class="string">"move"</span>,chess_sx,chess_sy,chess_dx,chess_dy);   <span class="comment">//向对方发送移子信息</span></div><div class="line">            InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">if</span>(chess_board-&gt;get_is_win()==WIN) &#123;</div><div class="line"></div><div class="line">                chess_board-&gt;init();<span class="comment">//重新初始化棋盘，重下一盘</span></div><div class="line">                MessageBox(hwnd,<span class="string">"你赢了"</span>,<span class="string">"获胜！"</span>,<span class="literal">NULL</span>);</div><div class="line">                InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        chess_sx=<span class="number">-1</span>;</div><div class="line">        chess_sy=<span class="number">-1</span>;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">case</span> WM_DESTROY:</div><div class="line">        <span class="keyword">if</span>(server!=<span class="literal">NULL</span>)server-&gt;close();</div><div class="line">        <span class="keyword">if</span>(client!=<span class="literal">NULL</span>)client-&gt;close();</div><div class="line">        PostQuitMessage (<span class="number">0</span>);       <span class="comment">/* send a WM_QUIT to the message queue */</span></div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:                      <span class="comment">/* for messages that we don't deal with */</span></div><div class="line">        <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="chess">chinese_chess.h</h3>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CHINESE_CHESS_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CHINESE_CHESS_H_INCLUDED</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> JU 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MA 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> XIANG 3</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SHI 4</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> JIANG 5</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PAO 6</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZU 7</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BLANK 8 <span class="comment">//空子</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BLACK -1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WHITE 1</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WIN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LOSE -1</span></div><div class="line"><span class="keyword">class</span> Board &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">bool</span> turn;   <span class="comment">//是否轮到自己下棋</span></div><div class="line">    <span class="keyword">int</span> color;  <span class="comment">//自己的颜色</span></div><div class="line">    <span class="keyword">int</span> M,N;        <span class="comment">//棋盘行数、列数</span></div><div class="line">    <span class="keyword">int</span> **b;    <span class="comment">//二维数组</span></div><div class="line">    <span class="keyword">int</span> is_win;     <span class="comment">//是否胜利</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_out</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;<span class="comment">//坐标是否出界</span></div><div class="line">        <span class="keyword">return</span> x&gt;M||y&gt;N||x&lt;<span class="number">0</span>||y&lt;<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_same_color</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;<span class="comment">//源坐标与目的坐标是否是同一颜色</span></div><div class="line">        <span class="keyword">return</span> get_color(sx,sy)==get_color(dx,dy);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap_num</span><span class="params">(<span class="keyword">int</span> &amp; num1,<span class="keyword">int</span>&amp; num2)</span> </span>&#123;<span class="comment">//交换两个数</span></div><div class="line">        num1+=num2;</div><div class="line">        num2=num1-num2;</div><div class="line">        num1=num1-num2;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_abs</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;<span class="comment">//取得绝对值</span></div><div class="line">        <span class="keyword">return</span> num&gt;=<span class="number">0</span>?num:-num;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">num_of_not_blank_betweenn</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;<span class="comment">//返回在起始坐标和目的坐标之间棋子的个数</span></div><div class="line">        <span class="keyword">if</span>(!(sx==dx||sy==dy))<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        <span class="keyword">int</span> num=<span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>(sy&gt;dy)swap_num(sy,dy);</div><div class="line">        <span class="keyword">if</span>(sx&gt;dx)swap_num(sx,dx);</div><div class="line">        <span class="keyword">if</span>(sx==dx) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=sy+<span class="number">1</span>; i&lt;dy; i++) &#123;</div><div class="line">                <span class="keyword">if</span>(b[sx][i]!=BLANK)num++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(sy==dy) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=sx+<span class="number">1</span>; i&lt;dx; i++) &#123;</div><div class="line">                <span class="keyword">if</span>(b[i][sy]!=BLANK)num++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> num;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_JU</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> num_of_not_blank_betweenn(sx,sy,dx,dy)==<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_MA</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> x=dx-sx,y=dy-sy;</div><div class="line">        <span class="keyword">if</span>(get_abs(x)==<span class="number">2</span>&amp;&amp;get_abs(y)==<span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">if</span>(get_color(sx+x/<span class="number">2</span>,sy)==BLANK)<span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//硌马蹄检测</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(get_abs(x)==<span class="number">1</span>&amp;&amp;get_abs(y)==<span class="number">2</span>) &#123;</div><div class="line">            <span class="keyword">if</span>(get_color(sx,sy+y/<span class="number">2</span>)==BLANK)<span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//硌马蹄检测</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_XIANG</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> x=dx-sx,y=dy-sy;</div><div class="line">        <span class="keyword">if</span>(!(get_abs(x)==<span class="number">2</span>&amp;&amp;get_abs(y)==<span class="number">2</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(get_color(sx+x/<span class="number">2</span>,sy+y/<span class="number">2</span>)==BLANK)<span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//硌象蹄检测</span></div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_SHI</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> x=dx-sx,y=dy-sy;</div><div class="line">        <span class="keyword">if</span>(!(get_abs(x)==<span class="number">1</span>&amp;&amp;get_abs(y)==<span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(dx&lt;<span class="number">7</span>)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(dy&lt;<span class="number">3</span>||dy&gt;<span class="number">5</span>)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_JIANG</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> x=dx-sx,y=dy-sy;</div><div class="line">        <span class="keyword">if</span>(!((get_abs(x)==<span class="number">1</span>&amp;&amp;get_abs(y)==<span class="number">0</span>)||(get_abs(x)==<span class="number">0</span>&amp;&amp;get_abs(y)==<span class="number">1</span>))) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(dx&lt;<span class="number">7</span>)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(dy&lt;<span class="number">3</span>||dy&gt;<span class="number">5</span>)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;<span class="comment">//明将检测</span></div><div class="line">            <span class="keyword">if</span>(get_type(i,dy)==JIANG) &#123;</div><div class="line">                <span class="keyword">if</span>(num_of_not_blank_betweenn(dx,dy,i,dy)==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_PAO</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> n=get_color(dx,dy)==BLANK?<span class="number">0</span>:<span class="number">1</span>;</div><div class="line">        <span class="keyword">return</span> num_of_not_blank_betweenn(sx,sy,dx,dy)==n;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_ZU</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(dx&gt;sx)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">int</span> x=dx-sx,y=dy-sy;</div><div class="line">        <span class="keyword">if</span>(get_abs(x)+get_abs(y)!=<span class="number">1</span>)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(sx&gt;<span class="number">4</span>&amp;&amp;get_abs(x)!=<span class="number">1</span>)<span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//过河前只能向前走</span></div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(sx==dx&amp;&amp;sy==dy) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(is_out(sx,sy)||is_out(dx,dy)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(get_color(sx,sy)!=color) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(is_same_color(sx,sy,dx,dy)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">switch</span>(get_type(sx,sy)) &#123;</div><div class="line">        <span class="keyword">case</span> JU:</div><div class="line">            <span class="keyword">return</span> is_correct_move_JU(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> MA:</div><div class="line">            <span class="keyword">return</span> is_correct_move_MA(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> XIANG:</div><div class="line">            <span class="keyword">return</span> is_correct_move_XIANG(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> SHI:</div><div class="line">            <span class="keyword">return</span> is_correct_move_SHI(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> JIANG:</div><div class="line">            <span class="keyword">return</span> is_correct_move_JIANG(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> PAO:</div><div class="line">            <span class="keyword">return</span> is_correct_move_PAO(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> ZU:</div><div class="line">            <span class="keyword">return</span> is_correct_move_ZU(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">move_s_to_d</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123; <span class="comment">//移动操作</span></div><div class="line">        <span class="keyword">if</span>(get_type(dx,dy)==JIANG) &#123;    <span class="comment">//如果目的棋子是将</span></div><div class="line">            <span class="keyword">if</span>(get_color(dx,dy)==color)set_win(LOSE);<span class="comment">//如果是自己的将，则输</span></div><div class="line">            <span class="keyword">else</span> set_win(WIN);<span class="comment">//如果是对方的将，则赢</span></div><div class="line">        &#125;</div><div class="line">        b[dx][dy]=b[sx][sy];</div><div class="line">        b[sx][sy]=BLANK;</div><div class="line">        change_turn();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init_pieces</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;M; i+=M<span class="number">-1</span>) &#123;<span class="comment">//第一行和最后一行（即车马象士将士象马车）</span></div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> index=<span class="number">0</span>; index&lt;N; index++) &#123;</div><div class="line">                <span class="keyword">if</span>(index&lt;N/<span class="number">2</span>+<span class="number">1</span>)b[i][index]=index+<span class="number">1</span>;</div><div class="line">                <span class="keyword">else</span> b[i][index]=N-index;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//卒所在的行</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> index=<span class="number">0</span>; index&lt;N; index+=<span class="number">2</span>) &#123;</div><div class="line">            b[<span class="number">3</span>][index]=ZU;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> index=<span class="number">0</span>; index&lt;N; index+=<span class="number">2</span>) &#123;</div><div class="line">            b[<span class="number">6</span>][index]=ZU;</div><div class="line">        &#125;</div><div class="line">        b[<span class="number">2</span>][<span class="number">1</span>]=PAO;</div><div class="line">        b[M<span class="number">-1</span><span class="number">-2</span>][<span class="number">1</span>]=PAO;</div><div class="line">        b[<span class="number">2</span>][N<span class="number">-1</span><span class="number">-1</span>]=PAO;</div><div class="line">        b[M<span class="number">-1</span><span class="number">-2</span>][N<span class="number">-1</span><span class="number">-1</span>]=PAO;</div><div class="line">        <span class="keyword">int</span> s,d;<span class="comment">//存储起始行和终点行</span></div><div class="line">        <span class="keyword">if</span>(color==BLACK) &#123;</div><div class="line">            s=<span class="number">0</span>;<span class="comment">//从0行到M/2行，即棋盘上半部分</span></div><div class="line">            d=M/<span class="number">2</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            s=M/<span class="number">2</span>;<span class="comment">//棋盘下半部分</span></div><div class="line">            d=M;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//从s行到d行，把非BLANK的值加BLANK，使小于BLANK的代表黑色棋，大于BLANK的代表白色棋</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> index=s; index&lt;d; index++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">                <span class="keyword">if</span>(b[index][j]!=BLANK) &#123;</div><div class="line">                    b[index][j]+=BLANK;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Board(<span class="keyword">int</span> c) &#123;</div><div class="line">        color=c;</div><div class="line">        M=<span class="number">10</span>;</div><div class="line">        N=<span class="number">9</span>;</div><div class="line">        b=<span class="keyword">new</span> <span class="keyword">int</span>*[M];</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;M; i++) &#123;</div><div class="line">            b[i]=<span class="keyword">new</span> <span class="keyword">int</span>[N];</div><div class="line">        &#125;</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;<span class="comment">//棋盘初始化</span></div><div class="line">        is_win=<span class="number">0</span>;</div><div class="line">        turn=color==BLACK?<span class="literal">true</span>:<span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;M; i++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">                b[i][j]=BLANK;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        init_pieces();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_M</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> M;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_N</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> N;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_color</span><span class="params">()</span> </span>&#123;<span class="comment">//获取己方的颜色</span></div><div class="line">        <span class="keyword">return</span> color;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_color</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;<span class="comment">//获取棋盘某一坐标上棋子的颜色</span></div><div class="line">        <span class="keyword">return</span> b[x][y]&gt;BLANK?WHITE:b[x][y]&lt;BLANK?BLACK:BLANK;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_type</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;<span class="comment">//获取棋子类型（空、车、马、象、士、将、炮、卒）</span></div><div class="line">        <span class="keyword">return</span> b[x][y]!=BLANK?b[x][y]%BLANK:BLANK;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_win</span><span class="params">(<span class="keyword">int</span> is)</span> </span>&#123;</div><div class="line">        is_win=is;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_is_win</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> is_win;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change_turn</span><span class="params">()</span> </span>&#123;</div><div class="line">        turn=turn==<span class="literal">true</span>?<span class="literal">false</span>:<span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_my_turn</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> turn;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">othside_move_piece</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;<span class="comment">//对方移子</span></div><div class="line">        sx=M<span class="number">-1</span>-sx;<span class="comment">//先进行坐标转换，因对方视角与己方相反</span></div><div class="line">        sy=N<span class="number">-1</span>-sy;</div><div class="line">        dx=M<span class="number">-1</span>-dx;</div><div class="line">        dy=N<span class="number">-1</span>-dy;</div><div class="line">        move_s_to_d(sx,sy,dx,dy);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">my_move_piece</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;       <span class="comment">//己方主动移子</span></div><div class="line">        <span class="keyword">if</span>(!is_correct_move(sx,sy,dx,dy))<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        move_s_to_d(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// CHINESE_CHESS_H_INCLUDED</span></span></div></pre></td></tr></table></figure>
<h3 id="server">Server.h</h3>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> SERVER_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SERVER_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winsock2.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">"chinese_chess.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INIT_ERROR 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BIND_ERROR 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LISTEN_ERROR 3</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CONNECT_ERROR 4</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SEND_ERROR 5</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ACCEPT_ERROR 6</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ALIVE_ERROR 7</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> THREAD_ERROR 8</span></div><div class="line"><span class="keyword">int</span> error_num;</div><div class="line"><span class="keyword">extern</span> HWND hwnd;</div><div class="line"><span class="keyword">extern</span> Board* chess_board;</div><div class="line"><span class="keyword">extern</span> <span class="keyword">char</span>* ots_ip;</div><div class="line"><span class="keyword">extern</span> <span class="keyword">int</span> port;</div><div class="line"><span class="keyword">extern</span> <span class="keyword">bool</span> is_connect_alive;</div><div class="line"></div><div class="line"><span class="comment">//线程参数结构体</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> server_args &#123;</div><div class="line">    SOCKET* Com_Sock;</div><div class="line">    <span class="keyword">char</span> * rebuf;</div><div class="line">&#125; server_args;</div><div class="line"><span class="comment">//校验检测，与客户端的添加校验是相反操作</span></div><div class="line"><span class="comment">//最后一位之前的所有字符相加取模后，如果等于最后一个字符，则校验通过</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">server_check</span><span class="params">(<span class="keyword">char</span> * r)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(r);</div><div class="line">    len--;</div><div class="line">    <span class="keyword">int</span> s=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        s+=r[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(r[len]==(s%<span class="number">5</span>+<span class="string">'0'</span>)) &#123;</div><div class="line">        r[len]=<span class="string">'\0'</span>;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//错误处理，is_tell控制是否显示错误信息，is_exit控制是否退出程序</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">handle_error</span><span class="params">(<span class="keyword">int</span> err,<span class="keyword">bool</span> is_tell,<span class="keyword">bool</span> is_exit)</span> </span>&#123;</div><div class="line">    error_num=err;</div><div class="line">    <span class="keyword">if</span>(!is_tell)<span class="keyword">return</span> error_num;</div><div class="line">    <span class="keyword">char</span> error[<span class="number">30</span>]=<span class="string">""</span>;</div><div class="line">    <span class="keyword">switch</span>(error_num) &#123;</div><div class="line">    <span class="keyword">case</span> INIT_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"初始化错误"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> BIND_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"绑定端口错误"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> LISTEN_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"监听错误"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> ACCEPT_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"接受连接错误"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> CONNECT_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"无法连接"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> ALIVE_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"连接已断开"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> THREAD_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"线程无法创建"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> SEND_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"发送错误"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span> error_message[<span class="number">50</span>];</div><div class="line">    <span class="built_in">strcpy</span>(error_message,<span class="string">"错误："</span>);</div><div class="line">    <span class="built_in">strcat</span>(error_message,error);</div><div class="line">    <span class="keyword">if</span>(is_exit)<span class="built_in">strcat</span>(error_message,<span class="string">"\n程序将退出。"</span>);</div><div class="line">    MessageBox(hwnd,error_message,<span class="string">"错误"</span>,MB_OK);</div><div class="line">    <span class="keyword">if</span>(is_exit)<span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> error_num;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">handle_message</span><span class="params">(<span class="keyword">void</span>*ar)</span> </span>&#123;</div><div class="line">    server_args * serarg=(server_args * )ar;</div><div class="line">    <span class="keyword">char</span> *recv=serarg-&gt;rebuf;</div><div class="line">    SOCKET* CommandSock=serarg-&gt;Com_Sock;</div><div class="line">    <span class="keyword">if</span>(server_check(recv)) &#123;<span class="comment">//校验通过发送okok（OK），不通过发送noto（NOTOK）</span></div><div class="line">        send(*CommandSock,<span class="string">"okok"</span>,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        send(*CommandSock,<span class="string">"noto"</span>,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">        <span class="keyword">return</span> ar;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">strncmp</span>(recv,<span class="string">"move"</span>,<span class="number">4</span>)==<span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">char</span> * pch;</div><div class="line">        <span class="comment">//将recvBuf以逗号拆分</span></div><div class="line">        pch = strtok (recv,<span class="string">","</span>);</div><div class="line">        pch = strtok (<span class="literal">NULL</span>,<span class="string">","</span>);</div><div class="line">        <span class="keyword">int</span> xys[<span class="number">4</span>];</div><div class="line">        <span class="keyword">int</span> index=<span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (pch != <span class="literal">NULL</span>) &#123;</div><div class="line">            xys[index]=atoi(pch);<span class="comment">//char* 转换为int</span></div><div class="line">            index++;</div><div class="line">            pch = strtok (<span class="literal">NULL</span>, <span class="string">","</span>);</div><div class="line">        &#125;</div><div class="line">        chess_board-&gt;othside_move_piece(xys[<span class="number">0</span>],xys[<span class="number">1</span>],xys[<span class="number">2</span>],xys[<span class="number">3</span>]);</div><div class="line">        <span class="keyword">if</span>(chess_board-&gt;get_is_win()==LOSE) &#123;</div><div class="line">            chess_board-&gt;init();<span class="comment">//如果输了，则重新初始化棋盘，再下一盘</span></div><div class="line">            MessageBox(hwnd,<span class="string">"你输了"</span>,<span class="string">"失败！"</span>,<span class="literal">NULL</span>);</div><div class="line">        &#125;</div><div class="line">        InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">delete</span> recv;</div><div class="line">&#125;</div><div class="line"><span class="keyword">class</span> Server &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    SOCKET Server_Sock;</div><div class="line">    SOCKADDR_IN server_addr;</div><div class="line">    SOCKADDR_IN client_addr;</div><div class="line">    <span class="keyword">char</span> recvBuf[<span class="number">20</span>];</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Server() &#123;</div><div class="line">        WSADATA wsa;</div><div class="line">        <span class="comment">/*初始化socket资源*/</span></div><div class="line">        <span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">1</span>,<span class="number">1</span>),&amp;wsa) != <span class="number">0</span>) &#123;</div><div class="line">            handle_error(INIT_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>((Server_Sock = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>))==<span class="number">-1</span>) &#123;</div><div class="line">            handle_error(INIT_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        ZeroMemory((<span class="keyword">char</span> *)&amp;server_addr,<span class="keyword">sizeof</span>(server_addr));</div><div class="line">        server_addr.sin_family = AF_INET;</div><div class="line">        server_addr.sin_port = htons(port);           <span class="comment">/*本地监听端口*/</span></div><div class="line">        server_addr.sin_addr.s_addr = htonl(INADDR_ANY); <span class="comment">/*有IP*/</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span>(bind(Server_Sock,(<span class="keyword">struct</span> sockaddr *)&amp;server_addr,<span class="keyword">sizeof</span>(server_addr))==<span class="number">-1</span>) &#123;</div><div class="line">            handle_error(BIND_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(listen(Server_Sock,<span class="number">5</span>)==<span class="number">-1</span>) &#123; <span class="comment">//其中第二个参数代表能够接收的最多的连接数</span></div><div class="line">            handle_error(LISTEN_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">strcpy</span>(recvBuf,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">listen_message</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> len=<span class="keyword">sizeof</span>(SOCKADDR);</div><div class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</div><div class="line">            SOCKET Command_Sock  = accept(Server_Sock, (SOCKADDR*)&amp;client_addr,&amp;len);</div><div class="line">            <span class="keyword">if</span>(Command_Sock == INVALID_SOCKET) &#123;</div><div class="line">                closesocket(Command_Sock);</div><div class="line">                handle_error(ACCEPT_ERROR,<span class="literal">false</span>,<span class="literal">false</span>);</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(client_addr.sin_addr.s_addr!=inet_addr(ots_ip)) &#123;<span class="comment">//如果接收的socket不是预期的对方的，则发送wron，继续等待</span></div><div class="line">                send(Command_Sock,<span class="string">"wron"</span>,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">                closesocket(Command_Sock);</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            send(Command_Sock,<span class="string">"righ"</span>,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">            is_connect_alive=<span class="literal">true</span>;</div><div class="line">            <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</div><div class="line">                <span class="keyword">if</span>(recv(Command_Sock,recvBuf,<span class="number">20</span>,<span class="number">0</span>)&lt;=<span class="number">0</span>) &#123;<span class="comment">//recv返回小于等于0的值，则连接已断开</span></div><div class="line">                    handle_error(ALIVE_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">                    closesocket(Command_Sock);</div><div class="line">                    close();</div><div class="line">                    <span class="keyword">return</span> ;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">char</span> *rbuf=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">20</span>];</div><div class="line">                <span class="built_in">strcpy</span>(rbuf,recvBuf);</div><div class="line">                server_args serarg;</div><div class="line">                serarg.Com_Sock=&amp;Command_Sock;</div><div class="line">                serarg.rebuf=rbuf;</div><div class="line">                <span class="keyword">pthread_t</span> handle_m;</div><div class="line">                <span class="keyword">int</span> ret;</div><div class="line">                ret= pthread_create( &amp;handle_m,  <span class="literal">NULL</span>, handle_message,&amp;serarg); <span class="comment">//</span></div><div class="line">                <span class="keyword">if</span>( ret != <span class="number">0</span> ) &#123; <span class="comment">//创建线程成功返回0</span></div><div class="line">                    <span class="comment">// printf("pthread_create error:error_code=%d\n",ret );</span></div><div class="line">                    handle_error(THREAD_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">                    <span class="keyword">return</span> ;</div><div class="line">                &#125;</div><div class="line">                <span class="built_in">strcpy</span>(recvBuf,<span class="string">""</span>);</div><div class="line">            &#125;</div><div class="line">            closesocket(Command_Sock);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</div><div class="line">        closesocket(Server_Sock);</div><div class="line">        WSACleanup();</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// SERVER_H_INCLUDED</span></span></div></pre></td></tr></table></figure>
<h3 id="client">Client.h</h3>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CLIENT_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CLIENT_H_INCLUDED</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winsock2.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">"chinese_chess.h"</span></span></div><div class="line"></div><div class="line"><span class="comment">//为字符串添加校验信息，对所有字符求和，模5之后转化为字符放在字符串最后</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">client_check</span><span class="params">(<span class="keyword">char</span>* r)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(r);</div><div class="line">    <span class="keyword">int</span> s=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        s+=r[i];</div><div class="line">    &#125;</div><div class="line">    r[len]=s%<span class="number">5</span>+<span class="string">'0'</span>;</div><div class="line">    r[len+<span class="number">1</span>]=<span class="string">'\0'</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">class</span> Client &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    SOCKET Client_Sock;</div><div class="line">    SOCKADDR_IN server_addr;</div><div class="line">    <span class="keyword">char</span> sendBuf[<span class="number">20</span>];</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Client() &#123;</div><div class="line">        WSADATA wsa;</div><div class="line">        <span class="comment">/*初始化socket资源*/</span></div><div class="line">        <span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">1</span>,<span class="number">1</span>),&amp;wsa) != <span class="number">0</span>) &#123;</div><div class="line">            handle_error(INIT_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;   <span class="comment">//代表失败</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>((Client_Sock = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>))==<span class="number">-1</span>) &#123;</div><div class="line">            handle_error(INIT_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;   <span class="comment">//代表失败</span></div><div class="line">        &#125;</div><div class="line">        server_addr.sin_addr.S_un.S_addr=inet_addr(ots_ip);</div><div class="line">        server_addr.sin_family=AF_INET;</div><div class="line">        server_addr.sin_port=htons(port);</div><div class="line">        <span class="built_in">strcpy</span>(sendBuf,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">connect_to_ots</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span>(connect(Client_Sock,(SOCKADDR*)&amp;server_addr,<span class="keyword">sizeof</span>(SOCKADDR)) ==<span class="number">-1</span>) &#123;</div><div class="line">            handle_error(CONNECT_ERROR,<span class="literal">false</span>,<span class="literal">false</span>);</div><div class="line">            Sleep(<span class="number">100</span>);</div><div class="line">            <span class="comment">//printf( "%d ", WSAGetLastError());</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">char</span> rec[<span class="number">5</span>];</div><div class="line">        recv(Client_Sock,rec,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">strncmp</span>(rec,<span class="string">"wron"</span>,<span class="number">4</span>)==<span class="number">0</span>) &#123;  <span class="comment">//收到wrong，说明对方所输入的IP不是己方IP</span></div><div class="line">            MessageBox(hwnd,<span class="string">"对方输入的IP不是你\n程序将退出"</span>,<span class="string">"错误"</span>,<span class="literal">NULL</span>);</div><div class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//谁先连接谁是黑色</span></div><div class="line">        <span class="comment">//如果server已经收到连接，则说明是对方先连接自己，则自己应为白色，否则自己是黑色</span></div><div class="line">        <span class="keyword">if</span>(is_connect_alive) &#123;</div><div class="line">            chess_board=<span class="keyword">new</span> Board(WHITE);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            chess_board=<span class="keyword">new</span> Board(BLACK);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</div><div class="line">        closesocket(Client_Sock);</div><div class="line">        WSACleanup();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">send_message</span><span class="params">(<span class="keyword">char</span> * message)</span> </span>&#123;</div><div class="line">        <span class="built_in">strcpy</span>(sendBuf,message);</div><div class="line">        client_check(sendBuf);</div><div class="line">        <span class="keyword">int</span> len;</div><div class="line">        <span class="keyword">int</span> try_time=<span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</div><div class="line">            len=send(Client_Sock,sendBuf,<span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">            <span class="keyword">if</span>(len!=(<span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>)) &#123;</div><div class="line">                handle_error(SEND_ERROR,<span class="literal">false</span>,<span class="literal">false</span>);</div><div class="line">                <span class="comment">//printf( "%d ", WSAGetLastError());</span></div><div class="line">            &#125;</div><div class="line">            <span class="keyword">char</span> rec[<span class="number">5</span>];</div><div class="line">            recv(Client_Sock,rec,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">            <span class="keyword">if</span>(<span class="built_in">strncmp</span>(rec,<span class="string">"okok"</span>,<span class="number">4</span>)==<span class="number">0</span>) &#123;<span class="comment">//收到OK说明数据已经正确被对方收到</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(try_time&gt;<span class="number">20</span>) &#123;   <span class="comment">//尝试20次，数据仍无法正确送达，则退出</span></div><div class="line">                handle_error(SEND_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            &#125;</div><div class="line">            try_time++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> len;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">send_message</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> * message,<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">char</span>* message_temp=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">20</span>];</div><div class="line">        <span class="built_in">sprintf</span>(message_temp,<span class="string">"%s,%d,%d,%d,%d,"</span>,message,sx,sy,dx,dy);</div><div class="line">        <span class="keyword">int</span> len=send_message(message_temp);</div><div class="line">        <span class="keyword">delete</span> message_temp;</div><div class="line">        <span class="keyword">return</span> len;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// CLIENT_H_INCLUDED</span></span></div></pre></td></tr></table></figure>
<ul>
<li>该程序从3.15晚开始，用了四天的空闲时间。</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Shell（C++实现，CodeBlocks+GCC编译）]]></title>
      <url>http://maxuewei2.git.io/2016/03/20/Shell%E5%AE%9E%E7%8E%B0/</url>
      <content type="html"><![CDATA[<h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p>　　只实现了login 、cd 、ls 、cat 四个命令。而且只能在 Windows 下运行。<br><a id="more"></a></p>
<p><img src="/imgs/shell1.jpg" alt="shell"></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"shell.h"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">com_to_int</span><span class="params">(<span class="keyword">int</span> com_num,<span class="keyword">char</span> * command,<span class="keyword">char</span>** coms)</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> COM_NUM=<span class="number">5</span>;</div><div class="line">    <span class="keyword">char</span> command[MAX_LENGTH_OF_COMMAND];</div><div class="line">    <span class="keyword">char</span> *coms[COM_NUM]=&#123;<span class="string">"login"</span>,<span class="string">"ls"</span>,<span class="string">"cd"</span>,<span class="string">"cat"</span>,<span class="string">"exit"</span>&#125;;</div><div class="line">    <span class="keyword">int</span> (*func_ptrs[COM_NUM])(<span class="keyword">char</span> *)=&#123;login,ls,cd,cat,shellexit&#125;;</div><div class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%s%s%s%s%s"</span>,<span class="string">"["</span>,USER_NAME,<span class="string">" "</span>,GLOBLE_PATH,<span class="string">"]"</span>);</div><div class="line">        gets(command);</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(command,<span class="string">""</span>)==<span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//printf("command: %s\n",command);</span></div><div class="line">        <span class="comment">//printf("command: %s\n",command);</span></div><div class="line">        <span class="keyword">int</span> i;</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;COM_NUM;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(<span class="built_in">strncmp</span>(coms[i],command,<span class="built_in">strlen</span>(coms[i]))==<span class="number">0</span>)&#123;</div><div class="line">                func_ptrs[i](command);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(i==COM_NUM)&#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"command not found.\n"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    cd(<span class="string">"C:/0"</span>);</div><div class="line">    ls(GLOBLE_PATH);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//shell.h</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> SHELL_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SHELL_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;io.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LENGTH_OF_PATH 256</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LENGTH_OF_USERNAME 50</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LENGTH_OF_COMMAND 50</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LENGTH_OF_LINE 256</span></div><div class="line"><span class="keyword">char</span> GLOBLE_PATH[MAX_LENGTH_OF_PATH]= &#123;<span class="string">'C'</span>,<span class="string">':'</span>,<span class="string">'/'</span>,<span class="string">'0'</span>,<span class="string">'\0'</span>&#125;;</div><div class="line"><span class="keyword">char</span> USER_NAME[MAX_LENGTH_OF_USERNAME]= &#123;<span class="string">'g'</span>,<span class="string">'u'</span>,<span class="string">'e'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'\0'</span>&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">login</span><span class="params">(<span class="keyword">char</span> * command)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"user name:"</span>);</div><div class="line">    <span class="keyword">char</span> username[MAX_LENGTH_OF_USERNAME];</div><div class="line">    gets(username);</div><div class="line">    FILE * pwd;</div><div class="line">    pwd = fopen (<span class="string">"pwd"</span>,<span class="string">"r"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (pwd!=<span class="literal">NULL</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">char</span> line[MAX_LENGTH_OF_LINE];</div><div class="line">        <span class="keyword">while</span> (!feof(pwd))</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span>(fgets(line,MAX_LENGTH_OF_LINE,pwd)!=<span class="literal">NULL</span>)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">char</span> * name=strtok(line,<span class="string">" "</span>);</div><div class="line">                <span class="comment">//printf("%s\n",name);</span></div><div class="line">                <span class="keyword">if</span>(<span class="built_in">strcmp</span>(name,username)==<span class="number">0</span>)</div><div class="line">                &#123;</div><div class="line">                    <span class="keyword">char</span> password[MAX_LENGTH_OF_USERNAME];</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"password:"</span>);</div><div class="line">                    gets(password);</div><div class="line">                    <span class="keyword">char</span> * pasw=strtok(<span class="literal">NULL</span>,<span class="string">" \n\r"</span>);</div><div class="line">                    <span class="comment">//printf("file password:%s\n",pasw);</span></div><div class="line">                    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(pasw,password)==<span class="number">0</span>)</div><div class="line">                    &#123;</div><div class="line">                        <span class="built_in">strcpy</span>(USER_NAME,username);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">else</span></div><div class="line">                    &#123;</div><div class="line">                        <span class="built_in">printf</span>(<span class="string">"wrong password.\n"</span>);</div><div class="line">                    &#125;</div><div class="line">                    fclose (pwd);</div><div class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"user not exist.\n"</span>);</div><div class="line">        fclose (pwd);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"login error.pwd file not exist or not able to open.\n"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">shellexit</span><span class="params">(<span class="keyword">char</span> * command)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cat_file</span><span class="params">(<span class="keyword">char</span> * file_path)</span></span></div><div class="line">&#123;</div><div class="line">    FILE* f=fopen(file_path,<span class="string">"r"</span>);</div><div class="line">    <span class="keyword">if</span>(f==<span class="literal">NULL</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"file does not exist.\n"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span> line[MAX_LENGTH_OF_LINE];</div><div class="line">    <span class="keyword">while</span>(!feof(f))</div><div class="line">    &#123;</div><div class="line">        fgets(line,MAX_LENGTH_OF_LINE,f);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">strlen</span>(line);i++)&#123;</div><div class="line">            <span class="keyword">if</span>(line[i]==<span class="string">'\0'</span>)<span class="keyword">break</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%c"</span>,line[i]);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cat</span><span class="params">(<span class="keyword">char</span> * command)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">char</span> * path=strtok(command,<span class="string">" "</span>);</div><div class="line">    path=strtok(<span class="literal">NULL</span>,<span class="string">" "</span>);</div><div class="line">    <span class="comment">//printf("path:%s",path);</span></div><div class="line">    cat_file(path);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cd_path</span><span class="params">(<span class="keyword">char</span> *path)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">struct</span> <span class="keyword">_finddata_t</span> f;</div><div class="line">    <span class="keyword">int</span> p;</div><div class="line">    <span class="comment">//printf("1");</span></div><div class="line">    <span class="comment">/* FILE * pFile;</span></div><div class="line">    pFile = fopen (path,"r");</div><div class="line">    if (pFile!=NULL)</div><div class="line">    &#123;      printf("2");</div><div class="line">    &#125;printf("3");*/</div><div class="line">    <span class="keyword">if</span>((p=_findfirst(path, &amp;f))!=<span class="number">-1</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="comment">//printf("%d",p);</span></div><div class="line">        <span class="comment">//printf("2");</span></div><div class="line">        <span class="comment">//printf(" %d ",f.attrib);</span></div><div class="line">        <span class="keyword">if</span>(f.attrib&amp;_A_SUBDIR)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//printf("4");</span></div><div class="line">            <span class="built_in">strcpy</span>(GLOBLE_PATH,path);</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"destination path is not a folder.\n"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"destination not exist.\n"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cd</span><span class="params">(<span class="keyword">char</span> * command)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">char</span> * path=strtok(command,<span class="string">" "</span>);</div><div class="line">    path=strtok(<span class="literal">NULL</span>,<span class="string">" "</span>);</div><div class="line">    <span class="comment">//printf("path:%s",path);</span></div><div class="line">    cd_path(path);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ls_path</span><span class="params">(<span class="keyword">char</span> * path)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">struct</span> <span class="keyword">_finddata_t</span> f;</div><div class="line">    <span class="keyword">int</span> p;</div><div class="line">    <span class="keyword">char</span> name[MAX_LENGTH_OF_PATH];</div><div class="line">    <span class="built_in">strcpy</span>(name,path);</div><div class="line">    <span class="built_in">strcat</span>(name,<span class="string">"/*"</span>);</div><div class="line">    <span class="comment">//printf("1");</span></div><div class="line">    <span class="keyword">if</span>((p=_findfirst(name, &amp;f))!=<span class="number">-1</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="comment">//read(p,filename,)</span></div><div class="line">        <span class="comment">//printf("2");</span></div><div class="line">        <span class="built_in">printf</span>(f.name);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">        <span class="keyword">while</span>(_findnext(p, &amp;f)==<span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">printf</span>(f.name);</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">char</span> * command)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">char</span> * path=strtok(command,<span class="string">" "</span>);</div><div class="line">    path=strtok(<span class="literal">NULL</span>,<span class="string">" "</span>);</div><div class="line">    <span class="comment">//printf("path:%s",path);</span></div><div class="line">    <span class="keyword">if</span>(path==<span class="literal">NULL</span>||<span class="built_in">strcmp</span>(path,<span class="string">""</span>)==<span class="number">0</span>)</div><div class="line">    &#123;</div><div class="line">        ls_path(GLOBLE_PATH);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        ls_path(path);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// SHELL_H_INCLUDED</span></span></div></pre></td></tr></table></figure>
<h3 id="外部资源文件："><a href="#外部资源文件：" class="headerlink" title="外部资源文件："></a>外部资源文件：</h3><p>pwd（login 命令使用）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ma 123456</div><div class="line">xue 123456</div><div class="line">wei 123456</div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于大三下学期，2016年3月。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[GLine游戏（Win32GUI实现，CodeBlocks+GCC编译）]]></title>
      <url>http://maxuewei2.git.io/2016/03/15/Glines%E6%B8%B8%E6%88%8F/</url>
      <content type="html"><![CDATA[<h3 id="游戏规则："><a href="#游戏规则：" class="headerlink" title="游戏规则："></a>游戏规则：</h3><p>在10X10的棋盘上有五种颜色的棋子。</p>
<p>点击一个棋子，再点击一个空格子，如果两者之间有一条路径的话，棋子会移动到空格子内。</p>
<p>每移动一次，棋盘上会增加三个棋子，其位置和颜色都是随机的。</p>
<p>当横向、竖向或斜向有五个或以上棋子有相同颜色时，这些棋子会消去。</p>
<p>当棋盘上没有空格子时，游戏结束。</p>
<p>得分为消去得棋子的个数。<br><a id="more"></a></p>
<h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p><img src="/imgs/glines.jpg" alt="xiaoguo"></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><h4 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//main.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(UNICODE) &amp;&amp; !defined(_UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(_UNICODE) &amp;&amp; !defined(UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"matrix.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"matrix.cpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BKCOLOR RGB(200,200,200)</span></div><div class="line"><span class="keyword">int</span> score=<span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> WIDTH=<span class="number">400</span>;</div><div class="line"><span class="keyword">int</span> HEIGHT=<span class="number">440</span>;</div><div class="line">Matrix ma;</div><div class="line"><span class="keyword">int</span> width=<span class="number">40</span>;<span class="comment">//WIDTH/ma.getN();</span></div><div class="line"><span class="keyword">int</span> height=<span class="number">40</span>;<span class="comment">//HEIGHT/ma.getN();</span></div><div class="line">PAINTSTRUCT ps ;</div><div class="line"><span class="keyword">static</span> HBRUSH  red_brush =CreateSolidBrush (RGB(<span class="number">230</span>,<span class="number">90</span>,<span class="number">90</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH  green_brush =CreateSolidBrush (RGB(<span class="number">90</span>,<span class="number">230</span>,<span class="number">90</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH  blue_brush =CreateSolidBrush (RGB(<span class="number">90</span>,<span class="number">90</span>,<span class="number">230</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH  yellow_brush =CreateSolidBrush (RGB(<span class="number">230</span>,<span class="number">230</span>,<span class="number">90</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH  purple_brush =CreateSolidBrush (RGB(<span class="number">230</span>,<span class="number">90</span>,<span class="number">230</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH  white_brush =CreateSolidBrush (BKCOLOR);</div><div class="line">Point * s_lattice=<span class="keyword">new</span> Point(<span class="number">0</span>,<span class="number">0</span>),*d_lattice=<span class="keyword">new</span> Point(<span class="number">0</span>,<span class="number">0</span>);</div><div class="line"><span class="keyword">bool</span> paint_path=<span class="literal">false</span>;</div><div class="line"><span class="keyword">int</span> path_color=<span class="number">0</span>;</div><div class="line">Point* sou=<span class="keyword">new</span> Point();</div><div class="line">Point* dest=<span class="keyword">new</span> Point();</div><div class="line">Point* mouse=<span class="keyword">new</span> Point(<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">Point *position=<span class="keyword">new</span> Point(<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">Link&lt;Point *&gt;* path;</div><div class="line">HBRUSH hBrush ;</div><div class="line">HDC hdc;</div><div class="line">POINT pc;</div><div class="line">RECT client_rect;</div><div class="line"><span class="keyword">int</span> score_height;</div><div class="line"></div><div class="line"><span class="comment">/*  Declare Windows procedure  */</span></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/*  Make the class name into a global variable  */</span></div><div class="line">TCHAR szClassName[ ] = _T(<span class="string">"Game"</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span> <span class="params">(HINSTANCE hThisInstance,</span></span></div><div class="line">                    HINSTANCE hPrevInstance,</div><div class="line">                    LPSTR lpszArgument,</div><div class="line">                    <span class="keyword">int</span> nCmdShow) &#123;</div><div class="line">    HWND hwnd;               <span class="comment">/* This is the handle for our window */</span></div><div class="line">    MSG messages;            <span class="comment">/* Here messages to the application are saved */</span></div><div class="line">    WNDCLASSEX wincl;        <span class="comment">/* Data structure for the windowclass */</span></div><div class="line"></div><div class="line">    <span class="comment">/* The Window structure */</span></div><div class="line">    wincl.hInstance = hThisInstance;</div><div class="line">    wincl.lpszClassName = szClassName;</div><div class="line">    wincl.lpfnWndProc = WindowProcedure;      <span class="comment">/* This function is called by windows */</span></div><div class="line">    wincl.style = CS_DBLCLKS;                 <span class="comment">/* Catch double-clicks */</span></div><div class="line">    wincl.cbSize = <span class="keyword">sizeof</span> (WNDCLASSEX);</div><div class="line"></div><div class="line">    <span class="comment">/* Use default icon and mouse-pointer */</span></div><div class="line">    wincl.hIcon = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hIconSm = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hCursor = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW);</div><div class="line">    wincl.lpszMenuName = <span class="literal">NULL</span>;                 <span class="comment">/* No menu */</span></div><div class="line">    wincl.cbClsExtra = <span class="number">0</span>;                      <span class="comment">/* No extra bytes after the window class */</span></div><div class="line">    wincl.cbWndExtra = <span class="number">0</span>;                      <span class="comment">/* structure or the window instance */</span></div><div class="line">    <span class="comment">/* Use Windows's default colour as the background of the window */</span></div><div class="line">    wincl.hbrBackground = (HBRUSH) COLOR_BACKGROUND;</div><div class="line"></div><div class="line">    <span class="comment">/* Register the window class, and if it fails quit the program */</span></div><div class="line">    <span class="keyword">if</span> (!RegisterClassEx (&amp;wincl))</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* The class is registered, let's create the program*/</span></div><div class="line">    hwnd = CreateWindowEx (</div><div class="line">               <span class="number">0</span>,                   <span class="comment">/* Extended possibilites for variation */</span></div><div class="line">               szClassName,         <span class="comment">/* Classname */</span></div><div class="line">               _T(<span class="string">"GLine"</span>),       <span class="comment">/* Title Text */</span></div><div class="line">               WS_OVERLAPPEDWINDOW, <span class="comment">/* default window */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* Windows decides the position */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* where the window ends up on the screen */</span></div><div class="line">               WIDTH,                 <span class="comment">/* The programs width */</span></div><div class="line">               HEIGHT,                 <span class="comment">/* and height in pixels */</span></div><div class="line">               HWND_DESKTOP,        <span class="comment">/* The window is a child-window to desktop */</span></div><div class="line">               <span class="literal">NULL</span>,                <span class="comment">/* No menu */</span></div><div class="line">               hThisInstance,       <span class="comment">/* Program Instance handler */</span></div><div class="line">               <span class="literal">NULL</span>                 <span class="comment">/* No Window Creation data */</span></div><div class="line">           );</div><div class="line"></div><div class="line">    <span class="comment">/* Make the window visible on the screen */</span></div><div class="line">    ShowWindow (hwnd, nCmdShow);</div><div class="line"></div><div class="line">    <span class="comment">/* Run the message loop. It will run until GetMessage() returns 0 */</span></div><div class="line">    <span class="keyword">while</span> (GetMessage (&amp;messages, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>)) &#123;</div><div class="line">        <span class="comment">/* Translate virtual-key messages into character messages */</span></div><div class="line">        TranslateMessage(&amp;messages);</div><div class="line">        <span class="comment">/* Send message to WindowProcedure */</span></div><div class="line">        DispatchMessage(&amp;messages);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/* The program return-value is 0 - The value that PostQuitMessage() gave */</span></div><div class="line">    <span class="keyword">return</span> messages.wParam;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">select_brush</span><span class="params">(<span class="keyword">int</span> color,HDC hdc)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span>(color) &#123;</div><div class="line">    <span class="keyword">case</span> RED:</div><div class="line">        SelectObject (hdc, red_brush);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> GREEN:</div><div class="line">        SelectObject (hdc, green_brush);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> BLUE:</div><div class="line">        SelectObject (hdc, blue_brush);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> YELLOW:</div><div class="line">        SelectObject (hdc, yellow_brush);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> PURPLE:</div><div class="line">        SelectObject (hdc, purple_brush);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">        SelectObject (hdc, white_brush);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> color;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_lattice</span><span class="params">(Point * p,HDC hdc,<span class="keyword">int</span> color)</span> </span>&#123; <span class="comment">//-1 original color</span></div><div class="line">    <span class="keyword">int</span> left=p-&gt;y*width;</div><div class="line">    <span class="keyword">int</span> right=(p-&gt;y+<span class="number">1</span>)*width;</div><div class="line">    <span class="keyword">int</span> top=p-&gt;x*height+score_height;</div><div class="line">    <span class="keyword">int</span> bottom=(p-&gt;x+<span class="number">1</span>)*height+score_height;</div><div class="line">    MoveToEx (hdc,left,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,top) ;</div><div class="line">    MoveToEx (hdc,left,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,left,bottom) ;</div><div class="line">    MoveToEx (hdc,right,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,bottom) ;</div><div class="line">    MoveToEx (hdc,left,bottom, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,bottom) ;</div><div class="line">    <span class="keyword">int</span> paint_color;</div><div class="line">    <span class="keyword">if</span>(color!=<span class="number">-1</span>) &#123;</div><div class="line">        paint_color=select_brush(color,hdc);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        paint_color=select_brush(ma.get_color(p),hdc);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(paint_color!=BLANK)Ellipse (hdc,left+<span class="number">3</span>,top+<span class="number">3</span>,right<span class="number">-3</span>,bottom<span class="number">-3</span>) ;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">mouse_to_position</span><span class="params">()</span> </span>&#123;</div><div class="line">    position-&gt;x=(mouse-&gt;y-score_height)/height;</div><div class="line">    position-&gt;y=mouse-&gt;x/width;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">char</span> *<span class="title">get_score_string</span><span class="params">(<span class="keyword">char</span>* content)</span></span>&#123;</div><div class="line">    <span class="keyword">char</span> *message=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">50</span>];</div><div class="line">    <span class="built_in">sprintf</span> (message, <span class="string">"%s  %d ."</span>,content,score);</div><div class="line">    <span class="keyword">return</span> message;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">show_score</span><span class="params">(HWND hwnd,<span class="keyword">char</span>* content,<span class="keyword">char</span>* title)</span> </span>&#123;</div><div class="line">    MessageBox(hwnd,get_score_string(content),title,<span class="literal">NULL</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">after_show_path</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    ma.set_flag(dest,ma.get_color(sou));</div><div class="line">    ma.set_blank(sou);</div><div class="line">    ma.random_set(<span class="number">2</span>);</div><div class="line">    ma.eliminate(score);</div><div class="line">    InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">    <span class="keyword">if</span>(ma.is_all_not_blank()) &#123;</div><div class="line">        show_score(hwnd,<span class="string">"GAME OVER.Your score is"</span>,<span class="string">"你输了"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">struct</span> args &#123;</div><div class="line">    HWND hwnd;</div><div class="line">    HDC hdc;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">show_path</span><span class="params">(<span class="keyword">void</span>* ar)</span> </span>&#123;</div><div class="line">    path=<span class="keyword">new</span> Link&lt;Point *&gt;();</div><div class="line">    ma.get_path(sou,dest,path);</div><div class="line">    <span class="keyword">struct</span> args* arg=(<span class="keyword">struct</span> args*) ar;</div><div class="line">    HWND hwnd=arg-&gt;hwnd;</div><div class="line">    HDC hdc=arg-&gt;hdc;</div><div class="line">    <span class="keyword">if</span>(path-&gt;get_first()==<span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//path-&gt;show_link();</span></div><div class="line">    path-&gt;seek_to_first();</div><div class="line">    Point* node=path-&gt;get_first();</div><div class="line">    path_color=ma.get_color(node);</div><div class="line">    s_lattice=node;</div><div class="line">    paint_path=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">while</span>((node=path-&gt;get_next())!=<span class="literal">NULL</span>) &#123;</div><div class="line">        d_lattice=node;</div><div class="line">        InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">        Sleep(<span class="number">300</span>);</div><div class="line">    &#125;</div><div class="line">    paint_path=<span class="literal">false</span>;</div><div class="line">    after_show_path(hwnd);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_GUI</span><span class="params">(HWND hwnd,HDC hdc)</span> </span>&#123;</div><div class="line">    SetBkColor(hdc,BKCOLOR);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;ma.getN(); i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;ma.getN(); j++) &#123;</div><div class="line">            Point* p=<span class="keyword">new</span> Point(i,j);</div><div class="line">            paint_lattice(p,hdc,<span class="number">-1</span>);</div><div class="line">            <span class="keyword">delete</span> p;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span> * score=get_score_string(<span class="string">"You Score: "</span>);</div><div class="line">    TextOut(hdc,<span class="number">0</span>,score_height/<span class="number">4</span>,score,<span class="built_in">strlen</span>(score));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sou_dest</span><span class="params">(HWND hwnd,HDC hdc)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">pthread_t</span> show_path_pth;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> ret;</div><div class="line">    mouse_to_position();</div><div class="line">    <span class="keyword">if</span>(sou!=<span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(ma.get_color(position)==BLANK) &#123;</div><div class="line">            *dest=*position;</div><div class="line">            <span class="keyword">struct</span> args arg;</div><div class="line">            arg.hdc=hdc;</div><div class="line">            arg.hwnd=hwnd;</div><div class="line">            ret= pthread_create( &amp;show_path_pth, <span class="literal">NULL</span>, &amp;show_path, &amp;arg ); <span class="comment">//参数：创建的线程id，线程参数，线程运行函数的起始地址，运行函数的参数</span></div><div class="line">            <span class="keyword">if</span>( ret != <span class="number">0</span> ) &#123; <span class="comment">//创建线程成功返回0</span></div><div class="line">                <span class="built_in">printf</span>(<span class="string">"pthread_create error:error_code=%d\n"</span>,ret );</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            *sou=*position;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span>(ma.get_color(position)!=BLANK) &#123;</div><div class="line">            *sou=*position;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*  This function is called by the Windows function DispatchMessage()  */</span></div><div class="line"></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span> (message) &#123;                <span class="comment">/* handle the messages */</span></div><div class="line">    <span class="keyword">case</span> WM_CREATE: &#123;</div><div class="line">        ma.init();</div><div class="line">        GetClientRect (hwnd, &amp;client_rect) ;</div><div class="line">        WIDTH=client_rect.right-client_rect.left ;</div><div class="line">        HEIGHT=client_rect.bottom-client_rect.top ;</div><div class="line">        score_height=HEIGHT/<span class="number">10</span>;</div><div class="line">        width=WIDTH/ma.getN();</div><div class="line">        height=(HEIGHT-score_height)/ma.getN();</div><div class="line">        InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_DESTROY:</div><div class="line">        PostQuitMessage (<span class="number">0</span>);       <span class="comment">/* send a WM_QUIT to the message queue */</span></div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_LBUTTONUP: &#123;</div><div class="line">        GetCursorPos(&amp;pc);</div><div class="line">        ScreenToClient(hwnd,&amp;pc);</div><div class="line">        mouse-&gt;x=pc.x;</div><div class="line">        mouse-&gt;y=pc.y;</div><div class="line">        sou_dest(hwnd,hdc);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_RBUTTONUP: &#123;</div><div class="line">        show_score(hwnd,<span class="string">""</span>,<span class="string">"得分"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_PAINT: &#123;</div><div class="line">        hdc = BeginPaint (hwnd, &amp;ps) ;</div><div class="line">        init_GUI(hwnd,hdc);</div><div class="line">        <span class="keyword">if</span>(paint_path) &#123;</div><div class="line">            paint_lattice(s_lattice,hdc,BLANK);</div><div class="line">            paint_lattice(d_lattice,hdc,path_color);</div><div class="line">        &#125;</div><div class="line">        EndPaint (hwnd, &amp;ps) ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:                      <span class="comment">/* for messages that we don't deal with */</span></div><div class="line">        <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="matrix-h"><a href="#matrix-h" class="headerlink" title="matrix.h"></a>matrix.h</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//matrix.h</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MATRIX_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MATRIX_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span>  once</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BLANK 0</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RED 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> GREEN 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BLUE 3</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> YELLOW 4</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PURPLE 5</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Point &#123;</div><div class="line"><span class="keyword">private</span> :</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">    Point(<span class="keyword">int</span> xx,<span class="keyword">int</span> yy);</div><div class="line">    Point();</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> ==(Point p);</div><div class="line">    Point&amp; <span class="keyword">operator</span> =(Point p);</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">class</span> node &#123;</div><div class="line"><span class="keyword">public</span> :</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">    node* father;</div><div class="line">    node();</div><div class="line">    node(<span class="keyword">int</span> xx,<span class="keyword">int</span> yy,node* f);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">class</span> LinkNode &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    T po;</div><div class="line">    LinkNode* next;</div><div class="line">    LinkNode(T  pp);</div><div class="line">    LinkNode&amp; <span class="keyword">operator</span>=(LinkNode nn);</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show_node</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">class</span> Link &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    LinkNode&lt;T&gt;* head=<span class="literal">NULL</span>;</div><div class="line">    LinkNode&lt;T&gt;* p=<span class="literal">NULL</span>;</div><div class="line">    LinkNode&lt;T&gt;* tail=<span class="literal">NULL</span>;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> Matrix;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">seek_to_first</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">T <span class="title">get_first</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">T <span class="title">remove_first</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">T <span class="title">get_next</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add_to_first</span><span class="params">(T t)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add_to_last</span><span class="params">(T t)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show_link</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">class</span> Matrix &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> N=<span class="number">10</span>;</div><div class="line">    <span class="keyword">int</span> COLOR_NUM=<span class="number">5</span>;</div><div class="line">    <span class="keyword">int</span>** matrix;</div><div class="line">    <span class="keyword">int</span> max_random_set_num=<span class="number">5</span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_random_num</span><span class="params">(<span class="keyword">int</span> x)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print_matrix</span><span class="params">()</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">random_set_one</span><span class="params">()</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_out</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getN</span><span class="params">()</span> </span>;</div><div class="line">    Matrix() ;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_flag</span><span class="params">(Point* p,<span class="keyword">int</span> color)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_blank</span><span class="params">(Point* p)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_in_que</span><span class="params">(<span class="keyword">int</span>** in,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_path</span><span class="params">(Point *s,Point* dest,Link&lt;Point *&gt; *&amp;l)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">random_set</span><span class="params">(<span class="keyword">int</span> n)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_color</span><span class="params">(Point *p)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_color</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sget_color</span><span class="params">(<span class="keyword">int</span> dir,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> n,<span class="keyword">int</span> color)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test_line</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> dir,<span class="keyword">int</span> &amp;score)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">eliminate</span><span class="params">(<span class="keyword">int</span> &amp; score)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_all_not_blank</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// MATRIX_H_INCLUDED</span></span></div></pre></td></tr></table></figure>
<h4 id="matrix-cpp"><a href="#matrix-cpp" class="headerlink" title="matrix.cpp"></a>matrix.cpp</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//matrix.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"matrix.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"></div><div class="line">Point::Point(<span class="keyword">int</span> xx,<span class="keyword">int</span> yy) &#123;</div><div class="line">    x=xx;</div><div class="line">    y=yy;</div><div class="line">&#125;</div><div class="line">Point::Point() &#123;&#125;</div><div class="line"><span class="keyword">bool</span> Point::<span class="keyword">operator</span> ==(Point p) &#123;</div><div class="line">    <span class="keyword">return</span> x==p.x&amp;y==p.y;</div><div class="line">&#125;</div><div class="line">Point&amp; Point::<span class="keyword">operator</span> =(Point p) &#123;</div><div class="line">    x=p.x;</div><div class="line">    y=p.y;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Point::show() &#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"(%d,%d)-&gt;"</span>,x,y);</div><div class="line">&#125;</div><div class="line"></div><div class="line">node::node() &#123;&#125;</div><div class="line">node::node(<span class="keyword">int</span> xx,<span class="keyword">int</span> yy,node* f) &#123;</div><div class="line">    x=xx;</div><div class="line">    y=yy;</div><div class="line">    father=f;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line">LinkNode&lt;T&gt;::LinkNode(T  pp) &#123;</div><div class="line">    po=pp;</div><div class="line">    next=<span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line">LinkNode&lt;T&gt;&amp; LinkNode&lt;T&gt;::<span class="keyword">operator</span>=(LinkNode&lt;T&gt; nn) &#123;</div><div class="line">    po=nn.p;</div><div class="line">    next=nn.next;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">void</span> LinkNode&lt;T&gt;::show_node() &#123;</div><div class="line">    po-&gt;show();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">void</span> Link&lt;T&gt;::seek_to_first() &#123;</div><div class="line">    p=head;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line">T Link&lt;T&gt;::get_first() &#123;</div><div class="line">    <span class="keyword">return</span> head==<span class="literal">NULL</span>?<span class="literal">NULL</span>:head-&gt;po;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line">T Link&lt;T&gt;::remove_first() &#123;</div><div class="line">    <span class="keyword">if</span>(head==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    T *temp=&amp;(head-&gt;po);</div><div class="line">    head=head-&gt;next;</div><div class="line">    <span class="keyword">return</span> *temp;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line">T Link&lt;T&gt;::get_next() &#123;</div><div class="line">    <span class="keyword">if</span>(p==tail)<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(p==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(p-&gt;next==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    p=p-&gt;next;</div><div class="line">    <span class="keyword">return</span> p-&gt;po;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">void</span> Link&lt;T&gt;::add_to_first(T t) &#123;</div><div class="line">    LinkNode&lt;T&gt;* x=<span class="keyword">new</span> LinkNode&lt;T&gt;(t);</div><div class="line">    x-&gt;next=head;</div><div class="line">    head=x;</div><div class="line">    <span class="keyword">if</span>(tail=<span class="literal">NULL</span>) &#123;</div><div class="line">        tail=head;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">void</span> Link&lt;T&gt;::add_to_last(T t) &#123;</div><div class="line">    LinkNode&lt;T&gt;* x=<span class="keyword">new</span> LinkNode&lt;T&gt;(t);</div><div class="line">    <span class="keyword">if</span>(head==<span class="literal">NULL</span>) &#123;</div><div class="line">        head=x;</div><div class="line">        x-&gt;next=<span class="literal">NULL</span>;</div><div class="line">        tail=x;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    tail-&gt;next=x;</div><div class="line">    x-&gt;next=<span class="literal">NULL</span>;</div><div class="line">    tail=x;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">void</span> Link&lt;T&gt;::show_link() &#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"show_link:\n"</span>);</div><div class="line">    p=head;</div><div class="line">    <span class="keyword">while</span>(p!=<span class="literal">NULL</span>) &#123;</div><div class="line">        p-&gt;show_node();</div><div class="line">        p=p-&gt;next;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">int</span> Matrix::get_random_num(<span class="keyword">int</span> x) &#123;</div><div class="line">    <span class="keyword">int</span> n=rand()%x;</div><div class="line">    <span class="keyword">return</span> n;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Matrix::print_matrix() &#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"matrix:\n"</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d"</span>,matrix[i][j]);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">bool</span> Matrix::random_set_one() &#123;</div><div class="line">    <span class="keyword">int</span> x=get_random_num(N),y=get_random_num(N);</div><div class="line">    <span class="keyword">if</span>(matrix[x][y]!=BLANK) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    Point *p=<span class="keyword">new</span> Point(x,y);</div><div class="line">    set_flag(p,get_random_num(COLOR_NUM)+<span class="number">1</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">bool</span> Matrix::is_out(<span class="keyword">int</span> x,<span class="keyword">int</span> y) &#123;</div><div class="line">    <span class="keyword">return</span> x&lt;<span class="number">0</span>|x&gt;=N|y&lt;<span class="number">0</span>|y&gt;=N;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">int</span> Matrix::getN() &#123;</div><div class="line">    <span class="keyword">return</span> N;</div><div class="line">&#125;</div><div class="line">Matrix::Matrix() &#123;</div><div class="line">    matrix=<span class="keyword">new</span> <span class="keyword">int</span>*[N];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        matrix[i]=<span class="keyword">new</span> <span class="keyword">int</span>[N];</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">            matrix[i][j]=BLANK;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    srand(time(<span class="number">0</span>));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Matrix::init() &#123;</div><div class="line">    random_set(N*N/<span class="number">4</span>);</div><div class="line">    <span class="comment">//print_matrix();</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Matrix::set_flag(Point* p,<span class="keyword">int</span> color) &#123;</div><div class="line">    matrix[p-&gt;x][p-&gt;y]=color;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Matrix::set_blank(Point* p) &#123;</div><div class="line">    matrix[p-&gt;x][p-&gt;y]=BLANK;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">bool</span> Matrix::is_in_que(<span class="keyword">int</span>** in,<span class="keyword">int</span> x,<span class="keyword">int</span> y) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Matrix::get_path(Point *s,Point* dest,Link&lt;Point *&gt; *&amp;l) &#123;</div><div class="line">    <span class="keyword">if</span>(!(get_color(s)!=BLANK&amp;&amp;get_color(dest)==BLANK))<span class="keyword">return</span> ;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> xc[<span class="number">4</span>]= &#123;<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> yc[<span class="number">4</span>]= &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</div><div class="line">    <span class="keyword">int</span> xt,yt;</div><div class="line">    Link&lt;node*&gt; que;</div><div class="line">    node* temp=<span class="keyword">new</span> node(s-&gt;x,s-&gt;y,<span class="literal">NULL</span>);</div><div class="line">    que.add_to_last(temp);</div><div class="line">    node* dest_node;</div><div class="line">    <span class="keyword">bool</span> flag=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">bool</span>** in=<span class="keyword">new</span> <span class="keyword">bool</span>*[N];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        in[i]=<span class="keyword">new</span> <span class="keyword">bool</span>[N];</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">            in[i][j]=<span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    in[temp-&gt;x][temp-&gt;y]=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">while</span>(flag&amp;&amp;que.get_first()!=<span class="literal">NULL</span>) &#123;</div><div class="line">        temp=que.remove_first();</div><div class="line">        <span class="keyword">if</span>(temp==<span class="literal">NULL</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">            xt=temp-&gt;x+xc[i];</div><div class="line">            yt=temp-&gt;y+yc[i];</div><div class="line">            <span class="keyword">if</span>((!is_out(xt,yt))&amp;&amp;(!in[xt][yt])) &#123;</div><div class="line">                node* new_node=<span class="keyword">new</span> node(xt,yt,temp);</div><div class="line">                <span class="keyword">if</span>(xt==dest-&gt;x&amp;&amp;yt==dest-&gt;y) &#123;</div><div class="line">                    dest_node=new_node;</div><div class="line">                    flag=<span class="literal">false</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(get_color(xt,yt)==BLANK) &#123;</div><div class="line">                    in[xt][yt]=<span class="literal">true</span>;</div><div class="line">                    que.add_to_last(new_node);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(flag) &#123;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    node *n=dest_node;</div><div class="line">    <span class="keyword">while</span>(n!=<span class="literal">NULL</span>) &#123;</div><div class="line">        Point *lp=<span class="keyword">new</span> Point(n-&gt;x,n-&gt;y);</div><div class="line">        l-&gt;add_to_first(lp);</div><div class="line">        n=n-&gt;father;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Matrix::random_set(<span class="keyword">int</span> n) &#123;</div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line">    srand(time(<span class="number">0</span>));</div><div class="line">    <span class="keyword">int</span> try_time=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(i&lt;n&amp;&amp;try_time&lt;N*N*N) &#123;</div><div class="line">        try_time++;</div><div class="line">        <span class="keyword">if</span>(random_set_one()) &#123;</div><div class="line">            i++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Matrix::get_color(Point *p) &#123;</div><div class="line">    <span class="keyword">return</span> matrix[p-&gt;x][p-&gt;y];</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Matrix::get_color(<span class="keyword">int</span> x,<span class="keyword">int</span> y) &#123;</div><div class="line">    <span class="keyword">return</span> matrix[x][y];</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Matrix::sget_color(<span class="keyword">int</span> dir,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> n,<span class="keyword">int</span> color) &#123;</div><div class="line">    <span class="keyword">switch</span>(dir) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">        y+=n;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">        x+=n;</div><div class="line">        y+=n;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">        x+=n;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> <span class="number">3</span>:</div><div class="line">        x+=n;</div><div class="line">        y-=n;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(is_out(x,y)) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(color!=<span class="number">-1</span>) &#123;</div><div class="line">        matrix[x][y]=color;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> get_color(x,y);</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Matrix::test_line(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> dir,<span class="keyword">int</span> &amp;score) &#123;</div><div class="line">    <span class="keyword">int</span> color=get_color(x,y);</div><div class="line">    <span class="keyword">if</span>(color==BLANK)<span class="keyword">return</span> ;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;<span class="number">5</span>; k++) &#123;</div><div class="line">        <span class="keyword">if</span>(sget_color(dir,x,y,k,<span class="number">-1</span>)!=color) &#123;</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> k=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>( ;; k++) &#123;</div><div class="line">        <span class="keyword">if</span>(sget_color(dir,x,y,k,<span class="number">-1</span>)!=color)<span class="keyword">break</span>;</div><div class="line">        sget_color(dir,x,y,k,BLANK);</div><div class="line">    &#125;</div><div class="line">    score+=k;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Matrix::eliminate(<span class="keyword">int</span> &amp; score) &#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;<span class="number">4</span>; k++) &#123;</div><div class="line">                test_line(i,j,k,score);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">bool</span> Matrix::is_all_not_blank() &#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">            <span class="keyword">if</span>(matrix[i][j]==BLANK) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="旧函数"><a href="#旧函数" class="headerlink" title="旧函数:"></a>旧函数:</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    int tree(node * n,node* father,Point* dest,node * temp)</span></div><div class="line"><span class="comment">//    &#123;</span></div><div class="line"><span class="comment">//        static int xc[4]= &#123;-1,1,0,0&#125;;</span></div><div class="line"><span class="comment">//        static int yc[4]= &#123;0,0,-1,1&#125;;</span></div><div class="line"><span class="comment">//        if(n==NULL)</span></div><div class="line"><span class="comment">//        &#123;</span></div><div class="line"><span class="comment">//            return -1;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        printf("n:(%d,%d)  ",n-&gt;x,n-&gt;y);</span></div><div class="line"><span class="comment">//        n-&gt;father=father;</span></div><div class="line"><span class="comment">//        int xt,yt;</span></div><div class="line"><span class="comment">//        Link&lt;Point *&gt; nei;</span></div><div class="line"><span class="comment">//        printf("neis:  ");</span></div><div class="line"><span class="comment">//        for(int i=0; i&lt;4; i++)</span></div><div class="line"><span class="comment">//        &#123;</span></div><div class="line"><span class="comment">//            xt=n-&gt;x+xc[i];</span></div><div class="line"><span class="comment">//            yt=n-&gt;y+yc[i];</span></div><div class="line"><span class="comment">//            if((!is_out(xt,yt))&amp;&amp;nn[xt][yt].father==NULL&amp;&amp;nn[xt][yt].father==temp)</span></div><div class="line"><span class="comment">//            &#123;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//                if(xt==dest-&gt;x&amp;&amp;yt==dest-&gt;y)</span></div><div class="line"><span class="comment">//                &#123;</span></div><div class="line"><span class="comment">//                    printf("(%d,%d) ",xt,yt);</span></div><div class="line"><span class="comment">//                    nn[xt][yt].father=n;</span></div><div class="line"><span class="comment">//                    return 0;</span></div><div class="line"><span class="comment">//                &#125;</span></div><div class="line"><span class="comment">//                if(get_color(xt,yt)==BLANK)</span></div><div class="line"><span class="comment">//                &#123;</span></div><div class="line"><span class="comment">//                    printf("(%d,%d) ",xt,yt);</span></div><div class="line"><span class="comment">//                    Point *ptemp=new Point(xt,yt);</span></div><div class="line"><span class="comment">//                    nei.add_to_first(ptemp);</span></div><div class="line"><span class="comment">//                    nn[xt][yt].father=n;</span></div><div class="line"><span class="comment">//                &#125;</span></div><div class="line"><span class="comment">//            &#125;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        printf("\n");</span></div><div class="line"><span class="comment">//        nei.seek_to_first();</span></div><div class="line"><span class="comment">//        Point *pp;</span></div><div class="line"><span class="comment">//        if((pp=nei.get_first())!=NULL)&#123;</span></div><div class="line"><span class="comment">//            if(tree(&amp;nn[pp-&gt;x][pp-&gt;y],n,dest,temp)==0)return 0;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        while((pp=nei.get_next())!=NULL)&#123;</span></div><div class="line"><span class="comment">//            if(tree(&amp;nn[pp-&gt;x][pp-&gt;y],n,dest,temp)==0)return 0;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        return 1;</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//    void get_path(Point *s,Point* dest,Link&lt;Point *&gt; *&amp;l)</span></div><div class="line"><span class="comment">//    &#123;</span></div><div class="line"><span class="comment">//        printf("1\n");</span></div><div class="line"><span class="comment">//        node* temp=new node;</span></div><div class="line"><span class="comment">//        tree(&amp;nn[s-&gt;x][s-&gt;y],temp,dest,temp);</span></div><div class="line"><span class="comment">//        printf("\n\nfathers:\n");</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//         for(int i=0; i&lt;N; i++)</span></div><div class="line"><span class="comment">//        &#123;</span></div><div class="line"><span class="comment">//            for(int j=0; j&lt;N; j++)</span></div><div class="line"><span class="comment">//            &#123;</span></div><div class="line"><span class="comment">//                if(nn[i][j].father!=NULL)&#123;</span></div><div class="line"><span class="comment">//                    printf("(%d",nn[i][j].x);</span></div><div class="line"><span class="comment">//                    printf(",%d)",nn[i][j].y);</span></div><div class="line"><span class="comment">//                    printf("-&gt;(%d",nn[i][j].father-&gt;x);</span></div><div class="line"><span class="comment">//                    printf(",%d)\n",nn[i][j].father-&gt;y);</span></div><div class="line"><span class="comment">//                &#125;</span></div><div class="line"><span class="comment">//            &#125;</span></div><div class="line"><span class="comment">//            printf("\n");</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//        node* n=&amp;nn[dest-&gt;x][dest-&gt;y];</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//        while(n!=temp)</span></div><div class="line"><span class="comment">//        &#123;</span></div><div class="line"><span class="comment">//            Point *lp=new Point(n-&gt;x,n-&gt;y);</span></div><div class="line"><span class="comment">//            l-&gt;add_to_first(lp);</span></div><div class="line"><span class="comment">//            n=n-&gt;father;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        printf("3\n");</span></div><div class="line"><span class="comment">//    &#125;</span></div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于大三下学期，2016年3月。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[科学计算器（JAVA实现）]]></title>
      <url>http://maxuewei2.git.io/2016/03/13/%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97%E5%99%A8Java/</url>
      <content type="html"><![CDATA[<h3 id="前记："><a href="#前记：" class="headerlink" title="前记：　　"></a>前记：　　</h3><p>　　大二学 Java 的时候写的，现在贴上来，只为留念。</p>
<p>　　再翻代码，自己看着都头疼。一重重的 if 嵌套，当时写得费劲，现在看着更费劲。</p>
<a id="more"></a>
<h3 id="代码思想："><a href="#代码思想：" class="headerlink" title="代码思想："></a>代码思想：</h3><p>　　代码的大致思想是这样：</p>
<p>　　　　首先定义一个算式字符串。然后用户通过键盘或鼠标点击按钮输入字符，添加到算式字符串末尾。在每次用户输入字符之后，先判断该字符是否符合算式语法规则（如加号后不能再跟加号），不符合语法规则的字符不添加到算式字符串末尾。如果用户输入了等号，则进行计算并将计算结果显示出来。</p>
<p>　　　　其中计算过程如下：<br>&gt;<br>　　　　首先将字符串转化为两个链表，一个存储浮点数，一个存储运算符。<br>&gt;<br>　　　　如 <code>3 + 2*4 - 4/2</code><br>&gt;<br>　　　　会被转换为两个链表：<br><code>3 2 4 4 2</code><br><code>+ * - /</code><br>&gt;<br>之后循环以下过程：<br>&gt;<br>　　　　　　在运算符链表中找到运算优先级最高的一个运算符（若有多个，取第一个）。假设其下标为 i（如在上例中，i = 1 ），然后在浮点数链表中找到下标为 i 和 i+1 的项，进行相应运算后，删除这两项，并把结果插入该位置。在运算符链表中删除该运算符。<br>&gt;<br>如上例中，执行一次运算后，链表为：<br><code>3 8 4 2</code><br><code>+ - /</code><br>&gt;<br>循环进行到浮点数链表中只有一个项目（也即操作符链表为空）。该项目即为算式计算结果。</p>
<p>　　经测试，程序能进行浮点数科学计算。能进行负数计算，如 <code>3--3</code> 。但是计算 <code>3---3</code> 时会出现异常。</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码：　　"></a>代码：　　</h3><p>Calculator.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mycalculator;</div><div class="line"><span class="comment">/*</span></div><div class="line"> *</div><div class="line"> * 计算3---3  会有异常</div><div class="line"> *</div><div class="line"> *</div><div class="line"> *</div><div class="line"> * */</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.*;</div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calculator</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span>, <span class="title">KeyListener</span>,</span></div><div class="line">        <span class="title">MouseListener</span> &#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> WIDTH = <span class="number">440</span>, HEIGHT = <span class="number">350</span>;</div><div class="line">    GridLayout gridLayout = <span class="keyword">new</span> GridLayout(<span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>); <span class="comment">// 勿忘初始化 不初始化不会报错，但面板是空的</span></div><div class="line">    BorderLayout borderLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    FlowLayout flowLayout = <span class="keyword">new</span> FlowLayout();</div><div class="line">    Container container;</div><div class="line">    <span class="comment">// Container cont;</span></div><div class="line">    JPanel panel, buttonPanel;</div><div class="line">    JButton[] buttons;</div><div class="line">    String[] name;</div><div class="line">    JTextField textField;</div><div class="line">    <span class="keyword">boolean</span> cleared = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Calculator</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"Calculator"</span>);</div><div class="line">        container = getContentPane();</div><div class="line">        <span class="comment">// Cont = getContentPane();</span></div><div class="line">        <span class="comment">// Cont.setLayout(borderLayout);</span></div><div class="line">        buttonPanel = <span class="keyword">new</span> JPanel();</div><div class="line">        panel = <span class="keyword">new</span> JPanel();</div><div class="line">        <span class="comment">// container = new Container();</span></div><div class="line">        <span class="comment">// Cont.add(container, borderLayout.CENTER);</span></div><div class="line">        <span class="comment">// panel.setSize(380,380);</span></div><div class="line">        buttonPanel.setLayout(gridLayout);</div><div class="line">        textField = <span class="keyword">new</span> JTextField(<span class="number">15</span>);</div><div class="line">        textField.setFont(textField.getFont().deriveFont(Font.BOLD,</div><div class="line">                (<span class="keyword">float</span>) <span class="number">32.0</span>));</div><div class="line">        textField.setEditable(<span class="keyword">false</span>);</div><div class="line">        textField.setHorizontalAlignment(JTextField.RIGHT);</div><div class="line">        textField.setBackground(Color.GRAY);</div><div class="line">        textField.setForeground(Color.WHITE);</div><div class="line">        panel.add(textField);</div><div class="line">        <span class="comment">// textField.setSize(getBounds().width,getBounds().height/3);</span></div><div class="line">        <span class="comment">// textField.setFont(textField.getFont().deriveFont(99));</span></div><div class="line">        <span class="comment">/*</span></div><div class="line">         * container.setLayout(borderLayout); container.add(textField,</div><div class="line">         * borderLayout.NORTH); container.add(cont, borderLayout.CENTER);</div><div class="line">         */</div><div class="line">        container.setLayout(borderLayout);</div><div class="line">        <span class="comment">// container.add(textField);</span></div><div class="line">        container.add(panel, borderLayout.NORTH);</div><div class="line">        container.add(buttonPanel, borderLayout.CENTER);</div><div class="line">        <span class="comment">// container.setSize(getBounds().width,getBounds().height);</span></div><div class="line">        <span class="comment">// cont.setSize(getBounds().width,getBounds().height/3*2);</span></div><div class="line">        buttons = <span class="keyword">new</span> JButton[<span class="number">16</span>];</div><div class="line">        name = <span class="keyword">new</span> String[] &#123; <span class="string">"7"</span>, <span class="string">"8"</span>, <span class="string">"9"</span>, <span class="string">"/"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>, <span class="string">"6"</span>, <span class="string">"*"</span>, <span class="string">"1"</span>, <span class="string">"2"</span>,</div><div class="line">                <span class="string">"3"</span>, <span class="string">"-"</span>, <span class="string">"0"</span>, <span class="string">"."</span>, <span class="string">"="</span>, <span class="string">"+"</span> &#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt;= <span class="number">15</span>; index++) &#123;</div><div class="line">            buttons[index] = <span class="keyword">new</span> JButton(name[index]);</div><div class="line">            buttons[index].addActionListener(<span class="keyword">this</span>);</div><div class="line">            buttons[index].setBackground(Color.GRAY);</div><div class="line">            buttons[index].setForeground(Color.WHITE);</div><div class="line">            buttons[index].addKeyListener(<span class="keyword">this</span>);</div><div class="line">            buttons[index].addMouseListener(<span class="keyword">this</span>);</div><div class="line">            buttons[index].setFont(buttons[index].getFont().deriveFont(</div><div class="line">                    Font.BOLD, (<span class="keyword">float</span>) <span class="number">32.0</span>));</div><div class="line">            <span class="comment">// buttons[index].setSize(200, 200);</span></div><div class="line">            buttonPanel.add(buttons[index]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">this</span>.addKeyListener(<span class="keyword">this</span>);</div><div class="line">        setSize(WIDTH, HEIGHT);</div><div class="line">        Toolkit kit = Toolkit.getDefaultToolkit(); <span class="comment">// 定义工具包</span></div><div class="line">        Dimension screenSize = kit.getScreenSize(); <span class="comment">// 获取屏幕的尺寸</span></div><div class="line">        <span class="keyword">int</span> screenWidth = screenSize.width; <span class="comment">// 获取屏幕的宽</span></div><div class="line">        <span class="keyword">int</span> screenHeight = screenSize.height; <span class="comment">// 获取屏幕的高</span></div><div class="line">        setLocation(screenWidth / <span class="number">2</span> - WIDTH / <span class="number">2</span>, screenHeight / <span class="number">2</span> - HEIGHT / <span class="number">2</span>);<span class="comment">// 设置窗口居中显示</span></div><div class="line">        <span class="comment">// setLocation(600, 250);</span></div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">        setFocusable(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function">String <span class="title">calculate</span><span class="params">(String str)</span> </span>&#123;</div><div class="line">        String result = <span class="string">"Wrong Expression"</span>;</div><div class="line">        String temp = <span class="string">""</span>;</div><div class="line">        <span class="keyword">if</span> (str.charAt(<span class="number">0</span>) != <span class="string">'-'</span></div><div class="line">                &amp;&amp; !(str.charAt(<span class="number">0</span>) &lt;= <span class="string">'9'</span> &amp;&amp; str.charAt(<span class="number">0</span>) &gt;= <span class="string">'0'</span>)) &#123;</div><div class="line">            <span class="keyword">return</span> result;</div><div class="line">        &#125;</div><div class="line">        LinkedList&lt;Double&gt; list = <span class="keyword">new</span> LinkedList&lt;Double&gt;();</div><div class="line">        LinkedList&lt;Character&gt; optList = <span class="keyword">new</span> LinkedList&lt;Character&gt;();</div><div class="line">        Double doubleTemp;</div><div class="line">        <span class="keyword">boolean</span> isFormerOpt = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt;= str.length() - <span class="number">1</span>; index++) &#123;</div><div class="line">            <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</div><div class="line">                isFormerOpt = <span class="keyword">true</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">if</span> (str.charAt(index - <span class="number">1</span>) &gt; <span class="string">'9'</span> || str.charAt(index - <span class="number">1</span>) &lt; <span class="string">'0'</span>) &#123;</div><div class="line">                    isFormerOpt = <span class="keyword">true</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    isFormerOpt = <span class="keyword">false</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (str.charAt(index) != <span class="string">'+'</span> &amp;&amp; str.charAt(index) != <span class="string">'*'</span></div><div class="line">                    &amp;&amp; str.charAt(index) != <span class="string">'/'</span></div><div class="line">                    &amp;&amp; (!(str.charAt(index) == <span class="string">'-'</span> &amp;&amp; isFormerOpt == <span class="keyword">false</span>))) &#123;</div><div class="line">                temp += str.charAt(index);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                doubleTemp = <span class="keyword">new</span> Double(temp);</div><div class="line">                list.add(doubleTemp);</div><div class="line">                temp = <span class="string">""</span>;</div><div class="line">                optList.add(str.charAt(index));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        doubleTemp = <span class="keyword">new</span> Double(temp);</div><div class="line">        list.add(doubleTemp);</div><div class="line">        temp = <span class="string">""</span>;</div><div class="line">        <span class="comment">/*</span></div><div class="line">         * for (int index = 0; index &lt;= list.size() - 1; index++) &#123;</div><div class="line">         * System.out.println(list.get(index)); &#125; for (int index = 0; index &lt;=</div><div class="line">         * optList.size() - 1; index++) &#123;</div><div class="line">         * System.out.println(optList.get(index)); &#125;</div><div class="line">         */</div><div class="line">        <span class="keyword">boolean</span> isThereHigherOpt = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">while</span> (isThereHigherOpt == <span class="keyword">true</span>) &#123;</div><div class="line">            <span class="comment">/*</span></div><div class="line">             * for (Iterator&lt;Character&gt; it = optList.iterator(); it.hasNext();)</div><div class="line">             * &#123; if (it.next() == '*' || it.next() == '/') &#123; isThereHigherOpt =</div><div class="line">             * true; int index = optList.indexOf(it.next());</div><div class="line">             *</div><div class="line">             * break; &#125; &#125;</div><div class="line">             */</div><div class="line">            isThereHigherOpt = <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt;= optList.size() - <span class="number">1</span>; index++) &#123;</div><div class="line">                <span class="keyword">if</span> (optList.get(index) == <span class="string">'*'</span>) &#123;</div><div class="line">                    Double t = list.get(index) * list.get(index + <span class="number">1</span>);</div><div class="line">                    list.remove(index + <span class="number">1</span>);</div><div class="line">                    list.set(index, t);</div><div class="line">                    optList.remove(index);</div><div class="line">                    isThereHigherOpt = <span class="keyword">true</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (optList.get(index) == <span class="string">'/'</span>) &#123;</div><div class="line">                    Double t = list.get(index) / list.get(index + <span class="number">1</span>);</div><div class="line">                    list.remove(index + <span class="number">1</span>);</div><div class="line">                    list.set(index, t);</div><div class="line">                    optList.remove(index);</div><div class="line">                    isThereHigherOpt = <span class="keyword">true</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">while</span> (optList.isEmpty() == <span class="keyword">false</span>) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt;= optList.size() - <span class="number">1</span>; index++) &#123;</div><div class="line">                <span class="keyword">if</span> (optList.get(index) == <span class="string">'+'</span>) &#123;</div><div class="line">                    Double t = list.get(index) + list.get(index + <span class="number">1</span>);</div><div class="line">                    list.remove(index + <span class="number">1</span>);</div><div class="line">                    list.set(index, t);</div><div class="line">                    optList.remove(index);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (optList.get(index) == <span class="string">'-'</span>) &#123;</div><div class="line">                    Double t = list.get(index) + <span class="number">0.0</span> - list.get(index + <span class="number">1</span>);</div><div class="line">                    list.remove(index + <span class="number">1</span>);</div><div class="line">                    list.set(index, t);</div><div class="line">                    optList.remove(index);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*</span></div><div class="line">         * System.out.println("/////////////////////////////////"); for (int</div><div class="line">         * index = 0; index &lt;= optList.size() - 1; index++) &#123; //</div><div class="line">         * System.out.println(index); System.out.println(list.get(index));</div><div class="line">         * System.out.println(optList.get(index));</div><div class="line">         * System.out.println(list.get(index + 1)); &#125;</div><div class="line">         */</div><div class="line">        <span class="keyword">if</span> (list.size() == <span class="number">1</span>) &#123;</div><div class="line">            result = list.get(<span class="number">0</span>).toString();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addText</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (cleared == <span class="keyword">true</span> &amp;&amp; ((ch &lt;= <span class="string">'9'</span> &amp;&amp; ch &gt;= <span class="string">'0'</span>))) &#123;</div><div class="line">            textField.setText(<span class="string">""</span>);</div><div class="line">            cleared = <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        String str = textField.getText();</div><div class="line">        <span class="keyword">if</span> (ch != <span class="string">'='</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (str.length() &gt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">if</span> (str.charAt(str.length() - <span class="number">1</span>) &lt;= <span class="string">'9'</span></div><div class="line">                        &amp;&amp; str.charAt(str.length() - <span class="number">1</span>) &gt;= <span class="string">'0'</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (ch != <span class="string">'.'</span>) &#123;</div><div class="line">                        textField.setText(str + ch);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="keyword">boolean</span> isTherePoint = <span class="keyword">false</span>;</div><div class="line">                        <span class="keyword">int</span> i = str.length() - <span class="number">1</span>;</div><div class="line">                        <span class="keyword">while</span> (i &gt;= <span class="number">0</span>) &#123;</div><div class="line">                            <span class="keyword">if</span> (str.charAt(i) == <span class="string">'*'</span> || str.charAt(i) == <span class="string">'/'</span></div><div class="line">                                    || str.charAt(i) == <span class="string">'+'</span></div><div class="line">                                    || str.charAt(i) == <span class="string">'-'</span>) &#123;</div><div class="line">                                <span class="keyword">break</span>;</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">if</span> (str.charAt(i) == <span class="string">'.'</span>) &#123;</div><div class="line">                                isTherePoint = <span class="keyword">true</span>;</div><div class="line">                                <span class="keyword">break</span>;</div><div class="line">                            &#125;</div><div class="line">                            i--;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">if</span> (isTherePoint == <span class="keyword">false</span>) &#123;</div><div class="line">                            textField.setText(str + ch);</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">if</span> ((ch &lt;= <span class="string">'9'</span> &amp;&amp; ch &gt;= <span class="string">'0'</span>) || ch == <span class="string">'-'</span>) &#123;</div><div class="line">                        textField.setText(str + ch);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">if</span> (ch == <span class="string">'-'</span> || (ch &lt;= <span class="string">'9'</span> &amp;&amp; ch &gt;= <span class="string">'0'</span>))</div><div class="line">                    textField.setText(str + ch);</div><div class="line">            &#125;</div><div class="line">            cleared = <span class="keyword">false</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (cleared == <span class="keyword">true</span>) &#123;</div><div class="line">                textField.setText(<span class="string">""</span>);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                str = textField.getText();</div><div class="line">                <span class="comment">//System.out.println(str);</span></div><div class="line">                textField.setText(<span class="string">""</span>);</div><div class="line">                <span class="keyword">if</span> (str.length() &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (str.charAt(str.length() - <span class="number">1</span>) &lt;= <span class="string">'9'</span></div><div class="line">                            &amp;&amp; str.charAt(str.length() - <span class="number">1</span>) &gt;= <span class="string">'0'</span>) &#123;</div><div class="line">                        textField.setText(calculate(str));</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        textField.setText(<span class="string">"Wrong Expression"</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            cleared = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent event)</span> </span>&#123;</div><div class="line">        Object source = event.getSource();</div><div class="line">        <span class="keyword">if</span> (source.getClass() == JButton.class) &#123;</div><div class="line">            JButton button = (JButton) source;</div><div class="line">            <span class="keyword">char</span> ch = button.getText().charAt(<span class="number">0</span>);</div><div class="line">            addText(ch);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyReleased</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyTyped</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">char</span> ch = e.getKeyChar();</div><div class="line">        <span class="keyword">if</span> (ch == <span class="string">' '</span>) &#123;</div><div class="line">            System.exit(EXIT_ON_CLOSE);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (ch == KeyEvent.VK_ENTER) &#123;</div><div class="line">            buttons[<span class="number">14</span>].setBackground(Color.LIGHT_GRAY);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= name.length - <span class="number">1</span>; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (i != <span class="number">14</span>) &#123;</div><div class="line">                    buttons[i].setBackground(Color.GRAY);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            addText(<span class="string">'='</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt;= name.length - <span class="number">1</span>; index++) &#123;</div><div class="line">            <span class="keyword">if</span> (ch == name[index].charAt(<span class="number">0</span>)) &#123;</div><div class="line">                <span class="comment">// System.out.println(ch);</span></div><div class="line">                buttons[index].setBackground(Color.LIGHT_GRAY);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= name.length - <span class="number">1</span>; i++) &#123;</div><div class="line">                    <span class="keyword">if</span> (i != index) &#123;</div><div class="line">                        buttons[i].setBackground(Color.GRAY);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                addText(ch);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseClicked</span><span class="params">(MouseEvent event)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseEntered</span><span class="params">(MouseEvent event)</span> </span>&#123;</div><div class="line">        Object source = event.getSource();</div><div class="line">        <span class="keyword">if</span> (source.getClass() == JButton.class) &#123;</div><div class="line">            JButton button = (JButton) source;</div><div class="line">            <span class="comment">// System.out.println("hey");</span></div><div class="line">            button.setBackground(Color.LIGHT_GRAY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mousePressed</span><span class="params">(MouseEvent event)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseReleased</span><span class="params">(MouseEvent event)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseExited</span><span class="params">(MouseEvent event)</span> </span>&#123;</div><div class="line">        Object source = event.getSource();</div><div class="line">        <span class="keyword">if</span> (source.getClass() == JButton.class) &#123;</div><div class="line">            JButton button = (JButton) source;</div><div class="line">            <span class="comment">// System.out.println("hey");</span></div><div class="line">            button.setBackground(Color.GRAY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Calculator c = <span class="keyword">new</span> Calculator();</div><div class="line">        <span class="comment">// c.addKeyListener(c);</span></div><div class="line">        c.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="程序运行效果："><a href="#程序运行效果：" class="headerlink" title="程序运行效果："></a>程序运行效果：</h3><p>计算9/3-1*2+-1</p>
<p><img src="/imgs/caljava1.jpg" alt="xiaoguo"></p>
<p>结果：<br><img src="/imgs/caljava2.jpg" alt="xiaoguo"></p>
<ul>
<li><p>随笔写于2016.4.8。</p>
</li>
<li><p>程序写于大二下学期，Java程序设计 课程期间。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[抓鼠标的猫（Win32实现，Codeblocks+GCC编译）]]></title>
      <url>http://maxuewei2.git.io/2016/03/13/%E6%8A%93%E9%BC%A0%E6%A0%87%E7%9A%84%E7%8C%AB/</url>
      <content type="html"><![CDATA[<h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p>猫的眼睛一直跟着鼠标移动：</p>
<p><img src="/imgs/cat1.jpg" alt="cat"><br><a id="more"></a></p>
<p>鼠标经过猫的右脚附近时，猫会抓住鼠标。（未使用Hook）<br><img src="/imgs/cat2.jpg" alt="cat"></p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//main.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="comment">//#include &lt;iostream&gt;</span></div><div class="line"><span class="comment">//using namespace std;</span></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span> </span>;</div><div class="line"><span class="keyword">double</span> WIDTH=<span class="number">410</span>,HEIGHT=<span class="number">430</span>;</div><div class="line"><span class="keyword">double</span> px=<span class="number">0.0</span>,py=<span class="number">0.0</span>;</div><div class="line"><span class="keyword">double</span> ppx=<span class="number">0.0</span>,ppy=<span class="number">0.0</span>;</div><div class="line">POINT sp;</div><div class="line"><span class="keyword">int</span> cat=<span class="number">0</span>;</div><div class="line"><span class="keyword">double</span> width,height;</div><div class="line">PAINTSTRUCT ps ;</div><div class="line">RECT rect ;</div><div class="line">POINT pts[<span class="number">3</span>];</div><div class="line"><span class="keyword">double</span> left_eye_px=<span class="number">0.0</span>,right_eye_px=<span class="number">0.0</span>;</div><div class="line"><span class="keyword">double</span> eye_py=<span class="number">0.0</span>;</div><div class="line"><span class="keyword">double</span> eye_r=<span class="number">0.0</span>;</div><div class="line"><span class="keyword">double</span> k=<span class="number">0.0</span>;</div><div class="line"><span class="keyword">double</span> ball_hr=<span class="number">0.0</span>;<span class="comment">//半径</span></div><div class="line"><span class="keyword">double</span> deltax=<span class="number">0.0</span>;</div><div class="line">POINT p,pp;</div><div class="line"><span class="keyword">int</span> initGraph=<span class="number">1</span>;</div><div class="line">LPPOINT catp;</div><div class="line">RECT eye_rect;</div><div class="line">HBRUSH  gray_brush =CreateSolidBrush (RGB(<span class="number">180</span>,<span class="number">180</span>,<span class="number">180</span>));</div><div class="line">HBRUSH  white_brush =CreateSolidBrush (RGB(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>));</div><div class="line">HBRUSH  black_brush =CreateSolidBrush (RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">drawRound</span><span class="params">(HDC hdc,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> r)</span>    <span class="comment">//r 直径</span></span></div><div class="line">&#123;</div><div class="line">    Ellipse(hdc,x-r/<span class="number">2</span>,y-r/<span class="number">2</span>,x+r/<span class="number">2</span>,y+r/<span class="number">2</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span> <span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance,</span></span></div><div class="line">                    PSTR szCmdLine, <span class="keyword">int</span> iCmdShow)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">static</span> TCHAR szAppName[] = TEXT (<span class="string">"HelloWin"</span>) ;</div><div class="line">    HWND         hwnd ;</div><div class="line">    MSG          msg ;</div><div class="line">    WNDCLASS     wndclass ;</div><div class="line">    wndclass.style         = CS_HREDRAW | CS_VREDRAW ;</div><div class="line">    wndclass.lpfnWndProc   = WndProc ;</div><div class="line">    wndclass.cbClsExtra    = <span class="number">0</span> ;</div><div class="line">    wndclass.cbWndExtra    = <span class="number">0</span> ;</div><div class="line">    wndclass.hInstance     = hInstance ;</div><div class="line">    wndclass.hIcon         = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION) ;</div><div class="line">    wndclass.hCursor       = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW) ;</div><div class="line">    wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) ;</div><div class="line">    wndclass.lpszMenuName  = <span class="literal">NULL</span> ;</div><div class="line">    wndclass.lpszClassName = szAppName ;</div><div class="line">    <span class="keyword">if</span> (!RegisterClass (&amp;wndclass))</div><div class="line">    &#123;</div><div class="line">        MessageBox (<span class="literal">NULL</span>, TEXT (<span class="string">"This program requires Windows NT!"</span>),</div><div class="line">                    szAppName, MB_ICONERROR) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    &#125;</div><div class="line">    hwnd = CreateWindow (szAppName,                  <span class="comment">// window class name</span></div><div class="line">                         TEXT (<span class="string">"Mouse Hook"</span>), <span class="comment">// window caption</span></div><div class="line">                         WS_OVERLAPPEDWINDOW,        <span class="comment">// window style</span></div><div class="line">                         CW_USEDEFAULT,              <span class="comment">// initial x position</span></div><div class="line">                         CW_USEDEFAULT,              <span class="comment">// initial y position</span></div><div class="line">                         WIDTH,              <span class="comment">// initial x size</span></div><div class="line">                         HEIGHT,              <span class="comment">// initial y size</span></div><div class="line">                         <span class="literal">NULL</span>,                       <span class="comment">// parent window handle</span></div><div class="line">                         <span class="literal">NULL</span>,                       <span class="comment">// window menu handle</span></div><div class="line">                         hInstance,                  <span class="comment">// program instance handle</span></div><div class="line">                         <span class="literal">NULL</span>) ;                     <span class="comment">// creation parameters</span></div><div class="line">    ShowWindow (hwnd, iCmdShow) ;</div><div class="line">    UpdateWindow (hwnd) ;</div><div class="line">    <span class="keyword">while</span> (GetMessage (&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</div><div class="line">    &#123;</div><div class="line">        TranslateMessage (&amp;msg) ;</div><div class="line">        DispatchMessage (&amp;msg) ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> msg.wParam ;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init</span><span class="params">(HWND hwnd)</span></span></div><div class="line">&#123;</div><div class="line">    GetClientRect (hwnd, &amp;rect) ;</div><div class="line">    width=rect.right-rect.left ;</div><div class="line">    height=rect.bottom-rect.top ;</div><div class="line">    left_eye_px=width*<span class="number">3</span>/<span class="number">8</span>-height/<span class="number">16</span>;</div><div class="line">    right_eye_px=width*<span class="number">5</span>/<span class="number">8</span>+height/<span class="number">16</span>;</div><div class="line">    eye_py=height*<span class="number">5</span>/<span class="number">10</span>-height/<span class="number">16</span>;</div><div class="line">    eye_r=height/<span class="number">8</span>;</div><div class="line">    ball_hr=eye_r/<span class="number">8</span>;<span class="comment">//半径</span></div><div class="line">    px=left_eye_px;</div><div class="line">    py=eye_py;</div><div class="line">    ppx=right_eye_px;</div><div class="line">    ppy=eye_py;</div><div class="line">    eye_rect.left=left_eye_px-eye_r/<span class="number">2</span>;</div><div class="line">    eye_rect.right=right_eye_px+eye_r/<span class="number">2</span>;</div><div class="line">    eye_rect.top=eye_py-eye_r/<span class="number">2</span>;</div><div class="line">    eye_rect.bottom=eye_py+eye_r/<span class="number">2</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">drawHand</span><span class="params">(HDC hdc)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">/**&lt; 画嘴 */</span></div><div class="line">    <span class="keyword">if</span>(cat==<span class="number">0</span>)</div><div class="line">    &#123;</div><div class="line">        MoveToEx (hdc, width/<span class="number">4</span>+width/<span class="number">10</span>,height/<span class="number">48</span>*<span class="number">33</span>, <span class="literal">NULL</span>) ;</div><div class="line">        LineTo (hdc, width*<span class="number">3</span>/<span class="number">4</span>-width/<span class="number">10</span>, height/<span class="number">48</span>*<span class="number">33</span>) ;</div><div class="line">        SelectObject (hdc,gray_brush ) ;</div><div class="line">        Ellipse(hdc,width/<span class="number">4</span>-width/<span class="number">20</span>,height/<span class="number">4</span>*<span class="number">3</span>,width/<span class="number">4</span>+width/<span class="number">20</span>,height*<span class="number">1.1</span>);<span class="comment">//左胳膊</span></div><div class="line">        Ellipse(hdc,width/<span class="number">4</span>*<span class="number">3</span>-width/<span class="number">20</span>,height/<span class="number">4</span>*<span class="number">3</span>,width/<span class="number">4</span>*<span class="number">3</span>+width/<span class="number">20</span>,height*<span class="number">1.1</span>);<span class="comment">//右胳膊</span></div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    SelectObject (hdc, gray_brush) ;</div><div class="line">    Ellipse(hdc,width/<span class="number">4</span>*<span class="number">3</span>-width/<span class="number">20</span>,height/<span class="number">4</span>*<span class="number">3</span>,width/<span class="number">4</span>*<span class="number">3</span>+width/<span class="number">20</span>,height*<span class="number">1.1</span>);<span class="comment">//右胳膊</span></div><div class="line">    Ellipse(hdc,width/<span class="number">4</span>-width/<span class="number">20</span>,height-height/<span class="number">4</span>,width/<span class="number">4</span>+width/<span class="number">20</span>,height);<span class="comment">//左胳膊</span></div><div class="line">    <span class="comment">/**&lt; 画脚掌 */</span></div><div class="line">    Ellipse(hdc,width/<span class="number">4</span>-width/<span class="number">12</span>,height-height/<span class="number">7</span>,width/<span class="number">4</span>+width/<span class="number">12</span>,height);</div><div class="line">    MoveToEx (hdc, width/<span class="number">4</span>-width/<span class="number">15</span>,height-height/<span class="number">9</span>, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc, width/<span class="number">4</span>-width/<span class="number">16</span>, height-height/<span class="number">15</span>) ;</div><div class="line">    MoveToEx (hdc, width/<span class="number">4</span>,height-height/<span class="number">7</span>, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc, width/<span class="number">4</span>, height-height/<span class="number">16</span>) ;</div><div class="line">    MoveToEx (hdc, width/<span class="number">4</span>+width/<span class="number">15</span>,height-height/<span class="number">9</span>, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc, width/<span class="number">4</span>+width/<span class="number">16</span>, height-height/<span class="number">15</span>) ;</div><div class="line">    Arc( hdc, width/<span class="number">4</span>-width/<span class="number">18</span>, height-height/<span class="number">16</span>,width/<span class="number">4</span>+width/<span class="number">18</span>, height,width/<span class="number">4</span>+width/<span class="number">16</span>, height,width/<span class="number">4</span>-width/<span class="number">16</span>, height);</div><div class="line">    <span class="comment">/**&lt; 画嘴 */</span></div><div class="line">    Arc( hdc, width*<span class="number">1</span>/<span class="number">4</span>+width/<span class="number">10</span>,  height/<span class="number">48</span>*<span class="number">27</span>,width*<span class="number">3</span>/<span class="number">4</span>-width/<span class="number">10</span>, height/<span class="number">48</span>*<span class="number">33</span>,width*<span class="number">1</span>/<span class="number">4</span>, height/<span class="number">48</span>*<span class="number">30</span>, width*<span class="number">3</span>/<span class="number">4</span>, height/<span class="number">48</span>*<span class="number">30</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span></div><div class="line">&#123;</div><div class="line">    POINT pc;</div><div class="line">    HDC hdc;</div><div class="line">    <span class="keyword">switch</span> (message)</div><div class="line">    &#123;</div><div class="line">    <span class="keyword">case</span> WM_CREATE:</div><div class="line">        init(hwnd);</div><div class="line">        initGraph =<span class="number">1</span>;</div><div class="line">        InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    <span class="keyword">case</span> WM_SIZE:</div><div class="line">        init(hwnd);</div><div class="line">        initGraph =<span class="number">1</span>;</div><div class="line">        InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">case</span> WM_MOVE:</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">case</span> WM_LBUTTONDOWN:</div><div class="line">        GetCursorPos(&amp;pc);</div><div class="line">        <span class="keyword">if</span>(pc.x==sp.x&amp;&amp;pc.y==sp.y)</div><div class="line">        &#123;</div><div class="line">            cat=<span class="number">0</span>;</div><div class="line">            SetCursorPos(sp.x,sp.y-height/<span class="number">2</span>);</div><div class="line">            ReleaseCapture () ;</div><div class="line">            initGraph=<span class="number">1</span>;</div><div class="line">            InvalidateRect (hwnd,<span class="literal">NULL</span>,  <span class="literal">true</span>) ;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    <span class="keyword">case</span> WM_MOUSEMOVE:</div><div class="line">        <span class="keyword">if</span>(cat==<span class="number">1</span>)</div><div class="line">        &#123;</div><div class="line">            SetCursorPos(sp.x,sp.y);</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        GetCursorPos(&amp;p);</div><div class="line">        pp=p;</div><div class="line">        ScreenToClient(hwnd,&amp;pp);</div><div class="line">        <span class="keyword">if</span>((pp.x&gt;width/<span class="number">4</span>-width/<span class="number">12</span>)&amp;&amp;(pp.x&lt;width/<span class="number">4</span>+width/<span class="number">12</span>)&amp;&amp;(pp.y&gt;height-height/<span class="number">7</span>)&amp;&amp;(pp.y&lt;height))</div><div class="line">        &#123;</div><div class="line">            SetCapture (hwnd) ;</div><div class="line">            sp.x=width/<span class="number">4</span>;</div><div class="line">            sp.y=height-height/<span class="number">14</span>;</div><div class="line">            ClientToScreen(hwnd,&amp;sp);</div><div class="line">            cat=<span class="number">1</span>;</div><div class="line">            initGraph=<span class="number">1</span>;</div><div class="line">            InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        k=<span class="number">999.0</span>;</div><div class="line">        <span class="keyword">if</span>(pp.x-left_eye_px!=<span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            k=(pp.y-eye_py)/(pp.x-left_eye_px);</div><div class="line">        &#125;</div><div class="line">        deltax=(ball_hr/<span class="number">4</span>)/(<span class="number">1</span>+k*k);</div><div class="line">        deltax=<span class="built_in">sqrt</span>(deltax);</div><div class="line">        <span class="keyword">if</span>(!(pp.x&gt;left_eye_px))</div><div class="line">        &#123;</div><div class="line">            deltax=(<span class="number">-1.0</span>)*deltax;</div><div class="line">        &#125;</div><div class="line">        px=left_eye_px+deltax*<span class="number">8</span>;</div><div class="line">        deltax=(ball_hr/<span class="number">4</span>)/(<span class="number">1</span>+<span class="number">1</span>/(k*k));</div><div class="line">        deltax=<span class="built_in">sqrt</span>(deltax);</div><div class="line">        <span class="keyword">if</span>(!(pp.y&gt;eye_py))</div><div class="line">        &#123;</div><div class="line">            deltax=(<span class="number">-1.0</span>)*deltax;</div><div class="line">        &#125;</div><div class="line">        py=eye_py+deltax*<span class="number">8</span>;</div><div class="line">        k=<span class="number">999.0</span>;</div><div class="line">        <span class="keyword">if</span>(pp.x-right_eye_px!=<span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            k=(pp.y-eye_py)/(pp.x-right_eye_px);</div><div class="line">        &#125;</div><div class="line">        deltax=(ball_hr/<span class="number">4</span>)/(<span class="number">1</span>+k*k);</div><div class="line">        deltax=<span class="built_in">sqrt</span>(deltax);</div><div class="line">        <span class="keyword">if</span>(!(pp.x&gt;right_eye_px))</div><div class="line">        &#123;</div><div class="line">            deltax=(<span class="number">-1.0</span>)*deltax;</div><div class="line">        &#125;</div><div class="line">        ppx=right_eye_px+deltax*<span class="number">8</span>;</div><div class="line">        deltax=(ball_hr/<span class="number">4</span>)/(<span class="number">1</span>+<span class="number">1</span>/(k*k));</div><div class="line">        deltax=<span class="built_in">sqrt</span>(deltax);</div><div class="line">        <span class="keyword">if</span>(!(pp.y&gt;eye_py))</div><div class="line">        &#123;</div><div class="line">            deltax=(<span class="number">-1.0</span>)*deltax;</div><div class="line">        &#125;</div><div class="line">        ppy=eye_py+deltax*<span class="number">8</span>;</div><div class="line">        InvalidateRect (hwnd, &amp;eye_rect, <span class="literal">false</span>) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    <span class="keyword">case</span> WM_PAINT:</div><div class="line">        hdc=BeginPaint (hwnd,&amp;ps) ;</div><div class="line">        <span class="keyword">if</span>(initGraph==<span class="number">1</span>)</div><div class="line">        &#123;</div><div class="line">            SelectObject (hdc, gray_brush) ;</div><div class="line">            Ellipse(hdc,width/<span class="number">6</span>,height/<span class="number">2</span>,width-width/<span class="number">6</span>,height*<span class="number">3</span>/<span class="number">2</span>);<span class="comment">//身体</span></div><div class="line">            <span class="comment">/**&lt; 画脸 */</span></div><div class="line">            Ellipse(hdc,<span class="number">0</span>,height/<span class="number">4</span>,width*<span class="number">20</span>/<span class="number">20</span>,height*<span class="number">3</span>/<span class="number">4</span>);</div><div class="line">            <span class="comment">/**&lt; 画耳朵 */</span></div><div class="line">            pts[<span class="number">0</span>].x =width/<span class="number">4</span>;</div><div class="line">            pts[<span class="number">0</span>].y =height/<span class="number">10</span>;</div><div class="line">            pts[<span class="number">1</span>].x =width/<span class="number">8</span>;</div><div class="line">            pts[<span class="number">1</span>].y =height/<span class="number">9</span>*<span class="number">3</span>;</div><div class="line">            pts[<span class="number">2</span>].x =width/<span class="number">8</span>*<span class="number">3</span>;</div><div class="line">            pts[<span class="number">2</span>].y =height/<span class="number">33</span>*<span class="number">9</span>;</div><div class="line">            Polygon (hdc, pts, <span class="number">3</span>) ;</div><div class="line">            pts[<span class="number">0</span>].x =width/<span class="number">4</span>*<span class="number">3</span>;</div><div class="line">            pts[<span class="number">0</span>].y =height/<span class="number">10</span>;</div><div class="line">            pts[<span class="number">1</span>].x =width/<span class="number">8</span>*<span class="number">7</span>;</div><div class="line">            pts[<span class="number">1</span>].y =height/<span class="number">9</span>*<span class="number">3</span>;</div><div class="line">            pts[<span class="number">2</span>].x =width/<span class="number">8</span>*<span class="number">5</span>;</div><div class="line">            pts[<span class="number">2</span>].y =height/<span class="number">33</span>*<span class="number">9</span>;</div><div class="line">            Polygon (hdc, pts, <span class="number">3</span>) ;</div><div class="line">            <span class="comment">/**&lt; 画胡子 */</span></div><div class="line">            MoveToEx (hdc, <span class="number">0</span>, height/<span class="number">48</span>*<span class="number">27</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">2</span>,height/<span class="number">48</span>*<span class="number">27</span>) ;</div><div class="line">            MoveToEx (hdc, <span class="number">0</span>, height/<span class="number">48</span>*<span class="number">30</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">2</span>,height/<span class="number">48</span>*<span class="number">30</span>) ;</div><div class="line">            MoveToEx (hdc, <span class="number">0</span>, height/<span class="number">48</span>*<span class="number">33</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">2</span>,height/<span class="number">48</span>*<span class="number">33</span>) ;</div><div class="line">            MoveToEx (hdc, width, height/<span class="number">48</span>*<span class="number">27</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">6</span>,height/<span class="number">48</span>*<span class="number">27</span>) ;</div><div class="line">            MoveToEx (hdc, width, height/<span class="number">48</span>*<span class="number">30</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">6</span>,height/<span class="number">48</span>*<span class="number">30</span>) ;</div><div class="line">            MoveToEx (hdc, width, height/<span class="number">48</span>*<span class="number">33</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">6</span>,height/<span class="number">48</span>*<span class="number">33</span>) ;</div><div class="line">            drawHand(hdc);</div><div class="line">            initGraph=<span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/**&lt; 画眼睛 */</span></div><div class="line">        SelectObject (hdc, white_brush) ;</div><div class="line">        drawRound(hdc,left_eye_px,eye_py,eye_r);</div><div class="line">        drawRound(hdc,right_eye_px,eye_py,eye_r);</div><div class="line">        SelectObject (hdc, black_brush) ;</div><div class="line">        drawRound(hdc,px,py,ball_hr*<span class="number">2</span>);</div><div class="line">        drawRound(hdc,ppx,ppy,ball_hr*<span class="number">2</span>);</div><div class="line">        EndPaint (hwnd, &amp;ps) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    <span class="keyword">case</span> WM_DESTROY:</div><div class="line">        PostQuitMessage (<span class="number">0</span>) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam) ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于大三上学期，Windows程序设计 课程考核作业。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[爬虫（Java实现）]]></title>
      <url>http://maxuewei2.git.io/2016/03/13/%E7%88%AC%E8%99%AB/</url>
      <content type="html"><![CDATA[<h3 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h3><p>使用了htmlparser库。<br><a id="more"></a></p>
<h4 id="运行过程："><a href="#运行过程：" class="headerlink" title="运行过程："></a>运行过程：</h4><p>　　　　从某个网址开始，摘取网页中的链接，并通过广度搜索，对这些链接递归执行上述操作。</p>
<p>　　　　在以上过程中把网址存入数据库中。以防止搜索中出现环路。</p>
<p>　　　　但是，程序经常进入某个网站后，会一直扫描其中的二级域名。</p>
<p>　　　　于是数据库中会出现这种情况：<br>&gt;<br>jack.art.com<br>han.art.com<br>bob.art.com<br>alice.art.com<br>rose.art.com<br>…<br>…</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Robot.java</span></div><div class="line"><span class="keyword">package</span> robot;</div><div class="line"><span class="keyword">import</span> java.net.*;</div><div class="line"><span class="keyword">import</span> java.sql.SQLException;</div><div class="line"><span class="keyword">import</span> java.util.Random;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.htmlparser.*;</div><div class="line"><span class="keyword">import</span> org.htmlparser.filters.TagNameFilter;</div><div class="line"><span class="keyword">import</span> org.htmlparser.tags.LinkTag;</div><div class="line"><span class="keyword">import</span> org.htmlparser.util.NodeList;</div><div class="line"><span class="keyword">import</span> org.htmlparser.util.ParserException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> mydb.DB;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Robot</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ff=<span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> num=<span class="number">0</span>;</div><div class="line">    <span class="comment">//DB db;</span></div><div class="line">    Robot() <span class="keyword">throws</span> MalformedURLException, SQLException&#123;</div><div class="line">        DB.getConnect(<span class="string">"localhost"</span>,<span class="string">"3306"</span>,<span class="string">"robot"</span>,<span class="string">"root"</span>,<span class="string">"142365"</span>);</div><div class="line">        DB.getSta();</div><div class="line">        String url0=<span class="string">"http://www.youku.com"</span>;<span class="comment">//"http://localhost";</span></div><div class="line">     <span class="comment">/*  DB.rs= DB.s.executeQuery("select count(*) from urls");</span></div><div class="line">        if(DB.rs.next())</div><div class="line">        &#123;int n=DB.rs.getInt(1);</div><div class="line">        System.out.println(n ); </div><div class="line">        Random random = new Random();</div><div class="line"></div><div class="line">        int ran = random.nextInt();</div><div class="line">        ran%=n;</div><div class="line">        ran=ran&gt;0?ran:-ran;</div><div class="line">        System.out.println(ran ); </div><div class="line">        DB.rs= DB.s.executeQuery("select * from urls");</div><div class="line">        int x=0;</div><div class="line">        while(DB.rs.next()&amp;&amp;x&lt;ran)&#123;</div><div class="line">             </div><div class="line">                  System.out.println(DB.rs.getString(1)+"000" ); url0=DB.rs.getString(1);</div><div class="line">                  </div><div class="line">              x++;</div><div class="line">        &#125;</div><div class="line">       </div><div class="line">        &#125;*/</div><div class="line">        <span class="comment">//catchHref("http://localhost",num);</span></div><div class="line">        catchHref(url0,num);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEndLegal</span><span class="params">(String str)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(str.endsWith(<span class="string">"php"</span>)||str.endsWith(<span class="string">"net/"</span>)||str.endsWith(<span class="string">"com/"</span>)||str.endsWith(<span class="string">"cn/"</span>)||str.endsWith(<span class="string">"gov/"</span>)||str.endsWith(<span class="string">"edu/"</span>)||str.endsWith(<span class="string">"org/"</span>)||str.endsWith(<span class="string">"net"</span>)||str.endsWith(<span class="string">"com"</span>)||str.endsWith(<span class="string">"cn"</span>)||str.endsWith(<span class="string">"gov"</span>)||str.endsWith(<span class="string">"edu"</span>)||str.endsWith(<span class="string">"org"</span>))&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">catchHref</span><span class="params">(String hreft ,<span class="keyword">int</span> num)</span> <span class="keyword">throws</span> MalformedURLException </span>&#123;</div><div class="line">        Parser     parser =<span class="keyword">null</span>;</div><div class="line">        NodeList nodelist=<span class="keyword">null</span>;</div><div class="line">        String href = <span class="string">"http://www.baidu.com"</span>;</div><div class="line">        <span class="comment">//db=new DB();</span></div><div class="line">        <span class="keyword">if</span>(ff!=<span class="number">0</span>)</div><div class="line">        <span class="keyword">if</span> (!(hreft.startsWith(<span class="string">"http"</span>)&amp;&amp;isEndLegal(hreft)&amp;&amp;!isInDatabase(hreft))) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        ff=<span class="number">1</span>;</div><div class="line">        add(hreft);</div><div class="line">        </div><div class="line">            System.out.println(num);</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                parser = <span class="keyword">new</span> Parser(hreft);</div><div class="line">                <span class="keyword">if</span>(parser==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125; <span class="keyword">catch</span> (ParserException e) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                <span class="comment">//e.printStackTrace();</span></div><div class="line">            &#125;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                nodelist = parser.parse(<span class="keyword">null</span>);</div><div class="line">            &#125; <span class="keyword">catch</span> (ParserException e1) &#123;</div><div class="line">                e1.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(nodelist==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            NodeFilter filter = <span class="keyword">new</span> TagNameFilter(<span class="string">"A"</span>);</div><div class="line">            <span class="keyword">if</span>(filter==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            nodelist = nodelist.extractAllNodesThatMatch(filter, <span class="keyword">true</span>);</div><div class="line">            <span class="keyword">if</span>(nodelist==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodelist.size(); i++) &#123;</div><div class="line">                LinkTag link = (LinkTag) nodelist.elementAt(i);</div><div class="line">                href = link.getAttribute(<span class="string">"href"</span>);</div><div class="line">                <span class="keyword">if</span>(href==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                System.out.println(href );</div><div class="line">                catchHref(href,num);</div><div class="line">                </div><div class="line">            &#125;</div><div class="line">            num++;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(String str)</span></span>&#123;</div><div class="line">        </div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            DB.s.execute(<span class="string">"insert into urls2(url)values('"</span>+str+<span class="string">"');"</span>);</div><div class="line">            DB.commit();</div><div class="line">            System.out.println(<span class="string">"add"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">            <span class="comment">//e.printStackTrace();return ;</span></div><div class="line">            <span class="comment">//JOptionPane.showMessageDialog(null, "数据库添加失败");</span></div><div class="line">            <span class="comment">//System.exit(-1);</span></div><div class="line">            </div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isInDatabase</span><span class="params">(String str)</span></span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            DB.rs= DB.s.executeQuery(<span class="string">"select * from urls where url like'"</span>+str+<span class="string">"%';"</span>);</div><div class="line">            <span class="keyword">if</span>(DB.rs.next())&#123;System.out.println(DB.rs);<span class="keyword">return</span> <span class="keyword">true</span>;&#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"数据库查找失败"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">            <span class="keyword">throws</span> MalformedURLException, ParserException, SQLException &#123;</div><div class="line">        Robot robot = <span class="keyword">new</span> Robot();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//DB.java</span></div><div class="line"><span class="keyword">package</span> mydb;</div><div class="line"><span class="keyword">import</span> java.sql.*;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="comment">//import com.mysql.jdbc.Driver;</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DB</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection conn = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResultSet rs = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Statement s = <span class="keyword">null</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DB</span><span class="params">()</span> </span>&#123;</div><div class="line">        conn = <span class="keyword">null</span>;</div><div class="line">        s = <span class="keyword">null</span>;</div><div class="line">        rs=<span class="keyword">null</span>;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    <span class="comment">/*</span></div><div class="line">    String getResult(ResultSet rs) &#123;</div><div class="line">        String str = "Book\t\tOwnerID\tOwnerName\n";</div><div class="line">        // System.out.println("\nno\tname\tsex\tsalary");</div><div class="line">        try &#123;</div><div class="line">            while (rs.next()) &#123;</div><div class="line">                StringBuilder builder = new StringBuilder(rs.getString(1));</div><div class="line">                builder.append("\t\t");</div><div class="line">                builder.append(rs.getString(2));</div><div class="line">                builder.append("\t");</div><div class="line">                builder.append(rs.getString(3));</div><div class="line">                builder.append("\n");</div><div class="line">                str += builder.toString();</div><div class="line">            &#125;</div><div class="line">        &#125; catch (Throwable e) &#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        // System.out.println();</div><div class="line">        return str;</div><div class="line">    &#125;*/</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnect</span><span class="params">(String IP,String port,String database,String user,String password)</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// Class.forName("org.gjt.mm.mysql.Driver").newInstance();</span></div><div class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e1) &#123;</div><div class="line">            e1.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"数据库包未找到"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125; <span class="comment">// .newInstance();</span></div><div class="line">        </div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            conn = DriverManager.getConnection(</div><div class="line">                    <span class="string">"jdbc:mysql://"</span>+IP+<span class="string">":"</span>+port+<span class="string">"/"</span>+database+<span class="string">"?useUnicode=true&amp;characterEncoding=utf8"</span>, user,</div><div class="line">                    password);<span class="comment">//autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=utf8</span></div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e1) &#123;</div><div class="line">            e1.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"数据库无法连接"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            conn.setAutoCommit(<span class="keyword">false</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e1) &#123;</div><div class="line"></div><div class="line">            e1.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> conn;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Statement <span class="title">getSta</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            s = conn.createStatement();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e1) &#123;</div><div class="line"></div><div class="line">            e1.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"无法建立数据库语句"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> s;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span>    <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">commit</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            conn.commit();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line"></div><div class="line">            e.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"对数据库更改无法应用"</span>);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeConnect</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            rs.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"数据库结果集无法关闭"</span>);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            s.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line"></div><div class="line">            e.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"数据库语句无法关闭"</span>);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            conn.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line"></div><div class="line">            e.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"与数据库的连接无法关闭"</span>);</div><div class="line">        &#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">        try &#123; // perform a clean shutdown</div><div class="line">            DriverManager.getConnection("jdbc:derby:;shutdown=true");</div><div class="line"></div><div class="line">        &#125; catch (SQLException se) &#123;</div><div class="line"></div><div class="line">            if (((se.getErrorCode() == 50000)</div><div class="line">                    &amp;&amp; ("XJ015".equals(se.getSQLState())))) &#123;</div><div class="line">                // we got the expected exception</div><div class="line">                System.out.println("Derby shut down normally");</div><div class="line">                // Note that for single database shutdown, the expected</div><div class="line">                // SQL state is "08006", and the error code is 45000.</div><div class="line">            &#125; else &#123;</div><div class="line">                System.err.println("Derby did not shut down normally");</div><div class="line">                // JOptionPane.showMessageDialog(null, "数据库关闭错误");</div><div class="line">                se.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;*/</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于大三上学期。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[贪吃蛇（Java实现）]]></title>
      <url>http://maxuewei2.git.io/2016/03/13/%E8%B4%AA%E5%90%83%E8%9B%87Java/</url>
      <content type="html"><![CDATA[<h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p><img src="/imgs/tanchishejava.jpg" alt="xiaoguo"><br><a id="more"></a></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Snake.java</span></div><div class="line"><span class="keyword">package</span> snake;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.*;</div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.BufferedWriter;</div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.FileReader;</div><div class="line"><span class="keyword">import</span> java.io.FileWriter;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"><span class="keyword">import</span> java.util.LinkedList;</div><div class="line"><span class="keyword">import</span> java.util.Random;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">go</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    Snake s;</div><div class="line">    Random random;</div><div class="line">    <span class="keyword">int</span> foodX = <span class="number">15</span>, foodY = <span class="number">15</span>;</div><div class="line"><span class="keyword">int</span> N;</div><div class="line">    go(Snake snake) &#123;</div><div class="line">        s = snake;</div><div class="line">        random = <span class="keyword">new</span> Random();</div><div class="line">        N=s.N;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Point <span class="title">getFood</span><span class="params">()</span> </span>&#123;</div><div class="line">        Point p = <span class="keyword">new</span> Point();</div><div class="line">        Iterator&lt;Point&gt; it = s.list.iterator();</div><div class="line">        Point temp = it.next();</div><div class="line">        <span class="keyword">boolean</span> isFoodinBody = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">while</span> (isFoodinBody) &#123;</div><div class="line">            foodX = Math.abs(random.nextInt()) % N;</div><div class="line">            foodY = Math.abs(random.nextInt()) % N;</div><div class="line">            isFoodinBody = <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">while</span> (it.hasNext()) &#123;</div><div class="line">                temp = (Point) it.next();</div><div class="line">                <span class="keyword">if</span> (foodX == temp.x &amp;&amp; temp.y == foodY) &#123;</div><div class="line">                    isFoodinBody = <span class="keyword">true</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> p;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            Point first = s.list.getFirst();</div><div class="line">            <span class="keyword">int</span> x = first.x, y = first.y;</div><div class="line">            <span class="keyword">int</span> gotfood = <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span> (foodX == x &amp;&amp; foodY == y) &#123;</div><div class="line">                <span class="keyword">if</span> (!s.isDead) &#123;</div><div class="line">                    s.SCORE += <span class="number">100</span>;</div><div class="line">                    s.scoreField.setText(<span class="string">"SCORE:  "</span>+<span class="keyword">new</span> Integer(s.SCORE).toString());</div><div class="line">                    s.list.add(s.list.getLast());</div><div class="line">                &#125;</div><div class="line">                gotfood = <span class="number">1</span>;</div><div class="line">                foodX = Math.abs(random.nextInt()) % N;</div><div class="line">                foodY = Math.abs(random.nextInt()) % N;</div><div class="line">                s.bs[foodX][foodY].setBackground(Color.PINK);</div><div class="line"></div><div class="line">            &#125;</div><div class="line">            Iterator&lt;Point&gt; it = s.list.iterator();</div><div class="line">            Point temp = it.next();</div><div class="line">            <span class="keyword">while</span> (it.hasNext()) &#123;</div><div class="line">                temp = (Point) it.next();</div><div class="line">                <span class="keyword">if</span> (temp.x == x &amp;&amp; temp.y == y) &#123;</div><div class="line"></div><div class="line"></div><div class="line">                    s.gameOver();</div><div class="line"></div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (gotfood == <span class="number">1</span> &amp;&amp; foodX == temp.x &amp;&amp; temp.y == foodY) &#123;</div><div class="line">                    Point food = getFood();</div><div class="line">                    foodX = food.x;</div><div class="line">                    foodY = food.y;</div><div class="line">                    s.bs[foodX][foodY].setBackground(Color.PINK);</div><div class="line">                    gotfood=<span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">switch</span> (s.dir) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="number">2</span> :</div><div class="line">                    y =( (y - <span class="number">1</span>)+N )% N;</div><div class="line">                    <span class="comment">/*if (y == -1)</span></div><div class="line">                        y = 29;*/</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">0</span> :</div><div class="line">                    y = (y + <span class="number">1</span>) % N;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">3</span> :</div><div class="line">                    x = ((x - <span class="number">1</span>)+N) % N;</div><div class="line">                    <span class="comment">/*if (x == -1)</span></div><div class="line">                        x = 29;*/</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">1</span> :</div><div class="line">                    x = (x + <span class="number">1</span>) % N;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            Point head = <span class="keyword">new</span> Point(x, y);</div><div class="line">            s.bs[x][y].setBackground(Color.LIGHT_GRAY);</div><div class="line"></div><div class="line">            s.list.addFirst(head);</div><div class="line">            Point lastP = s.list.removeLast();</div><div class="line">            s.bs[lastP.x][lastP.y].setBackground(Color.GRAY);</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                Thread.sleep(<span class="number">100</span>);</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">/*</span></div><div class="line">             * for (int i = 0; i &lt;= list.size() - 1; i++) &#123; System.out.print(</div><div class="line">             * "(" + list.get(i).x + "," + list.get(i).y + ")  ");</div><div class="line">             *</div><div class="line">             * &#125;</div><div class="line">             */</div><div class="line">            <span class="comment">// System.out.println();</span></div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Snake</span> <span class="keyword">extends</span> <span class="title">JFrame</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">6494984874207734357L</span>;</div><div class="line">    <span class="keyword">int</span> N = <span class="number">30</span>;</div><div class="line">    <span class="keyword">int</span> dir = <span class="number">0</span>;<span class="comment">// 0 右 1下 2左 3上</span></div><div class="line">    <span class="keyword">int</span> SCORE = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> a=<span class="number">0</span>,b=<span class="number">0</span>,c=<span class="number">0</span>;</div><div class="line">    <span class="keyword">boolean</span> isDead = <span class="keyword">false</span>;</div><div class="line">    JButton[][] bs = <span class="keyword">new</span> JButton[N][N];</div><div class="line">    JPanel panel,scorePanel;</div><div class="line">    JTextField scoreField,bestScoreField;</div><div class="line">    LinkedList&lt;Point&gt; list;</div><div class="line">    Snake() &#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"Snake"</span>);</div><div class="line">        Container container = getContentPane();</div><div class="line">        container.setLayout(<span class="keyword">new</span> BorderLayout());</div><div class="line">        scorePanel = <span class="keyword">new</span> JPanel();</div><div class="line">        scorePanel .setLayout(<span class="keyword">new</span> BorderLayout());</div><div class="line">        scoreField = <span class="keyword">new</span> JTextField(<span class="number">20</span>);</div><div class="line">        bestScoreField= <span class="keyword">new</span> JTextField(<span class="number">50</span>);</div><div class="line">        bestScoreField.setText(getBestScores());</div><div class="line">        bestScoreField.setEditable(<span class="keyword">false</span>);</div><div class="line">        scoreField.setText(<span class="string">"SCORE:  "</span>+<span class="keyword">new</span> Integer(SCORE).toString());</div><div class="line">        scoreField.setEditable(<span class="keyword">false</span>);</div><div class="line">        scorePanel.add(scoreField,BorderLayout.WEST);</div><div class="line">        scorePanel.add(bestScoreField,BorderLayout.EAST);</div><div class="line">        container.add(scorePanel, BorderLayout.NORTH);</div><div class="line">        panel = <span class="keyword">new</span> JPanel();</div><div class="line">        panel.setLayout(<span class="keyword">new</span> GridLayout(N, N));</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N - <span class="number">1</span>; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= N - <span class="number">1</span>; j++) &#123;</div><div class="line">                bs[i][j] = <span class="keyword">new</span> JButton();</div><div class="line">                bs[i][j].setBackground(Color.GRAY);</div><div class="line">                panel.add(bs[i][j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        container.add(panel, BorderLayout.CENTER);</div><div class="line">        list = <span class="keyword">new</span> LinkedList&lt;Point&gt;();</div><div class="line"></div><div class="line">        list.add(<span class="keyword">new</span> Point(<span class="number">15</span>, <span class="number">15</span>));</div><div class="line">        list.add(<span class="keyword">new</span> Point(<span class="number">15</span>, <span class="number">14</span>));</div><div class="line">        list.add(<span class="keyword">new</span> Point(<span class="number">15</span>, <span class="number">13</span>));</div><div class="line">        list.add(<span class="keyword">new</span> Point(<span class="number">15</span>, <span class="number">12</span>));</div><div class="line">        list.add(<span class="keyword">new</span> Point(<span class="number">15</span>, <span class="number">11</span>));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= list.size() - <span class="number">1</span>; i++) &#123;</div><div class="line">            bs[list.get(i).x][list.get(i).y].setBackground(Color.LIGHT_GRAY);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*for (int i = 0; i &lt;= list.size() - 1; i++) &#123;</span></div><div class="line">            System.out.print("(" + list.get(i).x + "," + list.get(i).y + ")  ");</div><div class="line"></div><div class="line">        &#125;*/</div><div class="line">        <span class="comment">/*System.out.println();*/</span></div><div class="line"></div><div class="line">        <span class="keyword">this</span>.addKeyListener(<span class="keyword">new</span> KeyAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> c = e.getKeyCode();</div><div class="line">                <span class="comment">//System.out.print(c);</span></div><div class="line">                <span class="keyword">int</span> dir1 = dir;</div><div class="line">                <span class="keyword">switch</span> (c) &#123;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_LEFT :</div><div class="line">                        dir1 = <span class="number">2</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_RIGHT :</div><div class="line">                        dir1 = <span class="number">0</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_UP :</div><div class="line">                        dir1 = <span class="number">3</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_DOWN :</div><div class="line">                        dir1 = <span class="number">1</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">default</span> :</div><div class="line">                        System.out.print(<span class="string">"hey"</span>);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (!(dir1 - dir == -<span class="number">2</span> | dir1 - dir == <span class="number">2</span>))</div><div class="line">                    dir = dir1;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">this</span>.setFocusable(<span class="keyword">true</span>);</div><div class="line">        setLocation(<span class="number">200</span>, <span class="number">10</span>);</div><div class="line">        setSize(<span class="number">800</span>, <span class="number">700</span>);</div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function">String <span class="title">getBestScores</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        BufferedReader reader=<span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">"score.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">        a=Integer.parseInt(reader.readLine());</div><div class="line">        b=Integer.parseInt(reader.readLine());</div><div class="line">        c=Integer.parseInt(reader.readLine());</div><div class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        String bestS=<span class="keyword">new</span> String(<span class="string">"Best Score: "</span>+<span class="keyword">new</span> Integer(a).toString()+<span class="string">"   "</span>+<span class="keyword">new</span> Integer(b).toString()+<span class="string">"   "</span>+<span class="keyword">new</span> Integer(c).toString());</div><div class="line">        <span class="keyword">return</span> bestS;</div><div class="line">    &#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">gameOver</span><span class="params">()</span></span>&#123;</div><div class="line">    isDead = <span class="keyword">true</span>;</div><div class="line">    JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"你死了~~~."</span>, <span class="string">"GAME OVER"</span>,</div><div class="line">            JOptionPane.PLAIN_MESSAGE);</div><div class="line">    <span class="keyword">if</span>(SCORE&gt;a)&#123;c=b;b=a;a=SCORE;save();System.exit(<span class="number">0</span>);&#125;</div><div class="line">    <span class="keyword">if</span>(SCORE&gt;b)&#123;c=b;b=SCORE;save();System.exit(<span class="number">0</span>);&#125;</div><div class="line">    <span class="keyword">if</span>(SCORE&gt;c)&#123;c=SCORE;save();System.exit(<span class="number">0</span>);&#125;</div><div class="line">    System.exit(<span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">save</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line">    BufferedWriter writer=<span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            writer=<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"score.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    String d=<span class="keyword">new</span> Integer(a).toString(),e=<span class="keyword">new</span> Integer(b).toString(),f=<span class="keyword">new</span> Integer(c).toString();</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        writer.write(d);</div><div class="line">        writer.newLine();</div><div class="line">        writer.write(e);</div><div class="line">        writer.newLine();</div><div class="line">        writer.write(f);</div><div class="line">        writer.flush();</div><div class="line">        writer.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException ev) &#123;</div><div class="line">        ev.printStackTrace();</div><div class="line">    &#125; <span class="keyword">catch</span> (IOException ev) &#123;</div><div class="line">        ev.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Snake snake = <span class="keyword">new</span> Snake();</div><div class="line">        snake.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</div><div class="line">        Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> go(snake));</div><div class="line">        thread.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于大三上学期。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[贪吃蛇（C++实现，VC6.0编译，使用了EasyX图形库）]]></title>
      <url>http://maxuewei2.git.io/2016/03/13/%E8%B4%AA%E5%90%83%E8%9B%87/</url>
      <content type="html"><![CDATA[<h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p><img src="/imgs/tanchishecpp.jpg" alt="效果1"><br><img src="/imgs/tanchishecpp1.jpg" alt="效果2"><br><a id="more"></a></p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//main.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;graphics.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;conio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;mmsystem.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"Winmm.lib"</span>)</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> IMGWIDTH 20</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> IMGHEIGHT 20</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WIDTH 1100</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEIGHT 650</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UP 72</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DOWN 80</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LEFT 75</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RIGHT 77</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADUP    <span class="meta-string">"headup.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADDOWN  <span class="meta-string">"headdown.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADLEFT  <span class="meta-string">"headleft.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADRIGHT <span class="meta-string">"headright.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BODYLR <span class="meta-string">"bodylr.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BODYUD <span class="meta-string">"bodyud.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TAILL <span class="meta-string">"taill.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TAILR <span class="meta-string">"tailr.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TAILU <span class="meta-string">"tailu.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TAILD <span class="meta-string">"taild.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WALL <span class="meta-string">"wall.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FOOD <span class="meta-string">"food.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> GAMEOVER <span class="meta-string">"gameover.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SNAKE <span class="meta-string">"snake.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> L 60   <span class="comment">//左</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> U 80   <span class="comment">//上</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> R 900  <span class="comment">//右</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> D 600  <span class="comment">//下</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">IMAGE wallimg;</div><div class="line"><span class="keyword">int</span> score=<span class="number">0</span>,grade=<span class="number">1</span>,rec[<span class="number">4</span>];</div><div class="line"><span class="keyword">class</span> Food;</div><div class="line"><span class="keyword">class</span> BodyNode&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    IMAGE img;</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">    BodyNode* next;</div><div class="line">    BodyNode()&#123;&#125;</div><div class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> Body;</div><div class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(Body&amp; snake,Food&amp; food)</span></span>;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    BodyNode(<span class="keyword">char</span>* str,<span class="keyword">int</span> X,<span class="keyword">int</span> Y)&#123;</div><div class="line">        x=X;</div><div class="line">        y=Y;</div><div class="line">        loadimage(&amp;img, _T(str));</div><div class="line">        next=<span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">    BodyNode(BodyNode&amp; bodynode)&#123;</div><div class="line">        x=bodynode.x;</div><div class="line">        y=bodynode.y;</div><div class="line">        next=bodynode.next;</div><div class="line">        img=bodynode.img;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">class</span> Body&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    BodyNode* head;</div><div class="line">    BodyNode* tail;</div><div class="line">    <span class="keyword">int</span> length;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(Body&amp; snake,Food&amp; food)</span></span>;</div><div class="line">    Body()&#123;</div><div class="line">        head=<span class="keyword">new</span> BodyNode(HEADRIGHT,L+(<span class="number">10</span>*(IMGWIDTH)),U+(<span class="number">10</span>*(IMGHEIGHT)));</div><div class="line">        head-&gt;next=<span class="keyword">new</span> BodyNode(BODYLR,head-&gt;x-head-&gt;img.getwidth(),head-&gt;y);</div><div class="line">        head-&gt;next-&gt;next=<span class="keyword">new</span> BodyNode(TAILR,head-&gt;next-&gt;x-head-&gt;img.getwidth(),head-&gt;y);</div><div class="line">        tail=head-&gt;next-&gt;next;</div><div class="line">        length=<span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Length</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> length;&#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsDead</span><span class="params">()</span></span>&#123;</div><div class="line">        BodyNode* p=head-&gt;next;</div><div class="line">        <span class="keyword">while</span>(p!=<span class="literal">NULL</span>)&#123;</div><div class="line">            <span class="keyword">if</span>(head-&gt;x==p-&gt;x&amp;&amp;head-&gt;y==p-&gt;y)&#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">            p=p-&gt;next;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Move</span><span class="params">(<span class="keyword">int</span> dir)</span></span>&#123;     <span class="comment">//1 上 2下  3左 4 右</span></div><div class="line">        BodyNode* p=head-&gt;next;</div><div class="line">        <span class="keyword">int</span> tempx=head-&gt;x,tempy=head-&gt;y,temp_x,temp_y;</div><div class="line">        <span class="keyword">while</span>(p!=tail-&gt;next)&#123;</div><div class="line">            temp_x=p-&gt;x;</div><div class="line">            temp_y=p-&gt;y;</div><div class="line">            p-&gt;x=tempx;;</div><div class="line">            p-&gt;y=tempy;</div><div class="line">            tempx=temp_x;</div><div class="line">            tempy=temp_y;</div><div class="line">            p=p-&gt;next;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(dir==<span class="number">1</span>)&#123;</div><div class="line">            loadimage(&amp;(head-&gt;img), _T(HEADUP));</div><div class="line">            head-&gt;y=head-&gt;next-&gt;y-head-&gt;img.getheight();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(dir==<span class="number">2</span>)&#123;</div><div class="line">            loadimage(&amp;(head-&gt;img), _T(HEADDOWN));</div><div class="line">            head-&gt;y=head-&gt;next-&gt;y+head-&gt;img.getheight();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(dir==<span class="number">3</span>)&#123;</div><div class="line">            loadimage(&amp;(head-&gt;img), _T(HEADLEFT));</div><div class="line">            head-&gt;x=head-&gt;next-&gt;x-head-&gt;img.getwidth();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(dir==<span class="number">4</span>)&#123;</div><div class="line">            loadimage(&amp;(head-&gt;img), _T(HEADRIGHT));</div><div class="line">            head-&gt;x=head-&gt;next-&gt;x+head-&gt;img.getwidth();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>((head-&gt;x+head-&gt;img.getwidth())&gt;R)&#123;head-&gt;x=L;&#125;</div><div class="line">        <span class="keyword">if</span>(head-&gt;x&lt;L)&#123;head-&gt;x=R-head-&gt;img.getwidth();&#125;</div><div class="line">        <span class="keyword">if</span>((head-&gt;y+head-&gt;img.getheight())&gt;D)&#123;head-&gt;y=U;&#125;</div><div class="line">        <span class="keyword">if</span>(head-&gt;y&lt;U)&#123;head-&gt;y=D-head-&gt;img.getheight();&#125;</div><div class="line">        p=head;</div><div class="line">        <span class="keyword">while</span>(p-&gt;next!=tail)&#123;</div><div class="line">            p=p-&gt;next;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;x-tail-&gt;x&gt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILR));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;x-tail-&gt;x&lt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILL));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;y-tail-&gt;y&gt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILD));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;y-tail-&gt;y&lt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILU));&#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Grow</span><span class="params">()</span></span>&#123;</div><div class="line">        BodyNode*p=head;</div><div class="line">        <span class="keyword">while</span>(p-&gt;next!=tail)&#123;</div><div class="line">            p=p-&gt;next;</div><div class="line">        &#125;</div><div class="line">        tail-&gt;img=p-&gt;img;</div><div class="line">        tail-&gt;next=<span class="keyword">new</span> BodyNode(&amp;(TAILL[<span class="number">0</span>]),tail-&gt;x-(p-&gt;x-tail-&gt;x),tail-&gt;y-(p-&gt;y-tail-&gt;y));</div><div class="line"></div><div class="line">        tail=tail-&gt;next;</div><div class="line">        <span class="keyword">if</span>(p-&gt;x-tail-&gt;x&gt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILR));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;x-tail-&gt;x&lt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILL));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;y-tail-&gt;y&gt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILD));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;y-tail-&gt;y&lt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILU));&#125;</div><div class="line">        tail-&gt;next=<span class="literal">NULL</span>;</div><div class="line">        length++;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Show</span><span class="params">()</span></span>&#123;</div><div class="line">        BodyNode* p=head;</div><div class="line">        <span class="keyword">while</span>(p!=<span class="literal">NULL</span>)&#123;</div><div class="line">            putimage(p-&gt;x, p-&gt;y, &amp;(p-&gt;img));</div><div class="line">            p=p-&gt;next;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">class</span> Food&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">    IMAGE rat;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(Body&amp; snake,Food&amp; food)</span></span>;</div><div class="line">    Food()&#123;</div><div class="line">        x=<span class="number">400</span>;</div><div class="line">        y=<span class="number">300</span>;</div><div class="line">        loadimage(&amp;(rat), _T(FOOD));</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">givefood</span><span class="params">(Body&amp; snake)</span></span>&#123;</div><div class="line">        srand((<span class="keyword">unsigned</span>)time(<span class="number">0</span>));</div><div class="line">        <span class="keyword">while</span>(check(snake,*<span class="keyword">this</span>)==<span class="literal">true</span>)&#123;</div><div class="line">            x=<span class="number">0</span>;y=<span class="number">0</span>;</div><div class="line">            <span class="keyword">while</span>(!(x&gt;L&amp;&amp;y&gt;U))&#123;</div><div class="line">                x= rand()%<span class="number">900</span>;</div><div class="line">                y= rand()%<span class="number">600</span>;</div><div class="line">            &#125;</div><div class="line">            x=x-(x%<span class="number">20</span>);</div><div class="line">            y=y-(y%<span class="number">20</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Show</span><span class="params">()</span></span>&#123;</div><div class="line">        putimage(x,y,&amp;(rat));</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">showgame</span><span class="params">(Body&amp; snake,Food food)</span></span>&#123;</div><div class="line"></div><div class="line">    cleardevice();</div><div class="line">    BeginBatchDraw();</div><div class="line">    setbkcolor(RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));    <span class="comment">//设置背景色</span></div><div class="line">    setcolor(YELLOW);         <span class="comment">//设置绘图色</span></div><div class="line">    outtextxy((WIDTH/<span class="number">2</span>)<span class="number">-80</span>, <span class="number">10</span>, <span class="string">"贪吃蛇"</span>);</div><div class="line">    outtextxy(L+<span class="number">300</span>, U-IMGHEIGHT<span class="number">-20</span>, <span class="string">"按空格 暂停"</span>);</div><div class="line">    outtextxy(R+IMGWIDTH+<span class="number">20</span>, U+IMGHEIGHT+<span class="number">20</span>, <span class="string">"最高记录："</span>);</div><div class="line"><span class="keyword">char</span> rec1[<span class="number">10</span>];<span class="comment">//,rec2[10],rec3[10];</span></div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> index=<span class="number">0</span>;index&lt;=<span class="number">2</span>;index++)&#123;</div><div class="line">    <span class="built_in">sprintf</span>(rec1, <span class="string">"%d"</span>,rec[index]);</div><div class="line">    outtextxy(R+IMGWIDTH+<span class="number">20</span>, U+IMGHEIGHT+<span class="number">20</span>+(index+<span class="number">1</span>)*<span class="number">30</span>, rec1);</div><div class="line">&#125;</div><div class="line">    <span class="keyword">int</span> i,j;</div><div class="line">    <span class="keyword">for</span>(i=L-IMGWIDTH;i&lt;=R;i=i+IMGWIDTH)&#123;</div><div class="line">        j=U-IMGHEIGHT;</div><div class="line">        putimage(i,j,&amp;(wallimg));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(j=U;j&lt;=D;j=j+IMGHEIGHT)&#123;</div><div class="line">        i=L-IMGWIDTH;</div><div class="line">        putimage(i,j,&amp;(wallimg));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(j=U;j&lt;=D;j=j+IMGHEIGHT)&#123;</div><div class="line">        i=R;</div><div class="line">        putimage(i,j,&amp;(wallimg));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(i=L-IMGWIDTH;i&lt;=R;i=i+IMGWIDTH)&#123;</div><div class="line">        j=D;</div><div class="line">        putimage(i,j,&amp;(wallimg));</div><div class="line">    &#125;</div><div class="line">    outtextxy(L<span class="number">-10</span>, U-IMGHEIGHT<span class="number">-20</span>, <span class="string">"得分:"</span>);</div><div class="line">    <span class="keyword">char</span> s[<span class="number">10</span>];</div><div class="line">    <span class="built_in">sprintf</span>(s, <span class="string">"%d"</span>,score);</div><div class="line">    outtextxy(L+<span class="number">60</span>, U-IMGHEIGHT<span class="number">-20</span>, s);</div><div class="line">             outtextxy(L+<span class="number">120</span>, U-IMGHEIGHT<span class="number">-20</span>, <span class="string">"长度:"</span>);</div><div class="line">             <span class="keyword">char</span> l[<span class="number">10</span>];</div><div class="line">             <span class="built_in">sprintf</span>(l, <span class="string">"%d"</span>,snake.Length());</div><div class="line">             outtextxy(L+<span class="number">180</span>, U-IMGHEIGHT<span class="number">-20</span>, l);</div><div class="line"></div><div class="line">             snake.Show();</div><div class="line"></div><div class="line">             food.Show();</div><div class="line">             FlushBatchDraw();</div><div class="line">             Sleep(<span class="number">50</span>*grade);</div><div class="line"></div><div class="line">             <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(Body&amp; snake,Food&amp; food)</span></span>&#123;</div><div class="line">    BodyNode* pl=snake.head;</div><div class="line">    <span class="keyword">bool</span> flag=<span class="literal">false</span>;</div><div class="line">    <span class="keyword">while</span>(pl!=snake.tail-&gt;next)&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>((pl-&gt;x==food.x)&amp;&amp;(pl-&gt;y==food.y))&#123;flag=<span class="literal">true</span>;<span class="keyword">break</span>;&#125;</div><div class="line"></div><div class="line">        pl=pl-&gt;next;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> flag;</div><div class="line">&#125;</div><div class="line"><span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(LPVOID IpParameter)</span></span></div><div class="line">&#123;</div><div class="line">    mciSendString(<span class="string">"play yeah.mp3 repeat"</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);<span class="comment">//播放</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">menu</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">//cleardevice();</span></div><div class="line">    outtextxy((WIDTH/<span class="number">2</span>)<span class="number">-80</span>, <span class="number">120</span>, <span class="string">"贪吃蛇"</span>);</div><div class="line">    outtextxy((WIDTH/<span class="number">2</span>)<span class="number">-180</span>, <span class="number">230</span>, <span class="string">"按↑和↓选择难度"</span>);</div><div class="line">    outtextxy((WIDTH/<span class="number">2</span>)<span class="number">-180</span>, <span class="number">250</span>, <span class="string">"按空格键确定选择"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">record</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="function">fstream <span class="title">f1</span><span class="params">(<span class="string">"record.txt"</span>)</span></span>;   <span class="comment">//打开文件，若文件不存在就创建它</span></div><div class="line">    <span class="keyword">if</span>(!f1) <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="comment">//int a=0,b=0,c=0;</span></div><div class="line">    f1&gt;&gt;rec[<span class="number">0</span>]&gt;&gt;rec[<span class="number">1</span>]&gt;&gt;rec[<span class="number">2</span>];</div><div class="line"></div><div class="line">    f1.close();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">saverecord</span><span class="params">()</span></span>&#123;</div><div class="line">    system(<span class="string">"del record.txt "</span>);</div><div class="line">    <span class="function">ofstream <span class="title">f1</span><span class="params">(<span class="string">"record.txt"</span>)</span></span>;   <span class="comment">//打开文件，若文件不存在就创建它</span></div><div class="line">    <span class="keyword">if</span>(!f1) <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="keyword">int</span> flag=<span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> temp;</div><div class="line">    rec[<span class="number">3</span>]=score;</div><div class="line">    <span class="keyword">while</span>(flag==<span class="number">1</span>)&#123;</div><div class="line">        flag=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">2</span>;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(rec[i]&lt;rec[i+<span class="number">1</span>])&#123;</div><div class="line">                flag=<span class="number">1</span>;</div><div class="line">                temp=rec[i];</div><div class="line">                rec[i]=rec[i+<span class="number">1</span>];</div><div class="line">                rec[i+<span class="number">1</span>]=temp;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    f1&lt;&lt;rec[<span class="number">0</span>]&lt;&lt;<span class="string">"\n"</span>&lt;&lt;rec[<span class="number">1</span>]&lt;&lt;<span class="string">"\n"</span>&lt;&lt;rec[<span class="number">2</span>];</div><div class="line"></div><div class="line">    f1.close();</div><div class="line">    <span class="keyword">if</span>(score!=rec[<span class="number">3</span>])&#123;</div><div class="line">    settextstyle(<span class="number">50</span>, <span class="number">0</span>, _T(<span class="string">"宋体"</span>));</div><div class="line">    outtextxy(WIDTH/<span class="number">2</span>-(<span class="number">50</span>*<span class="number">5</span>),U+<span class="number">40</span>, <span class="string">"恭喜你创造了新纪录！"</span>);</div><div class="line">&#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">3</span>;i++)&#123;</div><div class="line">    rec[i]=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    record();</div><div class="line">    IMAGE snakeimg;</div><div class="line"></div><div class="line">    HANDLE hThread1;</div><div class="line">    hThread1 = CreateThread(<span class="literal">NULL</span>,<span class="number">0</span>,Fun1Proc,<span class="literal">NULL</span>,<span class="number">0</span>,<span class="literal">NULL</span>);</div><div class="line">    <span class="keyword">char</span> key;</div><div class="line">    <span class="keyword">int</span> movekey=<span class="number">4</span>;</div><div class="line">    <span class="keyword">int</span> movekeyold=movekey;</div><div class="line">    initgraph(WIDTH,HEIGHT);</div><div class="line">    <span class="keyword">char</span> temp=<span class="number">0</span>,choose;</div><div class="line">    <span class="keyword">while</span>(temp!=<span class="string">' '</span>)&#123;</div><div class="line">            cleardevice();</div><div class="line">        <span class="keyword">if</span>(kbhit())&#123;</div><div class="line">            choose=getch();</div><div class="line">            fflush(<span class="built_in">stdin</span>);</div><div class="line">            <span class="keyword">switch</span>(choose)&#123;</div><div class="line">            <span class="keyword">case</span> UP:&#123;</div><div class="line">                grade++;</div><div class="line">                    &#125;;<span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> DOWN:&#123;</div><div class="line">                grade--;</div><div class="line">                      &#125;;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(grade==<span class="number">4</span>)&#123;grade=<span class="number">3</span>;&#125;</div><div class="line">        <span class="keyword">if</span>(grade==<span class="number">0</span>)&#123;grade=<span class="number">1</span>;&#125;</div><div class="line">        outtextxy(<span class="number">420</span>,<span class="number">350</span>,<span class="string">"简单"</span>);</div><div class="line">        outtextxy(<span class="number">420</span>,<span class="number">380</span>,<span class="string">"中等"</span>);</div><div class="line">        outtextxy(<span class="number">420</span>,<span class="number">410</span>,<span class="string">"难"</span>);</div><div class="line">    <span class="comment">//    cleardevice();</span></div><div class="line">        menu();</div><div class="line">        outtextxy(<span class="number">300</span>,<span class="number">300</span>,<span class="string">"请选择难度："</span>);</div><div class="line">        <span class="keyword">if</span>(grade==<span class="number">3</span>)&#123;</div><div class="line">        outtextxy(<span class="number">390</span>,<span class="number">350</span>,<span class="string">"→"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(grade==<span class="number">2</span>)&#123;</div><div class="line">        outtextxy(<span class="number">390</span>,<span class="number">380</span>,<span class="string">"→"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(grade==<span class="number">1</span>)&#123;</div><div class="line">        outtextxy(<span class="number">390</span>,<span class="number">410</span>,<span class="string">"→"</span>);</div><div class="line">        &#125;</div><div class="line">        temp=getch();</div><div class="line">                &#125;</div><div class="line">    loadimage(&amp;(wallimg), _T(WALL));</div><div class="line">    Body snake;</div><div class="line">                Food food;</div><div class="line">                showgame(snake,food);</div><div class="line">                <span class="keyword">while</span>(snake.IsDead()==<span class="literal">false</span>)&#123;</div><div class="line">                <span class="keyword">while</span>(snake.IsDead()==<span class="literal">false</span>&amp;&amp;(!kbhit()))&#123;</div><div class="line"></div><div class="line">                    <span class="keyword">if</span>(movekey==<span class="number">1</span>&amp;&amp;movekeyold==<span class="number">2</span>||movekey==<span class="number">2</span>&amp;&amp;movekeyold==<span class="number">1</span>||movekey==<span class="number">3</span>&amp;&amp;movekeyold==<span class="number">4</span>||movekey==<span class="number">4</span>&amp;&amp;movekeyold==<span class="number">3</span>)&#123;</div><div class="line">                        movekey=movekeyold;&#125;</div><div class="line">                    movekeyold=movekey;</div><div class="line">                    snake.Move(movekey);</div><div class="line">                    showgame(snake,food);</div><div class="line">                    <span class="keyword">if</span>(check(snake,food)==<span class="literal">true</span>)&#123;</div><div class="line">                        mciSendString(<span class="string">"play yeah.wav"</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);<span class="comment">//播放</span></div><div class="line">                        <span class="built_in">cout</span>&lt;&lt;<span class="string">'\a'</span>;</div><div class="line">                        score+=<span class="number">10</span>;</div><div class="line">                        food.givefood(snake);</div><div class="line">                        snake.Grow();</div><div class="line">                        snake.Grow();</div><div class="line">                        snake.Grow();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                    <span class="keyword">if</span>(kbhit())&#123;</div><div class="line">                        key=getch();</div><div class="line">                        <span class="keyword">switch</span>(key)&#123;</div><div class="line">                        <span class="keyword">case</span> UP:&#123;movekey=<span class="number">1</span>;</div><div class="line">                                &#125;;<span class="keyword">break</span>;</div><div class="line">                        <span class="keyword">case</span> DOWN:&#123;movekey=<span class="number">2</span>;</div><div class="line">                                  &#125;;<span class="keyword">break</span>;</div><div class="line">                        <span class="keyword">case</span> LEFT:&#123;movekey=<span class="number">3</span>;</div><div class="line">                                  &#125;;<span class="keyword">break</span>;</div><div class="line">                        <span class="keyword">case</span> RIGHT:&#123;movekey=<span class="number">4</span>;</div><div class="line">                                   &#125;;<span class="keyword">break</span>;</div><div class="line">                        <span class="keyword">case</span> <span class="string">' '</span>:&#123;<span class="keyword">int</span> t=<span class="number">0</span>;</div><div class="line">                            <span class="keyword">while</span>(t==<span class="number">0</span>)&#123;</div><div class="line">                                <span class="keyword">if</span>(kbhit())&#123;</div><div class="line">                                    key=getch();</div><div class="line">                                    <span class="keyword">if</span>(key==<span class="string">' '</span>)&#123;</div><div class="line">                                        t=<span class="number">1</span>;</div><div class="line">                                    &#125;</div><div class="line">                                &#125;</div><div class="line">                            &#125;</div><div class="line">                                 &#125;;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                CloseHandle(hThread1);</div><div class="line">                BeginBatchDraw();</div><div class="line">                showgame(snake,food);</div><div class="line">                IMAGE gameoverimg;</div><div class="line">                loadimage(&amp;(gameoverimg), _T(GAMEOVER));</div><div class="line">                putimage(WIDTH/<span class="number">2</span>-(gameoverimg.getwidth()/<span class="number">2</span>),HEIGHT/<span class="number">2</span>-(gameoverimg.getheight()/<span class="number">2</span>),&amp;(gameoverimg));</div><div class="line"></div><div class="line">                saverecord();</div><div class="line">                    FlushBatchDraw();</div><div class="line">                <span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">                &#123;</div><div class="line">                    Sleep(<span class="number">3000</span>);</div><div class="line">                &#125;</div><div class="line">                saverecord();</div><div class="line">                <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> &ensp;<br> &ensp;<br> &ensp;<br> &ensp;</p>
<h3 id="素材："><a href="#素材：" class="headerlink" title="素材："></a>素材：</h3><p>wall.jpg</p>
<p><img src="/imgs/wall.jpg" alt="wall"></p>
<p>tailu.jpg<br><img src="/imgs/tailu.jpg" alt="wall"></p>
<p>tailr.jpg<br><img src="/imgs/tailr.jpg" alt="wall"></p>
<p>taill.jpg<br><img src="/imgs/taill.jpg" alt="wall"></p>
<p>taild.jpg<br><img src="/imgs/taild.jpg" alt="wall"></p>
<p>headup.jpg<br><img src="/imgs/headup.jpg" alt="wall"></p>
<p>headright.jpg<br><img src="/imgs/headright.jpg" alt="wall"></p>
<p>headleft.jpg</p>
<p><img src="/imgs/headleft.jpg" alt="wall"></p>
<p>headdown.jpg</p>
<p><img src="/imgs/headdown.jpg" alt="wall"></p>
<p>food.jpg</p>
<p><img src="/imgs/food.jpg" alt="wall"></p>
<p>bodylr.jpg</p>
<p><img src="/imgs/bodylr.jpg" alt="wall"></p>
<p>gameover.jpg</p>
<p><img src="/imgs/gameover.jpg" alt="wall"></p>
<p>&ensp;<br>record.txt 内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">330</div><div class="line">140</div><div class="line">110</div></pre></td></tr></table></figure>
<p>yeah.mp3 ：游戏背景音乐。</p>
<p>yeah.wav ：蛇吃到食物时的哔声。</p>
<p>&ensp;<br>&ensp;</p>
<ul>
<li><p>程序写于大二上学期。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[俄罗斯方块（Java实现）]]></title>
      <url>http://maxuewei2.git.io/2016/03/13/%E4%BF%84%E7%BD%97%E6%96%AF%E6%96%B9%E5%9D%97Java/</url>
      <content type="html"><![CDATA[<h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p><img src="/imgs/tetris.jpg" alt="xiaoguo"><br><a id="more"></a></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Box.java</span></div><div class="line"><span class="keyword">package</span> tetris;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Box</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> M = <span class="number">30</span>, N = <span class="number">12</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][] ls = <span class="keyword">new</span> <span class="keyword">int</span>[M][N];</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> score=<span class="number">0</span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getM</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> M;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getN</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> N;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> score;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isOut</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> x&lt;<span class="number">0</span>|y&lt;<span class="number">0</span>|x&gt;M-<span class="number">1</span>|y&gt;N-<span class="number">1</span>?<span class="keyword">true</span>:<span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getFlag</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> isOut(x,y)?<span class="number">2</span>:ls[x][y];</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">clearFlag</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(isOut(x,y))<span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        ls[x][y]=<span class="number">0</span>;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">setFlag_1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(isOut(x,y))<span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        ls[x][y]=<span class="number">1</span>;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">setFlag_2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(isOut(x,y))<span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        ls[x][y]=<span class="number">2</span>;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/*boolean isFlag_2(int x, int y) &#123;</span></div><div class="line">        return isOut(x,y)?true:ls[x][y]== 2 ? true:false ;</div><div class="line">    &#125;*/</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> maxX)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(isOut(x,<span class="number">0</span>)||isOut(maxX,<span class="number">0</span>))<span class="keyword">return</span> ;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt;= maxX; i++) &#123;</div><div class="line">            <span class="keyword">boolean</span> isAllNotBlank = <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= N - <span class="number">1</span>; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (ls[i][j]== <span class="number">0</span>) &#123;</div><div class="line">                    isAllNotBlank = <span class="keyword">false</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (isAllNotBlank) &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = i - <span class="number">1</span>; k &gt;= <span class="number">0</span>; k--) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= N - <span class="number">1</span>; j++) &#123;</div><div class="line">                        ls[k + <span class="number">1</span>][j]=ls[k][j];</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                score+=<span class="number">100</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Shape.java</span></div><div class="line"><span class="keyword">package</span> tetris;</div><div class="line"><span class="keyword">import</span> java.awt.Point;</div><div class="line"><span class="keyword">import</span> java.util.Random;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Box box;</div><div class="line">    <span class="keyword">private</span> Point[] ps = <span class="keyword">new</span> Point[<span class="number">4</span>];</div><div class="line">    <span class="keyword">private</span> Point[] tps = <span class="keyword">new</span> Point[<span class="number">5</span>];</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>[][][]shapes=&#123;</div><div class="line">            &#123;&#123;-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>&#125;&#125;,</div><div class="line">            &#123;&#123;- <span class="number">1</span>,<span class="number">0</span>, <span class="number">1</span>, - <span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,- <span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;&#125;,</div><div class="line">            &#123;&#123;-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>&#125;&#125;,</div><div class="line">            &#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>&#125;&#125;,</div><div class="line">            &#123;&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;&#125;,</div><div class="line">            &#123;&#123;-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,-<span class="number">1</span>,-<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;&#125;,</div><div class="line">            &#123;&#123;- <span class="number">1</span>,<span class="number">0</span>, - <span class="number">1</span>,- <span class="number">1</span>,<span class="number">0</span>, <span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;- <span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>&#125;&#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> change = <span class="number">0</span>,shape,x,y;</div><div class="line">    <span class="keyword">int</span> left,down;</div><div class="line">    <span class="keyword">private</span> Random random;</div><div class="line">    <span class="keyword">boolean</span> isPaused = <span class="keyword">false</span>;</div><div class="line">    Shape(Box b) &#123;</div><div class="line">        box = b;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++) &#123;</div><div class="line">            ps[i] = <span class="keyword">new</span> Point();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; i++) &#123;</div><div class="line">            tps[i] = <span class="keyword">new</span> Point();</div><div class="line">        &#125;</div><div class="line">        random = <span class="keyword">new</span> Random();</div><div class="line">        getNewShape();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clearTpsFlag</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++) &#123;</div><div class="line">            box.clearFlag(tps[i].x, tps[i].y);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">setPsFlag_1</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++) &#123;</div><div class="line">            box.setFlag_1(ps[i].x, ps[i].y);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">setPsFlag_2</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++) &#123;</div><div class="line">            box.setFlag_2(ps[i].x, ps[i].y);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">tps</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++) &#123;</div><div class="line">            tps[i].x = ps[i].x;</div><div class="line">            tps[i].y = ps[i].y;</div><div class="line">        &#125;</div><div class="line">        tps[<span class="number">4</span>].x=x;</div><div class="line">        tps[<span class="number">4</span>].y=y;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">backupChange</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++) &#123;</div><div class="line">            ps[i].x = tps[i].x;</div><div class="line">            ps[i].y = tps[i].y;</div><div class="line">        &#125;</div><div class="line">        x=tps[<span class="number">4</span>].x;</div><div class="line">        y=tps[<span class="number">4</span>].y;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span>    <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(ps[<span class="number">0</span>]+<span class="string">","</span>+ps[<span class="number">1</span>]+<span class="string">","</span>+ps[<span class="number">2</span>]+<span class="string">","</span>+ps[<span class="number">3</span>]);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>;i++) &#123;</div><div class="line">            <span class="keyword">if</span> (!(box.getFlag(ps[i].x, ps[i].y)==<span class="number">0</span>||box.getFlag(ps[i].x, ps[i].y)==<span class="number">1</span>))&#123;</div><div class="line">                backupChange();</div><div class="line">                <span class="keyword">return</span> <span class="number">5</span>;&#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span>  <span class="title">getNewShape</span><span class="params">()</span></span>&#123;</div><div class="line">        System.out.println(<span class="string">"lll"</span>);</div><div class="line">        <span class="keyword">int</span> i = Math.abs(random.nextInt()) % <span class="number">7</span>;</div><div class="line">        shape=i;</div><div class="line">        x=<span class="number">1</span>;</div><div class="line">        y=box.getN()/<span class="number">2</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">3</span>;j++)&#123;</div><div class="line">            ps[j].setLocation(x+shapes[i][<span class="number">0</span>][j*<span class="number">2</span>], y+shapes[i][<span class="number">0</span>][j*<span class="number">2</span>+<span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line">        left=<span class="number">0</span>;</div><div class="line">        down=<span class="number">0</span>;</div><div class="line">        change=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">changeShape</span><span class="params">()</span></span>&#123;</div><div class="line">        tps();</div><div class="line">        change++;</div><div class="line">        change%=shapes[shape].length;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">3</span>;j++)&#123;</div><div class="line">            ps[j].setLocation(x+shapes[shape][change][j*<span class="number">2</span>], y+shapes[shape][change][j*<span class="number">2</span>+<span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> g=check();</div><div class="line">        <span class="keyword">if</span>(g==<span class="number">0</span>)&#123;</div><div class="line">            clearTpsFlag();</div><div class="line">            setPsFlag_1();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">move</span><span class="params">(<span class="keyword">int</span> dir)</span> </span>&#123;</div><div class="line">        tps();</div><div class="line">        <span class="keyword">switch</span>(dir)&#123;</div><div class="line">                <span class="keyword">case</span> <span class="number">0</span>:<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++) &#123;ps[i].y--;&#125;y--;<span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">1</span>:<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++) &#123;ps[i].y++;&#125;y++;<span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">2</span>:<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++) &#123;ps[i].x++;&#125;x++;<span class="keyword">break</span>;</div><div class="line">                <span class="keyword">default</span>:</div><div class="line">            &#125;</div><div class="line">        <span class="keyword">int</span> g = check();</div><div class="line">        <span class="keyword">if</span>(g!=<span class="number">0</span>&amp;&amp;dir==<span class="number">2</span>)&#123;</div><div class="line">            <span class="keyword">int</span> x = ps[<span class="number">0</span>].x;</div><div class="line">            <span class="keyword">int</span> maxX = ps[<span class="number">3</span>].x;<span class="comment">// x+4&gt;M-1?M-1:x+4;</span></div><div class="line">            setPsFlag_2();</div><div class="line">            box.clear(x, maxX);</div><div class="line">            <span class="keyword">if</span>(x==<span class="number">1</span>)&#123;<span class="keyword">return</span> -<span class="number">1</span>;&#125;</div><div class="line">            getNewShape();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(g==<span class="number">0</span>)&#123;</div><div class="line">            clearTpsFlag();</div><div class="line">            setPsFlag_1();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Tetris.java</span></div><div class="line"><span class="keyword">package</span> tetris;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.awt.BorderLayout;</div><div class="line"><span class="keyword">import</span> java.awt.Color;</div><div class="line"><span class="keyword">import</span> java.awt.Container;</div><div class="line"><span class="keyword">import</span> java.awt.Graphics;</div><div class="line"><span class="keyword">import</span> java.awt.GridLayout;</div><div class="line"><span class="keyword">import</span> java.awt.event.KeyAdapter;</div><div class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.BufferedWriter;</div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.FileReader;</div><div class="line"><span class="keyword">import</span> java.io.FileWriter;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> javax.swing.JButton;</div><div class="line"><span class="keyword">import</span> javax.swing.JFrame;</div><div class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</div><div class="line"><span class="keyword">import</span> javax.swing.JPanel;</div><div class="line"><span class="keyword">import</span> javax.swing.JTextField;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tetris</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">279494108361487144L</span>;</div><div class="line">    <span class="keyword">final</span> Color BC = Color.GRAY;</div><div class="line">    <span class="keyword">final</span> Color FC = Color.LIGHT_GRAY;</div><div class="line">    Box box;</div><div class="line">    Shape shape;</div><div class="line">    <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>, c = <span class="number">0</span>;</div><div class="line">    JPanel panel, scorePanel;</div><div class="line">    JTextField scoreField, bestScoreField;</div><div class="line">    JButton[][] bs;</div><div class="line">    Tetris(Box b) &#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"Tetris"</span>);</div><div class="line">        box = b;</div><div class="line">        shape =<span class="keyword">new</span> Shape(b);</div><div class="line">        bs = <span class="keyword">new</span> JButton[box.getM()][box.getN()];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= box.getM() - <span class="number">1</span>; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= box.getN() - <span class="number">1</span>; j++) &#123;</div><div class="line">                bs[i][j] = <span class="keyword">new</span> JButton();</div><div class="line">                bs[i][j].setBackground(BC);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        Container container = getContentPane();</div><div class="line">        container.setLayout(<span class="keyword">new</span> BorderLayout());</div><div class="line">        scorePanel = <span class="keyword">new</span> JPanel();</div><div class="line">        scorePanel.setLayout(<span class="keyword">new</span> BorderLayout());</div><div class="line">        scoreField = <span class="keyword">new</span> JTextField(<span class="number">10</span>);</div><div class="line">        bestScoreField = <span class="keyword">new</span> JTextField(<span class="number">20</span>);</div><div class="line">        bestScoreField.setText(getBestScores());</div><div class="line">        bestScoreField.setEditable(<span class="keyword">false</span>);</div><div class="line">        scoreField.setText(<span class="string">"SCORE:  "</span> + <span class="keyword">new</span> Integer(box.getScore()).toString());</div><div class="line">        scoreField.setEditable(<span class="keyword">false</span>);</div><div class="line">        scorePanel.add(scoreField, BorderLayout.NORTH);</div><div class="line">        scorePanel.add(bestScoreField, BorderLayout.SOUTH);</div><div class="line">        container.add(scorePanel, BorderLayout.NORTH);</div><div class="line">        panel = <span class="keyword">new</span> JPanel();</div><div class="line">        panel.setLayout(<span class="keyword">new</span> GridLayout(box.getM(), box.getN()));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= box.getM() - <span class="number">1</span>; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= box.getN() - <span class="number">1</span>; j++) &#123;</div><div class="line">                panel.add(bs[i][j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        container.add(panel, BorderLayout.CENTER);</div><div class="line">        <span class="keyword">this</span>.addKeyListener(<span class="keyword">new</span> KeyAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> c = e.getKeyCode();</div><div class="line">                <span class="comment">// System.out.print(c);</span></div><div class="line">                <span class="keyword">switch</span> (c) &#123;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_LEFT :</div><div class="line">                        <span class="comment">//shape.left++;</span></div><div class="line">                        shape.move(<span class="number">0</span>);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_RIGHT :</div><div class="line">                        <span class="comment">//shape.left--;</span></div><div class="line">                        shape.move(<span class="number">1</span>);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_UP :</div><div class="line">                        shape.changeShape();</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_DOWN :</div><div class="line">                        shape.down++;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_SPACE :</div><div class="line">                        <span class="keyword">if</span> (shape.isPaused == <span class="keyword">true</span>) &#123;</div><div class="line">                            shape.isPaused = <span class="keyword">false</span>;</div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            shape.isPaused = <span class="keyword">true</span>;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">default</span> :                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">this</span>.setFocusable(<span class="keyword">true</span>);</div><div class="line">        setLocation(<span class="number">200</span>, <span class="number">10</span>);</div><div class="line">        setSize(<span class="number">20</span> * box.getN(), <span class="number">20</span> * box.getM() + <span class="number">20</span>);</div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">down</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        System.out.println(<span class="string">"ddd"</span>);</div><div class="line">        <span class="keyword">int</span> dd=shape.move(<span class="number">2</span>);</div><div class="line">        scoreField.setText(<span class="string">"Score: "</span> + <span class="keyword">new</span> Integer(box.getScore()).toString());</div><div class="line">        <span class="keyword">if</span>(dd==-<span class="number">1</span>)&#123;gameOver();&#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="keyword">if</span> (shape.isPaused == <span class="keyword">true</span>) &#123;</div><div class="line">                <span class="comment">//    System.out.println("PAUSED");</span></div><div class="line">                    Thread.sleep(<span class="number">500</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="comment">//System.out.println("start1");</span></div><div class="line">                    down();</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= box.getM() - <span class="number">1</span>; i++) &#123;</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= box.getN() - <span class="number">1</span>; j++) &#123;</div><div class="line">                            <span class="keyword">if</span>(box.getFlag(i, j)==<span class="number">0</span>)</div><div class="line">                            bs[i][j].setBackground(BC);</div><div class="line">                            <span class="keyword">else</span> bs[i][j].setBackground(FC);</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span> (shape.down &gt;=<span class="number">1</span>) &#123;</div><div class="line">                        shape.down--;</div><div class="line">                        Thread.sleep(<span class="number">50</span>);</div><div class="line">                        <span class="keyword">continue</span>;</div><div class="line">                    &#125;</div><div class="line">                    Thread.sleep(<span class="number">250</span>);</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function">String <span class="title">getBestScores</span><span class="params">()</span> </span>&#123;</div><div class="line">        BufferedReader reader = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">"score.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            a = Integer.parseInt(reader.readLine());</div><div class="line">            b = Integer.parseInt(reader.readLine());</div><div class="line">            c = Integer.parseInt(reader.readLine());</div><div class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        String bestS = <span class="keyword">new</span> String(<span class="string">"Best Score: "</span> + <span class="keyword">new</span> Integer(a).toString()</div><div class="line">                + <span class="string">"   "</span> + <span class="keyword">new</span> Integer(b).toString() + <span class="string">"   "</span></div><div class="line">                + <span class="keyword">new</span> Integer(c).toString());</div><div class="line">        <span class="keyword">return</span> bestS;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">gameOver</span><span class="params">()</span> </span>&#123;</div><div class="line">        JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"你死了~~~."</span>, <span class="string">"GAME OVER"</span>,</div><div class="line">                JOptionPane.PLAIN_MESSAGE);</div><div class="line">        <span class="keyword">if</span> (box.getScore() &gt; a) &#123;</div><div class="line">            c = b;</div><div class="line">            b = a;</div><div class="line">            a = box.getScore();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (box.getScore() &gt; b) &#123;</div><div class="line">            c = b;</div><div class="line">            b = box.getScore();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (box.getScore()&gt; c) &#123;</div><div class="line">            c = box.getScore();</div><div class="line">            &#125;</div><div class="line">        save();</div><div class="line">        System.exit(<span class="number">0</span>);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</div><div class="line">        BufferedWriter writer = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"score.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        String d = <span class="keyword">new</span> Integer(a).toString(), e = <span class="keyword">new</span> Integer(b).toString(),</div><div class="line">                f = <span class="keyword">new</span> Integer(c).toString();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            writer.write(d);</div><div class="line">            writer.newLine();</div><div class="line">            writer.write(e);</div><div class="line">            writer.newLine();</div><div class="line">            writer.write(f);</div><div class="line">            writer.flush();</div><div class="line">            writer.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException ev) &#123;</div><div class="line">            ev.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException ev) &#123;</div><div class="line">            ev.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Box box = <span class="keyword">new</span> Box();</div><div class="line">        Tetris tetris = <span class="keyword">new</span> Tetris(box);</div><div class="line">        tetris.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</div><div class="line">        Thread thread1 = <span class="keyword">new</span> Thread(tetris);</div><div class="line">        thread1.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于大三上学期。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[校园导游系统（C++实现，VC6.0编译，使用EasyX图形库）]]></title>
      <url>http://maxuewei2.git.io/2016/03/13/%E6%A0%A1%E5%9B%AD%E5%AF%BC%E6%B8%B8%E7%B3%BB%E7%BB%9F/</url>
      <content type="html"><![CDATA[<p>&ensp;<br>运行效果：</p>
<p><img src="/imgs/daoyou1.jpg" alt="效果1"><br><a id="more"></a><br><img src="/imgs/daoyou2.jpg" alt="效果2"><br><img src="/imgs/daoyou3.jpg" alt="效果3"><br><img src="/imgs/daoyou4.jpg" alt="效果4"><br><img src="/imgs/daoyou5.jpg" alt="效果5"><br>&ensp;<br>&ensp;<br>&ensp;</p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明:"></a>说明:</h3><p>　　由于当年还不会使用多线程，所以很多获取用户点击的地方都是使用循环实现的。。。CPU占用率会比较高。</p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//校园导游系统.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;graphics.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;conio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;io.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Stack.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"functions.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Graph_List.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WIDTH  (1000+(LEFTBORDER*2))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEIGHT  (574+TOPBORDER+LEFTBORDER)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UP 72</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DOWN 80</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LEFT 75</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RIGHT 77</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BACKGROUND   <span class="meta-string">"background.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BKCOLOR      RGB(240,240,240)    <span class="comment">//原RGB(240,240,240)</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SELECTCOLOR  RGB(255,0,0)    <span class="comment">//原RED</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TEXTCOLOR    RGB(7,102,198)<span class="comment">//GREEN//   //原BLUE</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MENUCOLOR    RGB(208,161,227)<span class="comment">//RGB(77,197,131)//RGB(112,112,112)//RGB(117,75,144)//RGB(7,102,198)  //原GREEN</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CheckCancel <span class="meta-keyword">if</span>(iscancel)&#123;return -1;&#125;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line">Graph_List graph;</div><div class="line"><span class="keyword">int</span> choose;</div><div class="line"><span class="keyword">int</span> menunum = <span class="number">11</span>;</div><div class="line"><span class="keyword">int</span> menutop1 = <span class="number">10</span>;</div><div class="line"><span class="keyword">int</span> menutop = (menutop1 + <span class="number">3</span>);</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> left (LEFTBORDER)</span></div><div class="line"><span class="keyword">int</span> menuwidth = ((WIDTH - <span class="number">2</span> * LEFTBORDER) / (menunum ));</div><div class="line"><span class="keyword">int</span> menuheight = <span class="number">30</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetChoose</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">FrontMenu</span><span class="params">(Graph_List &amp;graph )</span></span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ShowAllVertex</span><span class="params">(Graph_List &amp;graph)</span></span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ShowAllPath</span><span class="params">(Graph_List &amp;graph)</span></span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">printroad</span><span class="params">(<span class="keyword">int</span> dx, <span class="keyword">int</span> dy, <span class="keyword">int</span> sx, <span class="keyword">int</span> sy)</span> </span>&#123;</div><div class="line">    LINESTYLE linestyle;</div><div class="line">    getlinestyle(&amp;linestyle);</div><div class="line">    setlinestyle(PS_SOLID,<span class="number">3</span>,<span class="literal">NULL</span>,<span class="number">0</span>);</div><div class="line">    setlinecolor(BLUE);</div><div class="line">    line(sx,sy,dx,dy);</div><div class="line">    setlinestyle(&amp;linestyle);</div><div class="line">    <span class="keyword">double</span> x1 = (sx + dx) / <span class="number">2</span>;</div><div class="line">    <span class="keyword">double</span> y1 = (sy + dy) / <span class="number">2</span>;</div><div class="line">    <span class="keyword">double</span> x2 = ((<span class="number">3.0</span> / <span class="number">8.0</span>) * sx + (<span class="number">5.0</span> / <span class="number">8.0</span>) * dx);</div><div class="line">    <span class="keyword">double</span> y2 = ((<span class="number">3.0</span> / <span class="number">8.0</span>) * sy + (<span class="number">5.0</span> / <span class="number">8.0</span>) * dy);</div><div class="line">    <span class="comment">//double x1=sx,x2=(sx+dx)/2,y1=sy,y2=(sy+dy)/2;</span></div><div class="line">    <span class="keyword">double</span> k1 = (y2 - y1) / (x2 - x1);</div><div class="line">    <span class="keyword">double</span> k2 = (<span class="number">-1</span>) / k1;</div><div class="line">    <span class="keyword">double</span> delta = <span class="number">1600</span>; <span class="comment">//=(y2-y1)*(y2-y1)+(x2-x1)*(x2-x1);</span></div><div class="line">    <span class="keyword">double</span> a = <span class="built_in">sqrt</span>((delta / <span class="number">16</span>) / (<span class="number">1</span> + k2 * k2));</div><div class="line">    <span class="keyword">double</span> b = a * <span class="built_in">fabs</span>(k2);</div><div class="line">    <span class="keyword">if</span>(((x1 &gt; x2) &amp;&amp; (y1 &lt; y2)) || ((x1 &lt; x2) &amp;&amp; (y1 &gt; y2))) &#123;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        b = <span class="number">-1</span> * b;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(x1 == x2) &#123;</div><div class="line">        a = <span class="number">5</span>;</div><div class="line">        b = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(y1 == y2) &#123;</div><div class="line">        a = <span class="number">0</span>;</div><div class="line">        b = <span class="number">3</span>;</div><div class="line">    &#125;</div><div class="line">    POINT pts[] = &#123; &#123;x1, y1&#125;, &#123;x2 + a, y2 + b&#125;, &#123;(x1 + x2) / <span class="number">2</span>, (y1 + y2) / <span class="number">2</span>&#125;, &#125;;</div><div class="line">    POINT pts1[] = &#123; &#123;x1, y1&#125;, &#123;x2 * <span class="number">2</span> - (x2 + a), y2 * <span class="number">2</span> - (y2 + b)&#125;, &#123;(x1 + x2) / <span class="number">2</span>, (y1 + y2) / <span class="number">2</span>&#125;, &#125;;</div><div class="line">    setfillcolor(BLUE);</div><div class="line">    solidpolygon(pts1, <span class="number">3</span>);</div><div class="line">    solidpolygon(pts, <span class="number">3</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetMouseXY</span><span class="params">(<span class="keyword">int</span>&amp; mousex,<span class="keyword">int</span>&amp; mousey)</span> </span>&#123;</div><div class="line">    MOUSEMSG temp;</div><div class="line">    temp.mkLButton = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">bool</span> kick = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">while</span>(!kick) &#123;</div><div class="line">       <span class="comment">// if(MouseHit()) &#123;</span></div><div class="line">            temp = GetMouseMsg();</div><div class="line">            FlushMouseMsgBuffer();</div><div class="line">            <span class="keyword">if</span>(temp.mkLButton == <span class="literal">false</span>) &#123;</div><div class="line">                mousex = temp.x;</div><div class="line">                mousey = temp.y;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                kick = temp.mkLButton ;</div><div class="line">            &#125;</div><div class="line">       <span class="comment">// &#125;</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">AddVertex</span><span class="params">(Graph_List &amp;graph)</span> </span>&#123;</div><div class="line">    LOGFONT font;</div><div class="line">    gettextstyle(&amp;font);</div><div class="line">    settextstyle(<span class="number">10</span>, <span class="number">0</span>, _T(<span class="string">"宋体"</span>));</div><div class="line">    BeginBatchDraw();</div><div class="line">    setlinecolor(GREEN);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> lx = LEFTBORDER; lx &lt;= WIDTH; lx += <span class="number">50</span>) &#123;</div><div class="line">        <span class="comment">//outtextxy(lx, TOPBORDER - 10, &amp;int_to_str(lx - LEFTBORDER)[0]);</span></div><div class="line">        line(lx, TOPBORDER, lx, HEIGHT - LEFTBORDER);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> ly = TOPBORDER; ly &lt;= HEIGHT - LEFTBORDER; ly += <span class="number">50</span>) &#123;</div><div class="line">        <span class="comment">//outtextxy(10, ly - 5, &amp;int_to_str(ly - TOPBORDER)[0]);</span></div><div class="line">        line(LEFTBORDER, ly, WIDTH - LEFTBORDER, ly);</div><div class="line">    &#125;</div><div class="line">    FlushBatchDraw();</div><div class="line">    setlinecolor(MENUCOLOR);</div><div class="line">    settextstyle(&amp;font);</div><div class="line">    ::MessageBox(GetHWnd(), <span class="string">"请在您要添加景点的位置点击"</span>, <span class="string">"添加景点"</span>, MB_OK);</div><div class="line">    <span class="keyword">int</span> mousex,mousey;</div><div class="line">    GetMouseXY(mousex,mousey);</div><div class="line">    <span class="keyword">char</span>  name[<span class="number">30</span>];</div><div class="line">    <span class="keyword">bool</span> iscancel = <span class="literal">false</span>;</div><div class="line">    iscancel = !InputBox(&amp;(name[<span class="number">0</span>]), <span class="number">30</span>, <span class="string">"输入名称"</span> , <span class="string">"添加景点"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    CheckCancel</div><div class="line">        <span class="keyword">char</span>  describe[<span class="number">1000</span>];</div><div class="line">    iscancel = !InputBox(&amp;(describe[<span class="number">0</span>]), <span class="number">1000</span>, <span class="string">"输入简介：(按Ctrl+Enter确认输入)"</span> , <span class="string">"添加景点"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>);</div><div class="line">    CheckCancel</div><div class="line">        <span class="keyword">char</span> mark[<span class="number">10</span>];</div><div class="line">    <span class="keyword">int</span> marki;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">        iscancel = !InputBox(&amp;(mark[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入代号"</span> , <span class="string">"添加景点"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        CheckCancel</div><div class="line">            marki = str_to_num(mark);</div><div class="line">        <span class="keyword">if</span>(marki &gt; <span class="number">0</span> &amp;&amp; graph.GetIndex(marki) == <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        ::MessageBox(GetHWnd(), <span class="string">"此代号已存在，请重输"</span>, <span class="string">"添加景点"</span>, MB_OK);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">string</span> namestr = <span class="string">""</span>, describestr = <span class="string">""</span>;</div><div class="line">    graph.InsertVertex((<span class="built_in">string</span>)(namestr + name), (<span class="built_in">string</span>)(describestr + describe), marki, mousex, mousey);</div><div class="line">    ::MessageBox(GetHWnd(), <span class="string">"添加成功"</span>, <span class="string">"添加景点"</span>, MB_OK);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">AddPath</span><span class="params">(Graph_List &amp;graph)</span> </span>&#123;</div><div class="line">    <span class="keyword">bool</span> iscancel = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">int</span> v1, v2;</div><div class="line">    <span class="built_in">string</span> source = <span class="string">"0000000000"</span>, destination = <span class="string">"0000000000"</span>, weightstr = <span class="string">"0000000000"</span>;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">        iscancel = !InputBox(&amp;(source[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入起点代号"</span> , <span class="string">"添加边"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        CheckCancel</div><div class="line">            v1 = str_to_num(source);</div><div class="line">        <span class="keyword">if</span>(graph.GetIndex(v1) != <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        ::MessageBox(GetHWnd(), <span class="string">"该位置不存在，请重输"</span>, <span class="string">"添加边"</span>, MB_OK);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">        iscancel = !InputBox(&amp;(destination[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入终点代号"</span>, <span class="string">"添加边"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        CheckCancel</div><div class="line">            v2 = str_to_num(destination);</div><div class="line">        <span class="keyword">if</span>(graph.GetIndex(v2) != <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        ::MessageBox(GetHWnd(), <span class="string">"该位置不存在，请重输"</span>, <span class="string">"添加边"</span>, MB_OK);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">double</span> dx = graph.GetHead()[graph.GetIndex(v2)].GetX();</div><div class="line">    <span class="keyword">double</span> sx = graph.GetHead()[graph.GetIndex(v1)].GetX();</div><div class="line">    <span class="keyword">double</span> dy = graph.GetHead()[graph.GetIndex(v2)].GetY();</div><div class="line">    <span class="keyword">double</span> sy = graph.GetHead()[graph.GetIndex(v1)].GetY();</div><div class="line">    <span class="keyword">double</span> weight = (<span class="keyword">double</span>)<span class="built_in">sqrt</span>(((dx - sx) * (dx - sx) + (dy - sy) * (dy - sy)) / <span class="number">24250.0</span>) * <span class="number">300.0</span>;</div><div class="line">    <span class="keyword">int</span> retop=graph.InsertEdge(graph.GetIndex(v1), graph.GetIndex(v2),  weight);</div><div class="line">    <span class="keyword">if</span>(retop==<span class="number">-3</span>)&#123;::MessageBox(GetHWnd(), <span class="string">"起点与终点相同！"</span>, <span class="string">"添加边"</span>, MB_OK);<span class="keyword">return</span> <span class="number">-3</span>;&#125;</div><div class="line">    <span class="keyword">if</span>(retop==<span class="number">-4</span>)&#123;::MessageBox(GetHWnd(), <span class="string">"边已存在！"</span>, <span class="string">"添加边"</span>, MB_OK);<span class="keyword">return</span> <span class="number">-4</span>;&#125;</div><div class="line">     ::MessageBox(GetHWnd(), <span class="string">"添加成功"</span>, <span class="string">"添加边"</span>, MB_OK);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">DeleteVertex</span><span class="params">(Graph_List &amp;graph)</span></span>&#123;</div><div class="line">    <span class="keyword">bool</span> iscancel = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">char</span> v[<span class="number">10</span>];</div><div class="line">    <span class="keyword">int</span> v1;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">        iscancel = !InputBox(&amp;(v[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入代号"</span> , <span class="string">"删除景点"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        CheckCancel</div><div class="line">            v1 = str_to_num(v);</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(graph.GetIndex(v1)!= <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        ::MessageBox(GetHWnd(), <span class="string">"此代号不存在，请重输"</span>, <span class="string">"删除景点"</span>, MB_OK);</div><div class="line">    &#125;</div><div class="line">    graph.DeleteVertex(graph.GetIndex(v1));</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">DeletePath</span><span class="params">(Graph_List &amp;graph)</span> </span>&#123;</div><div class="line">    <span class="keyword">bool</span> iscancel = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">int</span> v1, v2;</div><div class="line">    <span class="built_in">string</span> source = <span class="string">"0000000000"</span>, destination = <span class="string">"0000000000"</span>;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">        iscancel = !InputBox(&amp;(source[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入起点代号"</span> , <span class="string">"删除边"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        CheckCancel</div><div class="line">            v1 = str_to_num(source);</div><div class="line">        <span class="keyword">if</span>(graph.GetIndex(v1) != <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        ::MessageBox(GetHWnd(), <span class="string">"该位置不存在，请重输"</span>, <span class="string">"删除边"</span>, MB_OK);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">        iscancel = !InputBox(&amp;(destination[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入终点代号"</span>, <span class="string">"删除边"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        CheckCancel</div><div class="line">            v2 = str_to_num(destination);</div><div class="line">        <span class="keyword">if</span>(graph.GetIndex(v2) != <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        ::MessageBox(GetHWnd(), <span class="string">"该位置不存在，请重输"</span>, <span class="string">"删除边"</span>, MB_OK);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> retop=graph.DeleteEdge(graph.GetIndex(v1), graph.GetIndex(v2));</div><div class="line">    <span class="keyword">if</span>(retop==<span class="number">-1</span>)&#123;::MessageBox(GetHWnd(), <span class="string">"边不存在！"</span>, <span class="string">"删除边"</span>, MB_OK);<span class="keyword">return</span> <span class="number">-1</span>;&#125;</div><div class="line"></div><div class="line">     ::MessageBox(GetHWnd(), <span class="string">"删除成功"</span>, <span class="string">"删除边"</span>, MB_OK);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">DrawShortestPath</span><span class="params">(Graph_List &amp;graph, <span class="keyword">int</span> v1, <span class="keyword">int</span> v2)</span> </span>&#123;</div><div class="line">    Vertex *Head = graph.GetHead();</div><div class="line"></div><div class="line">    <span class="keyword">int</span> *path = <span class="keyword">new</span> <span class="keyword">int</span> [graph.NumberOfVertices()];</div><div class="line">    graph.DShortestPath(v1, path);</div><div class="line">    LStack&lt;<span class="keyword">int</span> &gt; <span class="built_in">stack</span>;</div><div class="line">    <span class="comment">//stack.Push(v2);</span></div><div class="line">    <span class="keyword">if</span>(path[v2] == <span class="number">-1</span>) &#123;</div><div class="line">        ::MessageBox(GetHWnd(), <span class="string">"*** 无路径 ***"</span>, <span class="string">"查询路径"</span>, MB_OK);</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> i = v2;</div><div class="line">    <span class="keyword">while</span>(i != path[v1]) &#123;</div><div class="line">        <span class="built_in">stack</span>.Push(i);</div><div class="line">        i = path[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">delete</span> []path;</div><div class="line">    <span class="comment">//stack.Push(v1);</span></div><div class="line">    <span class="keyword">int</span> temp = v1, temppre = v1, length = <span class="number">0</span>;</div><div class="line">    <span class="built_in">string</span> pathstr,tempstr;</div><div class="line">    BeginBatchDraw();</div><div class="line">    <span class="keyword">while</span>(!<span class="built_in">stack</span>.IsEmpty()) &#123;</div><div class="line">        <span class="built_in">stack</span>.Pop(temp);</div><div class="line">        printroad(Head[temppre].GetX(), Head[temppre].GetY(), Head[temp].GetX(), Head[temp].GetY());</div><div class="line">        <span class="keyword">int</span> pathweight=graph.GetWeight(temppre, temp);</div><div class="line">        length += pathweight;</div><div class="line">        tempstr=tempstr+<span class="string">"从"</span>+int_to_str(Head[temppre].GetMark())+<span class="string">"到"</span>+int_to_str(Head[temp].GetMark())+<span class="string">" : "</span>+int_to_str(pathweight)+<span class="string">" 米"</span>+<span class="string">"\n"</span>;</div><div class="line">        temppre = temp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    FlushBatchDraw();</div><div class="line">    setbkcolor(BKCOLOR);</div><div class="line">    settextcolor(TEXTCOLOR);</div><div class="line">    <span class="built_in">string</span> str = <span class="string">"最短路径长度为："</span>;</div><div class="line">    str = str + int_to_str(length) + <span class="string">" 米\n"</span>+<span class="string">"步行所需时间："</span>+int_to_str(length/<span class="number">90</span>)+<span class="string">"分钟\n"</span>;</div><div class="line">    str+=tempstr;</div><div class="line">    ::MessageBox(GetHWnd(), &amp;str[<span class="number">0</span>], <span class="string">"查询路径"</span>, MB_OK);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">FindPath</span><span class="params">(Graph_List &amp;graph)</span> </span>&#123;</div><div class="line">    <span class="keyword">bool</span> iscancel = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">int</span> v1, v2;</div><div class="line">    <span class="built_in">string</span> source = <span class="string">"0000000000"</span>, destination = <span class="string">"0000000000"</span>;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">        iscancel = !InputBox(&amp;(source[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入起点代号"</span> , <span class="string">"查询路径"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        CheckCancel</div><div class="line">            v1 = str_to_num(source);</div><div class="line">        <span class="keyword">if</span>(graph.GetIndex(v1) != <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        ::MessageBox(GetHWnd(), <span class="string">"该位置不存在，请重输"</span>, <span class="string">"查询路径"</span>, MB_OK);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">        iscancel = !InputBox(&amp;(destination[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入终点代号"</span>, <span class="string">"查询路径"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">        CheckCancel</div><div class="line">            v2 = str_to_num(destination);</div><div class="line">        <span class="keyword">if</span>(graph.GetIndex(v2) != <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        ::MessageBox(GetHWnd(), <span class="string">"该位置不存在，请重输"</span>, <span class="string">"查询路径"</span>, MB_OK);</div><div class="line">    &#125;</div><div class="line">    DrawShortestPath(graph, graph.GetIndex(v1), graph.GetIndex(v2));</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ShowVertex</span><span class="params">(Graph_List &amp;graph, <span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    Vertex *Head = graph.GetHead();</div><div class="line">    <span class="keyword">if</span>(i &lt; <span class="number">0</span> || i &gt; graph.NumberOfVertices() - <span class="number">1</span>) &#123;</div><div class="line">        ::MessageBox(GetHWnd(), <span class="string">"查询位置不存在"</span>, <span class="string">"景点查询"</span>, MB_OK);   <span class="comment">//GetHWnd()获得窗口句柄</span></div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">string</span> str = <span class="string">"代号："</span> +int_to_str(Head[i].GetMark()) + <span class="string">"\n"</span> + <span class="string">"简介: "</span> + Head[i].GetDescribe();</div><div class="line">    str = <span class="string">"名称："</span> + Head[i].GetVerName() + <span class="string">"\n"</span> + str;</div><div class="line">    ::MessageBox(GetHWnd(), &amp;str[<span class="number">0</span>], <span class="string">"景点查询"</span>, MB_OK);   <span class="comment">//GetHWnd()获得窗口句柄</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ModifyMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> choose1 = <span class="number">1</span>;</div><div class="line">    <span class="keyword">char</span> temp = <span class="number">0</span>, key;</div><div class="line">    <span class="keyword">while</span>(temp != <span class="string">'\r'</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(kbhit()) &#123;</div><div class="line">            key = getch();</div><div class="line">            fflush(<span class="built_in">stdin</span>);</div><div class="line">            <span class="keyword">switch</span>(key) &#123;</div><div class="line">            <span class="keyword">case</span> UP: &#123;</div><div class="line">                choose1--;</div><div class="line">                     &#125;;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> DOWN: &#123;</div><div class="line">                choose1++;</div><div class="line">                       &#125;;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(choose1 == <span class="number">6</span>) &#123;</div><div class="line">            choose1 = <span class="number">5</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(choose1 == <span class="number">0</span>) &#123;</div><div class="line">            choose1 = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        cleardevice();</div><div class="line">        outtextxy((WIDTH / <span class="number">2</span>) - <span class="number">80</span>, <span class="number">120</span>, <span class="string">"修改景点"</span>);</div><div class="line">        outtextxy((WIDTH / <span class="number">2</span>) - <span class="number">180</span>, <span class="number">230</span>, <span class="string">"按↑和↓选择选项"</span>);</div><div class="line">        outtextxy((WIDTH / <span class="number">2</span>) - <span class="number">180</span>, <span class="number">250</span>, <span class="string">"按ENTER键确定选择"</span>);</div><div class="line">        outtextxy(<span class="number">300</span>, <span class="number">300</span>, <span class="string">"请选择选项："</span>);</div><div class="line">        outtextxy(<span class="number">420</span>, <span class="number">350</span>, <span class="string">"修改名称"</span>);</div><div class="line">        outtextxy(<span class="number">420</span>, <span class="number">380</span>, <span class="string">"修改简介"</span>);</div><div class="line">        outtextxy(<span class="number">420</span>, <span class="number">410</span>, <span class="string">"修改代号"</span>);</div><div class="line">        outtextxy(<span class="number">420</span>, <span class="number">440</span>, <span class="string">"修改坐标"</span>);</div><div class="line">        outtextxy(<span class="number">420</span>, <span class="number">470</span>, <span class="string">"返回"</span>);</div><div class="line">        outtextxy(<span class="number">390</span>, <span class="number">350</span> + (choose1 - <span class="number">1</span>) * <span class="number">30</span>, <span class="string">"→"</span>);</div><div class="line">        FlushBatchDraw();</div><div class="line">        temp = getch();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> choose1;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ModifyVertex</span><span class="params">(Graph_List &amp;graph)</span> </span>&#123;</div><div class="line">     <span class="keyword">bool</span> iscancel = <span class="literal">false</span>;</div><div class="line">            <span class="keyword">int</span> v1;</div><div class="line">            <span class="keyword">char</span> v1str[<span class="number">10</span>] = &#123;<span class="string">'a'</span>&#125;;</div><div class="line">            <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">                iscancel = !InputBox(&amp;(v1str[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入代号"</span> , <span class="string">"修改景点"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">                CheckCancel</div><div class="line">                v1= str_to_num(v1str);</div><div class="line">                <span class="keyword">if</span>(graph.GetIndex(v1) != <span class="number">-1</span>) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                ::MessageBox(GetHWnd(), <span class="string">"该位置不存在，请重输"</span>, <span class="string">"修改景点"</span>, MB_OK);</div><div class="line">            &#125;</div><div class="line">   <span class="keyword">int</span> v=graph.GetIndex(v1);</div><div class="line">    Vertex *Head = graph.GetHead();</div><div class="line">   <span class="built_in">string</span> name=Head[v].GetVerName();</div><div class="line">        <span class="built_in">string</span> describe=Head[v].GetDescribe();</div><div class="line">         <span class="keyword">int</span> marki=Head[v].GetMark(),x=Head[v].GetX()-LEFTBORDER,y=Head[v].GetY()-TOPBORDER;</div><div class="line">    <span class="keyword">bool</span> isreturn = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">while</span>(!isreturn ) &#123;</div><div class="line">        <span class="keyword">int</span> in = ModifyMenu();</div><div class="line">        <span class="keyword">switch</span>(in) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="number">1</span>: &#123;</div><div class="line">            iscancel = !InputBox(&amp;(name[<span class="number">0</span>]), <span class="number">30</span>, <span class="string">"输入名称"</span> , <span class="string">"修改景点"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">            CheckCancel</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">2</span>: &#123;</div><div class="line">            iscancel = !InputBox(&amp;(describe[<span class="number">0</span>]), <span class="number">1000</span>, <span class="string">"输入简介：(按Ctrl+Enter确认输入)"</span> , <span class="string">"修改景点"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>);</div><div class="line">            CheckCancel</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">3</span>: &#123;</div><div class="line">           <span class="keyword">char</span> mark[<span class="number">10</span>];</div><div class="line">            <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">                iscancel = !InputBox(&amp;(mark[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入代号"</span> , <span class="string">"修改景点"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">                CheckCancel</div><div class="line">                marki = str_to_num(mark);</div><div class="line">                <span class="keyword">if</span>(marki &gt; <span class="number">0</span> &amp;&amp; (marki == Head[v].GetMark() || graph.GetIndex(marki) == <span class="number">-1</span>)) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                ::MessageBox(GetHWnd(), <span class="string">"输入有误或代号已存在，请重输"</span>, <span class="string">"修改景点"</span>, MB_OK);</div><div class="line">            &#125;</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">4</span>: &#123;</div><div class="line">            <span class="keyword">char</span> xstr[<span class="number">10</span>], ystr[<span class="number">10</span>];</div><div class="line">            <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">                iscancel = !InputBox(&amp;(xstr[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入X坐标"</span> , <span class="string">"修改景点"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">                CheckCancel</div><div class="line">                    x = str_to_num(xstr);</div><div class="line">                <span class="keyword">if</span>(x &gt; <span class="number">0</span> &amp;&amp; x &lt; WIDTH) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                ::MessageBox(GetHWnd(), <span class="string">"您所输入的坐标不在图像范围内"</span>, <span class="string">"修改景点"</span>, MB_OK);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">                iscancel = !InputBox(&amp;(ystr[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入Y坐标"</span> , <span class="string">"修改景点"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">                CheckCancel</div><div class="line">                y = str_to_num(ystr);</div><div class="line">                <span class="keyword">if</span>(y &gt; <span class="number">0</span> &amp;&amp; y &lt; HEIGHT) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                ::MessageBox(GetHWnd(), <span class="string">"您所输入的坐标不在图像范围内"</span>, <span class="string">"修改景点"</span>, MB_OK);</div><div class="line">            &#125;</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">5</span>: &#123;</div><div class="line">            graph.ModifyVertex(v, name,describe, marki, x, y);</div><div class="line">            ShowVertex(graph, v);</div><div class="line">            isreturn = <span class="literal">true</span>;</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            &#123;&#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ShowAllVertex</span><span class="params">(Graph_List &amp;graph)</span></span>&#123;</div><div class="line">        Vertex *Head = graph.GetHead();</div><div class="line">    <span class="comment">//putimage(LEFTBORDER, TOPBORDER, graph.GetMap());</span></div><div class="line">    setbkcolor(RGB(<span class="number">240</span>, <span class="number">240</span>, <span class="number">240</span>));</div><div class="line">    settextcolor(RED);</div><div class="line">    setfillcolor(RGB(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>));</div><div class="line">    LOGFONT font1;</div><div class="line">    gettextstyle(&amp;font1);</div><div class="line">    settextstyle(font1.lfHeight - <span class="number">2</span>, <span class="number">0</span>, _T(<span class="string">"宋体"</span>));</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= graph.NumberOfVertices() - <span class="number">1</span>; i++) &#123;</div><div class="line">        <span class="keyword">int</span> x = Head[i].GetX(), y = Head[i].GetY();</div><div class="line">        <span class="built_in">string</span> str = <span class="string">""</span>;</div><div class="line">        str += int_to_str(Head[i].GetMark());</div><div class="line">        <span class="keyword">if</span>(Head[i].GetVerName() != <span class="string">"*"</span>)</div><div class="line">            str = str + <span class="string">" "</span> + Head[i].GetVerName();</div><div class="line">        solidcircle(x,y,<span class="number">4</span>);</div><div class="line">        outtextxy( x, y, &amp;str[<span class="number">0</span>]);</div><div class="line">    &#125;</div><div class="line">    settextstyle(&amp;font1);</div><div class="line">    FlushBatchDraw();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ShowAllPath</span><span class="params">(Graph_List &amp;graph)</span> </span>&#123;</div><div class="line">    LINESTYLE linestyle;</div><div class="line">    getlinestyle(&amp;linestyle);</div><div class="line">    setlinestyle(PS_SOLID,<span class="number">3</span>,<span class="literal">NULL</span>,<span class="number">0</span>);</div><div class="line">    setlinecolor(BLUE);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=graph.NumberOfVertices()<span class="number">-1</span>;i++)&#123;</div><div class="line">        Edge* p=graph.GetHead()[i].Getadj();</div><div class="line">        <span class="keyword">while</span>(p!=<span class="literal">NULL</span>)&#123;</div><div class="line">            line(graph.GetHead()[i].GetX(),graph.GetHead()[i].GetY(),graph.GetHead()[p-&gt;GetVerAdj()].GetX(),graph.GetHead()[p-&gt;GetVerAdj()].GetY());</div><div class="line">            p=p-&gt;Getlink();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    setlinestyle(&amp;linestyle);</div><div class="line">    FlushBatchDraw();</div><div class="line">    <span class="keyword">return</span>  <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">FindMenu</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> choose1 = <span class="number">1</span>;</div><div class="line">    <span class="keyword">char</span> temp = <span class="number">0</span>, key;</div><div class="line">    <span class="keyword">while</span>(temp != <span class="string">'\r'</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(kbhit()) &#123;</div><div class="line">            key = getch();</div><div class="line">            fflush(<span class="built_in">stdin</span>);</div><div class="line">            <span class="keyword">switch</span>(key) &#123;</div><div class="line">            <span class="keyword">case</span> UP: &#123;</div><div class="line">                choose1--;</div><div class="line">                     &#125;;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> DOWN: &#123;</div><div class="line">                choose1++;</div><div class="line">                       &#125;;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(choose1 == <span class="number">4</span>) &#123;</div><div class="line">            choose1 = <span class="number">3</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(choose1 == <span class="number">0</span>) &#123;</div><div class="line">            choose1 = <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        cleardevice();</div><div class="line">        outtextxy((WIDTH / <span class="number">2</span>) - <span class="number">80</span>, <span class="number">120</span>, <span class="string">"查询景点"</span>);</div><div class="line">        outtextxy((WIDTH / <span class="number">2</span>) - <span class="number">180</span>, <span class="number">230</span>, <span class="string">"按↑和↓选择选项"</span>);</div><div class="line">        outtextxy((WIDTH / <span class="number">2</span>) - <span class="number">180</span>, <span class="number">250</span>, <span class="string">"按ENTER键确定选择"</span>);</div><div class="line">        outtextxy(<span class="number">300</span>, <span class="number">300</span>, <span class="string">"请选择选项："</span>);</div><div class="line">        outtextxy(<span class="number">420</span>, <span class="number">350</span>, <span class="string">"按代号查询"</span>);</div><div class="line">        outtextxy(<span class="number">420</span>, <span class="number">380</span>, <span class="string">"按名称查询"</span>);</div><div class="line">        outtextxy(<span class="number">420</span>, <span class="number">410</span>, <span class="string">"返回"</span>);</div><div class="line">        outtextxy(<span class="number">390</span>, <span class="number">350</span> + (choose1 - <span class="number">1</span>) * <span class="number">30</span>, <span class="string">"→"</span>);</div><div class="line">        FlushBatchDraw();</div><div class="line">        temp = getch();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> choose1;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">FindVertex</span><span class="params">(Graph_List &amp;graph)</span> </span>&#123;</div><div class="line">    <span class="keyword">bool</span> iscancel = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">bool</span> isreturn = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">while</span>(!isreturn ) &#123;</div><div class="line">        <span class="keyword">int</span> in = FindMenu();</div><div class="line">        <span class="keyword">switch</span>(in) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="number">1</span>: &#123;</div><div class="line">            <span class="keyword">char</span> v1str[<span class="number">10</span>] = &#123;<span class="string">'a'</span>&#125;;</div><div class="line">            <span class="keyword">int</span> v1;</div><div class="line">                iscancel = !InputBox(&amp;(v1str[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入代号"</span> , <span class="string">"查询景点"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">                CheckCancel</div><div class="line">                    v1 = str_to_num(v1str);</div><div class="line"></div><div class="line">            ShowVertex(graph, graph.GetIndex(v1));</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">2</span>: &#123;</div><div class="line">            <span class="keyword">char</span> v1str[<span class="number">10</span>] = &#123;<span class="string">'a'</span>&#125;;</div><div class="line">            <span class="built_in">string</span> v1;</div><div class="line">                iscancel = !InputBox(&amp;(v1str[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入名称"</span> , <span class="string">"查询景点"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">                CheckCancel</div><div class="line">                    v1 = <span class="string">""</span>;</div><div class="line">                v1 += v1str;</div><div class="line">            ShowVertex(graph, graph.GetIndex(v1));</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">3</span>: &#123;</div><div class="line"></div><div class="line">            isreturn = <span class="literal">true</span>;</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            &#123;&#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Open</span><span class="params">(Graph_List &amp;graph, <span class="keyword">bool</span> isfirstopen)</span> </span>&#123;</div><div class="line">    fstream filestr;</div><div class="line">    <span class="keyword">char</span> mapname[<span class="number">256</span>] = &#123;<span class="string">'a'</span>&#125;;</div><div class="line">    <span class="keyword">if</span>(isfirstopen) &#123;</div><div class="line">        filestr.open (<span class="string">"map.txt"</span>);</div><div class="line">        <span class="built_in">strcpy</span>(mapname, <span class="string">"map.jpg"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">bool</span> iscancel = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">char</span> filename[<span class="number">256</span>] = &#123;<span class="string">'a'</span>&#125;;</div><div class="line">        <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">            iscancel = !InputBox(&amp;(filename[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入文本文件名(不需输'.txt')"</span> , <span class="string">"打开"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">            <span class="function">CheckCancel</span></div><div class="line">                <span class="title">strcat</span><span class="params">(filename, <span class="string">".txt"</span>)</span>;</div><div class="line">            filestr.open (filename);</div><div class="line">            <span class="keyword">if</span> (filestr.is_open()) &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            ::MessageBox(GetHWnd(), <span class="string">"无此文件，请重输"</span>, <span class="string">"打开"</span>, MB_OK);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">            iscancel = !InputBox(&amp;(mapname[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入图片文件名(不需输'.jpg')"</span> , <span class="string">"打开"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">            <span class="function">CheckCancel</span></div><div class="line">                <span class="title">strcat</span><span class="params">(mapname, <span class="string">".jpg"</span>)</span>;</div><div class="line">            <span class="keyword">if</span>( (_access(mapname, <span class="number">0</span> )) != <span class="number">-1</span> ) &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            ::MessageBox(GetHWnd(), <span class="string">"无此文件，请重输"</span>, <span class="string">"打开"</span>, MB_OK);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    graph.graph_con(filestr, mapname);</div><div class="line">    filestr.close();</div><div class="line">    putimage(LEFTBORDER, TOPBORDER, graph.GetMap());</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Save</span><span class="params">(Graph_List &amp;graph)</span> </span>&#123;</div><div class="line">    <span class="keyword">bool</span> iscancel = <span class="literal">false</span>;</div><div class="line">    Vertex *Head = graph.GetHead();</div><div class="line">    <span class="keyword">char</span> filename[<span class="number">256</span>] = &#123;<span class="string">'a'</span>&#125;;</div><div class="line">    iscancel = !InputBox(&amp;(filename[<span class="number">0</span>]), <span class="number">10</span>, <span class="string">"输入文本文件名(不需输'.txt')"</span> , <span class="string">"保存"</span>, <span class="string">"0"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    <span class="function">CheckCancel</span></div><div class="line">        <span class="title">strcat</span><span class="params">(filename, <span class="string">".txt"</span>)</span>;</div><div class="line">    graph.SaveFile(filename);</div><div class="line">    ::MessageBox(GetHWnd(), <span class="string">"保存成功"</span>, <span class="string">"保存"</span>, MB_OK);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetChoose</span><span class="params">()</span> </span>&#123;</div><div class="line">    FlushMouseMsgBuffer();</div><div class="line">    MOUSEMSG temp;</div><div class="line">    temp.mkLButton = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">bool</span> kick = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">while</span>(!kick) &#123;</div><div class="line">       <span class="comment">// if(MouseHit()) &#123;</span></div><div class="line">            temp = GetMouseMsg();</div><div class="line">            FlushMouseMsgBuffer();</div><div class="line">            <span class="keyword">if</span>(temp.mkLButton == <span class="literal">false</span>) &#123;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">if</span>(temp.y &lt; menutop + menuheight &amp;&amp;temp. y &gt; menutop) &#123;</div><div class="line">                     kick = <span class="literal">true</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">       <span class="comment">// &#125;</span></div><div class="line">    &#125;</div><div class="line">    choose = (temp.x - left) / menuwidth;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">FrontMenu</span><span class="params">(Graph_List &amp;graph)</span> </span>&#123;</div><div class="line">    fflush(<span class="built_in">stdin</span>);</div><div class="line">    settextcolor(TEXTCOLOR);</div><div class="line">    setfillcolor(BKCOLOR);</div><div class="line">    solidrectangle(<span class="number">5</span>, TOPBORDER, WIDTH, HEIGHT); <span class="comment">//以背景色刷新</span></div><div class="line">    setfillcolor(MENUCOLOR);</div><div class="line">    solidrectangle(<span class="number">5</span>, <span class="number">0</span>, WIDTH - <span class="number">5</span>, menutop1); <span class="comment">//画最上方的绿色条</span></div><div class="line">    putimage(LEFTBORDER, TOPBORDER, graph.GetMap());</div><div class="line">    setfillcolor(BKCOLOR);</div><div class="line">    solidrectangle(LEFTBORDER, menutop + textheight(<span class="string">'a'</span>), WIDTH - LEFTBORDER, menutop + textheight(<span class="string">'a'</span>) + <span class="number">5</span>); <span class="comment">//去掉选中的菜单下方的小绿块</span></div><div class="line">    setfillcolor(TEXTCOLOR);</div><div class="line">    setfillcolor(MENUCOLOR);</div><div class="line">    solidrectangle(choose * menuwidth + left, menutop + textheight(<span class="string">'a'</span>), (choose + <span class="number">1</span>)*menuwidth + left, menutop + textheight(<span class="string">'a'</span>) + <span class="number">5</span>); <span class="comment">//画选中的菜单下方的小绿块</span></div><div class="line">    roundrect(<span class="number">5</span>, menutop + textheight(<span class="string">'a'</span>) + <span class="number">5</span>, WIDTH - <span class="number">5</span>, HEIGHT - <span class="number">5</span>, <span class="number">5</span>, <span class="number">3</span>); <span class="comment">//画图片周围的绿色边框</span></div><div class="line">    solidrectangle(<span class="number">5</span>, menutop + textheight(<span class="string">'a'</span>) + <span class="number">5</span>, WIDTH - <span class="number">5</span>, menutop + textheight(<span class="string">'a'</span>) + <span class="number">10</span>); <span class="comment">//画图片上方与小绿块相连的绿色条</span></div><div class="line">    setfillcolor(TEXTCOLOR);</div><div class="line">    LOGFONT font1;</div><div class="line">    gettextstyle(&amp;font1);</div><div class="line">    settextstyle(font1.lfHeight, <span class="number">0</span>, _T(<span class="string">"宋体"</span>));</div><div class="line">    <span class="built_in">string</span> menu[<span class="number">11</span>] = &#123;<span class="string">"     打开"</span>, <span class="string">"   显示"</span>, <span class="string">" 查询路径"</span>, <span class="string">" 查询景点"</span>, <span class="string">" 修改景点"</span>, <span class="string">" 添加景点"</span>, <span class="string">" 删除景点"</span>, <span class="string">"  添加边"</span>, <span class="string">"  删除边"</span>,<span class="string">"   保存"</span>, <span class="string">"     退出"</span>&#125;;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> index = <span class="number">0</span>; index &lt;= menunum - <span class="number">1</span>; index++) &#123;</div><div class="line">        <span class="keyword">if</span>(index == choose)settextcolor(SELECTCOLOR);</div><div class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *p = menu[index].c_str();</div><div class="line">        outtextxy(left + index * menuwidth, menutop, p);</div><div class="line">        <span class="keyword">if</span>(index == choose)settextcolor(TEXTCOLOR);</div><div class="line">    &#125;</div><div class="line">    settextstyle(&amp;font1);</div><div class="line">    setlinecolor(MENUCOLOR);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> index1 = <span class="number">0</span>; index1 &lt;= menunum + <span class="number">1</span>; index1++) &#123;</div><div class="line">        line(left + index1 * menuwidth, menutop, left + index1 * menuwidth, menutop + textheight(<span class="string">'a'</span>));</div><div class="line">    &#125;</div><div class="line">    LOGFONT font;</div><div class="line">    gettextstyle(&amp;font);</div><div class="line">    settextstyle(<span class="number">10</span>, <span class="number">0</span>, _T(<span class="string">"宋体"</span>));</div><div class="line">    settextcolor(TEXTCOLOR);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> lx = LEFTBORDER; lx &lt;= WIDTH; lx += <span class="number">50</span>) &#123;</div><div class="line">        outtextxy(lx, TOPBORDER - <span class="number">10</span>, &amp;int_to_str(lx - LEFTBORDER)[<span class="number">0</span>]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> ly = TOPBORDER; ly &lt;= HEIGHT - LEFTBORDER; ly += <span class="number">50</span>) &#123;</div><div class="line">        outtextxy(<span class="number">10</span>, ly - <span class="number">5</span>, &amp;int_to_str(ly - TOPBORDER)[<span class="number">0</span>]);</div><div class="line">    &#125;</div><div class="line">    settextstyle(&amp;font);</div><div class="line">    settextcolor(TEXTCOLOR);</div><div class="line">    FlushBatchDraw();</div><div class="line">    setbkcolor(BKCOLOR);</div><div class="line">    settextcolor(TEXTCOLOR);</div><div class="line">    <span class="keyword">return</span> choose;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    graph;</div><div class="line">    initgraph(WIDTH, HEIGHT); <span class="comment">//,0);//SHOWCONSOLE|NOMINIMIZE</span></div><div class="line">    setbkcolor(BKCOLOR);</div><div class="line">    cleardevice();</div><div class="line">    <span class="comment">//int in = INT_MIN;</span></div><div class="line">    <span class="comment">//FrontMenu(graph);</span></div><div class="line">    <span class="keyword">bool</span> isfirstopen = <span class="literal">true</span>;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">        FrontMenu(graph);</div><div class="line">        <span class="comment">//ShowAllVertex( graph);</span></div><div class="line">         <span class="keyword">if</span>(isfirstopen) &#123;</div><div class="line">           choose = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">             GetChoose( );</div><div class="line">        &#125;</div><div class="line">        FrontMenu(graph);</div><div class="line">        <span class="comment">//ShowAllVertex( graph);</span></div><div class="line">        <span class="keyword">switch</span>(choose) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="number">0</span>: &#123;</div><div class="line">            Open(graph, isfirstopen);</div><div class="line">            isfirstopen = <span class="literal">false</span>;</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">1</span>: &#123;</div><div class="line">            ShowAllPath(graph);</div><div class="line">            ShowAllVertex( graph);</div><div class="line">            <span class="keyword">int</span> vertexnum =graph.NumberOfVertices(),edgenum=graph.NumberOfEdges();</div><div class="line">            <span class="built_in">string</span> numofvertices;</div><div class="line">            numofvertices = <span class="string">"图中共有景点 "</span> + int_to_str(vertexnum) + <span class="string">" 个\n"</span>+<span class="string">"共有边 "</span> + int_to_str(edgenum) + <span class="string">" 条\n"</span>;</div><div class="line">            ::MessageBox(GetHWnd(), &amp;numofvertices[<span class="number">0</span>], <span class="string">"显示"</span>, MB_OK);</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">2</span>: &#123;</div><div class="line">            ShowAllVertex( graph);</div><div class="line">            FindPath(graph);</div><div class="line">            ShowAllVertex( graph);</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">3</span>: &#123;</div><div class="line">            ShowAllVertex( graph);</div><div class="line">            FindVertex(graph);</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">4</span>: &#123;</div><div class="line">            ShowAllVertex( graph);</div><div class="line">                ModifyVertex(graph );</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">5</span>: &#123;</div><div class="line">            ShowAllVertex( graph);</div><div class="line">            AddVertex(graph);</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">6</span>: &#123;</div><div class="line">            ShowAllVertex( graph);</div><div class="line">            DeleteVertex(graph);</div><div class="line">                &#125;;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">7</span>: &#123;</div><div class="line">            ShowAllPath(graph);</div><div class="line">            ShowAllVertex( graph);</div><div class="line">            AddPath( graph);</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">8</span>: &#123;</div><div class="line">            ShowAllPath(graph);</div><div class="line">            ShowAllVertex( graph);</div><div class="line">            DeletePath(graph);</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">9</span>: &#123;</div><div class="line">            Save(graph);</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">10</span>: &#123;</div><div class="line">            WinExec(_T(<span class="string">"taskkill /f /im conhost.exe /t"</span>), <span class="number">1</span>);</div><div class="line">            <span class="comment">//WinExec(_T("taskkill /f /im 校园导游系统.exe /t"), 1);</span></div><div class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">                 &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">default</span>: &#123;</div><div class="line">                 &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Graph_List.h</span></div><div class="line"><span class="comment">//********************************  类定义  ***************************************//</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span>  _MYGraph_List_h_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>  _MYGraph_List_h_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LEFTBORDER 30</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TOPBORDER 50</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;graphics.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Edge</div><div class="line">&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> VerAdj;</div><div class="line">    <span class="keyword">int</span> cost;</div><div class="line">    Edge *link;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Edge()</div><div class="line">    &#123;</div><div class="line">        VerAdj = <span class="number">-1</span>;</div><div class="line">        cost = <span class="number">-1</span>;</div><div class="line">        link = <span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">    Edge(<span class="keyword">int</span> VerAdji, <span class="keyword">int</span> costi,Edge *linki): VerAdj(VerAdji), cost(costi),link(linki)  <span class="comment">//初始化</span></div><div class="line">    &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> &amp;<span class="title">GetVerAdj</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> VerAdj;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> &amp;<span class="title">Getcost</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> cost;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Edge *&amp;<span class="title">Getlink</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> link;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">class</span> Vertex</div><div class="line">&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="built_in">string</span> VerName;</div><div class="line">    <span class="built_in">string</span> Describe;</div><div class="line">    Edge *adjacent;</div><div class="line">    <span class="keyword">int</span> mark;</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Vertex()</div><div class="line">    &#123;</div><div class="line">        VerName = <span class="string">"*"</span>;</div><div class="line">        Describe = <span class="string">"*"</span>;</div><div class="line">        adjacent = <span class="literal">NULL</span>;</div><div class="line">        mark=<span class="number">-1</span>;</div><div class="line">        x=<span class="number">-1</span>;</div><div class="line">        y=<span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="built_in">string</span> &amp;<span class="title">GetVerName</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> VerName;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="built_in">string</span> &amp;<span class="title">GetDescribe</span> <span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> Describe;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Edge *&amp;<span class="title">Getadj</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> adjacent;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> &amp; <span class="title">GetMark</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> mark;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> &amp; <span class="title">GetX</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> &amp; <span class="title">GetY</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> y;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">class</span> Graph_List</div><div class="line">&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    Vertex *Head;</div><div class="line">    <span class="keyword">int</span> graphsize;</div><div class="line">    <span class="keyword">int</span> MaxCost;</div><div class="line">    IMAGE*  <span class="built_in">map</span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">InsertEdge_Do</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;v1, <span class="keyword">const</span> <span class="keyword">int</span> &amp;v2, <span class="keyword">int</span> weight)</span>   <span class="comment">//插入时尽量保证顺序排列</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(Head[v1].Getadj() == <span class="literal">NULL</span>) &#123;</div><div class="line">            Head[v1].Getadj() = <span class="keyword">new</span> Edge(v2, weight, <span class="literal">NULL</span>);  <span class="comment">//若邻接表为空 直接在adjacent后添加边</span></div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        Edge *p = Head[v1].Getadj();</div><div class="line">        Edge *pt = p;</div><div class="line">        <span class="keyword">while</span>((p != <span class="literal">NULL</span>)&amp;&amp;(p-&gt;GetVerAdj() &lt; v2)) &#123;</div><div class="line">            pt = p;</div><div class="line">            p = p-&gt;Getlink();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(p == <span class="literal">NULL</span>) &#123;     <span class="comment">//到邻接表末端仍然比v2小</span></div><div class="line">            pt-&gt;Getlink() = <span class="keyword">new</span> Edge(v2, weight, <span class="literal">NULL</span>);</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(p == Head[v1].Getadj() &amp;&amp; p-&gt;GetVerAdj() &gt; v2) &#123;   <span class="comment">//邻接表第一个就比v2大</span></div><div class="line">            Edge *q = <span class="keyword">new</span> Edge(v2, weight, <span class="literal">NULL</span>);</div><div class="line">            q-&gt;Getlink() = p;</div><div class="line">            Head[v1].Getadj() = q;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;GetVerAdj() == v2) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">-4</span>;    <span class="comment">//插入边已存在  返回-4</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(p != Head[v1].Getadj() &amp;&amp; p-&gt;GetVerAdj() &gt; v2) &#123;  <span class="comment">//正常在邻接表中间添加的情况</span></div><div class="line">            Edge *q = <span class="keyword">new</span> Edge(v2, weight, <span class="literal">NULL</span>);</div><div class="line">            pt-&gt;Getlink() = q;</div><div class="line">            q-&gt;Getlink() = p;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">DeleteEdge_Do</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;v1, <span class="keyword">const</span> <span class="keyword">int</span> &amp;v2)</span></span></div><div class="line">    &#123;</div><div class="line">        Edge *p = Head[v1].Getadj();</div><div class="line">        <span class="keyword">if</span>(p == <span class="literal">NULL</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;   <span class="comment">//返回-1表示所删除的边不存在</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(p-&gt;GetVerAdj() == v2)    <span class="comment">//邻接表第一个就是v2的情况</span></div><div class="line">        &#123;</div><div class="line">            Head[v1].Getadj() = p-&gt;Getlink();</div><div class="line">            <span class="keyword">delete</span> p;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">            Edge *pt = p;</div><div class="line">            <span class="keyword">while</span>(p != <span class="literal">NULL</span>)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span>(p-&gt;GetVerAdj() == v2)</div><div class="line">                &#123;</div><div class="line">                    pt-&gt;Getlink() = p-&gt;Getlink();</div><div class="line">                    <span class="keyword">delete</span> p;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                pt = p;</div><div class="line">                p = p-&gt;Getlink();</div><div class="line">            &#125;</div><div class="line">        <span class="keyword">if</span>(p == <span class="literal">NULL</span>)    <span class="comment">//到邻接表末端仍未找到v2  则边不存在</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;   <span class="comment">//返回-1表示所删除的边不存在</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">      <span class="function"><span class="keyword">int</span> <span class="title">DeleteGraph_List</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= graphsize - <span class="number">1</span>; i++)</div><div class="line">        &#123;</div><div class="line">            Edge *p = Head[i].Getadj();</div><div class="line">            Edge *q = p;</div><div class="line">            <span class="keyword">while</span>(p != <span class="literal">NULL</span>)</div><div class="line">            &#123;</div><div class="line">                p = p-&gt;Getlink();</div><div class="line">                <span class="keyword">delete</span> q;</div><div class="line">                q = p;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">delete</span> [] Head;</div><div class="line">        <span class="keyword">delete</span> <span class="built_in">map</span>;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">int</span>&amp; <span class="title">GetMaxCost</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> MaxCost;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Vertex*&amp; <span class="title">GetHead</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> Head;</div><div class="line">    &#125;</div><div class="line">    <span class="function">IMAGE *&amp; <span class="title">GetMap</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">map</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">GetIndex</span><span class="params">(<span class="keyword">int</span> marki)</span>     <span class="comment">//按代号查找在顶点表中的位置</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= graphsize - <span class="number">1</span>; i++)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span>(marki == Head[i].GetMark())</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">return</span> i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;   <span class="comment">//找不到则返回-1</span></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">GetIndex</span><span class="params">(<span class="built_in">string</span> name)</span>   <span class="comment">//按名称查找在顶点表中的位置</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= graphsize - <span class="number">1</span>; i++)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span>(name == Head[i].GetVerName())</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">return</span> i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">//找不到则返回-1</span></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">graph_con</span><span class="params">(fstream &amp;file,<span class="keyword">char</span>* mapname)</span>                   <span class="comment">//插入边创建</span></span></div><div class="line">    &#123;</div><div class="line">        DeleteGraph_List();<span class="comment">//先把类里面之前的内容删除掉</span></div><div class="line">        <span class="built_in">map</span>=<span class="keyword">new</span> IMAGE;</div><div class="line">        loadimage(<span class="built_in">map</span>, _T(mapname));</div><div class="line">        file &gt;&gt; MaxCost;</div><div class="line">        file &gt;&gt; graphsize;</div><div class="line">        Head = <span class="keyword">new</span> Vertex[graphsize];</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= graphsize - <span class="number">1</span>; i++)</div><div class="line">        &#123;</div><div class="line">            file &gt;&gt; Head[i].GetVerName();</div><div class="line">            file &gt;&gt; Head[i].GetDescribe();</div><div class="line">            file &gt;&gt; Head[i].GetMark();</div><div class="line">            file &gt;&gt; Head[i].GetX();</div><div class="line">            Head[i].GetX()+=LEFTBORDER;    <span class="comment">//加左边界</span></div><div class="line">            file &gt;&gt; Head[i].GetY();</div><div class="line">            Head[i].GetY()+=TOPBORDER;    <span class="comment">//加上边界</span></div><div class="line">            Head[i].Getadj() = <span class="literal">NULL</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> edgenum;</div><div class="line">        file &gt;&gt; edgenum;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= edgenum - <span class="number">1</span>; j++)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> v1, v2, weight;</div><div class="line">            file &gt;&gt; v1;</div><div class="line">            file &gt;&gt; v2;</div><div class="line">        <span class="keyword">double</span> dx=Head[GetIndex(v2)].GetX();</div><div class="line">    <span class="keyword">double</span> sx=Head[GetIndex(v1)].GetX();</div><div class="line">    <span class="keyword">double</span> dy=Head[GetIndex(v2)].GetY();</div><div class="line">    <span class="keyword">double</span> sy=Head[GetIndex(v1)].GetY();</div><div class="line">weight=(<span class="keyword">double</span>)<span class="built_in">sqrt</span>(((dx-sx)*(dx-sx)+(dy-sy)*(dy-sy))/<span class="number">24250.0</span>)*<span class="number">300.0</span>;   <span class="comment">//通过坐标计算边长度 赋给weight</span></div><div class="line">            InsertEdge(GetIndex(v1),GetIndex(v2), weight);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    Graph_List()   <span class="comment">//构造函数  构造一个空图</span></div><div class="line">    &#123;</div><div class="line">        Head=<span class="literal">NULL</span>;</div><div class="line">        <span class="built_in">map</span>=<span class="literal">NULL</span>;</div><div class="line">        <span class="built_in">map</span>=<span class="keyword">new</span> IMAGE;</div><div class="line">        graphsize=<span class="number">0</span>;</div><div class="line">        MaxCost=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    ~Graph_List()&#123;</div><div class="line">    DeleteGraph_List();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">SaveFile</span><span class="params">(<span class="keyword">char</span>* filename)</span></span>&#123;</div><div class="line">    system(<span class="string">"del filename "</span>);   <span class="comment">//删除文件</span></div><div class="line">    <span class="function">ofstream <span class="title">fl</span><span class="params">(filename)</span></span>;<span class="comment">//打开文件用于写，若文件不存在就创建它</span></div><div class="line">    <span class="keyword">if</span>(!fl)<span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//打开文件失败则结束运行</span></div><div class="line">    fl &lt;&lt; GetMaxCost() &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    fl &lt;&lt; NumberOfVertices() &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= NumberOfVertices() - <span class="number">1</span>; i++) &#123;</div><div class="line">        fl &lt;&lt; Head[i].GetVerName() &lt;&lt; <span class="string">"\t\t\t"</span> &lt;&lt; Head[i].GetDescribe() &lt;&lt; <span class="string">"\t\t\t\t\t\t"</span> &lt;&lt; Head[i].GetMark() &lt;&lt; <span class="string">"\t"</span> &lt;&lt; Head[i].GetX() - LEFTBORDER &lt;&lt; <span class="string">"\t"</span> &lt;&lt; Head[i].GetY() - TOPBORDER &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;       <span class="comment">//用制表符对齐</span></div><div class="line">    fl &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">int</span> numofedges =NumberOfEdges() * <span class="number">2</span>;</div><div class="line">    fl &lt;&lt; numofedges &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">int</span> num = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= NumberOfVertices() - <span class="number">1</span>; j++) &#123;</div><div class="line">        Edge *p = Head[j].Getadj();</div><div class="line">        <span class="keyword">while</span>(p != <span class="literal">NULL</span>) &#123;</div><div class="line">            <span class="keyword">if</span>(num == <span class="number">5</span>) &#123;</div><div class="line">                fl &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">                num = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            fl &lt;&lt; GetHead()[j].GetMark() &lt;&lt; <span class="string">"\t"</span> &lt;&lt; GetHead()[p-&gt;GetVerAdj()].GetMark() &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">            p = p-&gt;Getlink();</div><div class="line">            num++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    fl.close();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">GraphEmpty</span><span class="params">()</span><span class="keyword">const</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> graphsize == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">NumberOfVertices</span> <span class="params">()</span><span class="keyword">const</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> graphsize;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">NumberOfEdges</span> <span class="params">()</span><span class="keyword">const</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> n = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= graphsize - <span class="number">1</span>; i++)</div><div class="line">        &#123;</div><div class="line">            Edge *p = Head[i].Getadj();</div><div class="line">            <span class="keyword">while</span>(p != <span class="literal">NULL</span>)</div><div class="line">            &#123;</div><div class="line">                n++;</div><div class="line">                p = p-&gt;Getlink();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> n / <span class="number">2</span>;    <span class="comment">//返回边的数目  不计重复边</span></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">GetWeight</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;v1, <span class="keyword">const</span> <span class="keyword">int</span> &amp;v2)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(v1 &gt; graphsize - <span class="number">1</span> || v2 &gt; graphsize - <span class="number">1</span> || v1 &lt; <span class="number">0</span> || v2 &lt; <span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//cout &lt;&lt; "查找元素超界！" &lt;&lt; endl;</span></div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(v1 == v2)      <span class="comment">///////</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        Edge *p = Head[v1].Getadj();</div><div class="line">        <span class="keyword">while</span>(p != <span class="literal">NULL</span> &amp;&amp; p-&gt;GetVerAdj() != v2)</div><div class="line">        &#123;</div><div class="line">            p = p-&gt;Getlink();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(p != <span class="literal">NULL</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> p-&gt;Getcost();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">return</span> MaxCost + <span class="number">1</span>;   <span class="comment">//两点之间没有边则返回 MaxCost + 1</span></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InsertVertex</span><span class="params">(<span class="built_in">string</span>  name,<span class="built_in">string</span>  describe,<span class="keyword">int</span> mark,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></div><div class="line">    &#123;</div><div class="line">        Vertex *head = <span class="keyword">new</span> Vertex[graphsize + <span class="number">1</span>];   <span class="comment">//创建一个新的顶点表  大小为现有大小再加1</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= graphsize - <span class="number">1</span>; i++)    <span class="comment">//复制现有顶点表的内容到新顶点表</span></div><div class="line">        &#123;</div><div class="line">            head[i] = Head[i];</div><div class="line">         &#125;</div><div class="line">        head[graphsize].GetVerName() = name;    <span class="comment">//把新添加的顶点加在新顶点表最后一个位置</span></div><div class="line">        head[graphsize].GetDescribe() = describe;</div><div class="line">        head[graphsize].GetMark() = mark;</div><div class="line">        head[graphsize].GetX() = x;</div><div class="line">        head[graphsize].GetY() = y;</div><div class="line">        head[graphsize].Getadj() = <span class="literal">NULL</span>;</div><div class="line">        <span class="keyword">delete</span> [] Head;    <span class="comment">//删除原顶点表</span></div><div class="line">        Head = head;   <span class="comment">//把Head指针指向新顶点表</span></div><div class="line">        graphsize++;    <span class="comment">//更新顶点数目</span></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">InsertEdge</span><span class="params">(<span class="keyword">int</span> v1,<span class="keyword">int</span>  v2, <span class="keyword">int</span> weight)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(v1 &gt; graphsize - <span class="number">1</span> || v2 &gt; graphsize - <span class="number">1</span> || v1 &lt; <span class="number">0</span> || v2 &lt; <span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//cerr &lt;&lt; "插入元素超界！无法完成操作！" &lt;&lt; endl;</span></div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;     <span class="comment">//插入元素超界返回-1</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(weight &gt; MaxCost)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//cerr &lt;&lt; "插入权值超出最大权值！无法完成操作！" &lt;&lt; endl;</span></div><div class="line">            <span class="keyword">return</span> <span class="number">-2</span>;            <span class="comment">//返回-2表示权值过大</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(v1 == v2)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//cerr &lt;&lt; "操作不合法" &lt;&lt; endl;</span></div><div class="line">            <span class="keyword">return</span> <span class="number">-3</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> i=InsertEdge_Do(v1, v2, weight);</div><div class="line">        <span class="keyword">if</span>(i==<span class="number">-4</span>)&#123;      <span class="comment">//边已存在</span></div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">        &#125;</div><div class="line">        InsertEdge_Do(v2, v1, weight);</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">DeleteVertex</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;v)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(v &gt; graphsize - <span class="number">1</span> || v &lt; <span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//cerr &lt;&lt; "删除元素超界！" &lt;&lt; endl;</span></div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;     <span class="comment">//超界返回-1</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= graphsize - <span class="number">1</span>; i++)</div><div class="line">        &#123;</div><div class="line">            DeleteEdge(i, v);    <span class="comment">//删除指向该顶点的所有边</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = v; j &lt;= graphsize - <span class="number">2</span>; j++)</div><div class="line">        &#123;</div><div class="line">            Head[j] = Head[j + <span class="number">1</span>];    <span class="comment">//把该顶点后边的元素向前挪一个位置</span></div><div class="line">        &#125;</div><div class="line">        graphsize--;    <span class="comment">//更新graphsize</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;= graphsize - <span class="number">1</span>; k++)</div><div class="line">        &#123;</div><div class="line">            Edge *p = Head[k].Getadj();</div><div class="line">            <span class="keyword">while</span>(p != <span class="literal">NULL</span>)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span>(p-&gt;GetVerAdj() &gt; v)</div><div class="line">                &#123;</div><div class="line">                    p-&gt;GetVerAdj()--;    <span class="comment">//所有边之中指向所删除顶点之后位置的  都要减1</span></div><div class="line">                &#125;</div><div class="line">                p = p-&gt;Getlink();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">ModifyVertex</span><span class="params">(<span class="keyword">int</span> v,<span class="built_in">string</span>&amp; name,<span class="built_in">string</span>&amp; describe,<span class="keyword">int</span>&amp; marki,<span class="keyword">int</span>&amp; x,<span class="keyword">int</span>&amp; y)</span></span>&#123;</div><div class="line">         <span class="keyword">if</span>(v &lt; <span class="number">0</span> || v &gt; NumberOfVertices() - <span class="number">1</span>) &#123;</div><div class="line">             <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">         &#125;</div><div class="line">        Head[v].GetVerName() = name;</div><div class="line">        Head[v].GetDescribe() = describe;</div><div class="line">        Head[v].GetMark() = marki;</div><div class="line">        Head[v].GetX() = x;</div><div class="line">        Head[v].GetX() += LEFTBORDER;</div><div class="line">        Head[v].GetY() = y;</div><div class="line">        Head[v].GetY() += TOPBORDER;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">DeleteEdge</span><span class="params">(<span class="keyword">int</span> v2, <span class="keyword">int</span> v1)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(v1 &gt; graphsize - <span class="number">1</span> || v2 &gt; graphsize - <span class="number">1</span> || v1 &lt; <span class="number">0</span> || v2 &lt; <span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//cerr &lt;&lt; "删除元素超界！" &lt;&lt; endl;</span></div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(v1 == v2)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> i=DeleteEdge_Do(v1,v2);</div><div class="line">        <span class="keyword">if</span>(i==<span class="number">-1</span>)&#123;<span class="keyword">return</span> i;&#125;</div><div class="line">        DeleteEdge_Do(v2,v1);</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">DShortestPath</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> v,<span class="keyword">int</span>*&amp; path)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> n = graphsize;</div><div class="line">        <span class="keyword">int</span> *s = <span class="keyword">new</span> <span class="keyword">int</span>[n];</div><div class="line">        <span class="keyword">int</span> *dist = <span class="keyword">new</span> <span class="keyword">int</span>[n];</div><div class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, temp = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">        &#123;</div><div class="line">            s[i] = <span class="number">0</span>;</div><div class="line">            dist[i] = MaxCost*graphsize*(graphsize<span class="number">-1</span>)/<span class="number">2</span>;</div><div class="line">            path[i] = <span class="number">-1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> u = v;</div><div class="line">        Edge *p = <span class="literal">NULL</span>;</div><div class="line">        dist[u] = <span class="number">0</span>;</div><div class="line">        s[u] = <span class="number">1</span>;</div><div class="line">        path[u] = u;</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">        &#123;</div><div class="line">            s[u] = <span class="number">1</span>;</div><div class="line">            p = Head[u].Getadj();</div><div class="line">            <span class="keyword">while</span> (p != <span class="literal">NULL</span>)</div><div class="line">            &#123;</div><div class="line">                temp = p-&gt;GetVerAdj();</div><div class="line">                <span class="keyword">if</span> (dist[u] + p-&gt;Getcost ()&lt; dist[temp])</div><div class="line">                &#123;</div><div class="line">                    dist[temp] = dist[u] + p-&gt;Getcost();</div><div class="line">                    path[temp] = u;</div><div class="line">                &#125;</div><div class="line">                p = p-&gt;Getlink();</div><div class="line">            &#125;</div><div class="line">            temp =MaxCost*graphsize*(graphsize<span class="number">-1</span>)/<span class="number">2</span>;;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span> (s[j] == <span class="number">0</span> &amp;&amp; dist[j] &lt; temp)</div><div class="line">                &#123;</div><div class="line">                    temp = dist[j];</div><div class="line">                    u = j;<span class="comment">//未访问中最小</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">delete</span>[]s;</div><div class="line">        <span class="keyword">delete</span>[]dist;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Stack.h</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span>   _MYStack_h_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>   _MYStack_h_</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> TL&gt;</div><div class="line"><span class="keyword">class</span> LStack;</div><div class="line"><span class="comment">//结点定义</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> TL&gt;</div><div class="line"><span class="keyword">class</span> LStackNode</div><div class="line">&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    TL data;</div><div class="line">    LStackNode&lt;TL&gt;* next;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> LStack&lt;TL&gt;;</div><div class="line">    LStackNode()</div><div class="line">    &#123;</div><div class="line">        next=<span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">    LStackNode(TL item,LStackNode&lt;TL&gt;* nextnode=<span class="literal">NULL</span>)</div><div class="line">    &#123;</div><div class="line">        data=item;</div><div class="line">        next=nextnode;</div><div class="line">    &#125;</div><div class="line">    LStackNode(LStackNode&lt;TL&gt;&amp; node)</div><div class="line">    &#123;</div><div class="line">        data=node.data;    <span class="comment">//   为什么必须是引用&amp;才行</span></div><div class="line">        next=node.next;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//栈定义</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> TL&gt;</div><div class="line"><span class="keyword">class</span> LStack</div><div class="line">&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    LStackNode&lt;TL&gt; * top;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    LStack()</div><div class="line">    &#123;</div><div class="line">        top=<span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Push</span><span class="params">(<span class="keyword">const</span> TL&amp; item)</span></span></div><div class="line">    &#123;</div><div class="line">        LStackNode&lt;TL&gt;* p=top;</div><div class="line">        top=<span class="keyword">new</span> LStackNode&lt;TL&gt;;</div><div class="line">        top-&gt;data=item;</div><div class="line">        top-&gt;next=p;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Pop</span><span class="params">( TL&amp; item)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(top==<span class="literal">NULL</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            item=top-&gt;data;</div><div class="line">            LStackNode&lt;TL&gt; * p=top;</div><div class="line">            top=top-&gt;next;</div><div class="line">            <span class="keyword">delete</span> p;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Peek</span><span class="params">( TL&amp; item)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(top==<span class="literal">NULL</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            item=top-&gt;data;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    ~LStack()</div><div class="line">    &#123;</div><div class="line">        LStackNode&lt;TL&gt;* p=top;</div><div class="line">        <span class="keyword">while</span>(top!=<span class="literal">NULL</span>)</div><div class="line">        &#123;</div><div class="line">            top=top-&gt;next;</div><div class="line">            <span class="keyword">delete</span> p;</div><div class="line">            p=top;</div><div class="line">        &#125;</div><div class="line">        top=p=<span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsEmpty</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> top==<span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> <span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//functions.h</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span>  _Functions_h_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>  _Functions_h_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="built_in">string</span> <span class="title">int_to_str</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</div><div class="line">            <span class="built_in">std</span>::<span class="built_in">stringstream</span> ss;</div><div class="line">            <span class="built_in">std</span>::<span class="built_in">string</span> str;</div><div class="line">            ss&lt;&lt;n;</div><div class="line">            ss&gt;&gt;str;</div><div class="line">        <span class="keyword">return</span> str;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">str_to_num1</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>*&amp; str)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>(!(str[<span class="number">0</span>]==<span class="string">'-'</span>||(str[<span class="number">0</span>]&gt;=<span class="string">'0'</span>&amp;&amp;str[<span class="number">0</span>]&lt;=<span class="string">'9'</span>)))&#123;</div><div class="line">        <span class="keyword">return</span> INT_MIN;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> n=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(str[n]!=<span class="string">'\0'</span>)&#123;</div><div class="line">        n++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> number=<span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(str[<span class="number">0</span>]!=<span class="string">'-'</span>)&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(!(str[i]&gt;=<span class="string">'0'</span>&amp;&amp;str[i]&lt;=<span class="string">'9'</span>))&#123;</div><div class="line">                <span class="keyword">return</span> INT_MIN;</div><div class="line">            &#125;</div><div class="line">            number+=(str[i]-<span class="string">'0'</span>)*<span class="built_in">pow</span>(<span class="number">10</span>,n-i<span class="number">-1</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(str[<span class="number">0</span>]==<span class="string">'-'</span>)&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(!(str[i]&gt;=<span class="string">'0'</span>&amp;&amp;str[i]&lt;=<span class="string">'9'</span>))&#123;</div><div class="line">                <span class="keyword">return</span> INT_MIN;</div><div class="line">            &#125;</div><div class="line">            number+=(str[i]-<span class="string">'0'</span>)*<span class="built_in">pow</span>(<span class="number">10</span>,n-i<span class="number">-1</span>);</div><div class="line">        &#125;</div><div class="line">        number*=<span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> number;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">str_to_num</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; str)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* data=str.c_str();</div><div class="line">    <span class="keyword">int</span> number=str_to_num1(data);</div><div class="line">    <span class="keyword">return</span> number;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h3 id="资源文件："><a href="#资源文件：" class="headerlink" title="资源文件："></a>资源文件：</h3><p>map.txt内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div></pre></td><td class="code"><pre><div class="line">94</div><div class="line">东门            学校正门                        1    974    182</div><div class="line">图书馆            一楼可自习，可通宵                        2    693    210</div><div class="line">计算机楼            计算机学院和软件学院公用实验教学楼                        3    665    335</div><div class="line">第三教学楼            一教二教不在本校区╮(╯_╰)╭                        4    739    277</div><div class="line">逸夫楼            公共教学楼                        5    585    147</div><div class="line">北门            最繁忙的学校大门                        6    528    25</div><div class="line">办公楼            行政人员办公楼                        7    528    219</div><div class="line">四食堂            最小食堂，却居于最重要位置                        8    420    252</div><div class="line">体育馆            大型活动举办地                        9    440    300</div><div class="line">体育运动场            主体育场                        10    325    277</div><div class="line">南苑            学生公寓                        11    380    460</div><div class="line">小北门            小校门                        12    365    129</div><div class="line">经信教学楼            经济信息学院教学楼                        13    149    448</div><div class="line">北苑            学生公寓                        14    215    169</div><div class="line">新食堂            食堂，有两层                        15    252    383</div><div class="line">李四光楼            地质教学楼                        16    34    343</div><div class="line">*            *                        17    202    427</div><div class="line">*            *                        18    213    245</div><div class="line">*            *                        19    261    237</div><div class="line">*            *                        20    249    194</div><div class="line">*            *                        21    475    235</div><div class="line">*            *                        22    346    200</div><div class="line">*            *                        23    388    183</div><div class="line">*            *                        24    399    321</div><div class="line">*            *                        25    299    362</div><div class="line">*            *                        26    447    157</div><div class="line">*            *                        27    497    276</div><div class="line">*            *                        28    529    352</div><div class="line">*            *                        29    649    297</div><div class="line">*            *                        30    759    210</div><div class="line">*            *                        31    651    211</div><div class="line">*            *                        32    545    256</div><div class="line">*            *                        33    978    10</div><div class="line">*            *                        34    439    140</div><div class="line">音乐厅            音乐厅                        35    489    125</div><div class="line">逸夫图书馆            校史陈列馆                        36    496    147</div><div class="line">麦克德尔米德实验室            实验室                        37    568    115</div><div class="line">*            *                        38    21    303</div><div class="line">*            *                        39    760    182</div><div class="line">唐敖庆楼            唐敖庆楼                        40    757    125</div><div class="line">*            *                        41    758    151</div><div class="line">*            *                        42    650    154</div><div class="line">*            *                        43    597    175</div><div class="line">*            *                        44    521    205</div><div class="line">外语楼            外语学院教学楼                        45    550    115</div><div class="line">篮球场            新食堂篮球场                        46    231    340</div><div class="line">匡亚明楼            匡亚明楼                        47    614    375</div><div class="line">*            *                        48    596    321</div><div class="line">南门            南门                        49    479    521</div><div class="line">*            *                        50    517    324</div><div class="line">莘子园食堂            莘子园食堂                        51    365    369</div><div class="line">*            *                        52    354    340</div><div class="line">*            *                        53    572    459</div><div class="line">*            *                        54    432    397</div><div class="line">*            *                        55    446    430</div><div class="line">*            *                        56    453    451</div><div class="line">*            *                        57    551    410</div><div class="line">*            *                        58    637    420</div><div class="line">*            *                        59    688    389</div><div class="line">*            *                        60    274    276</div><div class="line">*            *                        61    239    299</div><div class="line">*            *                        62    114    303</div><div class="line">*            *                        63    136    338</div><div class="line">*            *                        64    72    383</div><div class="line">*            *                        65    170    363</div><div class="line">*            *                        66    202    404</div><div class="line">*            *                        67    648    176</div><div class="line">*            *                        68    464    205</div><div class="line">*            *                        69    315    422</div><div class="line">*            *                        70    373    395</div><div class="line">*            *                        71    419    375</div><div class="line">*            *                        72    330    478</div><div class="line">*            *                        73    272    488</div><div class="line">*            *                        74    260    441</div><div class="line">*            *                        75    201    507</div><div class="line">*            *                        76    201    459</div><div class="line">经信公寓            经信公寓                        77    277    525</div><div class="line">*            *                        78    658    317</div><div class="line">*            *                        79    132    453</div><div class="line">西门            西门                        80    66    488</div><div class="line">物理楼            物理楼                        81    644    83</div><div class="line">生科楼            生命科学楼                        82    859    81</div><div class="line">*            *                        83    861    180</div><div class="line">*            *                        84    862    259</div><div class="line">东荣            0                        85    804    211</div><div class="line">数学楼            数学学院数学楼                        86    913    259</div><div class="line">*            *                        87    711    85</div><div class="line">*            *                        88    718    56</div><div class="line">*            *                        89    789    57</div><div class="line">*            *                        90    796    80</div><div class="line">*            *                        91    861    207</div><div class="line">*            *                        92    861    150</div><div class="line">*            *                        93    410    226</div><div class="line">*            *                        94    511    184</div><div class="line">1    33</div><div class="line">   83</div><div class="line">   30</div><div class="line">   31</div><div class="line">   59</div><div class="line">   78</div><div class="line">   29</div><div class="line">   30</div><div class="line">   78</div><div class="line">   85</div><div class="line">   37</div><div class="line">   43</div><div class="line">   12</div><div class="line">   33</div><div class="line">   35</div><div class="line">   37</div><div class="line">   81</div><div class="line">   21</div><div class="line">   32</div><div class="line">   44</div><div class="line">   9</div><div class="line">   21</div><div class="line">   93</div><div class="line">   8</div><div class="line">   24</div><div class="line">   27</div><div class="line">   50</div><div class="line">   19</div><div class="line">   22</div><div class="line">   24</div><div class="line">   25</div><div class="line">   55</div><div class="line">   72</div><div class="line">   6</div><div class="line">   20</div><div class="line">   23</div><div class="line">   34</div><div class="line">   17</div><div class="line">   79</div><div class="line">   20</div><div class="line">   38</div><div class="line">   25</div><div class="line">   66</div><div class="line">   20</div><div class="line">   38</div><div class="line">   62</div><div class="line">   64</div><div class="line">   13</div><div class="line">   66</div><div class="line">   76</div><div class="line">   19</div><div class="line">   62</div><div class="line">   10</div><div class="line">   18</div><div class="line">   20</div><div class="line">   22</div><div class="line">   60</div><div class="line">   12</div><div class="line">   14</div><div class="line">   16</div><div class="line">   19</div><div class="line">   7</div><div class="line">   8</div><div class="line">   26</div><div class="line">   27</div><div class="line">   10</div><div class="line">   19</div><div class="line">   23</div><div class="line">   24</div><div class="line">   12</div><div class="line">   22</div><div class="line">   26</div><div class="line">   93</div><div class="line">   9</div><div class="line">   10</div><div class="line">   22</div><div class="line">   52</div><div class="line">   71</div><div class="line">   10</div><div class="line">   15</div><div class="line">   52</div><div class="line">   60</div><div class="line">   69</div><div class="line">   21</div><div class="line">   23</div><div class="line">   34</div><div class="line">   9</div><div class="line">   21</div><div class="line">   32</div><div class="line">   50</div><div class="line">   48</div><div class="line">   50</div><div class="line">   53</div><div class="line">   54</div><div class="line">   4</div><div class="line">   31</div><div class="line">   32</div><div class="line">   48</div><div class="line">   78</div><div class="line">   2</div><div class="line">   4</div><div class="line">   39</div><div class="line">   85</div><div class="line">   2</div><div class="line">   29</div><div class="line">   32</div><div class="line">   43</div><div class="line">   67</div><div class="line">   7</div><div class="line">   27</div><div class="line">   29</div><div class="line">   31</div><div class="line">   1</div><div class="line">   6</div><div class="line">   12</div><div class="line">   26</div><div class="line">   35</div><div class="line">   6</div><div class="line">   34</div><div class="line">   36</div><div class="line">   35</div><div class="line">   45</div><div class="line">   94</div><div class="line">   5</div><div class="line">   6</div><div class="line">   45</div><div class="line">   81</div><div class="line">   14</div><div class="line">   16</div><div class="line">   30</div><div class="line">   40</div><div class="line">   41</div><div class="line">   67</div><div class="line">   83</div><div class="line">   39</div><div class="line">   39</div><div class="line">   42</div><div class="line">   92</div><div class="line">   41</div><div class="line">   43</div><div class="line">   67</div><div class="line">   81</div><div class="line">   5</div><div class="line">   31</div><div class="line">   42</div><div class="line">   44</div><div class="line">   67</div><div class="line">   7</div><div class="line">   43</div><div class="line">   94</div><div class="line">   36</div><div class="line">   37</div><div class="line">   61</div><div class="line">   66</div><div class="line">   48</div><div class="line">   58</div><div class="line">   28</div><div class="line">   29</div><div class="line">   47</div><div class="line">   53</div><div class="line">   56</div><div class="line">   9</div><div class="line">   27</div><div class="line">   28</div><div class="line">   52</div><div class="line">   70</div><div class="line">   24</div><div class="line">   25</div><div class="line">   51</div><div class="line">   28</div><div class="line">   49</div><div class="line">   58</div><div class="line">   28</div><div class="line">   55</div><div class="line">   71</div><div class="line">   11</div><div class="line">   54</div><div class="line">   56</div><div class="line">   49</div><div class="line">   55</div><div class="line">   57</div><div class="line">   56</div><div class="line">   47</div><div class="line">   53</div><div class="line">   59</div><div class="line">   3</div><div class="line">   58</div><div class="line">   19</div><div class="line">   25</div><div class="line">   61</div><div class="line">   46</div><div class="line">   60</div><div class="line">   65</div><div class="line">   16</div><div class="line">   18</div><div class="line">   63</div><div class="line">   62</div><div class="line">   64</div><div class="line">   65</div><div class="line">   16</div><div class="line">   63</div><div class="line">   79</div><div class="line">   61</div><div class="line">   63</div><div class="line">   66</div><div class="line">   15</div><div class="line">   17</div><div class="line">   46</div><div class="line">   65</div><div class="line">   31</div><div class="line">   39</div><div class="line">   42</div><div class="line">   43</div><div class="line">   93</div><div class="line">   94</div><div class="line">   25</div><div class="line">   70</div><div class="line">   72</div><div class="line">   74</div><div class="line">   51</div><div class="line">   69</div><div class="line">   71</div><div class="line">   24</div><div class="line">   54</div><div class="line">   70</div><div class="line">   11</div><div class="line">   69</div><div class="line">   73</div><div class="line">   72</div><div class="line">   74</div><div class="line">   75</div><div class="line">   77</div><div class="line">   69</div><div class="line">   73</div><div class="line">   76</div><div class="line">   73</div><div class="line">   76</div><div class="line">   17</div><div class="line">   74</div><div class="line">   75</div><div class="line">   73</div><div class="line">   3</div><div class="line">   4</div><div class="line">   29</div><div class="line">   13</div><div class="line">   64</div><div class="line">   80</div><div class="line">   79</div><div class="line">   6</div><div class="line">   37</div><div class="line">   42</div><div class="line">   87</div><div class="line">   90</div><div class="line">   92</div><div class="line">   1</div><div class="line">   39</div><div class="line">   91</div><div class="line">   92</div><div class="line">   86</div><div class="line">   91</div><div class="line">   4</div><div class="line">   30</div><div class="line">   91</div><div class="line">   84</div><div class="line">   81</div><div class="line">   88</div><div class="line">   87</div><div class="line">   89</div><div class="line">   88</div><div class="line">   90</div><div class="line">   82</div><div class="line">   89</div><div class="line">   83</div><div class="line">   84</div><div class="line">   85</div><div class="line">   41</div><div class="line">   82</div><div class="line">   83</div><div class="line">   8</div><div class="line">   23</div><div class="line">   68</div><div class="line">   36</div><div class="line">   44</div><div class="line">   68</div></pre></td></tr></table></figure>
<p>map.jpg</p>
<p><img src="/imgs/daoyou6.jpg" alt="map"></p>
<ul>
<li><p>大二上学期数据结构课程设计写此程序。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[五子棋估值算法]]></title>
      <url>http://maxuewei2.git.io/2015/09/21/%E4%BA%94%E5%AD%90%E6%A3%8B/</url>
      <content type="html"><![CDATA[<ul>
<li>目录<ul>
<li><a href="#buju">程序布局</a></li>
<li><a href="#guzhi">估值算法</a></li>
<li><a href="#chengguo">成果</a></li>
<li><a href="#daima">完整代码</a></li>
</ul>
</li>
</ul>
<a id="more"></a>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h2 id="程序布局"><a href="#程序布局" class="headerlink" title="程序布局"></a><h3 id="buju">程序布局</h3></h2><p>首先说明整个五子棋程序的整体布局。（用Java实现）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chess</span></span>&#123;    <span class="comment">//界面类</span></div><div class="line">　　Player player1 ;</div><div class="line">　　Player player2;</div><div class="line">　　ChessBox box;</div><div class="line">　　<span class="comment">//其余界面显示相关函数;</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span></span>&#123;</div><div class="line">　　<span class="keyword">int</span> code;　　<span class="comment">//代号　　1:选手1    2:选手2</span></div><div class="line">　　ChessBox box; 　</div><div class="line">　　<span class="function"><span class="keyword">abstract</span> Point <span class="title">play</span><span class="params">()</span></span>; <span class="comment">//落子操作  　</span></div><div class="line">　　<span class="function"><span class="keyword">int</span> <span class="title">getLine</span><span class="params">(Point p, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">extends</span> <span class="title">Player</span></span>&#123;</div><div class="line"> 　　<span class="function">Point <span class="title">play</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y )</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span> <span class="keyword">extends</span> <span class="title">Player</span></span>&#123;　　<span class="comment">//机器</span></div><div class="line">　　<span class="function"><span class="keyword">int</span> <span class="title">evaluate</span><span class="params">(Point, <span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</div><div class="line">　　<span class="function"><span class="keyword">int</span> <span class="title">Evaluate</span><span class="params">(Point)</span></span>;</div><div class="line">　　<span class="function">Point <span class="title">play</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChessBox</span></span>&#123;</div><div class="line">　　<span class="keyword">int</span> chess_flag[<span class="number">15</span>][<span class="number">15</span>] <span class="comment">//0:空     1:选手1    2:选手2</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h2 id="估值算法"><a href="#估值算法" class="headerlink" title="估值算法"></a><h3 id="guzhi">估值算法</h3></h2><h4 id="要求分析"><a href="#要求分析" class="headerlink" title="要求分析"></a>要求分析</h4><p>　　估值算法。要求给定棋盘上一个点，求出该点在当前棋局下的权值。若在该点落子后更容易接近胜利，则该点权值就高，越接近5子相连，权值越高。</p>
<p>　　则函数的形式为<code>int Evaluate(Point p);</code></p>
<p>　　首先考虑每个点有8个方向可以连子，每个方向上又有多种连子棋型，如活四、活三、死三等，而这些子又可能属于己方或者对方。活四与活三的权值自然不同。而同样是活三，己方的活三与对方的活三权值也不同，这样才能实现攻守的策略。假如现在棋局上同时有己方的活三和对方的活三，此时轮到我方落子，则正常情况下应当在己方活三上落子，使之成为活四，从而获胜。则计算机在判断棋局时，遇到己方活三，权值应当较高，遇到对方活三，权值应当较低。</p>
<p>　　以上即是对于估值函数所应达到的要求的分析。</p>
<h4 id="方向问题"><a href="#方向问题" class="headerlink" title="方向问题"></a>方向问题</h4><p>　　由于着眼处在于对棋型的判断，而不是方向，所以首先应该想个方法把方向问题先解决掉，这样在棋型判断时就能够对各个方向进行比较统一的处理，不至于棋型判断时对每个方向都写一段代码。</p>
<p>　　继续分析，在判断棋型时，着眼点在于棋子的相对位置，而常见棋型都呈线形排列，所以这个相对位置也就是顺序。相对位置、顺序，很容易想到要用一维的坐标解决。若取某一斜列（行、列），假设当前点的坐标为0，取右下（下、右、右上）为正方向，则在该斜列（行、列）上各点都能得到相应的坐标。如下图。</p>
<p><img src="/imgs/wuziqi1.png" alt="方向"></p>
<p>　　但若是同样的一维坐标，不同的方向，又会对应棋盘上不同的位置，也就是说，一维坐标转换到棋盘上的二维坐标，还需要一个方向。（额，想到这里，突然发现自己的思路明明就是极坐标啊。。。￣□￣｜｜………）</p>
<p>　　由此，我们需要达到这么一种要求：给定一个点、一个方向、一个相对坐标值，就能得到一个二维坐标，对应棋盘上一个点，进而可以获得任意一点的落子情况。所以我写了这么一个函数：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getLine</span><span class="params">(Point p,<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>;</div></pre></td></tr></table></figure></p>
<p>　　其中p为当前点，i为方向，取值为从1到8的整数，对应8个方向，j为相对于p点的坐标值。在函数体内要依据方向对p的x、y的值进行处理。返回该点的落子情况，0表示无子，1或2分别表示两个player，-1表示超出棋盘界。</p>
<p>　　代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getLine</span><span class="params">(Point p, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123; <span class="comment">// p：当前点  i：方向  j：坐标相对值</span></div><div class="line">         <span class="keyword">int</span> x = p.x, y = p.y;</div><div class="line">         <span class="keyword">switch</span> (i) &#123;　　<span class="comment">//对8个方向的处理</span></div><div class="line">            <span class="keyword">case</span> <span class="number">1</span> :</div><div class="line">                x = x + j;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">2</span> :</div><div class="line">                x = x + j;</div><div class="line">                y = y + j;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">           ...</div><div class="line">           ...</div><div class="line">            <span class="keyword">case</span> <span class="number">8</span> :</div><div class="line">                x = x + j;</div><div class="line">                y = y - j;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span> || y &lt; <span class="number">0</span> || x &gt; <span class="number">14</span> || y &gt; <span class="number">14</span>) &#123; <span class="comment">// 越界处理  返回-1</span></div><div class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> box.getFlag(x,y);</div><div class="line">      &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h4 id="棋型判断"><a href="#棋型判断" class="headerlink" title="棋型判断"></a>棋型判断</h4><p>　　对于方向的处理完成后，就是棋型的判断。判断棋型时需要区分当前所判断的棋型是哪一方的，假设当前所判断的棋型所属方的代号为plyer，则它的值可以是1或2，而要确定这个plyer是自己还是对方，就需要和自己的代号比对一下，假设自己的代号是me。则这个判断棋型的函数应该满足以下要求：给出一个点p，自己的代号me，一个plyer，能得出当前点对应plyer的权值。于是函数形式如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">evaluate</span><span class="params">(Point p, <span class="keyword">int</span> me,<span class="keyword">int</span> plyer)</span></span>;</div></pre></td></tr></table></figure></p>
<p>　　然后结合已有的算法结构，参考下图（网上找到的）</p>
<p><img src="/imgs/wuziqi2.png" alt="判断"></p>
<p>　　将棋型分为以下几种：</p>
<blockquote>
<table>
<thead>
<tr>
<th>棋型</th>
<th>编码</th>
</tr>
</thead>
<tbody>
<tr>
<td>活四</td>
<td>01111*</td>
</tr>
<tr>
<td>死四A</td>
<td>21111*</td>
</tr>
<tr>
<td>死四B</td>
<td>111*1</td>
</tr>
<tr>
<td>死四C</td>
<td>11*11</td>
</tr>
<tr>
<td>活三（近三位置）</td>
<td>111*0</td>
</tr>
<tr>
<td>活三（远三位置）</td>
<td>1110*</td>
</tr>
<tr>
<td>死三</td>
<td>11*1</td>
</tr>
</tbody>
</table>
<p>其中代号及含义如下：</p>
<table>
<thead>
<tr>
<th>代号</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td> *</td>
<td>当前空位置;</td>
</tr>
<tr>
<td> 0</td>
<td>其他空位置;</td>
</tr>
<tr>
<td> 1</td>
<td>plyer(当前所计算的player的代号);</td>
</tr>
<tr>
<td> 2</td>
<td>3 - plyer (对方的代号);</td>
</tr>
</tbody>
</table>
</blockquote>
<p>　　</p>
<p>此外由于两个或多个方向上都有活二的棋型较为常见且胜率较高（见下图）。所以又增加对此种棋型的判断。</p>
<p><img src="/imgs/wuziqi3.png" alt="活二"></p>
<p>　　即在每一个方向的棋型判断中扫描<code>011*0</code>或<code>111*0</code>并计数，若最终计数值大于等于2，则权值增加一个较大的数值，否则不增加。</p>
<p>　　</p>
<p>　　至此只要循环8次，每次循环中扫描各个棋型，并更新权值（设为value）即可。</p>
<p>　　代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">evaluate</span><span class="params">(Point p, <span class="keyword">int</span> me,<span class="keyword">int</span> plyer)</span> </span>&#123; <span class="comment">/* me:我的代号;　　plyer:当前计算的player的代号;*/</span></div><div class="line">        <span class="keyword">int</span> value = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> numoftwo=<span class="number">0</span>;</div><div class="line">　　　　 <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">8</span>; i++) &#123; <span class="comment">// 8个方向</span></div><div class="line">            <span class="comment">// 活四       01111*      *代表当前空位置    0代表其他空位置</span></div><div class="line">            <span class="keyword">if</span> (getLine(p, i, -<span class="number">1</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">2</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, -<span class="number">3</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">4</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, -<span class="number">5</span>) == <span class="number">0</span>) &#123;</div><div class="line">                value += <span class="number">300000</span>;</div><div class="line">                <span class="keyword">if</span>(me!=plyer)&#123;value-=<span class="number">500</span>;&#125;</div><div class="line">                System.out.print(<span class="string">"+ 300000"</span>);</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">         　　   &#125;</div><div class="line">　　　　　　　...</div><div class="line">            <span class="comment">//计算011*0或111*0的个数</span></div><div class="line">            <span class="keyword">if</span> (getLine(p, i, -<span class="number">1</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">2</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, -<span class="number">3</span>) != <span class="number">3</span>-plyer&amp;&amp;getLine(p,i,<span class="number">1</span>)!=<span class="number">3</span>-plyer) &#123;</div><div class="line">                numoftwo++;</div><div class="line">       　　　 　 &#125;</div><div class="line">　　　　　　  ...</div><div class="line">　　　　　　&#125;</div><div class="line">　　　　<span class="keyword">if</span>(numoftwo&gt;=<span class="number">2</span>)&#123;</div><div class="line">　　　　　　value+=<span class="number">3000</span>;</div><div class="line">　　　　　　<span class="keyword">if</span>(me!=plyer)&#123;</div><div class="line">　　　　　　　 value-=<span class="number">100</span>;</div><div class="line">　 　　　　  &#125;</div><div class="line">　　　   &#125;</div><div class="line">    <span class="keyword">return</span> value;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　其中每种棋型对value值所做的贡献要依据实际情况不断调整优化，优化不当就可能造成计算机放着活三不堵跑去堵活二了。。。</p>
<p>　　最终的估值函数<code>int Evaluate(Point p)</code>只要调用<code>int evaluate(Point p, int me,int plyer)</code>函数就可以获得p点的权值。</p>
<p>　　代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Evaluate</span><span class="params">(Point p)</span></span>&#123;</div><div class="line">	<span class="comment">//code是调用者的代号</span></div><div class="line">	<span class="keyword">return</span> evaluate(p,code,<span class="number">1</span>)+ evaluate(p,code,<span class="number">2</span>);　　</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h2 id="成果"><a href="#成果" class="headerlink" title="成果"></a><h3 id="chengguo">成果</h3></h2><p>　　最终程序核心算法只运用该估值算法，没有进行深度搜索。界面如下：</p>
<p><img src="/imgs/wuziqi4.png" alt="界面1"><br><img src="/imgs/wuziqi5.png" alt="界面2"></p>
<p>　　可见估值算法即便非常完美（当然这个算法离完美还差得远￣□￣｜｜），依然无法做到立于不败之地，因为往往会出现对方有多个接近连五，以至于堵都堵不住。所以博弈还是必须要深度搜索的。</p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码 "></a><h3 id="daima">完整代码 </h3></h2><p> 最后贴出自己写的估值算法完整的代码（仅供参考，正确性未经严格验证）：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Evaluate</span><span class="params">(Point p)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> evaluate(p, code,<span class="number">1</span>)</div><div class="line">                + evaluate(p, code,<span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">evaluate</span><span class="params">(Point p, <span class="keyword">int</span> me,<span class="keyword">int</span> plyer)</span> </span>&#123; <span class="comment">// me:我的代号  plyer:当前计算的player的代号</span></div><div class="line">        <span class="keyword">int</span> value = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> numoftwo=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">8</span>; i++) &#123; <span class="comment">// 8个方向</span></div><div class="line">            <span class="comment">// 活四 01111* *代表当前空位置  0代表其他空位置    下同</span></div><div class="line">            <span class="keyword">if</span> (getLine(p, i, -<span class="number">1</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">2</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, -<span class="number">3</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">4</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, -<span class="number">5</span>) == <span class="number">0</span>) &#123;</div><div class="line">                value += <span class="number">300000</span>;</div><div class="line">                <span class="keyword">if</span>(me!=plyer)&#123;value-=<span class="number">500</span>;&#125;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 死四A 21111*</span></div><div class="line">            <span class="keyword">if</span> (getLine(p, i, -<span class="number">1</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">2</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, -<span class="number">3</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">4</span>) == plyer</div><div class="line">                    &amp;&amp; (getLine(p, i, -<span class="number">5</span>) == <span class="number">3</span> - plyer||getLine(p, i, -<span class="number">5</span>) == -<span class="number">1</span>)) &#123;</div><div class="line">                value += <span class="number">250000</span>;</div><div class="line">                <span class="keyword">if</span>(me!=plyer)&#123;value-=<span class="number">500</span>;&#125;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 死四B 111*1</span></div><div class="line">            <span class="keyword">if</span> (getLine(p, i, -<span class="number">1</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">2</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, -<span class="number">3</span>) == plyer &amp;&amp; getLine(p, i, <span class="number">1</span>) == plyer) &#123;</div><div class="line">                value += <span class="number">240000</span>;</div><div class="line">                <span class="keyword">if</span>(me!=plyer)&#123;value-=<span class="number">500</span>;&#125;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 死四C 11*11</span></div><div class="line">            <span class="keyword">if</span> (getLine(p, i, -<span class="number">1</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">2</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, <span class="number">1</span>) == plyer &amp;&amp; getLine(p, i, <span class="number">2</span>) == plyer) &#123;</div><div class="line">                value += <span class="number">230000</span>;</div><div class="line">                <span class="keyword">if</span>(me!=plyer)&#123;value-=<span class="number">500</span>;&#125;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 活三 近3位置 111*0</span></div><div class="line">            <span class="keyword">if</span> (getLine(p, i, -<span class="number">1</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">2</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, -<span class="number">3</span>) == plyer) &#123;</div><div class="line">                <span class="keyword">if</span> (getLine(p, i, <span class="number">1</span>) == <span class="number">0</span>) &#123;</div><div class="line">                    value += <span class="number">750</span>;</div><div class="line">                    <span class="keyword">if</span> (getLine(p, i, -<span class="number">4</span>) == <span class="number">0</span>) &#123;</div><div class="line">                        value += <span class="number">3150</span>;</div><div class="line">                        <span class="keyword">if</span>(me!=plyer)&#123;value-=<span class="number">300</span>;&#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> ((getLine(p, i, <span class="number">1</span>) == <span class="number">3</span> - plyer||getLine(p, i, <span class="number">1</span>) == -<span class="number">1</span>) &amp;&amp; getLine(p, i, -<span class="number">4</span>) == <span class="number">0</span>) &#123;</div><div class="line">                    value += <span class="number">500</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 活三 远3位置 1110*</span></div><div class="line">            <span class="keyword">if</span> (getLine(p, i, -<span class="number">1</span>) == <span class="number">0</span> &amp;&amp; getLine(p, i, -<span class="number">2</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, -<span class="number">3</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">4</span>) == plyer) &#123;</div><div class="line">                value += <span class="number">350</span>;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 死三 11*1</span></div><div class="line">            <span class="keyword">if</span> (getLine(p, i, -<span class="number">1</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">2</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, <span class="number">1</span>) == plyer) &#123;</div><div class="line">                value += <span class="number">600</span>;</div><div class="line">                <span class="keyword">if</span> (getLine(p, i, -<span class="number">3</span>) == <span class="number">0</span> &amp;&amp; getLine(p, i, <span class="number">2</span>) == <span class="number">0</span>) &#123;</div><div class="line">                    value += <span class="number">3150</span>;</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> ((getLine(p, i, -<span class="number">3</span>) == <span class="number">3</span> - plyer||getLine(p, i, -<span class="number">3</span>) == -<span class="number">1</span>) &amp;&amp; (getLine(p, i, <span class="number">2</span>) == <span class="number">3</span> - plyer||getLine(p, i, <span class="number">2</span>) == -<span class="number">1</span>)) &#123;</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    value += <span class="number">700</span>;</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//活二的个数</span></div><div class="line">            <span class="keyword">if</span> (getLine(p, i, -<span class="number">1</span>) == plyer &amp;&amp; getLine(p, i, -<span class="number">2</span>) == plyer</div><div class="line">                    &amp;&amp; getLine(p, i, -<span class="number">3</span>) != <span class="number">3</span>-plyer&amp;&amp;getLine(p,i,<span class="number">1</span>)!=<span class="number">3</span>-plyer) &#123;</div><div class="line">                numoftwo++;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//其余散棋</span></div><div class="line">            <span class="keyword">int</span> numOfplyer = <span class="number">0</span>; <span class="comment">// 因为方向会算两次？</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = -<span class="number">4</span>; k &lt;= <span class="number">0</span>; k++) &#123; <span class="comment">// ++++* +++*+ ++*++ +*+++ *++++</span></div><div class="line">                <span class="keyword">int</span> temp = <span class="number">0</span>;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt;= <span class="number">4</span>; l++) &#123;</div><div class="line">                    <span class="keyword">if</span> (getLine(p, i, k + l) == plyer) &#123;</div><div class="line">                        temp++;</div><div class="line">                    &#125; <span class="keyword">else</span></div><div class="line">                        <span class="keyword">if</span> (getLine(p, i, k + l) == <span class="number">3</span> - plyer</div><div class="line">                                || getLine(p, i, k + l) == -<span class="number">1</span>) &#123;</div><div class="line">                        temp = <span class="number">0</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                numOfplyer += temp;</div><div class="line">            &#125;</div><div class="line">            value += numOfplyer * <span class="number">15</span>;</div><div class="line">            <span class="keyword">if</span> (numOfplyer != <span class="number">0</span>) &#123;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(numoftwo&gt;=<span class="number">2</span>)&#123;</div><div class="line">            value+=<span class="number">3000</span>;</div><div class="line">            <span class="keyword">if</span>(me!=plyer)&#123;</div><div class="line">                value-=<span class="number">100</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getLine</span><span class="params">(Point p, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123; <span class="comment">// i:方向 j:相对p的顺序值（以p为0） p:当前点</span></div><div class="line">        <span class="keyword">int</span> x = p.x, y = p.y;</div><div class="line">        <span class="keyword">switch</span> (i) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="number">1</span> :</div><div class="line">                x = x + j;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">2</span> :</div><div class="line">                x = x + j;</div><div class="line">                y = y + j;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">3</span> :</div><div class="line">                y = y + j;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">4</span> :</div><div class="line">                x = x - j;</div><div class="line">                y = y + j;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">5</span> :</div><div class="line">                x = x - j;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">6</span> :</div><div class="line">                x = x - j;</div><div class="line">                y = y - j;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">7</span> :</div><div class="line">                y = y - j;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">8</span> :</div><div class="line">                x = x + j;</div><div class="line">                y = y - j;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span> || y &lt; <span class="number">0</span> || x &gt; <span class="number">14</span> || y &gt; <span class="number">14</span>) &#123; <span class="comment">// 越界处理</span></div><div class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> box.getFlag(x,y);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>2015.9.21 10:53</li>
</ul>
]]></content>
    </entry>
    
  
  
</search>
