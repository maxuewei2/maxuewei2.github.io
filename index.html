<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="做一个优雅的变态...">
<meta property="og:type" content="website">
<meta property="og:title" content="maxuewei2">
<meta property="og:url" content="http://maxuewei2.git.io/index.html">
<meta property="og:site_name" content="maxuewei2">
<meta property="og:description" content="做一个优雅的变态...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="maxuewei2">
<meta name="twitter:description" content="做一个优雅的变态...">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://maxuewei2.git.io/"/>


  <title> maxuewei2 </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">maxuewei2</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Xlc Love Coding</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/28/FirstPost/" itemprop="url">
                  开始使用GitHub Pages
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-28T22:15:59+08:00" content="2016-10-28">
              2016-10-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/生活/" itemprop="url" rel="index">
                    <span itemprop="name">生活</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开始使用GitHub Pages，并使用Hexo。</p>
<ul>
<li>2016.10.28 22:17</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/22/近期学到的/" itemprop="url">
                  近期学到的
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-22T16:53:59+08:00" content="2016-10-22">
              2016-10-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h4><p>　　编辑器使用Remarkable</p>
<p>　　语法，参考Remarkable帮助里的Tutorial</p>
<h4 id="Mathjax"><a href="#Mathjax" class="headerlink" title="Mathjax"></a>Mathjax</h4><p><a href="http://mlworks.cn/posts/introduction-to-mathjax-and-latex-expression/" target="_blank" rel="external">Mathjax语法简介</a></p>
<h4 id="Sphinx"><a href="#Sphinx" class="headerlink" title="Sphinx"></a>Sphinx</h4><p>使用docstring生成APIdoc</p>
<p>　　<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$sphinx</span>-apidoc -o /home/me/outdir -F /home/me/code</div></pre></td></tr></table></figure></p>
<p>　　　<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cd</span> /home/me/outdir</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$gedit</span> conf.py</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line">sys.path.insert(<span class="number">0</span>, os.path.abspath(<span class="string">'../..'</span>))</div><div class="line">....</div><div class="line">....</div></pre></td></tr></table></figure>
<h4 id="reStructuredText"><a href="#reStructuredText" class="headerlink" title="reStructuredText"></a>reStructuredText</h4><p><a href="http://zh-sphinx-doc.readthedocs.io/en/latest/rest.html" target="_blank" rel="external">reStructuredText语法简介</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/12/重定向/" itemprop="url">
                  重定向
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-12T21:31:59+08:00" content="2016-09-12">
              2016-09-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Linux 终端:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cat testin.txt|./<span class="built_in">test</span></div><div class="line"></div><div class="line">./<span class="built_in">test</span>&gt;testout.txt</div><div class="line"></div><div class="line">cat testin.txt|./<span class="built_in">test</span>&gt;testout.txt</div></pre></td></tr></table></figure></p>
<p>　　</p>
<p>Windows cmd:　　　　<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">　　test.exe&lt;testin.txt</div><div class="line"></div><div class="line">　　test.exe&gt;testout.txt</div><div class="line"></div><div class="line">　　test.exe&lt;testin.txt&gt;testout.txt</div></pre></td></tr></table></figure></p>
<p>C代码：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">freopen(<span class="string">"testin.txt"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line"></div><div class="line">fclose(<span class="built_in">stdin</span>);</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">freopen(<span class="string">"testout.txt"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line"></div><div class="line">fclose(<span class="built_in">stdout</span>);</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/11/CCF记录/" itemprop="url">
                  CCF考试
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-11T20:40:50+08:00" content="2016-09-11">
              2016-09-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>第八次CCF考试记录</p>
<p>代码还不知道对不对，过两天出成绩。</p>
<blockquote>
<p>成绩出来了，310分。</p>
<p>100+100+100+10+0；</p>
</blockquote>
<p>考试13:27开始，17:30结束，提交第4题后不再答题，只是检查前四题的代码</p>
<p>第一次提交：<br>1 13:34<br>2 14:00左右<br>3 15:32<br>4 16:56<br>5</p>
<p>最后一次提交：<br>1 13:34<br>2 16:06<br>3 15:32<br>4 16:56<br>5</p>
<p>代码行数（不算空行，算无用的include，算注释掉的部分）<br>1 23<br>2 50<br>3 101<br>4 71<br>5<br>共 245 行</p>
<h3 id="源代码："><a href="#源代码：" class="headerlink" title="源代码："></a>源代码：</h3><p>1<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;n;</div><div class="line">    <span class="keyword">int</span> * a=<span class="keyword">new</span> <span class="keyword">int</span>[n];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">        <span class="built_in">cin</span>&gt;&gt;a[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> m=<span class="number">-99999</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</div><div class="line">        <span class="keyword">int</span> t=a[i]-a[i<span class="number">-1</span>];</div><div class="line">        t=t&gt;<span class="number">0</span>?t:<span class="number">0</span>-t;</div><div class="line">        m=m&lt;t?t:m;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;m;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> * a=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">20</span>];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</div><div class="line">        a[i]=<span class="number">5</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> n,t;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;n;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">        <span class="built_in">cin</span>&gt;&gt;t;</div><div class="line">        <span class="keyword">int</span> flag=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(a[i]&gt;=t)&#123;</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;t;j++)&#123;</div><div class="line">                    <span class="built_in">cout</span>&lt;&lt;i*<span class="number">5</span>+<span class="number">5</span>-a[i]+j+<span class="number">1</span>&lt;&lt;<span class="string">" "</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">                a[i]-=t;</div><div class="line">                flag=<span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(flag==<span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</div><div class="line">                <span class="keyword">if</span>(a[i]-t&gt;<span class="number">0</span>)&#123;</div><div class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;t;j++)&#123;</div><div class="line">                        <span class="built_in">cout</span>&lt;&lt;i*<span class="number">5</span>+<span class="number">5</span>-a[i]+j+<span class="number">1</span>&lt;&lt;<span class="string">" "</span>;</div><div class="line">                    &#125;</div><div class="line">                    a[i]-=t;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;a[i];j++)&#123;</div><div class="line">                        <span class="built_in">cout</span>&lt;&lt;i*<span class="number">5</span>+<span class="number">5</span>-a[i]+j+<span class="number">1</span>&lt;&lt;<span class="string">" "</span>;</div><div class="line">                    &#125;</div><div class="line">                    t-=a[i];</div><div class="line">                    a[i]=<span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">delete</span> []a;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>3<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">struct</span> suicong&#123;</div><div class="line">    <span class="keyword">int</span> hth;</div><div class="line">    <span class="keyword">int</span> att;</div><div class="line">    suicong(<span class="keyword">int</span> h,<span class="keyword">int</span> a)&#123;</div><div class="line">        hth=h;</div><div class="line">        att=a;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">struct</span> ying&#123;</div><div class="line">    <span class="keyword">int</span> hth;</div><div class="line">    <span class="keyword">int</span> att;</div><div class="line">    ying()&#123;</div><div class="line">        hth=<span class="number">30</span>;</div><div class="line">        att=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</div><div class="line">    <span class="built_in">vector</span>&lt;suicong&gt;* war=<span class="keyword">new</span> <span class="built_in">vector</span>&lt;suicong&gt;[<span class="number">2</span>];</div><div class="line">    <span class="comment">//vector&lt;suicong&gt; war0;</span></div><div class="line">    <span class="comment">//vector&lt;suicong&gt; war1;</span></div><div class="line">    <span class="comment">//suicong* ying0=new suicong(30,0,1);</span></div><div class="line">    <span class="comment">//suicong* ying1=new suicong(30,0,1);</span></div><div class="line">    ying ying[<span class="number">2</span>];</div><div class="line">    <span class="comment">//war[0].push_back(*ying0);</span></div><div class="line">    <span class="comment">//war[1].push_back(*ying1);</span></div><div class="line">    <span class="keyword">int</span> n;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;n;</div><div class="line">    <span class="keyword">int</span> t=<span class="number">0</span>;</div><div class="line">    <span class="comment">//int y[2];</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</div><div class="line">        <span class="built_in">string</span> str;</div><div class="line">        <span class="built_in">cin</span>&gt;&gt;str;</div><div class="line">        <span class="keyword">if</span>(str==<span class="string">"summon"</span>)&#123;</div><div class="line">            <span class="keyword">int</span> p,h,a;</div><div class="line">            <span class="built_in">cin</span>&gt;&gt;p&gt;&gt;a&gt;&gt;h;</div><div class="line">            suicong* temp=<span class="keyword">new</span> suicong(h,a);</div><div class="line">            war[t].insert(war[t].begin()+p<span class="number">-1</span>,*temp);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(str==<span class="string">"attack"</span>)&#123;</div><div class="line">            <span class="keyword">int</span> d,a;</div><div class="line">            <span class="built_in">cin</span>&gt;&gt;a&gt;&gt;d;</div><div class="line">            <span class="keyword">if</span>(d==<span class="number">0</span>)&#123;</div><div class="line">                ying[<span class="number">1</span>-t].hth-=war[t].at(a<span class="number">-1</span>).att;</div><div class="line">                war[t].at(a<span class="number">-1</span>).hth-=ying[<span class="number">1</span>-t].att;</div><div class="line">                <span class="keyword">if</span>(war[t].at(a<span class="number">-1</span>).hth&lt;=<span class="number">0</span>)&#123;</div><div class="line">                    war[t].erase(war[t].begin()+a<span class="number">-1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span>&#123;</div><div class="line">                <span class="comment">//cout&lt;&lt;t&lt;&lt;" "&lt;&lt;war[t].size()&lt;&lt;" "&lt;&lt;war[1-t].size();</span></div><div class="line">                war[<span class="number">1</span>-t].at(d<span class="number">-1</span>).hth-=war[t].at(a<span class="number">-1</span>).att;</div><div class="line">                war[t].at(a<span class="number">-1</span>).hth-=war[<span class="number">1</span>-t].at(d<span class="number">-1</span>).att;</div><div class="line">                <span class="keyword">if</span>(war[t].at(a<span class="number">-1</span>).hth&lt;=<span class="number">0</span>)&#123;</div><div class="line">                    war[t].erase(war[t].begin()+a<span class="number">-1</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(war[<span class="number">1</span>-t].at(d<span class="number">-1</span>).hth&lt;=<span class="number">0</span>)&#123;</div><div class="line">                    war[<span class="number">1</span>-t].erase(war[<span class="number">1</span>-t].begin()+d<span class="number">-1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(str==<span class="string">"end"</span>)&#123;</div><div class="line">            t=<span class="number">1</span>-t;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*cout&lt;&lt;0&lt;&lt;" "&lt;&lt;ying[0].hth&lt;&lt;" "&lt;&lt;war[0].size()&lt;&lt;" ";</span></div><div class="line">        for(int i=0;i&lt;war[0].size();i++)&#123;</div><div class="line">            cout&lt;&lt;war[0].at(i).hth&lt;&lt;" ";</div><div class="line">        &#125;cout&lt;&lt;endl;</div><div class="line">        cout&lt;&lt;1&lt;&lt;" "&lt;&lt;ying[1].hth&lt;&lt;" "&lt;&lt;war[1].size()&lt;&lt;" ";</div><div class="line">        for(int i=0;i&lt;war[1].size();i++)&#123;</div><div class="line">            cout&lt;&lt;war[1].at(i).hth&lt;&lt;" ";</div><div class="line">        &#125;cout&lt;&lt;endl;*/</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(ying[<span class="number">0</span>].hth&lt;=<span class="number">0</span>)&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;<span class="keyword">else</span></div><div class="line">    <span class="keyword">if</span>(ying[<span class="number">1</span>].hth&lt;=<span class="number">0</span>)&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="number">1</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;ying[<span class="number">0</span>].hth&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;war[<span class="number">0</span>].size()&lt;&lt;<span class="string">" "</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;war[<span class="number">0</span>].size();i++)&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;war[<span class="number">0</span>].at(i).hth&lt;&lt;<span class="string">" "</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;ying[<span class="number">1</span>].hth&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;war[<span class="number">1</span>].size()&lt;&lt;<span class="string">" "</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;war[<span class="number">1</span>].size();i++)&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;war[<span class="number">1</span>].at(i).hth&lt;&lt;<span class="string">" "</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4</p>
<blockquote>
<p>此代码是错误的<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">struct</span> road&#123;</div><div class="line">    <span class="keyword">int</span> to;</div><div class="line">    <span class="keyword">int</span> len;</div><div class="line">    road(<span class="keyword">int</span> t,<span class="keyword">int</span> l)&#123;</div><div class="line">        to=t;len=l;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">struct</span> city&#123;</div><div class="line">    <span class="comment">//int num;</span></div><div class="line">    <span class="keyword">int</span> pre=<span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> tlen=<span class="number">999999999</span>;</div><div class="line">    <span class="built_in">vector</span>&lt;road&gt; v;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addroad</span><span class="params">(<span class="keyword">int</span> t,<span class="keyword">int</span> len)</span></span>&#123;</div><div class="line">        road* r=<span class="keyword">new</span> road(t,len);</div><div class="line">        v.push_back(*r);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(city* cs,<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;cs[i].v.size();k++)&#123;</div><div class="line">        <span class="keyword">if</span>(cs[i].v.at(k).to==j)<span class="keyword">return</span> cs[i].v.at(k).len;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n,m;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;n&gt;&gt;m;</div><div class="line">    city* cs=<span class="keyword">new</span> city[n+<span class="number">1</span>];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</div><div class="line">        <span class="keyword">int</span> a,b,c;</div><div class="line">        <span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b&gt;&gt;c;</div><div class="line">        cs[a].addroad(b,c);</div><div class="line">        cs[b].addroad(a,c);</div><div class="line">    &#125;</div><div class="line">    cs[<span class="number">1</span>].tlen=<span class="number">0</span>;</div><div class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</div><div class="line">    q.push(<span class="number">1</span>);</div><div class="line">    <span class="keyword">while</span>(!q.empty())&#123;</div><div class="line">        <span class="keyword">int</span> t=q.front();</div><div class="line">        q.pop();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;cs[t].v.size();i++)&#123;</div><div class="line">            <span class="keyword">if</span>(cs[cs[t].v.at(i).to].tlen&gt;cs[t].tlen+cs[t].v.at(i).len)&#123;</div><div class="line">                cs[cs[t].v.at(i).to].tlen=cs[t].tlen+cs[t].v.at(i).len;</div><div class="line">                cs[cs[t].v.at(i).to].pre=t;</div><div class="line">                q.push(cs[t].v.at(i).to);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(cs[cs[t].v.at(i).to].tlen==cs[t].tlen+cs[t].v.at(i).len)&#123;</div><div class="line">                <span class="keyword">if</span>(get(cs,cs[cs[t].v.at(i).to].pre,cs[t].v.at(i).to)&gt;cs[t].v.at(i).len)&#123;</div><div class="line">                    cs[cs[t].v.at(i).to].tlen=cs[t].tlen+cs[t].v.at(i).len;</div><div class="line">                    cs[cs[t].v.at(i).to].pre=t;</div><div class="line">                    q.push(cs[t].v.at(i).to);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="comment">/*    for(int i=0;i&lt;n+1;i++)&#123;</span></div><div class="line">        cout&lt;&lt;i&lt;&lt;" "&lt;&lt;cs[i].pre&lt;&lt;" "&lt;&lt;get(cs,i,cs[i].pre)&lt;&lt;endl;</div><div class="line">    &#125;*/</div><div class="line">    <span class="keyword">int</span> ll=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n+<span class="number">1</span>;i++)&#123;</div><div class="line">        ll+=get(cs,i,cs[i].pre);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;ll;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li>2016.9.11 晚8:40</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/13/简单的词法分析和语法分析/" itemprop="url">
                  简单的词法分析和语法分析（C++实现，CodeBlocks+GCC编译）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-13T11:35:59+08:00" content="2016-07-13">
              2016-07-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h3><p>　　分析的语言是SNL语言，详见《编译程序的设计与实现》（ 刘磊、金英、张晶、张荷花、单郸编著）</p>
<p>　　词法分析就是实现了词法分析的自动机</p>
<p>　　语法分析使用递归下降法</p>
<h3 id="运行结果："><a href="#运行结果：" class="headerlink" title="运行结果："></a>运行结果：</h3><p>　　词法分析 得到TokenList</p>
<p>　　语法分析 输出语法树</p>
<p>　　</p>
<h4 id="运行输出："><a href="#运行输出：" class="headerlink" title="运行输出："></a>运行输出：</h4><p><img src="/imgs/cifafenxi.png" alt="shuchu"></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><p>main.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div><div class="line">815</div><div class="line">816</div><div class="line">817</div><div class="line">818</div><div class="line">819</div><div class="line">820</div><div class="line">821</div><div class="line">822</div><div class="line">823</div><div class="line">824</div><div class="line">825</div><div class="line">826</div><div class="line">827</div><div class="line">828</div><div class="line">829</div><div class="line">830</div><div class="line">831</div><div class="line">832</div><div class="line">833</div><div class="line">834</div><div class="line">835</div><div class="line">836</div><div class="line">837</div><div class="line">838</div><div class="line">839</div><div class="line">840</div><div class="line">841</div><div class="line">842</div><div class="line">843</div><div class="line">844</div><div class="line">845</div><div class="line">846</div><div class="line">847</div><div class="line">848</div><div class="line">849</div><div class="line">850</div><div class="line">851</div><div class="line">852</div><div class="line">853</div><div class="line">854</div><div class="line">855</div><div class="line">856</div><div class="line">857</div><div class="line">858</div><div class="line">859</div><div class="line">860</div><div class="line">861</div><div class="line">862</div><div class="line">863</div><div class="line">864</div><div class="line">865</div><div class="line">866</div><div class="line">867</div><div class="line">868</div><div class="line">869</div><div class="line">870</div><div class="line">871</div><div class="line">872</div><div class="line">873</div><div class="line">874</div><div class="line">875</div><div class="line">876</div><div class="line">877</div><div class="line">878</div><div class="line">879</div><div class="line">880</div><div class="line">881</div><div class="line">882</div><div class="line">883</div><div class="line">884</div><div class="line">885</div><div class="line">886</div><div class="line">887</div><div class="line">888</div><div class="line">889</div><div class="line">890</div><div class="line">891</div><div class="line">892</div><div class="line">893</div><div class="line">894</div><div class="line">895</div><div class="line">896</div><div class="line">897</div><div class="line">898</div><div class="line">899</div><div class="line">900</div><div class="line">901</div><div class="line">902</div><div class="line">903</div><div class="line">904</div><div class="line">905</div><div class="line">906</div><div class="line">907</div><div class="line">908</div><div class="line">909</div><div class="line">910</div><div class="line">911</div><div class="line">912</div><div class="line">913</div><div class="line">914</div><div class="line">915</div><div class="line">916</div><div class="line">917</div><div class="line">918</div><div class="line">919</div><div class="line">920</div><div class="line">921</div><div class="line">922</div><div class="line">923</div><div class="line">924</div><div class="line">925</div><div class="line">926</div><div class="line">927</div><div class="line">928</div><div class="line">929</div><div class="line">930</div><div class="line">931</div><div class="line">932</div><div class="line">933</div><div class="line">934</div><div class="line">935</div><div class="line">936</div><div class="line">937</div><div class="line">938</div><div class="line">939</div><div class="line">940</div><div class="line">941</div><div class="line">942</div><div class="line">943</div><div class="line">944</div><div class="line">945</div><div class="line">946</div><div class="line">947</div><div class="line">948</div><div class="line">949</div><div class="line">950</div><div class="line">951</div><div class="line">952</div><div class="line">953</div><div class="line">954</div><div class="line">955</div><div class="line">956</div><div class="line">957</div><div class="line">958</div><div class="line">959</div><div class="line">960</div><div class="line">961</div><div class="line">962</div><div class="line">963</div><div class="line">964</div><div class="line">965</div><div class="line">966</div><div class="line">967</div><div class="line">968</div><div class="line">969</div><div class="line">970</div><div class="line">971</div><div class="line">972</div><div class="line">973</div><div class="line">974</div><div class="line">975</div><div class="line">976</div><div class="line">977</div><div class="line">978</div><div class="line">979</div><div class="line">980</div><div class="line">981</div><div class="line">982</div><div class="line">983</div><div class="line">984</div><div class="line">985</div><div class="line">986</div><div class="line">987</div><div class="line">988</div><div class="line">989</div><div class="line">990</div><div class="line">991</div><div class="line">992</div><div class="line">993</div><div class="line">994</div><div class="line">995</div><div class="line">996</div><div class="line">997</div><div class="line">998</div><div class="line">999</div><div class="line">1000</div><div class="line">1001</div><div class="line">1002</div><div class="line">1003</div><div class="line">1004</div><div class="line">1005</div><div class="line">1006</div><div class="line">1007</div><div class="line">1008</div><div class="line">1009</div><div class="line">1010</div><div class="line">1011</div><div class="line">1012</div><div class="line">1013</div><div class="line">1014</div><div class="line">1015</div><div class="line">1016</div><div class="line">1017</div><div class="line">1018</div><div class="line">1019</div><div class="line">1020</div><div class="line">1021</div><div class="line">1022</div><div class="line">1023</div><div class="line">1024</div><div class="line">1025</div><div class="line">1026</div><div class="line">1027</div><div class="line">1028</div><div class="line">1029</div><div class="line">1030</div><div class="line">1031</div><div class="line">1032</div><div class="line">1033</div><div class="line">1034</div><div class="line">1035</div><div class="line">1036</div><div class="line">1037</div><div class="line">1038</div><div class="line">1039</div><div class="line">1040</div><div class="line">1041</div><div class="line">1042</div><div class="line">1043</div><div class="line">1044</div><div class="line">1045</div><div class="line">1046</div><div class="line">1047</div><div class="line">1048</div><div class="line">1049</div><div class="line">1050</div><div class="line">1051</div><div class="line">1052</div><div class="line">1053</div><div class="line">1054</div><div class="line">1055</div><div class="line">1056</div><div class="line">1057</div><div class="line">1058</div><div class="line">1059</div><div class="line">1060</div><div class="line">1061</div><div class="line">1062</div><div class="line">1063</div><div class="line">1064</div><div class="line">1065</div><div class="line">1066</div><div class="line">1067</div><div class="line">1068</div><div class="line">1069</div><div class="line">1070</div><div class="line">1071</div><div class="line">1072</div><div class="line">1073</div><div class="line">1074</div><div class="line">1075</div><div class="line">1076</div><div class="line">1077</div><div class="line">1078</div><div class="line">1079</div><div class="line">1080</div><div class="line">1081</div><div class="line">1082</div><div class="line">1083</div><div class="line">1084</div><div class="line">1085</div><div class="line">1086</div><div class="line">1087</div><div class="line">1088</div><div class="line">1089</div><div class="line">1090</div><div class="line">1091</div><div class="line">1092</div><div class="line">1093</div><div class="line">1094</div><div class="line">1095</div><div class="line">1096</div><div class="line">1097</div><div class="line">1098</div><div class="line">1099</div><div class="line">1100</div><div class="line">1101</div><div class="line">1102</div><div class="line">1103</div><div class="line">1104</div><div class="line">1105</div><div class="line">1106</div><div class="line">1107</div><div class="line">1108</div><div class="line">1109</div><div class="line">1110</div><div class="line">1111</div><div class="line">1112</div><div class="line">1113</div><div class="line">1114</div><div class="line">1115</div><div class="line">1116</div><div class="line">1117</div><div class="line">1118</div><div class="line">1119</div><div class="line">1120</div><div class="line">1121</div><div class="line">1122</div><div class="line">1123</div><div class="line">1124</div><div class="line">1125</div><div class="line">1126</div><div class="line">1127</div><div class="line">1128</div><div class="line">1129</div><div class="line">1130</div><div class="line">1131</div><div class="line">1132</div><div class="line">1133</div><div class="line">1134</div><div class="line">1135</div><div class="line">1136</div><div class="line">1137</div><div class="line">1138</div><div class="line">1139</div><div class="line">1140</div><div class="line">1141</div><div class="line">1142</div><div class="line">1143</div><div class="line">1144</div><div class="line">1145</div><div class="line">1146</div><div class="line">1147</div><div class="line">1148</div><div class="line">1149</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMOFRESERVED 22</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMOFSYMBOLS 20</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RES 0</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ID 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NUM 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SYM 3</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> STR 4</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PLUS 100</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SUB 101</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MUL 102</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DIV 103</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LT 104</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LBRACK 105</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RBRACK 106</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LSQUBRACK 107</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RSQUBRACK 108</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> POINT 109</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SEMI 110</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LBRACE 111</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RBRACE 112</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> EOFF 113</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BLANK 114</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> QUO 115</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> EQU 116</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INDEX 117</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ASSI 118</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> COM 119</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> uint unsigned</span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> Token &#123;</div><div class="line">    <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">int</span> ptr;</div><div class="line">    <span class="keyword">int</span> linenum;</div><div class="line">&#125; Token;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> Node &#123;</div><div class="line">    <span class="keyword">char</span> *desc;</div><div class="line">    <span class="built_in">vector</span>&lt;Node*&gt; children;</div><div class="line">    Node(<span class="keyword">const</span> <span class="keyword">char</span>* str) &#123;</div><div class="line">        desc=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">30</span>];</div><div class="line">        <span class="built_in">strcpy</span>(desc,str);</div><div class="line">    &#125;</div><div class="line">&#125; Node;</div><div class="line"></div><div class="line"><span class="built_in">vector</span>&lt;Token&gt;* tokens;</div><div class="line"><span class="keyword">int</span> Token_n=<span class="number">0</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span>* reserved_words[NUMOFRESERVED]= &#123;<span class="string">"begin"</span>,<span class="string">"end"</span>,<span class="string">"program"</span>,<span class="string">"var"</span>,</div><div class="line">                                            <span class="string">"type"</span>,<span class="string">"procedure"</span>,<span class="string">"while"</span>,<span class="string">"endwh"</span>,</div><div class="line">                                            <span class="string">"integer"</span>,<span class="string">"char"</span>,<span class="string">"array"</span>,<span class="string">"of"</span>,</div><div class="line">                                            <span class="string">"intc"</span>,<span class="string">"record"</span>,<span class="string">"if"</span>,<span class="string">"then"</span>,</div><div class="line">                                            <span class="string">"else"</span>,<span class="string">"fi"</span>,<span class="string">"do"</span>,<span class="string">"write"</span>,</div><div class="line">                                            <span class="string">"read"</span>,<span class="string">"return"</span></div><div class="line">                                           &#125;;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span>* symbol_table[NUMOFSYMBOLS]= &#123;<span class="string">"+"</span>,<span class="string">"-"</span>,<span class="string">"*"</span>,<span class="string">"/"</span>,<span class="string">"&lt;"</span>,</div><div class="line">                                                <span class="string">"("</span>,<span class="string">")"</span>,<span class="string">"["</span>,<span class="string">"]"</span>,<span class="string">"."</span>,</div><div class="line">                                                <span class="string">";"</span>,<span class="string">"&#123;"</span>,<span class="string">"&#125;"</span>,<span class="string">"EOF"</span>,<span class="string">"BLANK"</span>,</div><div class="line">                                                <span class="string">"\'"</span>,<span class="string">"="</span>,<span class="string">".."</span>,<span class="string">":="</span>,<span class="string">","</span></div><div class="line">                                               &#125;;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">syntaxError</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* message)</span></span>;</div><div class="line"><span class="function">Node* <span class="title">MatchRES</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* expected)</span></span>;</div><div class="line"><span class="function">Node* <span class="title">MatchSYM</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> expected)</span></span>;</div><div class="line"><span class="function">Node* <span class="title">MatchID</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">MatchNUM</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isRES</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* res)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isSYM</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> res)</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isID</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isNUM</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isLineEnd</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Program</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProgramHead</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">DeclarePart</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeDec</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeDeclaration</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeDecList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeDecMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeId</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">TypeName</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">BaseType</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">StructureType</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ArrayType</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">RecType</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FieldDecList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FieldDecMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">IdList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">IdMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarDec</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarDeclaration</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarDecList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarDecMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarIdList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VarIdMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProcDec</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProcDeclaration</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ParamList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ParamDecList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ParamMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Param</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FormList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FidMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProcDecPart</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProcBody</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ProgramBody</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">StmList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">StmMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Stm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">AssCall</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">AssignmentRest</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ConditionalStm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">LoopStm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">InputStm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">OutputStm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ReturnStm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">CallStmRest</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ActParamList</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">ActParamMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Exp</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Term</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">OtherFactor</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">OtherTerm</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Factor</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Variable</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">VariMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FieldVar</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">FieldVarMore</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">Parse</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">CmpOp</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">AddOp</span><span class="params">()</span></span>;</div><div class="line"><span class="function">Node* <span class="title">MultOp</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_tree</span><span class="params">(Node* root,<span class="keyword">int</span> depth,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;* v,<span class="keyword">bool</span> islast)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="built_in">vector</span>&lt;Node* &gt;&amp; children,Node* node)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(node!=<span class="literal">NULL</span>) &#123;</div><div class="line">        children.push_back(node);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> COMMENT_ERROR -1000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> STR_ERROR -1001</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SYM_ERROR -1002</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NOT_REC_SYMBOL -1003</span></div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">char</span>*&gt; ID_table;</div><div class="line"><span class="built_in">vector</span>&lt;uint&gt; NUM_table;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">char</span>*&gt; STR_table;</div><div class="line"><span class="keyword">int</span> ID_n=<span class="number">0</span>,NUM_n=<span class="number">0</span>,STR_n=<span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> num_of_lines=<span class="number">1</span>;</div><div class="line">FILE * file;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/***************************************************************************************/</span></div><div class="line"><span class="comment">/*****************                   词法分析                          *****************/</span></div><div class="line"><span class="comment">/***************************************************************************************/</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">handle_error</span><span class="params">(<span class="keyword">int</span> error_num,<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"行号:%d \t"</span>,num_of_lines);</div><div class="line">    <span class="keyword">switch</span>(error_num) &#123;</div><div class="line">    <span class="keyword">case</span> COMMENT_ERROR:</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"注释未结束 \t"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> SYM_ERROR:</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"出现未定义的符号，您想输入的是\":=\"吗? \t"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> STR_ERROR:</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"字符串未结束 \t"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> NOT_REC_SYMBOL:</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"出现未定义的符号 \t"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%s\n"</span>,str);</div><div class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">char</span> <span class="title">getNextChar</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">char</span> c;</div><div class="line">    c=fgetc(file);</div><div class="line">    <span class="keyword">return</span> c;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ungetNextChar</span><span class="params">()</span> </span>&#123;</div><div class="line">    fseek(file,<span class="number">-1</span>,SEEK_CUR);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">reservedLookup</span><span class="params">(<span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;NUMOFRESERVED; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(str,reserved_words[i])==<span class="number">0</span>)<span class="keyword">return</span> i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">str_to_num</span><span class="params">(<span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(str);</div><div class="line">    <span class="keyword">int</span> n=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        n=n*<span class="number">10</span>+str[i]-<span class="string">'0'</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> n;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">addIDTable</span><span class="params">(<span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    ID_table.push_back(str);</div><div class="line">    <span class="keyword">return</span> ID_n++;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">addNUMTable</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</div><div class="line">    NUM_table.push_back(num);</div><div class="line">    <span class="keyword">return</span> NUM_n++;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">addSTRTable</span><span class="params">(<span class="keyword">char</span>* str )</span> </span>&#123;</div><div class="line">    STR_table.push_back(str);</div><div class="line">    <span class="keyword">return</span> STR_n++;</div><div class="line">&#125;</div><div class="line"><span class="function">Token <span class="title">scan</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> symbols[<span class="number">12</span>]= &#123;<span class="string">'+'</span>,<span class="string">'-'</span>,<span class="string">'*'</span>,<span class="string">'/'</span>,<span class="string">'&lt;'</span>,<span class="string">'('</span>,<span class="string">')'</span>,<span class="string">'['</span>,<span class="string">']'</span>,<span class="string">';'</span>,<span class="string">'='</span>,<span class="string">','</span>&#125;;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> symbols_n[<span class="number">12</span>]= &#123;PLUS,SUB,MUL,DIV,LT,LBRACK,RBRACK,LSQUBRACK,RSQUBRACK,SEMI,EQU,COM&#125;;</div><div class="line">    Token t;</div><div class="line">    t.linenum=num_of_lines;</div><div class="line">    <span class="keyword">char</span>* str=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">256</span>];</div><div class="line">    <span class="built_in">strcpy</span>(str,<span class="string">""</span>);<span class="comment">//字符串要初始化，不然有乱码</span></div><div class="line">    <span class="keyword">char</span> c[<span class="number">2</span>]= &#123;<span class="string">'a'</span>,<span class="string">'\0'</span>&#125;;</div><div class="line">    c[<span class="number">0</span>]=getNextChar();</div><div class="line">LS0:</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'a'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'z'</span>)<span class="keyword">goto</span> LS1;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'A'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'Z'</span>)<span class="keyword">goto</span> LS1;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'0'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'9'</span>)<span class="keyword">goto</span> LS2;</div><div class="line">    <span class="keyword">int</span> indexofsym;</div><div class="line">    <span class="keyword">for</span>(indexofsym=<span class="number">0</span>; indexofsym&lt;<span class="number">12</span>; indexofsym++) &#123;</div><div class="line">        <span class="keyword">if</span>(c[<span class="number">0</span>]==symbols[indexofsym]) &#123;</div><div class="line">            <span class="keyword">goto</span> LS3;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'.'</span>)<span class="keyword">goto</span> LS4;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'&#123;'</span>)<span class="keyword">goto</span> LS5;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">':'</span>)<span class="keyword">goto</span> LS6;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'\''</span>)<span class="keyword">goto</span> LS7;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'\n'</span>)<span class="keyword">goto</span> LS8;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==EOF)<span class="keyword">goto</span> LS9;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'\t'</span>||c[<span class="number">0</span>]==<span class="string">' '</span>)<span class="keyword">goto</span> LS10;</div><div class="line">    <span class="keyword">goto</span> OTHER;</div><div class="line">LS1:</div><div class="line">    <span class="built_in">strcat</span>(str,c);</div><div class="line">    c[<span class="number">0</span>]=getNextChar();</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'a'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'z'</span>)<span class="keyword">goto</span> LS1;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'A'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'Z'</span>)<span class="keyword">goto</span> LS1;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'0'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'9'</span>)<span class="keyword">goto</span> LS1;</div><div class="line">    ungetNextChar();</div><div class="line">    <span class="keyword">int</span> nres;</div><div class="line">    <span class="keyword">if</span>(nres=reservedLookup(str),nres!=<span class="number">-1</span>) &#123;</div><div class="line">        t.id=RES;</div><div class="line">        t.ptr=nres;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        t.id=ID;</div><div class="line">        t.ptr=addIDTable(str);</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">LS2:</div><div class="line">    <span class="built_in">strcat</span>(str,c);</div><div class="line">    c[<span class="number">0</span>]=getNextChar();</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]&gt;=<span class="string">'0'</span>&amp;&amp;c[<span class="number">0</span>]&lt;=<span class="string">'9'</span>)<span class="keyword">goto</span> LS2;</div><div class="line">    ungetNextChar();</div><div class="line">    t.id=NUM;</div><div class="line">    t.ptr=addNUMTable(str_to_num(str));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">LS3:</div><div class="line">    t.ptr=symbols_n[indexofsym];</div><div class="line">    t.id=SYM;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">LS4:</div><div class="line">    <span class="built_in">strcat</span>(str,c);</div><div class="line">    c[<span class="number">0</span>]=getNextChar();</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'.'</span>) &#123;</div><div class="line">        t.id=SYM;</div><div class="line">        t.ptr=INDEX;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        t.id=SYM;</div><div class="line">        t.ptr=POINT;</div><div class="line">        ungetNextChar();</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">LS5:</div><div class="line">    <span class="keyword">while</span>(c[<span class="number">0</span>]=getNextChar(),c[<span class="number">0</span>]!=EOF&amp;&amp;c[<span class="number">0</span>]!=<span class="string">'&#125;'</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'\n'</span>||c[<span class="number">0</span>]==<span class="string">'\r'</span>)num_of_lines++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'&#125;'</span>) &#123;</div><div class="line">        c[<span class="number">0</span>]=getNextChar();</div><div class="line">        <span class="keyword">goto</span> LS0;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        handle_error(COMMENT_ERROR,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">LS6:</div><div class="line">    <span class="built_in">strcat</span>(str,c);</div><div class="line">    c[<span class="number">0</span>]=getNextChar();</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'='</span>) &#123;</div><div class="line">        t.id=SYM;</div><div class="line">        t.ptr=ASSI;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        handle_error(SYM_ERROR,<span class="string">"符号为 \':\'"</span>);</div><div class="line">    &#125;</div><div class="line">LS7:</div><div class="line">    <span class="keyword">while</span>(c[<span class="number">0</span>]=getNextChar(),c[<span class="number">0</span>]!=EOF&amp;&amp;c[<span class="number">0</span>]!=<span class="string">'\''</span>) &#123;</div><div class="line">        <span class="built_in">strcat</span>(str,c);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(c[<span class="number">0</span>]==<span class="string">'\''</span>) &#123;</div><div class="line">        t.id=STR;</div><div class="line">        t.ptr=addSTRTable(str);</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        handle_error(STR_ERROR,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">LS8:</div><div class="line">    t.id=<span class="number">-1</span>;</div><div class="line">    num_of_lines++;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">LS9:</div><div class="line">    t.id=SYM;</div><div class="line">    t.ptr=EOFF;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">LS10:</div><div class="line">    t.id=<span class="number">-1</span>;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">OTHER:</div><div class="line">    handle_error(NOT_REC_SYMBOL,c);</div><div class="line">    t.id=<span class="number">-1</span>;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_token</span><span class="params">(Token t)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(t.id==STR) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"&lt;%d %s %s&gt; \n"</span>,t.linenum,<span class="string">"STR"</span>,STR_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==NUM) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"&lt;%d %s %d&gt; \n"</span>,t.linenum,<span class="string">"NUM"</span>,NUM_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==ID) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"&lt;%d %s %s&gt; \n"</span>,t.linenum,<span class="string">"ID"</span>,ID_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==RES) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"&lt;%d %s %s&gt; \n"</span>,t.linenum,<span class="string">"RES"</span>,reserved_words[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==SYM) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"&lt;%d %s %s&gt; \n"</span>,t.linenum,<span class="string">"SYM"</span>,symbol_table[t.ptr<span class="number">-100</span>]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"><span class="built_in">vector</span>&lt;Token&gt;*  getTokenlist(<span class="keyword">const</span> <span class="keyword">char</span>* filename) &#123;</div><div class="line">    tokens-&gt;clear();</div><div class="line">    file=fopen(filename,<span class="string">"r"</span>);</div><div class="line">    Token temp;</div><div class="line">    <span class="keyword">while</span>(temp=scan(),!(temp.id==SYM&amp;&amp;temp.ptr==EOFF)) &#123;</div><div class="line">        <span class="keyword">if</span>(temp.id!=<span class="number">-1</span>) &#123;</div><div class="line">            tokens-&gt;push_back(temp);</div><div class="line">            <span class="keyword">if</span>(temp.id==RES&amp;&amp;<span class="built_in">strcmp</span>(<span class="string">"end"</span>,reserved_words[temp.ptr])==<span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">char</span> c;</div><div class="line">                <span class="keyword">if</span>(c=getNextChar(),c==<span class="string">'.'</span>) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    ungetNextChar();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    fclose(file);</div><div class="line">    <span class="keyword">return</span> tokens;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_Token_list</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> len=tokens-&gt;size();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        show_token(tokens-&gt;at(i));</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">write_token</span><span class="params">(FILE* file,Token t)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(t.id==STR) &#123;</div><div class="line">        <span class="built_in">fprintf</span>(file,<span class="string">"&lt;%s %s&gt; \n"</span>,<span class="string">"STR"</span>,STR_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==NUM) &#123;</div><div class="line">        <span class="built_in">fprintf</span>(file,<span class="string">"&lt;%s %d&gt; \n"</span>,<span class="string">"NUM"</span>,NUM_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==ID) &#123;</div><div class="line">        <span class="built_in">fprintf</span>(file,<span class="string">"&lt;%s %s&gt; \n"</span>,<span class="string">"ID"</span>,ID_table[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==RES) &#123;</div><div class="line">        <span class="built_in">fprintf</span>(file,<span class="string">"&lt;%s %s&gt; \n"</span>,<span class="string">"RES"</span>,reserved_words[t.ptr]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(t.id==SYM) &#123;</div><div class="line">        <span class="built_in">fprintf</span>(file,<span class="string">"&lt;%s %s&gt; \n"</span>,<span class="string">"SYM"</span>,symbol_table[t.ptr<span class="number">-100</span>]);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_Token_list</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* filename)</span> </span>&#123;</div><div class="line">    FILE* f=fopen(filename,<span class="string">"w"</span>);</div><div class="line">    <span class="keyword">int</span> len=tokens-&gt;size();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        write_token(f,tokens-&gt;at(i));</div><div class="line">    &#125;</div><div class="line">    fclose(f);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/***************************************************************************************/</span></div><div class="line"><span class="comment">/*****************                   语法分析                          *****************/</span></div><div class="line"><span class="comment">/***************************************************************************************/</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">syntaxError</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* message)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(message,<span class="string">"outofrange"</span>)==<span class="number">0</span>) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"出现越界错误"</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"   Token_n:%d    tokens-&gt;size:%d\n"</span>,Token_n,tokens-&gt;size());</div><div class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"行号：%d    %s"</span>,tokens-&gt;at(Token_n).linenum,message);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"当前token："</span>);</div><div class="line">    show_token(tokens-&gt;at(Token_n));</div><div class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MatchRES</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* expected)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id,ptr=tokens-&gt;at(Token_n).ptr;</div><div class="line">    <span class="keyword">if</span>(id==RES&amp;&amp;<span class="built_in">strcmp</span>(expected,reserved_words[ptr])==<span class="number">0</span>) &#123;</div><div class="line">        Node*t =<span class="keyword">new</span> Node(expected);</div><div class="line">        Token_n++;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span>* message=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">100</span>];</div><div class="line">    <span class="built_in">strcpy</span>(message,<span class="string">"match res error.\nexpect: "</span>);</div><div class="line">    <span class="built_in">strcat</span>(message,expected);</div><div class="line">    <span class="built_in">strcat</span>(message,<span class="string">"\n"</span>);</div><div class="line">    syntaxError(message);</div><div class="line">    <span class="keyword">delete</span> message;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MatchNUM</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==NUM) &#123;</div><div class="line">        Node* t= <span class="keyword">new</span> Node(<span class="string">"NUM"</span>);</div><div class="line">        Token_n++;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"match num error\n"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MatchSTR</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==STR) &#123;</div><div class="line">        Node* t= <span class="keyword">new</span> Node(<span class="string">"STR"</span>);</div><div class="line">        Token_n++;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"match str error\n"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MatchID</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==ID) &#123;</div><div class="line">        Node* t =<span class="keyword">new</span> Node(<span class="string">"ID"</span>);</div><div class="line">        Token_n++;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"match id error\n"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MatchSYM</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> expected)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id,ptr=tokens-&gt;at(Token_n).ptr;</div><div class="line">    <span class="keyword">if</span>(id==SYM&amp;&amp;ptr==expected) &#123;</div><div class="line">        Node* t =<span class="keyword">new</span> Node(symbol_table[ptr<span class="number">-100</span>]);</div><div class="line">        Token_n++;</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span>* message=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">100</span>];</div><div class="line">    <span class="built_in">strcpy</span>(message,<span class="string">"match symbol error.\nexpect: "</span>);</div><div class="line">    <span class="built_in">strcat</span>(message,symbol_table[expected<span class="number">-100</span>]);</div><div class="line">    <span class="built_in">strcat</span>(message,<span class="string">"\n"</span>);</div><div class="line">    syntaxError(message);</div><div class="line">    <span class="keyword">delete</span> message;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isRES</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* res)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id,ptr=tokens-&gt;at(Token_n).ptr;</div><div class="line">    <span class="keyword">if</span>(id==RES&amp;&amp;<span class="built_in">strcmp</span>(reserved_words[ptr],res)==<span class="number">0</span>)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isSYM</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> res)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id,ptr=tokens-&gt;at(Token_n).ptr;</div><div class="line">    <span class="keyword">if</span>(id==SYM&amp;&amp;ptr==res)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isID</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==ID)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isNUM</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==NUM)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isSTR</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(Token_n&gt;=(<span class="keyword">int</span>)tokens-&gt;size())syntaxError(<span class="string">"outofrange"</span>);</div><div class="line">    <span class="keyword">int</span> id=tokens-&gt;at(Token_n).id;</div><div class="line">    <span class="keyword">if</span>(id==STR)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Program</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Program"</span>);</div><div class="line">    add(t-&gt;children,ProgramHead());</div><div class="line">    add(t-&gt;children,DeclarePart());</div><div class="line">    add(t-&gt;children,ProgramBody());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProgramHead</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ProgramHead"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"program"</span>));</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">Node* <span class="title">DeclarePart</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"DeclarePart"</span>);</div><div class="line">    add(t-&gt;children,TypeDeclaration());</div><div class="line">    add(t-&gt;children,VarDeclaration());</div><div class="line">    add(t-&gt;children,ProcDeclaration());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeDec</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"TypeDec"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"type"</span>));</div><div class="line">    add(t-&gt;children,TypeDecList());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeDeclaration</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"type"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"TypeDeclaration"</span>);</div><div class="line">        add(t-&gt;children,TypeDec());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeDecList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"TypeDecList"</span>);</div><div class="line">    add(t-&gt;children,TypeId());</div><div class="line">    add(t-&gt;children,MatchSYM(EQU));</div><div class="line">    add(t-&gt;children,TypeName());</div><div class="line">    add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">    add(t-&gt;children,TypeDecMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeDecMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isID()) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"TypeDecMore"</span>);</div><div class="line">        add(t-&gt;children,TypeDecList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeId</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"TypeId"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">TypeName</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"TypeName"</span>);</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)) &#123;</div><div class="line">        add(t-&gt;children,BaseType());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"array"</span>)||isRES(<span class="string">"record"</span>)) &#123;</div><div class="line">        add(t-&gt;children,StructureType());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">BaseType</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"BaseType"</span>);</div><div class="line">        add(t-&gt;children,MatchRES(<span class="string">"integer"</span>));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"char"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"BaseType"</span>);</div><div class="line">        add(t-&gt;children,MatchRES(<span class="string">"char"</span>));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"not a base type\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">StructureType</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"array"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"StructureType"</span>);</div><div class="line">        add(t-&gt;children,ArrayType());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"record"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"StructureType"</span>);</div><div class="line">        add(t-&gt;children,RecType());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ArrayType</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ArrayType"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"array"</span>));</div><div class="line">    add(t-&gt;children,MatchSYM(LSQUBRACK));</div><div class="line">    add(t-&gt;children,MatchNUM());</div><div class="line">    add(t-&gt;children,MatchSYM(INDEX));</div><div class="line">    add(t-&gt;children,MatchNUM());</div><div class="line">    add(t-&gt;children,MatchSYM(RSQUBRACK));</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"of"</span>));</div><div class="line">    add(t-&gt;children,BaseType());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">RecType</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"RecType"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"record"</span>));</div><div class="line">    add(t-&gt;children,FieldDecList());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"end"</span>));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FieldDecList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"FieldDecList"</span>);</div><div class="line">        add(t-&gt;children,BaseType());</div><div class="line">        add(t-&gt;children,IdList());</div><div class="line">        add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">        add(t-&gt;children,FieldDecMore());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"array"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"FieldDecList"</span>);</div><div class="line">        add(t-&gt;children,ArrayType());</div><div class="line">        add(t-&gt;children,IdList());</div><div class="line">        add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">        add(t-&gt;children,FieldDecMore());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"field declare list error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FieldDecMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)||isRES(<span class="string">"array"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"FieldDecMore"</span>);</div><div class="line">        add(t-&gt;children,FieldDecList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">IdList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"IdList"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,IdMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">IdMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(COM)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"IdMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(COM));</div><div class="line">        add(t-&gt;children,IdList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarDec</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"VarDec"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"var"</span>));</div><div class="line">    add(t-&gt;children,VarDecList());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarDeclaration</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"var"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"VarDeclaration"</span>);</div><div class="line">        add(t-&gt;children,VarDec());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarDecList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"VarDecList"</span>);</div><div class="line">    add(t-&gt;children,TypeName());</div><div class="line">    add(t-&gt;children,VarIdList());</div><div class="line">    add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">    add(t-&gt;children,VarDecMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarDecMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)||isRES(<span class="string">"array"</span>)||isRES(<span class="string">"record"</span>)||isID()) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"VarDecMore"</span>);</div><div class="line">        add(t-&gt;children,VarDecList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarIdList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"VarIdList"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,VarIdMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VarIdMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(COM)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"VarIdMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(COM));</div><div class="line">        add(t-&gt;children,VarIdList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProcDec</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ProcDec"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"procedure"</span>));</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,MatchSYM(LBRACK));</div><div class="line">    add(t-&gt;children,ParamList());</div><div class="line">    add(t-&gt;children,MatchSYM(RBRACK));</div><div class="line">    add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">    add(t-&gt;children,DeclarePart());</div><div class="line">    add(t-&gt;children,ProcBody());</div><div class="line">    add(t-&gt;children,ProcDeclaration());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProcDeclaration</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"procedure"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"ProcDeclaration"</span>);</div><div class="line">        add(t-&gt;children,ProcDec());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ParamList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)||isRES(<span class="string">"array"</span>)||isRES(<span class="string">"record"</span>)||isID()||isRES(<span class="string">"var"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"ParamList"</span>);</div><div class="line">        add(t-&gt;children,ParamDecList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ParamDecList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ParamDecList"</span>);</div><div class="line">    add(t-&gt;children,Param());</div><div class="line">    add(t-&gt;children,ParamMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ParamMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(SEMI)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"ParamMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">        add(t-&gt;children,ParamDecList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Param</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"integer"</span>)||isRES(<span class="string">"char"</span>)||isRES(<span class="string">"array"</span>)||isRES(<span class="string">"record"</span>)||isID()) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"Param"</span>);</div><div class="line">        add(t-&gt;children,TypeName());</div><div class="line">        add(t-&gt;children,FormList());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"var"</span>)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"Param"</span>);</div><div class="line">        add(t-&gt;children,MatchRES(<span class="string">"var"</span>));</div><div class="line">        add(t-&gt;children,TypeName());</div><div class="line">        add(t-&gt;children,FormList());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"param error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FormList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"FormList"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,FidMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FidMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(COM)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"FidMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(COM));</div><div class="line">        add(t-&gt;children,FormList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProcDecPart</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ProcDecPart"</span>);</div><div class="line">    add(t-&gt;children,DeclarePart());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProcBody</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ProcBody"</span>);</div><div class="line">    add(t-&gt;children,ProgramBody());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ProgramBody</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ProgramBody"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"begin"</span>));</div><div class="line">    add(t-&gt;children,StmList());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"end"</span>));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">StmList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"StmList"</span>);</div><div class="line">    add(t-&gt;children,Stm());</div><div class="line">    add(t-&gt;children,StmMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">StmMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(SEMI)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"StmMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(SEMI));</div><div class="line">        add(t-&gt;children,StmList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Stm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Stm"</span>);</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"if"</span>)) &#123;</div><div class="line">        add(t-&gt;children,ConditionalStm());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"while"</span>)) &#123;</div><div class="line">        add(t-&gt;children,LoopStm());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"read"</span>)) &#123;</div><div class="line">        add(t-&gt;children,InputStm());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"write"</span>)) &#123;</div><div class="line">        add(t-&gt;children,OutputStm());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isRES(<span class="string">"return"</span>)) &#123;</div><div class="line">        add(t-&gt;children,ReturnStm());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isID()) &#123;</div><div class="line">        add(t-&gt;children,MatchID());</div><div class="line">        add(t-&gt;children,AssCall());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">delete</span> t;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">AssCall</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(LSQUBRACK)||isSYM(POINT)||isSYM(ASSI)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"AssCall"</span>);</div><div class="line">        add(t-&gt;children,AssignmentRest());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(LBRACK)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"AssCall"</span>);</div><div class="line">        add(t-&gt;children,CallStmRest());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"ass call error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">AssignmentRest</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"AssignmentRest"</span>);</div><div class="line">    <span class="keyword">if</span>(isSYM(LSQUBRACK)||isSYM(POINT)) &#123;</div><div class="line">        add(t-&gt;children,VariMore());</div><div class="line">    &#125;</div><div class="line">    add(t-&gt;children,MatchSYM(ASSI));</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ConditionalStm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ConditionalStm"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"if"</span>));</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    <span class="keyword">if</span>(isSYM(LT))add(t-&gt;children,MatchSYM(LT));</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(isSYM(EQU))add(t-&gt;children,MatchSYM(EQU));</div><div class="line">    <span class="keyword">else</span> syntaxError(<span class="string">"condition error\n"</span>);</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"then"</span>));</div><div class="line">    add(t-&gt;children,StmList());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"else"</span>));</div><div class="line">    add(t-&gt;children,StmList());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"fi"</span>));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">LoopStm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"LoopStm"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"while"</span>));</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    <span class="keyword">if</span>(isSYM(LT))add(t-&gt;children,MatchSYM(LT));</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(isSYM(EQU))add(t-&gt;children,MatchSYM(EQU));</div><div class="line">    <span class="keyword">else</span> syntaxError(<span class="string">"condition error\n"</span>);</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"do"</span>));</div><div class="line">    add(t-&gt;children,StmList());</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"endwh"</span>));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">InputStm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"InputStm"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"read"</span>));</div><div class="line">    add(t-&gt;children,MatchSYM(LBRACK));</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,MatchSYM(RBRACK));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">OutputStm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"OutputStm"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"write"</span>));</div><div class="line">    add(t-&gt;children,MatchSYM(LBRACK));</div><div class="line">    add(t-&gt;children,Exp());</div><div class="line">    add(t-&gt;children,MatchSYM(RBRACK));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ReturnStm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"ReturnStm"</span>);</div><div class="line">    add(t-&gt;children,MatchRES(<span class="string">"return"</span>));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">CallStmRest</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"CallStmRest"</span>);</div><div class="line">    add(t-&gt;children,MatchSYM(LBRACK));</div><div class="line">    add(t-&gt;children,ActParamList());</div><div class="line">    add(t-&gt;children,MatchSYM(RBRACK));</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ActParamList</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(LBRACK)||isNUM()||isID()) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"ActParamList"</span>);</div><div class="line">        add(t-&gt;children,Exp());</div><div class="line">        add(t-&gt;children,ActParamMore());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">ActParamMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(COM)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"ActParamMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(COM));</div><div class="line">        add(t-&gt;children,ActParamList());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Exp</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Exp"</span>);</div><div class="line">    add(t-&gt;children,Term());</div><div class="line">    add(t-&gt;children,OtherTerm());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">OtherTerm</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(PLUS)||isSYM(SUB)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"OtherTerm"</span>);</div><div class="line">        add(t-&gt;children,AddOp());</div><div class="line">        add(t-&gt;children,Exp());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Term</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Term"</span>);</div><div class="line">    add(t-&gt;children,Factor());</div><div class="line">    add(t-&gt;children,OtherFactor());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">OtherFactor</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(MUL)||isSYM(DIV)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"OtherFactor"</span>);</div><div class="line">        add(t-&gt;children,MultOp());</div><div class="line">        add(t-&gt;children,Term());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Factor</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Factor"</span>);</div><div class="line">    <span class="keyword">if</span>(isNUM()) &#123;</div><div class="line">        add(t-&gt;children,MatchNUM());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSTR()) &#123;</div><div class="line">        add(t-&gt;children,MatchSTR());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(LBRACK)) &#123;</div><div class="line">        add(t-&gt;children,MatchSYM(LBRACK));</div><div class="line">        add(t-&gt;children,Exp());</div><div class="line">        add(t-&gt;children,MatchSYM(RBRACK));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isID()) &#123;</div><div class="line">        add(t-&gt;children,Variable());</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">delete</span> t;</div><div class="line">    syntaxError(<span class="string">"factor error\n"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Variable</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"Variable"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,VariMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">VariMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(LSQUBRACK)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"VariMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(LSQUBRACK));</div><div class="line">        add(t-&gt;children,Exp());</div><div class="line">        add(t-&gt;children,MatchSYM(RSQUBRACK));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(POINT)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"VariMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(POINT));</div><div class="line">        add(t-&gt;children,FieldVar());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FieldVar</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node* t=<span class="keyword">new</span> Node(<span class="string">"FieldVar"</span>);</div><div class="line">    add(t-&gt;children,MatchID());</div><div class="line">    add(t-&gt;children,FieldVarMore());</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">FieldVarMore</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(LSQUBRACK)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"FieldVarMore"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(LSQUBRACK));</div><div class="line">        add(t-&gt;children,Exp());</div><div class="line">        add(t-&gt;children,MatchSYM(RSQUBRACK));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">CmpOp</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(LT)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"CmpOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(LT));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(EQU)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"CmpOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(EQU));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"cmpop error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">AddOp</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(PLUS)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"AddOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(PLUS));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(SUB)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"AddOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(SUB));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"cmpop error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">MultOp</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node*t=<span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(isSYM(MUL)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"MultOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(MUL));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(isSYM(DIV)) &#123;</div><div class="line">        t=<span class="keyword">new</span> Node(<span class="string">"MultOp"</span>);</div><div class="line">        add(t-&gt;children,MatchSYM(DIV));</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    &#125;</div><div class="line">    syntaxError(<span class="string">"cmpop error\n"</span>);</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function">Node* <span class="title">Parse</span><span class="params">()</span> </span>&#123;</div><div class="line">    num_of_lines=<span class="number">1</span>;</div><div class="line">    Node* root=Program();</div><div class="line">    <span class="keyword">return</span> root;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_tree</span><span class="params">(Node* root,<span class="keyword">int</span> depth,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;* v,<span class="keyword">bool</span> islast)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(root==<span class="literal">NULL</span>)<span class="keyword">return</span> ;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;depth; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(v-&gt;at(i)==<span class="number">1</span>)<span class="built_in">printf</span>(<span class="string">" │"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"  "</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(islast) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">" └─%s"</span>,root-&gt;desc);</div><div class="line">        v-&gt;at(depth)=<span class="number">0</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">" ├─%s"</span>,root-&gt;desc);</div><div class="line">    <span class="keyword">if</span>(depth+<span class="number">1</span>==(<span class="keyword">int</span>)v-&gt;size())v-&gt;push_back(<span class="number">1</span>);</div><div class="line">    v-&gt;at(depth+<span class="number">1</span>)=<span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> len=root-&gt;children.size();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(i==len<span class="number">-1</span>)show_tree(root-&gt;children.at(i),depth+<span class="number">1</span>,v,<span class="literal">true</span>);</div><div class="line">        <span class="keyword">else</span> show_tree(root-&gt;children.at(i),depth+<span class="number">1</span>,v,<span class="literal">false</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    tokens=<span class="keyword">new</span> <span class="built_in">vector</span>&lt;Token&gt;();</div><div class="line">    getTokenlist(<span class="string">"cs1.txt"</span>);</div><div class="line">    save_Token_list(<span class="string">"tokens.txt"</span>);</div><div class="line">    <span class="comment">//打印显示</span></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"TOKENS:\n\n"</span>);</div><div class="line">    show_Token_list();</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"\n\n\n\n语法树:\n\n"</span>);</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;* v=<span class="keyword">new</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;();</div><div class="line">    v-&gt;push_back(<span class="number">0</span>);</div><div class="line">    show_tree(Parse(),<span class="number">0</span>,v,<span class="literal">true</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>cs1.txt<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">&#123;冒泡排序&#125;</div><div class="line">&#123;输入m,表示要排序的数的个数；接着输入m个整数；</div><div class="line"> 输出从小到大排序后的结果&#125;</div><div class="line"></div><div class="line">program  p</div><div class="line">var  <span class="built_in">integer</span>  i,j,num;</div><div class="line">      array[1..20] of  <span class="built_in">integer</span> a;</div><div class="line"></div><div class="line">procedure  q(<span class="built_in">integer</span> num);</div><div class="line">var  <span class="built_in">integer</span> i,j,k;</div><div class="line">     <span class="built_in">integer</span> t;</div><div class="line">begin</div><div class="line">  i:=<span class="string">'lklklk'</span>;</div><div class="line">  j:=1;</div><div class="line">  <span class="keyword">while</span> i &lt; num <span class="keyword">do</span></div><div class="line">     j:=num-i+1;</div><div class="line">     k:=1;</div><div class="line">     <span class="keyword">while</span> k&lt;j  <span class="keyword">do</span></div><div class="line">         <span class="keyword">if</span> a[k+1] &lt; a[k]</div><div class="line">         <span class="keyword">then</span>  t:=a[k];</div><div class="line">           a[k]:=a[k+1];</div><div class="line">           a[k+1]:=t</div><div class="line">         <span class="keyword">else</span>  t:=0</div><div class="line">         <span class="keyword">fi</span>;</div><div class="line">     k:=k+1</div><div class="line">     endwh;</div><div class="line">  i:=i+1</div><div class="line">  endwh</div><div class="line">end</div><div class="line"></div><div class="line">begin</div><div class="line">   <span class="built_in">read</span>(num);</div><div class="line">   i:=1;</div><div class="line">   <span class="keyword">while</span> i&lt;(num+1)  <span class="keyword">do</span></div><div class="line">     <span class="built_in">read</span>(j);</div><div class="line">     a[i]:=j;</div><div class="line">     i:=i+1</div><div class="line">   endwh;</div><div class="line">   q(num);</div><div class="line">   i:=1;</div><div class="line">   <span class="keyword">while</span>  i&lt;(num+1) <span class="keyword">do</span></div><div class="line">       write(a[i]);</div><div class="line">       i:=i+1</div><div class="line">   endwh</div><div class="line">end.</div></pre></td></tr></table></figure></p>
<ul>
<li>代码写于大三下6月份，编译原理课程设计</li>
<li>随笔写于2016.7.13</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/03/ChatRoom/" itemprop="url">
                  聊天室（Java实现）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-03T00:00:00+08:00" content="2016-07-03">
              2016-07-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&ensp;<br>&ensp;<br>&ensp;</p>
<h2 id="功能："><a href="#功能：" class="headerlink" title="功能："></a>功能：</h2><h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p>　　　　若用户账号不存在，弹出错误</p>
<p>　　　　若用户密码错误，弹出错误</p>
<p>　　　　若用户账号已在线，弹出错误<br><img src="/imgs/chatroom1.png" alt="denglu1"><br><img src="/imgs/chatroom2.png" alt="denglu1"><br><img src="/imgs/chatroom3.png" alt="denglu1"></p>
<p> 　　　　　</p>
<p>　　　　　　</p>
<h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><p>　　　　若用户已注册，弹出错误<br><img src="/imgs/chatroom4.png" alt="denglu1"><br><img src="/imgs/chatroom5.png" alt="denglu1">
 　　　　　　　　</p>
<p>　　　　　　　　</p>
<h3 id="聊天室"><a href="#聊天室" class="headerlink" title="聊天室"></a>聊天室</h3><p>　　　　多人聊天，类似QQ里的群。</p>
<p>　　　　点击右侧的在线用户，可进行一对一聊天。<br><img src="/imgs/chatroom6.png" alt="denglu1"></p>
<h3 id="一对一聊天"><a href="#一对一聊天" class="headerlink" title="一对一聊天"></a>一对一聊天</h3><p>　　　　在聊天室中点击在线用户可进入此窗口。</p>
<p>　　　　发送消息后，对方会收到消息，并弹出一对一聊天窗口 。<br><img src="/imgs/chatroom7.png" alt="denglu1">　　　　　　
　　　　　　</p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h2 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h2><p>　　　　服务端的IP和端口固定。（代码中使用127.0.0.1作为服务端的IP）</p>
<p>　　　　客户端通过该IP和端口访问服务器。</p>
<p>　　　　客户端向服务器发送消息，服务器根据消息做出不同的处理，并可能向其他客户端发送消息。</p>
<p>　　　　每个客户端都有一个客户端server进程，以接收服务端发来的消息。</p>
<p>　　　　初始化客户端时，启动客户端server进程，监听任意一个可用端口。用户登录时，将本地账户、密码、本地的server进程端口发给服务端，服务端检验用户合法性，若合　法，则更新该账户的IP地址和端口。以后服务端即可向该IP发送消息。</p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><p> 　　项目工程结构：</p>
<p>　　　　<br><img src="/imgs/chatroom8.png" alt="denglu1">　　　　　　</p>
<p><strong>Server</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomutil;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.PrintWriter;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</div><div class="line">    <span class="keyword">protected</span> ServerSocket sSocket;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Server</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">listen</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            Socket ots = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                ots = sSocket.accept();</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                ChatRoomUtil.showErrorBox(<span class="string">"服务器Accept错误"</span>);</div><div class="line">                System.exit(-<span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">            Thread hThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> handleThread(ots));</div><div class="line">            hThread.start();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 处理消息的进程 的内部类</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">handleThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">        Socket ots;</div><div class="line">        handleThread(Socket ots) &#123;</div><div class="line">            <span class="keyword">this</span>.ots = ots;</div><div class="line">        &#125;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            handleMessage(ots);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">handle</span><span class="params">(Socket ots,String rMessage)</span></span>;<span class="comment">//处理函数，输入收到的消息，返回要发送的消息</span></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">handleMessage</span><span class="params">(Socket ots)</span> </span>&#123;</div><div class="line">        StringBuffer buffer=<span class="keyword">new</span> StringBuffer();</div><div class="line">        BufferedReader reader=ChatRoomUtil.getMsgFromSocket(ots,buffer);<span class="comment">//获取消息</span></div><div class="line">        String rMessage = buffer.toString();</div><div class="line">        String message=handle(ots,rMessage);<span class="comment">//处理消息</span></div><div class="line">        PrintWriter writer=ChatRoomUtil.putMesgToSocket(ots, message);<span class="comment">//发送消息</span></div><div class="line">        ChatRoomUtil.closeSocket(ots,reader,writer);<span class="comment">//关闭</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ChatRoomUtil</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomutil;</div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStreamReader;</div><div class="line"><span class="keyword">import</span> java.io.PrintWriter;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatRoomUtil</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">showErrorBox</span><span class="params">(String message)</span> </span>&#123;<span class="comment">//显示错误信息对话框</span></div><div class="line">        JOptionPane.showMessageDialog(<span class="keyword">null</span>, message, <span class="string">"错误"</span>,</div><div class="line">                JOptionPane.ERROR_MESSAGE);</div><div class="line">        <span class="keyword">return</span> message;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//获取消息</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BufferedReader <span class="title">getMsgFromSocket</span><span class="params">(Socket socket,StringBuffer buffer)</span></span>&#123;</div><div class="line">        BufferedReader reader = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader = <span class="keyword">new</span> BufferedReader(</div><div class="line">                    <span class="keyword">new</span> InputStreamReader(socket.getInputStream()));</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"获取Socket输入流错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            String line = <span class="string">""</span>;</div><div class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</div><div class="line">                buffer.append(line + <span class="string">"\n"</span>);</div><div class="line">            &#125;</div><div class="line">            buffer.deleteCharAt(buffer.length()-<span class="number">1</span>);<span class="comment">//去掉最后一个回车符</span></div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"读取Socket输入流错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            socket.shutdownInput();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"关闭Socket输入时发生错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> reader;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//发送消息</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PrintWriter <span class="title">putMesgToSocket</span><span class="params">(Socket socket,String message)</span></span>&#123;</div><div class="line">        PrintWriter writer = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            writer = <span class="keyword">new</span> PrintWriter(socket.getOutputStream());</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"获取Socket输出流错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        writer.println(message);</div><div class="line">        writer.flush();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            socket.shutdownOutput();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e1) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"关闭Socket输出时发生错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> writer;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//关闭socket、输入流、输出流</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeSocket</span><span class="params">(Socket socket,BufferedReader reader,PrintWriter writer )</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"关闭Scoket输入流时发生错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        writer.close();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            socket.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"关闭Scoket输出流时发生错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ServerServer</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomserver;</div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.FileReader;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.RandomAccessFile;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> java.util.Enumeration;</div><div class="line"><span class="keyword">import</span> java.util.Hashtable;</div><div class="line"><span class="keyword">import</span> chatroomsend.Send;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"><span class="keyword">import</span> chatroomutil.Server;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerServer</span> <span class="keyword">extends</span> <span class="title">Server</span> </span>&#123;</div><div class="line">    Hashtable&lt;String, User&gt; onlineTable = <span class="keyword">new</span> Hashtable&lt;String, User&gt;();<span class="comment">// 在线用户集合</span></div><div class="line">    Hashtable&lt;String, User&gt; offlineTable = <span class="keyword">new</span> Hashtable&lt;String, User&gt;();<span class="comment">// 离线用户集合</span></div><div class="line">    <span class="comment">// 用户内部类</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">        String id;</div><div class="line">        String pwd;</div><div class="line">        String IP;</div><div class="line">        <span class="keyword">int</span> port;</div><div class="line">        User(String id, String pwd) &#123;</div><div class="line">            <span class="keyword">this</span>.id = id;</div><div class="line">            <span class="keyword">this</span>.pwd = pwd;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 发送进程内部类</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">sendThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">        String mesg;</div><div class="line">        String IP;</div><div class="line">        <span class="keyword">int</span> port;</div><div class="line">        sendThread(String IP, <span class="keyword">int</span> port, String mesg) &#123;</div><div class="line">            <span class="keyword">this</span>.IP = IP;</div><div class="line">            <span class="keyword">this</span>.port = port;</div><div class="line">            <span class="keyword">this</span>.mesg = mesg;</div><div class="line">        &#125;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">            sendClient.connect(IP, port, <span class="number">1000</span>);</div><div class="line">            sendClient.send(mesg);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServerServer</span><span class="params">(<span class="keyword">int</span> port)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        init(port);</div><div class="line">        initUsers();</div><div class="line">        listen();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> port)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            sSocket = <span class="keyword">new</span> ServerSocket(port);<span class="comment">//绑定指定端口</span></div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"服务器初始化失败，无法绑定端口。"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> port;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">initUsers</span><span class="params">()</span> </span>&#123;<span class="comment">//读取Users文件，初始化offlineTable</span></div><div class="line">        BufferedReader reader = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">"Users.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e1) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"无法找到User文件"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        String line;</div><div class="line">        String[] fa;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</div><div class="line">                fa = line.split(<span class="string">":"</span>, <span class="number">2</span>);</div><div class="line">                User f = <span class="keyword">new</span> User(fa[<span class="number">0</span>], fa[<span class="number">1</span>]);</div><div class="line">                offlineTable.put(fa[<span class="number">0</span>], f);</div><div class="line">            &#125;</div><div class="line">            reader.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"读取User文件错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">saveNewUser</span><span class="params">(String id, String pwd)</span> </span>&#123;<span class="comment">//将新用户写入Users文件最后</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            RandomAccessFile file = <span class="keyword">new</span> RandomAccessFile(<span class="string">"Users.txt"</span>, <span class="string">"rw"</span>);</div><div class="line">            file.seek(file.length());</div><div class="line">            file.writeBytes(id + <span class="string">":"</span> + pwd + <span class="string">"\r\n"</span>);</div><div class="line">            file.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"写入User文件错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"写入User文件错误"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function">String <span class="title">loginCheck</span><span class="params">(String id, String pwd, String IP, <span class="keyword">int</span> port)</span> </span>&#123;<span class="comment">//检查登录用户的合法性</span></div><div class="line">        System.out.println(<span class="string">"logi check"</span>);</div><div class="line">        <span class="keyword">if</span> (onlineTable.containsKey(id))</div><div class="line">            <span class="keyword">return</span> <span class="string">"alreadyonline"</span>;<span class="comment">//该用户已在线</span></div><div class="line">        User f = offlineTable.get(id);</div><div class="line">        <span class="keyword">if</span> (f == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="string">"nothisid"</span>;<span class="comment">//无此用户</span></div><div class="line">        <span class="keyword">if</span> (f.pwd.compareTo(pwd) == <span class="number">0</span>) &#123;</div><div class="line">            oneUserOnline(id, IP, port);</div><div class="line">            sendOnlinesToNewOnlineUser(id, IP, port);</div><div class="line">            sendNewOnlineUserToOnlines(id);</div><div class="line">            <span class="keyword">return</span> <span class="string">"yes"</span>;<span class="comment">//合法</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"wrong"</span>;<span class="comment">//密码错误</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">oneUserOnline</span><span class="params">(String id, String IP, <span class="keyword">int</span> port)</span> </span>&#123;<span class="comment">//一个新用户上线</span></div><div class="line">        User f = offlineTable.get(id);</div><div class="line">        offlineTable.remove(id);</div><div class="line">        onlineTable.put(id, f);</div><div class="line">        f.IP = IP;</div><div class="line">        f.port = port;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sendNewOnlineUserToOnlines</span><span class="params">(String id)</span> </span>&#123;<span class="comment">//给所有在线用户发送新上线的用户的id</span></div><div class="line">        Enumeration&lt;User&gt; fs = onlineTable.elements();</div><div class="line">        <span class="keyword">while</span> (fs.hasMoreElements()) &#123;</div><div class="line">            User f = fs.nextElement();</div><div class="line">            <span class="keyword">if</span> (f.id.compareTo(id) != <span class="number">0</span>) &#123;</div><div class="line">                Thread hThread = <span class="keyword">new</span> Thread(</div><div class="line">                        <span class="keyword">new</span> sendThread(f.IP, f.port, <span class="string">"newf"</span> + id));</div><div class="line">                hThread.start();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sendMesg</span><span class="params">(String mesg)</span> </span>&#123;<span class="comment">//向所有在线用户转发一条消息</span></div><div class="line">        Enumeration&lt;User&gt; fs = onlineTable.elements();</div><div class="line">        <span class="keyword">while</span> (fs.hasMoreElements()) &#123;</div><div class="line">            User f = fs.nextElement();</div><div class="line">            Thread hThread = <span class="keyword">new</span> Thread(</div><div class="line">                    <span class="keyword">new</span> sendThread(f.IP, f.port, <span class="string">"mesg"</span> + mesg));</div><div class="line">            hThread.start();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sendChat</span><span class="params">(String id, String mesg)</span> </span>&#123;<span class="comment">//向一个用户发送一条一对一聊天的消息</span></div><div class="line">        User f = onlineTable.get(id);</div><div class="line">        Thread hThread = <span class="keyword">new</span> Thread(</div><div class="line">                <span class="keyword">new</span> sendThread(f.IP, f.port, <span class="string">"chat"</span> + mesg));</div><div class="line">        hThread.start();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function">String <span class="title">newRegisUser</span><span class="params">(String id, String pwd)</span> </span>&#123;<span class="comment">//有新注册的用户</span></div><div class="line">        <span class="keyword">if</span> (onlineTable.containsKey(id) || offlineTable.containsKey(id)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"no"</span>;</div><div class="line">        &#125;</div><div class="line">        offlineTable.put(id, <span class="keyword">new</span> User(id, pwd));</div><div class="line">        saveNewUser(id, pwd);</div><div class="line">        <span class="keyword">return</span> <span class="string">"yes"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sendOnlinesToNewOnlineUser</span><span class="params">(String id, String IP, <span class="keyword">int</span> port)</span> </span>&#123;<span class="comment">//给新上线的用户发送所有已在线用户的id</span></div><div class="line">        <span class="keyword">if</span> (onlineTable.isEmpty() || onlineTable.size() == <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        StringBuffer strBuf = <span class="keyword">new</span> StringBuffer();</div><div class="line">        Enumeration&lt;User&gt; fs = onlineTable.elements();</div><div class="line">        <span class="keyword">while</span> (fs.hasMoreElements()) &#123;</div><div class="line">            User f = fs.nextElement();</div><div class="line">            <span class="keyword">if</span> (f.id.compareTo(id) != <span class="number">0</span>) &#123;</div><div class="line">                strBuf.append(f.id);</div><div class="line">                strBuf.append(<span class="string">";"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        String str = strBuf.toString();</div><div class="line">        Thread hThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> sendThread(IP, port, <span class="string">"newf"</span> + str));</div><div class="line">        hThread.start();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">oneUserOffline</span><span class="params">(String id)</span> </span>&#123;<span class="comment">//有一个用户下线，将其下线消息发送给所有在线用户</span></div><div class="line">        Enumeration&lt;User&gt; fs = onlineTable.elements();</div><div class="line">        <span class="keyword">while</span> (fs.hasMoreElements()) &#123;</div><div class="line">            User f = fs.nextElement();</div><div class="line">            <span class="keyword">if</span> (f.id.compareTo(id) == <span class="number">0</span>) &#123;</div><div class="line">                onlineTable.remove(id);</div><div class="line">                offlineTable.put(id, f);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                Thread hThread = <span class="keyword">new</span> Thread(</div><div class="line">                        <span class="keyword">new</span> sendThread(f.IP, f.port, <span class="string">"offl"</span> + id));</div><div class="line">                hThread.start();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">protected</span>  String <span class="title">handle</span><span class="params">(Socket ots,String rMessage)</span></span>&#123;</div><div class="line">        System.out.println(<span class="string">"handle"</span>);</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"regi"</span>)) &#123;<span class="comment">//注册</span></div><div class="line">            rMessage = rMessage.substring(<span class="string">"regi"</span>.length());</div><div class="line">            String id = rMessage.substring(<span class="number">0</span>, rMessage.indexOf(<span class="string">','</span>));</div><div class="line">            String pwd = rMessage.substring(rMessage.indexOf(<span class="string">','</span>) + <span class="number">1</span>);</div><div class="line">            <span class="keyword">return</span> newRegisUser(id, pwd);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"logi"</span>)) &#123;<span class="comment">//登录</span></div><div class="line">            System.out.println(<span class="string">"logi"</span>);</div><div class="line">            rMessage = rMessage.substring(<span class="string">"logi"</span>.length());</div><div class="line">            String id = rMessage.substring(<span class="number">0</span>, rMessage.indexOf(<span class="string">','</span>));</div><div class="line">            String pwd = rMessage.substring(rMessage.indexOf(<span class="string">','</span>) + <span class="number">1</span>,</div><div class="line">                    rMessage.lastIndexOf(<span class="string">','</span>));</div><div class="line">            String portstr = rMessage.substring(rMessage.lastIndexOf(<span class="string">','</span>) + <span class="number">1</span>);</div><div class="line">            <span class="keyword">int</span> port = <span class="keyword">new</span> Integer(portstr);</div><div class="line">            String IP = ots.getInetAddress().getHostAddress();</div><div class="line">            <span class="keyword">return</span> loginCheck(id, pwd, IP, port);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"mesg"</span>)) &#123;<span class="comment">//聊天室消息</span></div><div class="line">            String mesg = rMessage.substring((<span class="string">"mesg"</span>).length());</div><div class="line">            sendMesg(mesg);</div><div class="line">            <span class="keyword">return</span> <span class="string">"getm"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"chat"</span>)) &#123;<span class="comment">//一对一消息</span></div><div class="line">            String chat = rMessage.substring((<span class="string">"chat"</span>).length());</div><div class="line">            String id = chat.substring(<span class="number">0</span>, chat.indexOf(<span class="string">':'</span>));</div><div class="line">            String mesg = chat.substring(chat.indexOf(<span class="string">':'</span>) + <span class="number">1</span>);</div><div class="line">            sendChat(id, mesg);</div><div class="line">            <span class="keyword">return</span> <span class="string">"getm"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"offl"</span>)) &#123;<span class="comment">//下线</span></div><div class="line">            String id = rMessage.substring((<span class="string">"offl"</span>).length());</div><div class="line">            oneUserOffline(id);</div><div class="line">            <span class="keyword">return</span> <span class="string">"getm"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="string">"getm"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">new</span> ServerServer(<span class="number">65142</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>Send</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomsend;</div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.PrintWriter;</div><div class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Send</span> </span>&#123;</div><div class="line">    Socket socket;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Send</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        socket = <span class="keyword">new</span> Socket();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">connect</span><span class="params">(String IP, <span class="keyword">int</span> port, <span class="keyword">int</span> timeout)</span> </span>&#123;<span class="comment">//连接</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            socket.connect(<span class="keyword">new</span> InetSocketAddress(IP, port), timeout);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">(String message)</span> </span>&#123;</div><div class="line">        PrintWriter writer=ChatRoomUtil.putMesgToSocket(socket, message);</div><div class="line">        StringBuffer buffer=<span class="keyword">new</span> StringBuffer();</div><div class="line">        BufferedReader reader=ChatRoomUtil.getMsgFromSocket(socket,buffer);</div><div class="line">        String rMessage = buffer.toString();</div><div class="line">        ChatRoomUtil.closeSocket(socket,reader,writer);</div><div class="line">        <span class="keyword">return</span> rMessage;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>LoginBox</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomclient;</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</div><div class="line"><span class="keyword">import</span> java.awt.event.MouseEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.MouseListener;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> chatroomsend.Send;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginBox</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span>, <span class="title">MouseListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">329711894663212488L</span>;</div><div class="line">    ClientServer myServer;</div><div class="line">    String serverIP;</div><div class="line">    <span class="keyword">int</span> serverPort;</div><div class="line">    JLabel l_account = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel l_password = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel l_regist = <span class="keyword">new</span> JLabel();</div><div class="line">    JTextField j_account = <span class="keyword">new</span> JTextField();</div><div class="line">    JPasswordField j_password = <span class="keyword">new</span> JPasswordField();</div><div class="line">    JButton submit = <span class="keyword">new</span> JButton();</div><div class="line">    JButton cancel = <span class="keyword">new</span> JButton();</div><div class="line">    JLabel clearAccount = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel clearPassword = <span class="keyword">new</span> JLabel();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginBox</span><span class="params">(String ip, <span class="keyword">int</span> port)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"登录"</span>);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            myServer = <span class="keyword">new</span> ClientServer(serverIP, serverPort);</div><div class="line">            Thread myServerThread = <span class="keyword">new</span> Thread(myServer);</div><div class="line">            myServerThread.start();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"服务器进程初始化失败，无法绑定端口。"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        serverIP = ip;</div><div class="line">        serverPort = port;</div><div class="line">        setLayout(<span class="keyword">null</span>);</div><div class="line">        l_account.setVisible(<span class="keyword">true</span>);</div><div class="line">        l_account.setBounds(<span class="number">80</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">30</span>);</div><div class="line">        l_account.setText(<span class="string">"账号:"</span>);</div><div class="line">        l_password.setVisible(<span class="keyword">true</span>);</div><div class="line">        l_password.setBounds(<span class="number">80</span>, <span class="number">80</span>, <span class="number">50</span>, <span class="number">30</span>);</div><div class="line">        l_password.setText(<span class="string">"密码:"</span>);</div><div class="line">        j_account.setBounds(<span class="number">130</span>, <span class="number">40</span>, <span class="number">150</span>, <span class="number">30</span>);</div><div class="line">        j_password.setBounds(<span class="number">130</span>, <span class="number">80</span>, <span class="number">150</span>, <span class="number">30</span>);</div><div class="line">        clearAccount.setBounds(<span class="number">280</span>, <span class="number">42</span>, <span class="number">26</span>, <span class="number">26</span>);</div><div class="line">        clearPassword.setBounds(<span class="number">280</span>, <span class="number">82</span>, <span class="number">26</span>, <span class="number">26</span>);</div><div class="line">        submit.setBounds(<span class="number">100</span>, <span class="number">130</span>, <span class="number">80</span>, <span class="number">30</span>);</div><div class="line">        submit.setText(<span class="string">"登录"</span>);</div><div class="line">        cancel.setText(<span class="string">"取消"</span>);</div><div class="line">        clearAccount.setText(<span class="string">"X"</span>);</div><div class="line">        clearPassword.setText(<span class="string">"X"</span>);</div><div class="line">        clearAccount.setOpaque(<span class="keyword">true</span>);</div><div class="line">        clearPassword.setOpaque(<span class="keyword">true</span>);</div><div class="line">        clearAccount.setBackground(Color.LIGHT_GRAY);</div><div class="line">        clearPassword.setBackground(Color.LIGHT_GRAY);</div><div class="line">        clearAccount.setHorizontalAlignment(JLabel.CENTER);</div><div class="line">        clearPassword.setHorizontalAlignment(JLabel.CENTER);</div><div class="line">        submit.setBackground(Color.LIGHT_GRAY);</div><div class="line">        cancel.setBackground(Color.LIGHT_GRAY);</div><div class="line">        submit.addActionListener(<span class="keyword">this</span>);</div><div class="line">        cancel.addActionListener(<span class="keyword">this</span>);</div><div class="line">        cancel.setBounds(<span class="number">190</span>, <span class="number">130</span>, <span class="number">80</span>, <span class="number">30</span>);</div><div class="line">        l_regist.setBounds(<span class="number">270</span>, <span class="number">200</span>, <span class="number">70</span>, <span class="number">30</span>);</div><div class="line">        l_regist.setText(<span class="string">"没有账号?"</span>);</div><div class="line">        <span class="keyword">this</span>.add(l_account);</div><div class="line">        <span class="keyword">this</span>.add(l_password);</div><div class="line">        <span class="keyword">this</span>.add(j_account);</div><div class="line">        <span class="keyword">this</span>.add(j_password);</div><div class="line">        <span class="keyword">this</span>.add(submit);</div><div class="line">        <span class="keyword">this</span>.add(cancel);</div><div class="line">        <span class="keyword">this</span>.add(l_regist);</div><div class="line">        <span class="keyword">this</span>.add(clearAccount);</div><div class="line">        <span class="keyword">this</span>.add(clearPassword);</div><div class="line">        setBounds(<span class="number">480</span>, <span class="number">240</span>, <span class="number">370</span>, <span class="number">270</span>);</div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">        setResizable(<span class="keyword">false</span>);</div><div class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(EXIT_ON_CLOSE);</div><div class="line">        validate();</div><div class="line">        l_regist.addMouseListener(<span class="keyword">this</span>);</div><div class="line">        clearAccount.addMouseListener(<span class="keyword">this</span>);</div><div class="line">        clearPassword.addMouseListener(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function">String <span class="title">checkPwd</span><span class="params">(String id, String pwd)</span> </span>&#123;</div><div class="line">        Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">        sendClient.connect(serverIP, serverPort, <span class="number">1000</span>);</div><div class="line">        String ret= sendClient</div><div class="line">                .send(<span class="string">"logi"</span> + id + <span class="string">","</span> + pwd + <span class="string">","</span> + myServer.getMyServerPort());</div><div class="line">        <span class="keyword">if</span> (ret.compareTo(<span class="string">"yes"</span>) == <span class="number">0</span>) &#123;</div><div class="line">            myServer.chatRoom = <span class="keyword">new</span> ChatRoom(id, serverIP, serverPort);</div><div class="line">            dispose();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ret.compareTo(<span class="string">"wrong"</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"登录失败，密码有误。"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ret.compareTo(<span class="string">"alreadyonline"</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"登录失败，该账号已在线"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ret.compareTo(<span class="string">"nothisid"</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"登录失败，账号不存在。"</span>);</div><div class="line">            <span class="keyword">new</span> RegisBox(serverIP, serverPort,</div><div class="line">                    myServer.getMyServerPort());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</div><div class="line">        Object t = e.getSource();</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JButton.class) &#123;</div><div class="line">            JButton button = (JButton) (t);</div><div class="line">            <span class="keyword">if</span> (button.getText().compareTo(<span class="string">"登录"</span>) == <span class="number">0</span>) &#123;</div><div class="line">                String id = j_account.getText();</div><div class="line">                String pwd = String.valueOf(j_password.getPassword());</div><div class="line">                <span class="keyword">if</span> (id.compareTo(<span class="string">""</span>) == <span class="number">0</span> || pwd.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">                    ChatRoomUtil.showErrorBox(<span class="string">"账号与密码均不能为空"</span>);</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                checkPwd(id, pwd);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (button.getText().compareTo(<span class="string">"取消"</span>) == <span class="number">0</span>) &#123;</div><div class="line">                dispose();</div><div class="line">                System.exit(<span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseClicked</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().equals(l_regist)) &#123;</div><div class="line">            <span class="keyword">new</span> RegisBox(serverIP, serverPort,</div><div class="line">                    myServer.getMyServerPort());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (e.getSource().equals(clearAccount)) &#123;</div><div class="line">            j_account.setText(<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (e.getSource().equals(clearPassword)) &#123;</div><div class="line">            j_password.setText(<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mousePressed</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseReleased</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseEntered</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        Object x = e.getSource();</div><div class="line">        <span class="keyword">if</span> (x.equals(l_regist)) &#123;</div><div class="line">            JLabel l = (JLabel) x;</div><div class="line">            l.setForeground(Color.blue);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (x.equals(clearAccount) || x.equals(clearPassword)) &#123;</div><div class="line">            JLabel l = (JLabel) x;</div><div class="line">            l.setBackground(Color.GRAY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseExited</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        Object x = e.getSource();</div><div class="line">        <span class="keyword">if</span> (x.equals(l_regist)) &#123;</div><div class="line">            JLabel l = (JLabel) x;</div><div class="line">            l.setForeground(Color.BLACK);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (x.equals(clearAccount) || x.equals(clearPassword)) &#123;</div><div class="line">            JLabel l = (JLabel) x;</div><div class="line">            l.setBackground(Color.LIGHT_GRAY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        String serverIP = <span class="string">"127.0.0.1"</span>;</div><div class="line">        <span class="keyword">int</span> serverPort = <span class="number">65142</span>;</div><div class="line">        <span class="keyword">new</span> LoginBox(serverIP, serverPort);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>RegisBox</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomclient;</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> chatroomsend.Send;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisBox</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">5795626909275119718L</span>;</div><div class="line">    String serverIP;</div><div class="line">    <span class="keyword">int</span> serverPort;</div><div class="line">    <span class="keyword">int</span> myServerPort;</div><div class="line">    JLabel id_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel pwd_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel pwdCheck_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel num_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel firstName_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel lastName_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel age_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel sex_label = <span class="keyword">new</span> JLabel();</div><div class="line">    JTextField id_text = <span class="keyword">new</span> JTextField();</div><div class="line">    JPasswordField pwd_text = <span class="keyword">new</span> JPasswordField();</div><div class="line">    JPasswordField pwdCheck_text = <span class="keyword">new</span> JPasswordField();</div><div class="line">    JTextField num_text = <span class="keyword">new</span> JTextField();</div><div class="line">    JTextField firstName_text = <span class="keyword">new</span> JTextField();</div><div class="line">    JTextField lastName_text = <span class="keyword">new</span> JTextField();</div><div class="line">    JTextField age_text = <span class="keyword">new</span> JTextField();</div><div class="line">    JComboBox sex_box = <span class="keyword">new</span> JComboBox();</div><div class="line">    JButton cancel = <span class="keyword">new</span> JButton();</div><div class="line">    JButton regis = <span class="keyword">new</span> JButton();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RegisBox</span><span class="params">(String serverIP, <span class="keyword">int</span> serverPort, <span class="keyword">int</span> myServerPort)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        <span class="keyword">this</span>.serverIP = serverIP;</div><div class="line">        <span class="keyword">this</span>.serverPort = serverPort;</div><div class="line">        <span class="keyword">this</span>.myServerPort = myServerPort;</div><div class="line">        setLayout(<span class="keyword">null</span>);</div><div class="line">        setTitle(<span class="string">"注册"</span>);</div><div class="line">        id_label.setBounds(<span class="number">60</span>, <span class="number">23</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        pwd_label.setBounds(<span class="number">60</span>, <span class="number">53</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        pwdCheck_label.setBounds(<span class="number">50</span>, <span class="number">83</span>, <span class="number">70</span>, <span class="number">20</span>);</div><div class="line">        num_label.setBounds(<span class="number">60</span>, <span class="number">113</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        firstName_label.setBounds(<span class="number">60</span>, <span class="number">143</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        lastName_label.setBounds(<span class="number">60</span>, <span class="number">173</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        age_label.setBounds(<span class="number">60</span>, <span class="number">203</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        sex_label.setBounds(<span class="number">60</span>, <span class="number">233</span>, <span class="number">50</span>, <span class="number">20</span>);</div><div class="line">        id_text.setBounds(<span class="number">130</span>, <span class="number">20</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        pwd_text.setBounds(<span class="number">130</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        pwdCheck_text.setBounds(<span class="number">130</span>, <span class="number">80</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        num_text.setBounds(<span class="number">130</span>, <span class="number">110</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        firstName_text.setBounds(<span class="number">130</span>, <span class="number">140</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        lastName_text.setBounds(<span class="number">130</span>, <span class="number">170</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        age_text.setBounds(<span class="number">130</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        sex_box.setBounds(<span class="number">130</span>, <span class="number">230</span>, <span class="number">200</span>, <span class="number">26</span>);</div><div class="line">        regis.setBounds(<span class="number">190</span>, <span class="number">270</span>, <span class="number">70</span>, <span class="number">30</span>);</div><div class="line">        cancel.setBounds(<span class="number">270</span>, <span class="number">270</span>, <span class="number">70</span>, <span class="number">30</span>);</div><div class="line">        id_label.setText(<span class="string">"账号"</span>);</div><div class="line">        pwd_label.setText(<span class="string">"密码"</span>);</div><div class="line">        pwdCheck_label.setText(<span class="string">"密码确认"</span>);</div><div class="line">        num_label.setText(<span class="string">"编号"</span>);</div><div class="line">        firstName_label.setText(<span class="string">"名"</span>);</div><div class="line">        lastName_label.setText(<span class="string">"姓"</span>);</div><div class="line">        age_label.setText(<span class="string">"年龄"</span>);</div><div class="line">        sex_label.setText(<span class="string">"性别"</span>);</div><div class="line">        sex_box.addItem(<span class="string">"男"</span>);</div><div class="line">        sex_box.addItem(<span class="string">"女"</span>);</div><div class="line">        regis.setText(<span class="string">"提交"</span>);</div><div class="line">        cancel.setText(<span class="string">"取消"</span>);</div><div class="line">        regis.setBackground(Color.LIGHT_GRAY);</div><div class="line">        cancel.setBackground(Color.LIGHT_GRAY);</div><div class="line">        sex_box.setBackground(Color.LIGHT_GRAY);</div><div class="line">        regis.addActionListener(<span class="keyword">this</span>);</div><div class="line">        cancel.addActionListener(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.add(id_label);</div><div class="line">        <span class="keyword">this</span>.add(pwd_label);</div><div class="line">        <span class="keyword">this</span>.add(pwdCheck_label);</div><div class="line">        <span class="keyword">this</span>.add(num_label);</div><div class="line">        <span class="keyword">this</span>.add(firstName_label);</div><div class="line">        <span class="keyword">this</span>.add(lastName_label);</div><div class="line">        <span class="keyword">this</span>.add(age_label);</div><div class="line">        <span class="keyword">this</span>.add(sex_label);</div><div class="line">        <span class="keyword">this</span>.add(id_text);</div><div class="line">        <span class="keyword">this</span>.add(pwd_text);</div><div class="line">        <span class="keyword">this</span>.add(pwdCheck_text);</div><div class="line">        <span class="keyword">this</span>.add(num_text);</div><div class="line">        <span class="keyword">this</span>.add(firstName_text);</div><div class="line">        <span class="keyword">this</span>.add(lastName_text);</div><div class="line">        <span class="keyword">this</span>.add(age_text);</div><div class="line">        <span class="keyword">this</span>.add(sex_box);</div><div class="line">        <span class="keyword">this</span>.add(regis);</div><div class="line">        <span class="keyword">this</span>.add(cancel);</div><div class="line">        setBounds(<span class="number">200</span>, <span class="number">200</span>, <span class="number">500</span>, <span class="number">400</span>);</div><div class="line">        validate();</div><div class="line">        setResizable(<span class="keyword">false</span>);</div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">regis</span><span class="params">(String serverIP, <span class="keyword">int</span> serverPort, String id, String pwd,</span></span></div><div class="line">            <span class="keyword">int</span> myServerPort) &#123;</div><div class="line">        Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">        sendClient.connect(serverIP, serverPort, <span class="number">1000</span>);</div><div class="line">        <span class="keyword">if</span> (sendClient.send(<span class="string">"regi"</span> + id + <span class="string">","</span> + pwd).compareTo(<span class="string">"yes"</span>) == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</div><div class="line">        String id = id_text.getText();</div><div class="line">        String pwd = String.valueOf(pwd_text.getPassword());</div><div class="line">        String pwdc = String.valueOf(pwdCheck_text.getPassword());</div><div class="line">        String fName = firstName_text.getText();</div><div class="line">        String lName = lastName_text.getText();</div><div class="line">        String age = age_text.getText();</div><div class="line">        String num = num_text.getText();</div><div class="line">        String sex = sex_box.getSelectedItem().toString();</div><div class="line">        <span class="keyword">if</span> (id.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"账号不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (pwd.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"密码不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (pwdc.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"请确认密码"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (pwd.compareTo(pwdc) != <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"两次输入的密码不符"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (num.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"编号不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (fName.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"名不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (lName.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"姓不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (age.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"年龄不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (sex.compareTo(<span class="string">""</span>) == <span class="number">0</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"性别不能为空"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (regis(serverIP, serverPort, id, pwd, myServerPort)) &#123;</div><div class="line">            dispose();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"注册失败。该用户已存在"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</div><div class="line">        Object t = e.getSource();</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JButton.class) &#123;</div><div class="line">            JButton button = (JButton) (t);</div><div class="line">            <span class="keyword">if</span> (button.getText().compareTo(<span class="string">"提交"</span>) == <span class="number">0</span>) &#123;</div><div class="line">                check();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (button.getText().compareTo(<span class="string">"取消"</span>) == <span class="number">0</span>) &#123;</div><div class="line">                dispose();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ClientServer</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomclient;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"><span class="keyword">import</span> chatroomutil.Server;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientServer</span> <span class="keyword">extends</span> <span class="title">Server</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    ChatRoom chatRoom;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> myPort;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClientServer</span><span class="params">(String serverIP, <span class="keyword">int</span> serverPort)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        myPort = init();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getMyServerPort</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> myPort;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">createServerSocket</span><span class="params">(<span class="keyword">int</span> i)</span> <span class="keyword">throws</span> IOException </span>&#123;<span class="comment">//绑定端口i</span></div><div class="line">        <span class="keyword">if</span> (i &gt;= <span class="number">65536</span>) &#123;</div><div class="line">            ChatRoomUtil.showErrorBox(<span class="string">"ClientServer无端口可绑定"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            sSocket = <span class="keyword">new</span> ServerSocket(i);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            <span class="keyword">return</span> createServerSocket(i + <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">int</span> port = createServerSocket(<span class="number">1025</span>);</div><div class="line">        <span class="keyword">return</span> port;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">handle</span><span class="params">(Socket ots,String rMessage)</span></span>&#123;</div><div class="line">        String message = <span class="string">"getm"</span>;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"newf"</span>)) &#123;</div><div class="line">            <span class="keyword">while</span> (chatRoom == <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    Thread.sleep(<span class="number">300</span>);</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                    ChatRoomUtil.showErrorBox(<span class="string">"ClientServer在Sleep时出错"</span>);</div><div class="line">                    System.exit(-<span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            String ids = rMessage.substring((<span class="string">"newf"</span>).length());</div><div class="line">            String[] idArray = ids.split(<span class="string">";"</span>);</div><div class="line">            chatRoom.addFriend(idArray);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"offl"</span>)) &#123;</div><div class="line">            String name = rMessage.substring((<span class="string">"offl"</span>).length());</div><div class="line">            chatRoom.removeFriend(name);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"mesg"</span>)) &#123;</div><div class="line">            String mesg = rMessage.substring((<span class="string">"mesg"</span>).length());</div><div class="line">            chatRoom.addRecord(mesg);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rMessage.startsWith(<span class="string">"chat"</span>)) &#123;</div><div class="line">            String chat = rMessage.substring((<span class="string">"chat"</span>).length());</div><div class="line">            String id = chat.substring(<span class="number">0</span>, chat.indexOf(<span class="string">':'</span>));</div><div class="line">            String mesg = chat.substring(chat.indexOf(<span class="string">':'</span>) + <span class="number">1</span>);</div><div class="line">            chatRoom.dialogAddRecord(id, mesg);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> message;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        listen();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ChatRoom</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomclient;</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</div><div class="line"><span class="keyword">import</span> java.awt.event.MouseEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.MouseListener;</div><div class="line"><span class="keyword">import</span> java.awt.event.WindowAdapter;</div><div class="line"><span class="keyword">import</span> java.awt.event.WindowEvent;</div><div class="line"><span class="keyword">import</span> java.util.HashSet;</div><div class="line"><span class="keyword">import</span> java.util.Hashtable;</div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"><span class="keyword">import</span> java.util.TimerTask;</div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> javax.swing.event.CaretEvent;</div><div class="line"><span class="keyword">import</span> javax.swing.event.CaretListener;</div><div class="line"><span class="keyword">import</span> chatroomsend.Send;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatRoom</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span>, <span class="title">MouseListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">9016166784223701159L</span>;</div><div class="line">    String myId;</div><div class="line">    String serverIP;</div><div class="line">    <span class="keyword">int</span> serverPort;</div><div class="line">    JLabel chatRoomLabel = <span class="keyword">new</span> JLabel();</div><div class="line">    JLabel onlineLabel = <span class="keyword">new</span> JLabel();</div><div class="line">    JTextArea chatArea = <span class="keyword">new</span> JTextArea();</div><div class="line">    JPanel onlineArea = <span class="keyword">new</span> JPanel();</div><div class="line">    JTextArea sendArea = <span class="keyword">new</span> JTextArea(<span class="number">5</span>, <span class="number">20</span>);</div><div class="line">    JButton sendButton = <span class="keyword">new</span> JButton();</div><div class="line">    JScrollPane chatScroll = <span class="keyword">new</span> JScrollPane(chatArea);</div><div class="line">    JScrollPane onlineScroll = <span class="keyword">new</span> JScrollPane(onlineArea);</div><div class="line">    JScrollPane sendScroll = <span class="keyword">new</span> JScrollPane(sendArea);</div><div class="line">    JPanel chatPanel = <span class="keyword">new</span> JPanel();</div><div class="line">    JPanel onlinePanel = <span class="keyword">new</span> JPanel();</div><div class="line">    JPanel sendPanel = <span class="keyword">new</span> JPanel();</div><div class="line">    JPanel chatAndOnlinePanel = <span class="keyword">new</span> JPanel();</div><div class="line">    HashSet&lt;String&gt; friends = <span class="keyword">new</span> HashSet&lt;String&gt;();</div><div class="line">    Hashtable&lt;String, ChatDialog&gt; chatDialogs = <span class="keyword">new</span> Hashtable&lt;String, ChatDialog&gt;();</div><div class="line">    BorderLayout mainLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout chatLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout onlineLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout sendLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout chatAndOnlineLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    FlowLayout onlineAreaLayout = <span class="keyword">new</span> FlowLayout();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChatRoom</span><span class="params">(String id, String serverIP, <span class="keyword">int</span> port)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"聊天室   "</span> + id);</div><div class="line">        <span class="keyword">this</span>.myId = id;</div><div class="line">        <span class="keyword">this</span>.serverIP = serverIP;</div><div class="line">        <span class="keyword">this</span>.serverPort = port;</div><div class="line">        mainLayout.setVgap(<span class="number">5</span>);</div><div class="line">        sendLayout.setHgap(<span class="number">10</span>);</div><div class="line">        chatAndOnlineLayout.setHgap(<span class="number">15</span>);</div><div class="line">        onlineAreaLayout.setVgap(<span class="number">1</span>);</div><div class="line">        <span class="keyword">this</span>.setLayout(mainLayout);</div><div class="line">        chatPanel.setLayout(chatLayout);</div><div class="line">        onlinePanel.setLayout(onlineLayout);</div><div class="line">        sendPanel.setLayout(sendLayout);</div><div class="line">        chatAndOnlinePanel.setLayout(chatAndOnlineLayout);</div><div class="line">        chatArea.setLineWrap(<span class="keyword">true</span>);</div><div class="line">        sendArea.setLineWrap(<span class="keyword">true</span>);</div><div class="line">        onlineArea.setLayout(onlineAreaLayout);</div><div class="line">        onlineArea.setPreferredSize(<span class="keyword">new</span> Dimension(<span class="number">130</span>, <span class="number">200</span>));</div><div class="line">        sendButton.setText(<span class="string">"   发送    "</span>);</div><div class="line">        sendButton.setBackground(Color.LIGHT_GRAY);</div><div class="line">        sendButton.addActionListener(<span class="keyword">this</span>);</div><div class="line">        onlineLabel.setText(<span class="string">"在线好友(点击可开始聊天)"</span>);</div><div class="line">        chatRoomLabel.setText(<span class="string">"聊天"</span>);</div><div class="line">        chatArea.setEditable(<span class="keyword">false</span>);</div><div class="line">        chatArea.setBackground(<span class="keyword">new</span> Color(<span class="number">230</span>, <span class="number">230</span>, <span class="number">230</span>));</div><div class="line">        chatPanel.add(chatRoomLabel, BorderLayout.NORTH);</div><div class="line">        chatPanel.add(chatScroll, BorderLayout.CENTER);</div><div class="line">        onlinePanel.add(onlineLabel, BorderLayout.NORTH);</div><div class="line">        onlinePanel.add(onlineScroll, BorderLayout.CENTER);</div><div class="line">        sendPanel.add(sendScroll, BorderLayout.CENTER);</div><div class="line">        sendPanel.add(sendButton, BorderLayout.EAST);</div><div class="line">        chatAndOnlinePanel.add(chatPanel, BorderLayout.CENTER);</div><div class="line">        chatAndOnlinePanel.add(onlinePanel, BorderLayout.EAST);</div><div class="line">        <span class="keyword">this</span>.add(sendPanel, BorderLayout.SOUTH);</div><div class="line">        <span class="keyword">this</span>.add(chatAndOnlinePanel, BorderLayout.CENTER);</div><div class="line">        friends.add(myId);</div><div class="line">        <span class="keyword">this</span>.setBounds(<span class="number">200</span>, <span class="number">200</span>, <span class="number">600</span>, <span class="number">650</span>);</div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">        reFreshOnlineArea();</div><div class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(DO_NOTHING_ON_CLOSE);</div><div class="line">        <span class="keyword">this</span>.addWindowListener(<span class="keyword">new</span> WindowAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">windowClosing</span><span class="params">(WindowEvent e)</span> </span>&#123;<span class="comment">//点击关闭按钮时发送下线消息</span></div><div class="line">                sendOffLine();</div><div class="line">                System.exit(<span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        sendArea.addCaretListener(<span class="keyword">new</span> CaretListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">caretUpdate</span><span class="params">(CaretEvent e)</span> </span>&#123;</div><div class="line">                String str = sendArea.getText();</div><div class="line">                <span class="keyword">if</span> (str.length() &gt; <span class="number">5000</span>) &#123;</div><div class="line">                    ChatRoomUtil.showErrorBox(<span class="string">"字数过多，超出限制。"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">new</span> java.util.Timer().schedule(<span class="keyword">new</span> TimerTask() &#123;<span class="comment">//定时刷新界面</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                repaint();</div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="number">400</span>, <span class="number">400</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">reFreshOnlineArea</span><span class="params">()</span> </span>&#123;<span class="comment">//刷新当前在线用户</span></div><div class="line">        <span class="keyword">int</span> size = friends.size();</div><div class="line">        onlineArea.removeAll();</div><div class="line">        Iterator&lt;String&gt; it = friends.iterator();</div><div class="line">        <span class="keyword">while</span> (it.hasNext()) &#123;</div><div class="line">            String str = it.next();</div><div class="line">            String id = str;</div><div class="line">            JLabel label = <span class="keyword">new</span> JLabel(id);</div><div class="line">            label.addMouseListener(<span class="keyword">this</span>);</div><div class="line">            label.setPreferredSize(<span class="keyword">new</span> Dimension(<span class="number">130</span>, <span class="number">20</span>));</div><div class="line">            label.setBackground(Color.GRAY);</div><div class="line">            label.setForeground(Color.WHITE);</div><div class="line">            label.setHorizontalAlignment(JLabel.CENTER);</div><div class="line">            label.setOpaque(<span class="keyword">true</span>);</div><div class="line">            onlineArea.add(label);</div><div class="line">        &#125;</div><div class="line">        onlineArea.setPreferredSize(<span class="keyword">new</span> Dimension(<span class="number">130</span>, size * <span class="number">22</span>));</div><div class="line">        <span class="keyword">this</span>.repaint();</div><div class="line">        <span class="keyword">this</span>.validate();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sendOffLine</span><span class="params">()</span> </span>&#123;<span class="comment">//发送下线消息</span></div><div class="line">        Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">        sendClient.connect(serverIP, serverPort, <span class="number">1000</span>);</div><div class="line">        sendClient.send(<span class="string">"offl"</span> + myId);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addFriend</span><span class="params">(String[] fs)</span> </span>&#123;<span class="comment">//添加上线的用户</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fs.length; i++) &#123;</div><div class="line">            friends.add(fs[i]);</div><div class="line">        &#125;</div><div class="line">        reFreshOnlineArea();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">removeFriend</span><span class="params">(String friendID)</span> </span>&#123;<span class="comment">//移除一个用户（已下线）</span></div><div class="line">        friends.remove(friendID);</div><div class="line">        reFreshOnlineArea();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addRecord</span><span class="params">(String mesg)</span> </span>&#123;<span class="comment">//添加聊天记录</span></div><div class="line">        chatArea.append(mesg + <span class="string">"\n"</span>);</div><div class="line">        chatArea.setCaretPosition(chatArea.getText().length());</div><div class="line">        <span class="keyword">this</span>.validate();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">dialogAddRecord</span><span class="params">(String id, String mesg)</span> </span>&#123;<span class="comment">//给一对一聊天增加聊天记录</span></div><div class="line">        <span class="keyword">if</span> (chatDialogs.containsKey(id) == <span class="keyword">false</span>) &#123;</div><div class="line">            chatDialogs.put(id,</div><div class="line">                    <span class="keyword">new</span> ChatDialog(<span class="keyword">this</span>, myId, id, serverIP, serverPort));</div><div class="line">        &#125;</div><div class="line">        chatDialogs.get(id).addRecord(mesg);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">removeDialog</span><span class="params">(String id)</span> </span>&#123;<span class="comment">//移除一对一聊天</span></div><div class="line">        chatDialogs.remove(id);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">sendMessage</span><span class="params">(String mesg)</span> </span>&#123;<span class="comment">//发送群聊消息</span></div><div class="line">        Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">        sendClient.connect(serverIP, serverPort, <span class="number">1000</span>);</div><div class="line">        String getm = sendClient.send(<span class="string">"mesg"</span> + myId + <span class="string">":  \n"</span> + mesg);</div><div class="line">        <span class="keyword">return</span> getm;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JButton.class) &#123;</div><div class="line">            sendMessage(sendArea.getText());</div><div class="line">            sendArea.setText(<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseClicked</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JLabel.class) &#123;</div><div class="line">            JLabel l = (JLabel) e.getSource();</div><div class="line">            <span class="keyword">if</span> (l.getText().compareTo(myId) == <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (chatDialogs.containsKey(l.getText())) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            chatDialogs.put(l.getText(), <span class="keyword">new</span> ChatDialog(<span class="keyword">this</span>, myId, l.getText(),</div><div class="line">                    serverIP, serverPort));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseEntered</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JLabel.class) &#123;</div><div class="line">            JLabel l = (JLabel) e.getSource();</div><div class="line">            l.setBackground(Color.LIGHT_GRAY);</div><div class="line">            l.setForeground(Color.BLACK);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseExited</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JLabel.class) &#123;</div><div class="line">            JLabel l = (JLabel) e.getSource();</div><div class="line">            l.setBackground(Color.GRAY);</div><div class="line">            l.setForeground(Color.WHITE);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mousePressed</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseReleased</span><span class="params">(MouseEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>ChatDialog</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> chatroomclient;</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</div><div class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</div><div class="line"><span class="keyword">import</span> java.awt.event.WindowAdapter;</div><div class="line"><span class="keyword">import</span> java.awt.event.WindowEvent;</div><div class="line"><span class="keyword">import</span> java.util.HashSet;</div><div class="line"><span class="keyword">import</span> java.util.TimerTask;</div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> javax.swing.event.CaretEvent;</div><div class="line"><span class="keyword">import</span> javax.swing.event.CaretListener;</div><div class="line"><span class="keyword">import</span> chatroomsend.Send;</div><div class="line"><span class="keyword">import</span> chatroomutil.ChatRoomUtil;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatDialog</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1437996471885472344L</span>;</div><div class="line">    String myId;</div><div class="line">    String otsId;</div><div class="line">    String serverIP;</div><div class="line">    <span class="keyword">int</span> serverPort;</div><div class="line">    JLabel chatRoomLabel = <span class="keyword">new</span> JLabel();</div><div class="line">    JTextArea chatArea = <span class="keyword">new</span> JTextArea();</div><div class="line">    JTextArea sendArea = <span class="keyword">new</span> JTextArea(<span class="number">5</span>, <span class="number">20</span>);</div><div class="line">    JButton sendButton = <span class="keyword">new</span> JButton();</div><div class="line">    JScrollPane chatScroll = <span class="keyword">new</span> JScrollPane(chatArea);</div><div class="line">    JScrollPane sendScroll = <span class="keyword">new</span> JScrollPane(sendArea);</div><div class="line">    JPanel chatPanel = <span class="keyword">new</span> JPanel();</div><div class="line">    JPanel sendPanel = <span class="keyword">new</span> JPanel();</div><div class="line">    HashSet&lt;String&gt; friends = <span class="keyword">new</span> HashSet&lt;String&gt;();</div><div class="line">    BorderLayout mainLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout chatLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    BorderLayout sendLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    ChatRoom chatRoom;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChatDialog</span><span class="params">(<span class="keyword">final</span> ChatRoom chatRoom, String id, <span class="keyword">final</span> String otsId,</span></span></div><div class="line">            String serverIP, <span class="keyword">int</span> port) &#123;</div><div class="line">        <span class="keyword">super</span>(id + <span class="string">"与"</span> + otsId + <span class="string">"聊天"</span>);</div><div class="line">        <span class="keyword">this</span>.chatRoom = chatRoom;</div><div class="line">        <span class="keyword">this</span>.myId = id;</div><div class="line">        <span class="keyword">this</span>.otsId = otsId;</div><div class="line">        <span class="keyword">this</span>.serverIP = serverIP;</div><div class="line">        <span class="keyword">this</span>.serverPort = port;</div><div class="line">        mainLayout.setVgap(<span class="number">5</span>);</div><div class="line">        sendLayout.setHgap(<span class="number">10</span>);</div><div class="line">        <span class="keyword">this</span>.setLayout(mainLayout);</div><div class="line">        chatPanel.setLayout(chatLayout);</div><div class="line">        sendPanel.setLayout(sendLayout);</div><div class="line">        chatArea.setLineWrap(<span class="keyword">true</span>);</div><div class="line">        sendArea.setLineWrap(<span class="keyword">true</span>);</div><div class="line">        sendButton.setText(<span class="string">"   发送    "</span>);</div><div class="line">        sendButton.setBackground(Color.LIGHT_GRAY);</div><div class="line">        sendButton.addActionListener(<span class="keyword">this</span>);</div><div class="line">        chatRoomLabel.setText(<span class="string">"聊天"</span>);</div><div class="line">        chatArea.setEditable(<span class="keyword">false</span>);</div><div class="line">        chatArea.setBackground(<span class="keyword">new</span> Color(<span class="number">230</span>, <span class="number">230</span>, <span class="number">230</span>));</div><div class="line">        chatPanel.add(chatRoomLabel, BorderLayout.NORTH);</div><div class="line">        chatPanel.add(chatScroll, BorderLayout.CENTER);</div><div class="line">        sendPanel.add(sendScroll, BorderLayout.CENTER);</div><div class="line">        sendPanel.add(sendButton, BorderLayout.EAST);</div><div class="line">        <span class="keyword">this</span>.add(sendPanel, BorderLayout.SOUTH);</div><div class="line">        <span class="keyword">this</span>.add(chatPanel, BorderLayout.CENTER);</div><div class="line">        <span class="keyword">this</span>.setBounds(<span class="number">200</span>, <span class="number">200</span>, <span class="number">530</span>, <span class="number">600</span>);</div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(DISPOSE_ON_CLOSE);</div><div class="line">        sendArea.addCaretListener(<span class="keyword">new</span> CaretListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">caretUpdate</span><span class="params">(CaretEvent e)</span> </span>&#123;</div><div class="line">                String str = sendArea.getText();</div><div class="line">                <span class="keyword">if</span> (str.length() &gt; <span class="number">5000</span>) &#123;</div><div class="line">                    ChatRoomUtil.showErrorBox(<span class="string">"字数过多，超出限制。"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(DO_NOTHING_ON_CLOSE);</div><div class="line">        <span class="keyword">this</span>.addWindowListener(<span class="keyword">new</span> WindowAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">windowClosing</span><span class="params">(WindowEvent e)</span> </span>&#123;<span class="comment">//关闭窗口后，ChatRoom要移除该对话</span></div><div class="line">                chatRoom.removeDialog(otsId);</div><div class="line">                dispose();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">new</span> java.util.Timer().schedule(<span class="keyword">new</span> TimerTask() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                repaint();</div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="number">400</span>, <span class="number">400</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addRecord</span><span class="params">(String mesg)</span> </span>&#123;</div><div class="line">        chatArea.append(mesg + <span class="string">"\n"</span>);</div><div class="line">        chatArea.setCaretPosition(chatArea.getText().length());</div><div class="line">        <span class="keyword">this</span>.validate();</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">sendMessage</span><span class="params">(String mesg)</span> </span>&#123;</div><div class="line">        Send sendClient = <span class="keyword">new</span> Send();</div><div class="line">        sendClient.connect(serverIP, serverPort, <span class="number">1000</span>);</div><div class="line">        String getm = sendClient.send(</div><div class="line">                <span class="string">"chat"</span> + otsId + <span class="string">":"</span> + myId + <span class="string">":"</span> + myId + <span class="string">":   \n"</span> + mesg);</div><div class="line">        addRecord(myId + <span class="string">":   \n"</span> + mesg);</div><div class="line">        <span class="keyword">return</span> getm;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (e.getSource().getClass() == JButton.class) &#123;</div><div class="line">            sendMessage(sendArea.getText());</div><div class="line">            sendArea.setText(<span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>Users.txt</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line">1:1</div><div class="line">2:2</div><div class="line">3:3</div><div class="line">4:4</div><div class="line">5:5</div><div class="line">6:6</div><div class="line">7:7</div><div class="line">8:8</div><div class="line">9:9</div><div class="line">10:10</div><div class="line">11:11</div><div class="line">12:12</div><div class="line">13:13</div><div class="line">14:14</div><div class="line">15:15</div><div class="line">16:16</div><div class="line">17:17</div><div class="line">18:18</div><div class="line">19:19</div><div class="line">20:20</div><div class="line">21:21</div><div class="line">22:22</div><div class="line">23:23</div><div class="line">24:24</div><div class="line">25:25</div><div class="line">26:26</div><div class="line">27:27</div><div class="line">28:28</div><div class="line">29:29</div><div class="line">30:30</div><div class="line">31:31</div><div class="line">32:32</div><div class="line">33:33</div><div class="line">34:34</div><div class="line">35:35</div><div class="line">36:36</div><div class="line">37:37</div><div class="line">38:38</div><div class="line">39:39</div><div class="line">40:40</div><div class="line">41:41</div><div class="line">42:42</div><div class="line">43:43</div><div class="line">44:44</div><div class="line">45:45</div><div class="line">46:46</div><div class="line">47:47</div><div class="line">48:48</div><div class="line">49:49</div><div class="line">50:50</div><div class="line">51:51</div><div class="line">52:52</div><div class="line">53:53</div><div class="line">54:54</div><div class="line">55:55</div><div class="line">56:56</div><div class="line">57:57</div><div class="line">58:58</div><div class="line">59:59</div><div class="line">60:60</div><div class="line">61:61</div><div class="line">62:62</div><div class="line">63:63</div><div class="line">64:64</div><div class="line">65:65</div><div class="line">66:66</div><div class="line">67:67</div><div class="line">68:68</div><div class="line">69:69</div><div class="line">70:70</div><div class="line">71:71</div><div class="line">72:72</div><div class="line">73:73</div><div class="line">74:74</div><div class="line">75:75</div><div class="line">76:76</div><div class="line">77:77</div><div class="line">78:78</div><div class="line">79:79</div><div class="line">80:80</div><div class="line">81:81</div><div class="line">82:82</div><div class="line">83:83</div><div class="line">84:84</div><div class="line">85:85</div><div class="line">86:86</div><div class="line">87:87</div><div class="line">88:88</div><div class="line">89:89</div><div class="line">90:90</div><div class="line">91:91</div><div class="line">92:92</div><div class="line">93:93</div><div class="line">94:94</div><div class="line">95:95</div><div class="line">96:96</div><div class="line">aa:aa</div><div class="line">qq:qq</div><div class="line">ww:ww</div><div class="line">ee:ee</div><div class="line">guochengxin:guochengxin</div><div class="line">huoda:huoda</div><div class="line">zhangfa:zhangfa</div><div class="line">hanyu:hanyu</div><div class="line">maxuewei:maxuewei</div><div class="line">lizeyu:lizeyu</div></pre></td></tr></table></figure></p>
<ul>
<li>写于大三下实训期间</li>
<li>随笔写于2016.7.13</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/08/俄罗斯C++/" itemprop="url">
                  俄罗斯方块（Win32实现，Codeblocks+GCC编译）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-08T13:08:59+08:00" content="2016-05-08">
              2016-05-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="缘起："><a href="#缘起：" class="headerlink" title="缘起："></a>缘起：</h3><p>　　在玩Codeblocks自带的俄罗斯方块时觉得不错，然而有时间限制。所以想自己再写一个。</p>
<blockquote>
<p>后来发现在设置中是可以取消时间限制的。。。Orz</p>
</blockquote>
<h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p><img src="/imgs/trisc++1.png" alt="xiaoguo1"></p>
<h3 id="主要内容："><a href="#主要内容：" class="headerlink" title="主要内容："></a>主要内容：</h3><p>　　程序中有一个board数组，其中有要显示的部分，也有不显示的部分，不显示的部分都存储1。</p>
<p>　　如下图：</p>
<p><img src="/imgs/trisc++2.png" alt="neirong">   　　　　</p>
<p>　　shape采用4*4数组(shape)保存。如：<br>&gt;<br>0 0 0 0<br>0 1 0 0<br>1 1 1 0<br>0 0 0 0</p>
<p>　　另外用变量row和column保存shape数组左上角在board中的位置。</p>
<p>　　每次下落或左右移动，先对row和column做出改变，然后检测当前row和column下，shape是否重合了为1的格子，如果有重合，就说明shape出界了或者到达下落最低点，则要恢复row和column值。另外，如果是下落，还要将shape放在board上，并产生新的shape。</p>
<p>　　旋转时，先对shape数组进行旋转操作，然后检测重合，如果有重合，则反向旋转回来。</p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(UNICODE) &amp;&amp; !defined(_UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(_UNICODE) &amp;&amp; !defined(UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="comment">/*-----------------宏定义--------------------------------------------------------*/</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WIDTH 180</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEIGHT 400</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LONG_SLEEP 300</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BKCOLOR RGB(238,238,238)<span class="comment">//背景色</span></span></div><div class="line"><span class="comment">/*-----------------变量----------------------------------------------------------*/</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> shapes[<span class="number">7</span>][<span class="number">4</span>][<span class="number">4</span>];<span class="comment">//存储7个形状</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> high_score[<span class="number">4</span>]= &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;<span class="comment">//前三个元素存储最高分，最后一个元素存储此次得分</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> **shape;<span class="comment">//当前形状</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> **board;</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> M=<span class="number">15</span>;<span class="comment">//显示的列数</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> N=<span class="number">30</span>;<span class="comment">//显示的行数</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> MM=M+<span class="number">8</span>;<span class="comment">//board的列数</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> NN=N+<span class="number">4</span>;<span class="comment">//board的行数</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> LEFT=<span class="number">4</span>;<span class="comment">//显示的最左一列</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> RIGHT=LEFT+M<span class="number">-1</span>;<span class="comment">//显示的最右一列</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> TOP=<span class="number">0</span>;<span class="comment">//显示的最上一列</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> BOTTOM=N<span class="number">-1</span>;<span class="comment">//显示的最下一列</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> score=<span class="number">0</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> row=<span class="number">0</span>;<span class="comment">//形状所在行</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> column=MM/<span class="number">2</span>;<span class="comment">//形状坐在列</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">bool</span> is_pause=<span class="literal">false</span>;</div><div class="line"><span class="keyword">static</span> HBRUSH grey_brush =CreateSolidBrush (RGB(<span class="number">210</span>,<span class="number">210</span>,<span class="number">210</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH white_brush =CreateSolidBrush (RGB(<span class="number">130</span>,<span class="number">130</span>,<span class="number">130</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH bk_brush =CreateSolidBrush (BKCOLOR);</div><div class="line"><span class="keyword">static</span> HPEN hPen = CreatePen(PS_SOLID,<span class="number">1</span>,RGB(<span class="number">147</span>,<span class="number">155</span>,<span class="number">166</span>));</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> lattices_top=<span class="number">40</span>;<span class="comment">//上面留白</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> lattices_left=<span class="number">20</span>;<span class="comment">//左侧留白</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> width=WIDTH/M;<span class="comment">//每个格子的宽度</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> height=(HEIGHT-lattices_top)/N;<span class="comment">//每个格子的高度</span></div><div class="line"><span class="comment">/*-----------------函数-----------------------------------------------------------*/</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_score</span><span class="params">()</span> </span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_is_lose</span><span class="params">()</span> </span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear_up</span><span class="params">()</span> </span>;<span class="comment">//消除没有空格子的行</span></div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">down_thread_function</span><span class="params">(<span class="keyword">void</span> * args)</span> </span>;<span class="comment">//形状下落进程要执行的函数</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">exit_game</span><span class="params">(HWND hwnd)</span> </span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">give_new_shape</span><span class="params">()</span> </span>;<span class="comment">//随机生成一个新形状</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">handle_key</span><span class="params">(HWND hwnd,WPARAM wParam)</span> </span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_down_thread</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//初始化形状下落进程</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_game</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//初始化游戏程序</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_play</span><span class="params">()</span> </span>;<span class="comment">//初始化游戏数据</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_legel</span><span class="params">()</span> </span>;<span class="comment">//检测形状在当前位置是否合法（即是否重合了非空的格子）</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>;<span class="comment">//读取游戏最高分数据</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_shape</span><span class="params">()</span> </span>;<span class="comment">//从文件中加载7个形状</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">lose_game</span><span class="params">(HWND hwnd)</span> </span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_down</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//形状下落</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_lr</span><span class="params">(HWND hwnd,<span class="keyword">int</span> lr)</span> </span>;<span class="comment">//形状左右移动</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_lattice</span><span class="params">(HDC hdc,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> color)</span> </span>;<span class="comment">//显示一个格子</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_UI</span><span class="params">(HDC hdc)</span> </span>;<span class="comment">//画界面</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">reset_rc</span><span class="params">()</span> </span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rerotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>;<span class="comment">//顺时针旋转一个行列数为mn的方阵</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>;<span class="comment">//逆时针旋转一个行列数为mn的方阵</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">rotate_shape</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//旋转当前形状并更新界面</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">save_score</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//保存最高分数据</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">shape_to_ground</span><span class="params">()</span> </span>;<span class="comment">//当前形状落地之后，更新board</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sort_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>;<span class="comment">//对最高分和此次得分排序，若创造新纪录则返回true</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//更新界面，仅更新Rect区域（形状所在的那几行）内</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI_all</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//更新界面，更新整个界面</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">write_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>;<span class="comment">//写最高分数据</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*  Declare Windows procedure  */</span></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/*  Make the class name into a global variable  */</span></div><div class="line">TCHAR szClassName[ ] = _T(<span class="string">"Tris"</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span> <span class="params">(HINSTANCE hThisInstance,</span></span></div><div class="line">                    HINSTANCE hPrevInstance,</div><div class="line">                    LPSTR lpszArgument,</div><div class="line">                    <span class="keyword">int</span> nCmdShow) &#123;</div><div class="line">    HWND hwnd;               <span class="comment">/* This is the handle for our window */</span></div><div class="line">    MSG messages;            <span class="comment">/* Here messages to the application are saved */</span></div><div class="line">    WNDCLASSEX wincl;        <span class="comment">/* Data structure for the windowclass */</span></div><div class="line"></div><div class="line">    <span class="comment">/* The Window structure */</span></div><div class="line">    wincl.hInstance = hThisInstance;</div><div class="line">    wincl.lpszClassName = szClassName;</div><div class="line">    wincl.lpfnWndProc = WindowProcedure;      <span class="comment">/* This function is called by windows */</span></div><div class="line">    wincl.style = CS_DBLCLKS;                 <span class="comment">/* Catch double-clicks */</span></div><div class="line">    wincl.cbSize = <span class="keyword">sizeof</span> (WNDCLASSEX);</div><div class="line"></div><div class="line">    <span class="comment">/* Use default icon and mouse-pointer */</span></div><div class="line">    wincl.hIcon = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hIconSm = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hCursor = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW);</div><div class="line">    wincl.lpszMenuName = <span class="literal">NULL</span>;                 <span class="comment">/* No menu */</span></div><div class="line">    wincl.cbClsExtra = <span class="number">0</span>;                      <span class="comment">/* No extra bytes after the window class */</span></div><div class="line">    wincl.cbWndExtra = <span class="number">0</span>;                      <span class="comment">/* structure or the window instance */</span></div><div class="line">    <span class="comment">/* Use Windows's default colour as the background of the window */</span></div><div class="line">    wincl.hbrBackground =bk_brush;</div><div class="line">    <span class="comment">/* Register the window class, and if it fails quit the program */</span></div><div class="line">    <span class="keyword">if</span> (!RegisterClassEx (&amp;wincl))</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* The class is registered, let's create the program*/</span></div><div class="line">    hwnd = CreateWindowEx (</div><div class="line">               <span class="number">0</span>,                   <span class="comment">/* Extended possibilites for variation */</span></div><div class="line">               szClassName,         <span class="comment">/* Classname */</span></div><div class="line">               _T(<span class="string">"Tris"</span>),       <span class="comment">/* Title Text */</span></div><div class="line">               WS_OVERLAPPEDWINDOW, <span class="comment">/* default window */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* Windows decides the position */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* where the window ends up on the screen */</span></div><div class="line">               WIDTH+<span class="number">200</span>,                 <span class="comment">/* The programs width */</span></div><div class="line">               HEIGHT+<span class="number">70</span>,                 <span class="comment">/* and height in pixels */</span></div><div class="line">               HWND_DESKTOP,        <span class="comment">/* The window is a child-window to desktop */</span></div><div class="line">               <span class="literal">NULL</span>,                <span class="comment">/* No menu */</span></div><div class="line">               hThisInstance,       <span class="comment">/* Program Instance handler */</span></div><div class="line">               <span class="literal">NULL</span>                 <span class="comment">/* No Window Creation data */</span></div><div class="line">           );</div><div class="line"></div><div class="line">    <span class="comment">/* Make the window visible on the screen */</span></div><div class="line">    ShowWindow (hwnd, nCmdShow);</div><div class="line"></div><div class="line">    <span class="comment">/* Run the message loop. It will run until GetMessage() returns 0 */</span></div><div class="line">    <span class="keyword">while</span> (GetMessage (&amp;messages, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>)) &#123;</div><div class="line">        <span class="comment">/* Translate virtual-key messages into character messages */</span></div><div class="line">        TranslateMessage(&amp;messages);</div><div class="line">        <span class="comment">/* Send message to WindowProcedure */</span></div><div class="line">        DispatchMessage(&amp;messages);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/* The program return-value is 0 - The value that PostQuitMessage() gave */</span></div><div class="line">    <span class="keyword">return</span> messages.wParam;</div><div class="line">&#125;</div><div class="line"><span class="comment">//从文件中加载7个形状</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_shape</span><span class="params">()</span> </span>&#123;</div><div class="line">    FILE* f=fopen(<span class="string">"shapes.txt"</span>,<span class="string">"rb"</span>);</div><div class="line">    <span class="keyword">if</span>(f==<span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;<span class="number">4</span>; k++) &#123;</div><div class="line">                <span class="keyword">if</span>(<span class="built_in">fscanf</span>(f,<span class="string">"%d"</span>,&amp;shapes[i][j][k])!=<span class="number">1</span>) &#123;</div><div class="line">                    <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    fclose(f);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//随机生成一个新形状</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">give_new_shape</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> shape_num=rand()%<span class="number">7</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) &#123;</div><div class="line">            shape[i][j]=shapes[shape_num][i][j];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_score</span><span class="params">()</span> </span>&#123;</div><div class="line">    score+=<span class="number">100</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//消除没有空格子的行</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear_up</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=row; i&lt;=row+<span class="number">3</span>; i++) &#123;</div><div class="line">        <span class="keyword">if</span>(i&gt;BOTTOM)<span class="keyword">continue</span>;</div><div class="line">        <span class="keyword">bool</span> there_is_blank=<span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=LEFT; j&lt;=RIGHT; j++) &#123;</div><div class="line">            <span class="keyword">if</span>(board[i][j]==<span class="number">0</span>) &#123;</div><div class="line">                there_is_blank=<span class="literal">true</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(!there_is_blank) &#123;</div><div class="line">            add_score();</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> r=i; r&gt;=<span class="number">1</span>; r--) &#123;</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> c=LEFT; c&lt;=RIGHT; c++) &#123;</div><div class="line">                    board[r][c]=board[r<span class="number">-1</span>][c];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//检测形状在当前位置是否合法（即是否重合了非空的格子）</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_legel</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) &#123;</div><div class="line">            <span class="keyword">if</span>(shape[i][j]==<span class="number">1</span>&amp;&amp;board[row+i][column+j]==<span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//逆时针旋转一个行列数为mn的方阵</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span>** a=shape;</div><div class="line">    <span class="keyword">int</span> s=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> n=mn; n&gt;=<span class="number">1</span>; n-=<span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n<span class="number">-1</span>; i++) &#123;</div><div class="line">            <span class="keyword">int</span> t=a[s+i][s];</div><div class="line">            a[s+i][s]=a[s][s+n-i<span class="number">-1</span>];</div><div class="line">            a[s][s+n-i<span class="number">-1</span>]=a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>];</div><div class="line">            a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>]=a[s+n<span class="number">-1</span>][s+i];</div><div class="line">            a[s+n<span class="number">-1</span>][s+i]=t;</div><div class="line">        &#125;</div><div class="line">        s++;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//顺时针旋转一个行列数为mn的方阵</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rerotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span>** a=shape;</div><div class="line">    <span class="keyword">int</span> s=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> n=mn; n&gt;=<span class="number">1</span>; n-=<span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n<span class="number">-1</span>; i++) &#123;</div><div class="line">            <span class="keyword">int</span> t=a[s+i][s];</div><div class="line">            a[s+i][s]=a[s+n<span class="number">-1</span>][s+i];</div><div class="line">            a[s+n<span class="number">-1</span>][s+i]=a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>];</div><div class="line">            a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>]=a[s][s+n-i<span class="number">-1</span>];</div><div class="line">            a[s][s+n-i<span class="number">-1</span>]=t;</div><div class="line">        &#125;</div><div class="line">        s++;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//显示一个格子</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_lattice</span><span class="params">(HDC hdc,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> color)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(x&lt;TOP||x&gt;BOTTOM||y&lt;LEFT||y&gt;RIGHT) &#123;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    x-=TOP;</div><div class="line">    y-=LEFT;</div><div class="line">    <span class="keyword">int</span> left=lattices_left+y*width;</div><div class="line">    <span class="keyword">int</span> right=lattices_left+y*width+width;</div><div class="line">    <span class="keyword">int</span> top=lattices_top+x*height;</div><div class="line">    <span class="keyword">int</span> bottom=lattices_top+x*height+height;</div><div class="line">    MoveToEx (hdc,left,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,top) ;</div><div class="line">    MoveToEx (hdc,left,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,left,bottom) ;</div><div class="line">    MoveToEx (hdc,left,bottom, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,bottom) ;</div><div class="line">    MoveToEx (hdc,right,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,bottom) ;</div><div class="line">    SelectObject(hdc, grey_brush);</div><div class="line">    <span class="keyword">if</span>(color==<span class="number">0</span>) &#123;</div><div class="line">        SelectObject(hdc, white_brush);</div><div class="line">    &#125;</div><div class="line">    Rectangle(hdc,left,top,right,bottom);</div><div class="line">&#125;</div><div class="line"><span class="comment">//更新界面，仅更新Rect区域（形状所在的那几行）内</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> RECT rect;</div><div class="line">    rect.left=lattices_left;</div><div class="line">    rect.right=lattices_left+M*width+width;</div><div class="line">    rect.top=lattices_top+(row<span class="number">-1</span>)*height;</div><div class="line">    rect.bottom=lattices_top+(row+<span class="number">4</span>)*height;</div><div class="line">    InvalidateRect (hwnd,&amp;rect, <span class="literal">false</span>) ;</div><div class="line">&#125;</div><div class="line"><span class="comment">//更新界面，更新整个界面</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI_all</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">false</span>) ;</div><div class="line">&#125;</div><div class="line"><span class="comment">//画界面</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_UI</span><span class="params">(HDC hdc)</span> </span>&#123;</div><div class="line">    SetBkColor(hdc,BKCOLOR);</div><div class="line">    SelectObject(hdc,hPen);  <span class="comment">//选用画笔</span></div><div class="line">    <span class="keyword">char</span> score_str[<span class="number">20</span>];</div><div class="line">    <span class="built_in">sprintf</span>(score_str,<span class="string">"Score:%d"</span>,score);</div><div class="line">    TextOut(hdc,<span class="number">10</span>,<span class="number">10</span>,score_str,<span class="built_in">strlen</span>(score_str));</div><div class="line">    <span class="built_in">sprintf</span>(score_str,<span class="string">"Highest Scores:"</span>);</div><div class="line">    TextOut(hdc,WIDTH+<span class="number">50</span>,<span class="number">50</span>,score_str,<span class="built_in">strlen</span>(score_str));</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</div><div class="line">        <span class="built_in">sprintf</span>(score_str,<span class="string">"%d"</span>,high_score[i]);</div><div class="line">        TextOut(hdc,WIDTH+<span class="number">50</span>,<span class="number">50</span>+(i+<span class="number">1</span>)*<span class="number">20</span>,score_str,<span class="built_in">strlen</span>(score_str));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=TOP; i&lt;=BOTTOM; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=LEFT; j&lt;=RIGHT; j++) &#123;</div><div class="line">            paint_lattice(hdc,i,j,board[i][j]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) &#123;</div><div class="line">            <span class="keyword">if</span>(shape[i][j]==<span class="number">1</span>)</div><div class="line">                paint_lattice(hdc,row+i,column+j,shape[i][j]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//旋转当前形状并更新界面</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">rotate_shape</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> mn=<span class="number">4</span>;</div><div class="line">    rotate_matrix(mn);</div><div class="line">    <span class="keyword">if</span>(!is_legel()) &#123;</div><div class="line">        rerotate_matrix(mn);</div><div class="line">    &#125;</div><div class="line">    update_UI(hwnd);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">reset_rc</span><span class="params">()</span> </span>&#123;</div><div class="line">    row=<span class="number">0</span>;</div><div class="line">    column=MM/<span class="number">2</span><span class="number">-2</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//读取游戏最高分数据</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>&#123;</div><div class="line">    FILE* f=fopen(<span class="string">"scores.txt"</span>,<span class="string">"r"</span>);</div><div class="line">    <span class="keyword">if</span>(f==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="built_in">fscanf</span>(f,<span class="string">"%d%d%d"</span>,&amp;a[<span class="number">0</span>],&amp;a[<span class="number">1</span>],&amp;a[<span class="number">2</span>]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//初始化游戏数据</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_play</span><span class="params">()</span> </span>&#123;</div><div class="line">    load_scores(high_score);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;NN; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;MM; j++) &#123;</div><div class="line">            board[i][j]=<span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;LEFT; j++) &#123;</div><div class="line">            board[i][j]=<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=RIGHT+<span class="number">1</span>; j&lt;MM; j++) &#123;</div><div class="line">            board[i][j]=<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=BOTTOM+<span class="number">1</span>; i&lt;NN; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;MM; j++) &#123;</div><div class="line">            board[i][j]=<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    reset_rc();</div><div class="line">    score=<span class="number">0</span>;</div><div class="line">    give_new_shape();</div><div class="line">    is_pause=<span class="literal">false</span>;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_is_lose</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(row==<span class="number">0</span>)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//对最高分和此次得分排序，若创造新纪录则返回true</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sort_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> temp=a[<span class="number">3</span>];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">3</span>; j++) &#123;</div><div class="line">            <span class="keyword">if</span>(a[j]&lt;a[j+<span class="number">1</span>]) &#123;</div><div class="line">                <span class="keyword">int</span> t=a[j];</div><div class="line">                a[j]=a[j+<span class="number">1</span>];</div><div class="line">                a[j+<span class="number">1</span>]=t;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(temp&gt;a[<span class="number">3</span>])<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//写最高分数据</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">write_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>&#123;</div><div class="line">    FILE* f=fopen(<span class="string">"scores.txt"</span>,<span class="string">"w"</span>);</div><div class="line">    <span class="keyword">if</span>(f==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="built_in">fprintf</span>(f,<span class="string">"%d\n%d\n%d\n"</span>,a[<span class="number">0</span>],a[<span class="number">1</span>],a[<span class="number">2</span>]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//保存最高分数据</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">save_score</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    high_score[<span class="number">3</span>]=score;</div><div class="line">    <span class="keyword">bool</span> made_record=sort_scores(high_score);</div><div class="line">    <span class="keyword">if</span>(write_scores(high_score)!=<span class="number">0</span>) &#123;</div><div class="line">        MessageBox(hwnd,<span class="string">"Write file error.Program will exit."</span>,<span class="string">"Error"</span>,<span class="literal">NULL</span>);</div><div class="line">        DestroyWindow(hwnd);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> made_record;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">lose_game</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(is_pause)<span class="keyword">return</span> ;</div><div class="line">    is_pause=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">char</span> message[<span class="number">200</span>]=<span class="string">"You lose the Game.\n"</span>;</div><div class="line">    <span class="keyword">char</span> title[<span class="number">50</span>]=<span class="string">"Game Over"</span>;</div><div class="line">    <span class="keyword">if</span>(save_score(hwnd)) &#123;</div><div class="line">        <span class="built_in">strcat</span>(message,<span class="string">"You have made a new record.\n"</span>);</div><div class="line">        <span class="keyword">char</span> score_str[<span class="number">100</span>];</div><div class="line">        <span class="built_in">sprintf</span>(score_str,<span class="string">"The Highest Scores:\n%d\n%d\n%d\n"</span>,high_score[<span class="number">0</span>],high_score[<span class="number">1</span>],high_score[<span class="number">2</span>]);</div><div class="line">        <span class="built_in">strcat</span>(message,score_str);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">strcat</span>(message,<span class="string">"\nPlay again?\n"</span>);</div><div class="line">    <span class="keyword">if</span>(MessageBox(hwnd,message,title,MB_YESNO)==IDYES) &#123;</div><div class="line">        init_play();</div><div class="line">        update_UI_all(hwnd);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">exit_game</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    is_pause=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">char</span> message[<span class="number">200</span>]=<span class="string">""</span>;</div><div class="line">    <span class="keyword">char</span> title[<span class="number">50</span>]=<span class="string">"Exit"</span>;</div><div class="line">    <span class="keyword">if</span>(save_score(hwnd)) &#123;</div><div class="line">        <span class="built_in">strcat</span>(message,<span class="string">"You have made a new record.\n"</span>);</div><div class="line">        <span class="keyword">char</span> score_str[<span class="number">100</span>];</div><div class="line">        <span class="built_in">sprintf</span>(score_str,<span class="string">"The Highest Scores:\n%d\n%d\n%d\n"</span>,high_score[<span class="number">0</span>],high_score[<span class="number">1</span>],high_score[<span class="number">2</span>]);</div><div class="line">        <span class="built_in">strcat</span>(message,score_str);</div><div class="line">        MessageBox(hwnd,message,title,<span class="literal">NULL</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">//当前形状落地之后，更新board</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">shape_to_ground</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) &#123;</div><div class="line">            board[row+i][column+j]=shape[i][j]==<span class="number">1</span>?<span class="number">1</span>:board[row+i][column+j];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//形状下落</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_down</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    row++;</div><div class="line">    <span class="keyword">if</span>(!is_legel()) &#123;</div><div class="line">        row--;</div><div class="line">        <span class="keyword">if</span>(check_is_lose()) &#123;</div><div class="line">            lose_game(hwnd);</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        shape_to_ground();</div><div class="line">        clear_up();</div><div class="line">        update_UI_all(hwnd);</div><div class="line">        reset_rc();</div><div class="line">        give_new_shape();</div><div class="line">    &#125;</div><div class="line">    update_UI(hwnd);</div><div class="line">&#125;</div><div class="line"><span class="comment">//进程参数结构体</span></div><div class="line"><span class="keyword">struct</span> thread_arg &#123;</div><div class="line">    HWND arg_hwnd;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//形状下落进程要执行的函数</span></div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">down_thread_function</span><span class="params">(<span class="keyword">void</span> * args)</span> </span>&#123;</div><div class="line">    thread_arg *arg=(thread_arg*)args;</div><div class="line">    HWND dhwnd=arg-&gt;arg_hwnd;</div><div class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(is_pause) &#123;</div><div class="line">            Sleep(<span class="number">300</span>);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        move_down(dhwnd);</div><div class="line">        Sleep(LONG_SLEEP);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//初始化形状下落进程</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_down_thread</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ret;</div><div class="line">    <span class="keyword">pthread_t</span> t;</div><div class="line">    thread_arg *argp=<span class="keyword">new</span> thread_arg;</div><div class="line">    argp-&gt;arg_hwnd=hwnd;</div><div class="line">    ret=pthread_create(&amp;t,<span class="literal">NULL</span>,down_thread_function,argp);</div><div class="line">    <span class="keyword">delete</span> argp;</div><div class="line">    <span class="keyword">if</span>(ret!=<span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//初始化游戏程序</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_game</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    board=<span class="keyword">new</span> <span class="keyword">int</span>*[NN];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;NN; i++) &#123;</div><div class="line">        board[i]=<span class="keyword">new</span> <span class="keyword">int</span>[MM];</div><div class="line">    &#125;</div><div class="line">    shape=<span class="keyword">new</span> <span class="keyword">int</span>*[<span class="number">4</span>];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">        shape[i]=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>];</div><div class="line">    &#125;</div><div class="line">    srand(time(<span class="number">0</span>));</div><div class="line">    <span class="keyword">if</span>(load_shape()!=<span class="number">0</span>) &#123;</div><div class="line">        MessageBox(hwnd,<span class="string">"Read file error.Program will exit."</span>,<span class="string">"Error"</span>,<span class="literal">NULL</span>);</div><div class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    init_play();</div><div class="line">    update_UI_all(hwnd);</div><div class="line">    <span class="keyword">if</span>(init_down_thread(hwnd)!=<span class="number">0</span>) &#123;</div><div class="line">        MessageBox(hwnd,<span class="string">"Thread error.Program will exit."</span>,<span class="string">"Error"</span>,<span class="literal">NULL</span>);</div><div class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//形状左右移动</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_lr</span><span class="params">(HWND hwnd,<span class="keyword">int</span> lr)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> temp=column;</div><div class="line">    <span class="keyword">if</span>(lr==<span class="number">0</span>)column--;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        column++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(!is_legel()) &#123;</div><div class="line">        column=temp;</div><div class="line">    &#125;</div><div class="line">    update_UI(hwnd);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">handle_key</span><span class="params">(HWND hwnd,WPARAM wParam)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_ESCAPE) &#123;<span class="comment">//ESC退出</span></div><div class="line">        exit_game(hwnd);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_SPACE) &#123;<span class="comment">//空格暂停</span></div><div class="line">        is_pause=!is_pause;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(is_pause==<span class="literal">true</span>) &#123;</div><div class="line">        Sleep(<span class="number">300</span>);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_UP) &#123;</div><div class="line">        rotate_shape(hwnd);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_DOWN) &#123;</div><div class="line">        move_down(hwnd);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_LEFT) &#123;</div><div class="line">        move_lr(hwnd,<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(wParam==VK_RIGHT) &#123;</div><div class="line">        move_lr(hwnd,<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*  This function is called by the Windows function DispatchMessage()  */</span></div><div class="line">HWND hwnd;</div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> HDC hdc;</div><div class="line">    <span class="keyword">static</span> HDC hdcBuffer;</div><div class="line">    <span class="keyword">static</span> HBITMAP hBitMap;</div><div class="line">    <span class="keyword">static</span> PAINTSTRUCT ps ;</div><div class="line">    <span class="keyword">switch</span> (message) &#123;                <span class="comment">/* handle the messages */</span></div><div class="line">    <span class="keyword">case</span> WM_CREATE:</div><div class="line">        init_game(hwnd);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_KEYDOWN:</div><div class="line">        handle_key(hwnd,wParam);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_DESTROY:</div><div class="line">        exit_game(hwnd);</div><div class="line">        PostQuitMessage (<span class="number">0</span>);       <span class="comment">/* send a WM_QUIT to the message queue */</span></div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_PAINT:</div><div class="line">        hdc = BeginPaint (hwnd, &amp;ps) ;</div><div class="line">        paint_UI(hdc);</div><div class="line">        EndPaint (hwnd, &amp;ps) ;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:                      <span class="comment">/* for messages that we don't deal with */</span></div><div class="line">        <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于2016年五一期间</p>
</li>
<li><p>随笔写于2016.5.8</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/08/迷宫/" itemprop="url">
                  Java迷宫游戏
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-08T11:48:59+08:00" content="2016-05-08">
              2016-05-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="缘起："><a href="#缘起：" class="headerlink" title="缘起："></a>缘起：</h3><p>　　去年（大三上学期）比较喜欢写小游戏，于是想试着写个迷宫试一下。</p>
<h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p><img src="/imgs/maze1.jpg" alt="xiaoguo1"></p>
<p>按下空格显示路径：<br><img src="/imgs/maze2.jpg" alt="xiaoguo2"></p>
<h3 id="思考过程："><a href="#思考过程：" class="headerlink" title="思考过程："></a>思考过程：</h3><p>　　迷宫由一个一个格子组成，要求从入口到出口只有一条路径.</p>
<p>　　想了一下各种数据结构，似乎树是比较合适的，从根节点到每一个子节点都只有一条路径。假设入口是根节点，出口是树中某个子节点，那么，从根节点到该子节点的路径肯定是唯一的。</p>
<p>　　所以如果能构造一棵树把所有的格子都覆盖到，也就能够做出一个迷宫了。</p>
<p>　　另外还要求树的父节点和子节点必须是界面上相邻的格子。</p>
<p>　　在界面显示时，父节点和子节点之间共用的边不画，其他的边都画出来，就能画出一个迷宫。</p>
<p>　　之后就是想一下该怎么实现这样一棵树。</p>
<p>首要的两个问题：<br>&gt;</p>
<ol>
<li>树怎么表示？<br>&gt;</li>
<li>怎么构造这棵树？</li>
</ol>
<p>　　</p>
<p><strong>1.树怎么表示？</strong><br>　　假设像写二叉树一样实现这棵树，那么每个树节点里就要存储一个坐标（X,Y）表示一个格子，另外还要存储四个指针。指针中有的为空，有的不为空，不为空的指针指向子节点，子节点保存邻居格子的坐标。这样做最大的问题是无法判定是否所有的格子都在树中。也许还要用一个二维数组作标志数组。</p>
<p>　　假如用二维数组表示迷宫的格子。每个数组元素存储一个指向父节点的引用，这样也可以形成一个虚拟的树。于是就用一个N<em>N的二维数组，表示N</em>N个格子，每个数组元素(Lattice)中有一个指向父节点的引用(father)。另外，为了能方便的获取格子的坐标，还要保存坐标信息。</p>
<p><strong>2.怎么构造这棵树？</strong><br>　　首先选定一个格子作为根节点。为了让迷宫的形状够随机，我选择随机生成一个坐标作为根节点。其实，选择确定的一个坐标也可以。</p>
<p>　　然后，怎样往这棵树上增加节点呢？</p>
<p>　　在这里我走了不少弯路，一开始想的是一种现在看来类似回溯的算法（当时还不知道回溯算法。。），但是时间复杂度很高，大概当迷宫为64*64的时候，算法就不出结果了。</p>
<p>　　然后，又使用了一种扫深度搜索也是回溯描的方法，每次扫描在当前树中找一个节点，看它的邻居格子是否在树中，如果还没在树中，就将该邻居格子加入树中，如果已在树中，就看下一个邻居格子，如果该节点所有邻居格子都在树中了，就找下一个节点，继续同样的操作。另外为了让迷宫生成的随机，扫描的起始位置是随机的就可以了。但是，该方法生成的迷宫中的路径总是不够深，没有我想要的曲折深入的效果。毕竟是类似广度搜索的方法。而且，这样做总还像是靠蛮力，算法不够聪明简洁。</p>
<p>　　最后，我终于想到使用深度搜索。。大概是因为数据结构已经学过了一年，又没太练，忘了不少，所以一直没想到这个应该第一想到的方法。。</p>
<p>　　随机选择一个格子作为根节点，从它开始随机地深度搜索前进，开出一条路来，直到无路可走了，退回一步，换另一条路，再走到无路可走，回退一步，换另一条……如此循环往复，直到完全无路可走。。。其实也还是回溯。</p>
<p>　　在程序里就是以下过程（详见代码中的<code>createMaze()</code>函数）：<br>&gt;<br>　　　　随机选择一个格子作为根节点，将它压进栈里。<br>&gt;<br>　　　　然后在栈不为空的时候执行以下循环：</p>
<blockquote>
<p>&gt;<br>　　　　　　取出一个格子，将它的INTREE标志设置为1，然后将它的所有不在树中的邻居格子压进栈里（顺序随机），并且让这些邻居格子的father指向该格子。</p>
</blockquote>
<p>　　</p>
<p>　　解决了这两个问题，其余的画迷宫、显示路径、小球移动也就比较简单了。</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> maze;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.awt.Color;</div><div class="line"><span class="keyword">import</span> java.awt.Graphics;</div><div class="line"><span class="keyword">import</span> java.awt.event.KeyAdapter;</div><div class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</div><div class="line"><span class="keyword">import</span> java.util.Random;</div><div class="line"><span class="keyword">import</span> java.util.Stack;</div><div class="line"><span class="keyword">import</span> javax.swing.JFrame;</div><div class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</div><div class="line"><span class="keyword">import</span> javax.swing.JPanel;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lattice</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INTREE = <span class="number">1</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NOTINTREE = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> y = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> flag = NOTINTREE;</div><div class="line">    <span class="keyword">private</span> Lattice father = <span class="keyword">null</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Lattice</span><span class="params">(<span class="keyword">int</span> xx, <span class="keyword">int</span> yy)</span> </span>&#123;</div><div class="line">        x = xx;</div><div class="line">        y = yy;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> y;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFlag</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> flag;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> Lattice <span class="title">getFather</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> father;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFather</span><span class="params">(Lattice f)</span> </span>&#123;</div><div class="line">        father = f;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlag</span><span class="params">(<span class="keyword">int</span> f)</span> </span>&#123;</div><div class="line">        flag = f;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(<span class="string">"("</span> + x + <span class="string">","</span> + y + <span class="string">")\n"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Maze</span> <span class="keyword">extends</span> <span class="title">JPanel</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">8300339045454852626L</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> NUM, width, padding;<span class="comment">// width 每个格子的宽度和高度</span></div><div class="line">    <span class="keyword">private</span> Lattice[][] maze;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ballX, ballY;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> drawPath = <span class="keyword">false</span>;</div><div class="line">    Maze(<span class="keyword">int</span> m, <span class="keyword">int</span> wi, <span class="keyword">int</span> p) &#123;</div><div class="line">        NUM = m;</div><div class="line">        width = wi;</div><div class="line">        padding = p;</div><div class="line">        maze = <span class="keyword">new</span> Lattice[NUM][NUM];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= NUM - <span class="number">1</span>; i++)</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= NUM - <span class="number">1</span>; j++)</div><div class="line">                maze[i][j] = <span class="keyword">new</span> Lattice(i, j);</div><div class="line">        createMaze();</div><div class="line">        setKeyListener();</div><div class="line">        <span class="keyword">this</span>.setFocusable(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= NUM - <span class="number">1</span>; i++)</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= NUM - <span class="number">1</span>; j++) &#123;</div><div class="line">                maze[i][j].setFather(<span class="keyword">null</span>);</div><div class="line">                maze[i][j].setFlag(Lattice.NOTINTREE);</div><div class="line">            &#125;</div><div class="line">        ballX = <span class="number">0</span>;</div><div class="line">        ballY = <span class="number">0</span>;</div><div class="line">        drawPath = <span class="keyword">false</span>;</div><div class="line">        createMaze();</div><div class="line">        <span class="comment">// setKeyListener();</span></div><div class="line">        <span class="keyword">this</span>.setFocusable(<span class="keyword">true</span>);</div><div class="line">        repaint();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCenterX</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> padding + x * width + width / <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCenterY</span><span class="params">(<span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> padding + y * width + width / <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCenterX</span><span class="params">(Lattice p)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> padding + p.getY() * width + width / <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCenterY</span><span class="params">(Lattice p)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> padding + p.getX() * width + width / <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkIsWin</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (ballX == NUM - <span class="number">1</span> &amp;&amp; ballY == NUM - <span class="number">1</span>) &#123;</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"YOU WIN !"</span>, <span class="string">"你走出了迷宫。"</span>,</div><div class="line">                    JOptionPane.PLAIN_MESSAGE);</div><div class="line">            init();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> tx = ballX, ty = ballY;</div><div class="line">        <span class="comment">// System.out.println(c);</span></div><div class="line">        <span class="keyword">switch</span> (c) &#123;</div><div class="line">            <span class="keyword">case</span> KeyEvent.VK_LEFT :</div><div class="line">                ty--;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> KeyEvent.VK_RIGHT :</div><div class="line">                ty++;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> KeyEvent.VK_UP :</div><div class="line">                tx--;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> KeyEvent.VK_DOWN :</div><div class="line">                tx++;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> KeyEvent.VK_SPACE :</div><div class="line">                <span class="keyword">if</span> (drawPath == <span class="keyword">true</span>) &#123;</div><div class="line">                    drawPath = <span class="keyword">false</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    drawPath = <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span> :</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!isOutOfBorder(tx, ty)</div><div class="line">                &amp;&amp; (maze[tx][ty].getFather() == maze[ballX][ballY]</div><div class="line">                        || maze[ballX][ballY].getFather() == maze[tx][ty])) &#123;</div><div class="line">            ballX = tx;</div><div class="line">            ballY = ty;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setKeyListener</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.addKeyListener(<span class="keyword">new</span> KeyAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> c = e.getKeyCode();</div><div class="line">                move(c);</div><div class="line">                repaint();</div><div class="line">                checkIsWin();</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isOutOfBorder</span><span class="params">(Lattice p)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> isOutOfBorder(p.getX(), p.getY());</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isOutOfBorder</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (x &gt; NUM - <span class="number">1</span> || y &gt; NUM - <span class="number">1</span> || x &lt; <span class="number">0</span> || y &lt; <span class="number">0</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">private</span> Lattice[] getNeis(Lattice p) &#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span>[] adds = &#123;-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>&#125;;<span class="comment">// 顺序为上右下左</span></div><div class="line">        <span class="keyword">if</span> (isOutOfBorder(p)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        Lattice[] ps = <span class="keyword">new</span> Lattice[<span class="number">4</span>];<span class="comment">// 顺序为上右下左</span></div><div class="line">        <span class="keyword">int</span> xt;</div><div class="line">        <span class="keyword">int</span> yt;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++) &#123;</div><div class="line">            xt = p.getX() + adds[i];</div><div class="line">            yt = p.getY() + adds[i + <span class="number">1</span>];</div><div class="line">            <span class="keyword">if</span> (isOutOfBorder(xt, yt))</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            ps[i] = maze[xt][yt];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> ps;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createMaze</span><span class="params">()</span> </span>&#123;</div><div class="line">        Random random = <span class="keyword">new</span> Random();</div><div class="line">        <span class="keyword">int</span> rx = Math.abs(random.nextInt()) % NUM;</div><div class="line">        <span class="keyword">int</span> ry = Math.abs(random.nextInt()) % NUM;</div><div class="line">        Stack&lt;Lattice&gt; s = <span class="keyword">new</span> Stack&lt;Lattice&gt;();</div><div class="line">        Lattice p = maze[rx][ry];</div><div class="line">        Lattice neis[] = <span class="keyword">null</span>;</div><div class="line">        s.push(p);</div><div class="line">        <span class="keyword">while</span> (!s.isEmpty()) &#123;</div><div class="line">            p = s.pop();</div><div class="line">            p.setFlag(Lattice.INTREE);</div><div class="line">            neis = getNeis(p);</div><div class="line">            <span class="keyword">int</span> ran = Math.abs(random.nextInt()) % <span class="number">4</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> a = <span class="number">0</span>; a &lt;= <span class="number">3</span>; a++) &#123;</div><div class="line">                ran++;</div><div class="line">                ran %= <span class="number">4</span>;</div><div class="line">                <span class="keyword">if</span> (neis[ran] == <span class="keyword">null</span> || neis[ran].getFlag() == Lattice.INTREE)</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line">                s.push(neis[ran]);</div><div class="line">                neis[ran].setFather(p);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// changeFather(maze[0][0],null);</span></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">changeFather</span><span class="params">(Lattice p, Lattice f)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (p.getFather() == <span class="keyword">null</span>) &#123;</div><div class="line">            p.setFather(f);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            changeFather(p.getFather(), p);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clearFence</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j, <span class="keyword">int</span> fx, <span class="keyword">int</span> fy, Graphics g)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> sx = padding + ((j &gt; fy ? j : fy) * width),</div><div class="line">                sy = padding + ((i &gt; fx ? i : fx) * width),</div><div class="line">                dx = (i == fx ? sx : sx + width),</div><div class="line">                dy = (i == fx ? sy + width : sy);</div><div class="line">        <span class="keyword">if</span> (sx != dx) &#123;</div><div class="line">            sx++;</div><div class="line">            dx--;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            sy++;</div><div class="line">            dy--;</div><div class="line">        &#125;</div><div class="line">        g.drawLine(sx, sy, dx, dy);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">paintComponent</span><span class="params">(Graphics g)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.paintComponent(g);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= NUM; i++) &#123;</div><div class="line">            g.drawLine(padding + i * width, padding, padding + i * width,</div><div class="line">                    padding + NUM * width);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= NUM; j++) &#123;</div><div class="line">            g.drawLine(padding, padding + j * width, padding + NUM * width,</div><div class="line">                    padding + j * width);</div><div class="line">        &#125;</div><div class="line">        g.setColor(<span class="keyword">this</span>.getBackground());</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = NUM - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = NUM - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</div><div class="line">                Lattice f = maze[i][j].getFather();</div><div class="line">                <span class="keyword">if</span> (f != <span class="keyword">null</span>) &#123;</div><div class="line">                    <span class="keyword">int</span> fx = f.getX(), fy = f.getY();</div><div class="line">                    clearFence(i, j, fx, fy, g);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        g.drawLine(padding, padding + <span class="number">1</span>, padding, padding + width - <span class="number">1</span>);</div><div class="line">        <span class="keyword">int</span> last = padding + NUM * width;</div><div class="line">        g.drawLine(last, last - <span class="number">1</span>, last, last - width + <span class="number">1</span>);</div><div class="line">        g.setColor(Color.RED);</div><div class="line">        g.fillOval(getCenterX(ballY) - width / <span class="number">3</span>, getCenterY(ballX) - width / <span class="number">3</span>,</div><div class="line">                width / <span class="number">2</span>, width / <span class="number">2</span>);</div><div class="line">        <span class="keyword">if</span> (drawPath == <span class="keyword">true</span>)</div><div class="line">            drawPath(g);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawPath</span><span class="params">(Graphics g)</span> </span>&#123;</div><div class="line">        Color PATH_COLOR = Color.ORANGE, BOTH_PATH_COLOR = Color.PINK;</div><div class="line">        <span class="keyword">if</span> (drawPath == <span class="keyword">true</span>)</div><div class="line">            g.setColor(PATH_COLOR);</div><div class="line">        <span class="keyword">else</span></div><div class="line">            g.setColor(<span class="keyword">this</span>.getBackground());</div><div class="line">        Lattice p = maze[NUM - <span class="number">1</span>][NUM - <span class="number">1</span>];</div><div class="line">        <span class="keyword">while</span> (p.getFather() != <span class="keyword">null</span>) &#123;</div><div class="line">            p.setFlag(<span class="number">2</span>);</div><div class="line">            p = p.getFather();</div><div class="line">        &#125;</div><div class="line">        g.fillOval(getCenterX(p) - width / <span class="number">3</span>, getCenterY(p) - width / <span class="number">3</span>,</div><div class="line">                width / <span class="number">2</span>, width / <span class="number">2</span>);</div><div class="line">        p = maze[<span class="number">0</span>][<span class="number">0</span>];</div><div class="line">        <span class="keyword">while</span> (p.getFather() != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (p.getFlag() == <span class="number">2</span>) &#123;</div><div class="line">                p.setFlag(<span class="number">3</span>);</div><div class="line">                g.setColor(BOTH_PATH_COLOR);</div><div class="line">            &#125;</div><div class="line">            g.drawLine(getCenterX(p), getCenterY(p), getCenterX(p.getFather()),</div><div class="line">                    getCenterY(p.getFather()));</div><div class="line">            p = p.getFather();</div><div class="line">        &#125;</div><div class="line">        g.setColor(PATH_COLOR);</div><div class="line">        p = maze[NUM - <span class="number">1</span>][NUM - <span class="number">1</span>];</div><div class="line">        <span class="keyword">while</span> (p.getFather() != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (p.getFlag() == <span class="number">3</span>)</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            g.drawLine(getCenterX(p), getCenterY(p), getCenterX(p.getFather()),</div><div class="line">                    getCenterY(p.getFather()));</div><div class="line">            p = p.getFather();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> n = <span class="number">30</span>, width = <span class="number">600</span>, padding = <span class="number">20</span>, LX = <span class="number">200</span>, LY = <span class="number">100</span>;</div><div class="line">        JPanel p = <span class="keyword">new</span> Maze(n, (width - padding - padding) / n, padding);</div><div class="line">        JFrame frame = <span class="keyword">new</span> JFrame(<span class="string">"MAZE(按空格键显示或隐藏路径)"</span>);</div><div class="line">        frame.getContentPane().add(p);</div><div class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</div><div class="line">        frame.setSize(width + padding, width + padding + padding);</div><div class="line">        frame.setLocation(LX, LY);</div><div class="line">        frame.setVisible(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>程序完成于大三上学期。</p>
</li>
<li><p>随笔写于2016.5.8</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/29/读文件错误/" itemprop="url">
                  读文件错误
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-29T16:13:59+08:00" content="2016-04-29">
              2016-04-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天想写个小程序，但一开始就不顺利。</p>
<p>想从文件中读取数据，但使用 fscanf ，总是读不出任何信息。</p>
<p>最后无奈了，改用 fread 看一下能读出什么内容，发现除了开始几个字符是乱码，之后读取的数据都是正常的。</p>
<p>这个现象正是前一段时间遇到过的，因为文件编码是 UTF-8 ，所以无法读出正确的 ASCII 码。</p>
<p>马上将文件重新以 ANSI 格式编码。程序立刻正常了。</p>
<p><img src="/imgs/zhenggeshijieqingjingle.jpg" alt="qingjing"></p>
<p>之所以每次新建一个文本文档都是 UTF-8 编码，是去年编写网页时设置的。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/15/findstr/" itemprop="url">
                  在文件夹中 的指定类型文件中 查找字符串（CodeBlocks+GCC编译，控制台程序，仅能在Windows上运行）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-15T00:00:00+08:00" content="2016-04-15">
              2016-04-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h3><p>　　程序使用 io.h 中的<code>_findfirst</code> 和 <code>_findnext</code> 函数遍历文件夹，故而程序只能在 Windows 下使用。　　</p>
<p>　　程序遍历当前文件夹，对其中的文件夹执行递归遍历。同时检查遍历到的文件是否属于指定类型，如果是，则将在该文件中查找指定字符串。　</p>
<p>　　在文件中查找字符串时，开辟一个与指定字符串 text （长度为len ）同样大小的字符串数组 temp 。数组上有两个指针：一个是字符串比较的开始位置 s ，一个是新字符写入的位置 d 。每从文件中读入一个字符，就写入 temp[d] ，之后 temp 从 s 到 d 与 text 从 0 到 len-1 比较，之后， s 与 d 均后移一位，再继续读入字符，写入，比较，后移。。。</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div></pre></td><td class="code"><pre><div class="line">#include&lt;stdio.h&gt;</div><div class="line">#include&lt;vector&gt;</div><div class="line">#include&lt;string.h&gt;</div><div class="line">#include&lt;io.h&gt;</div><div class="line">using namespace std;</div><div class="line"></div><div class="line">vector&lt;char*&gt; types;</div><div class="line">char text[256];</div><div class="line"></div><div class="line">void ls_path(char * path);</div><div class="line">bool is_in_types(char* filename);</div><div class="line">void findtext(char * filename,char* text);</div><div class="line"></div><div class="line">void solve(char* name,struct _finddata_t *f) &#123;</div><div class="line">    if(strcmp(f-&gt;name,".")==0)return ;</div><div class="line">    if(strcmp(f-&gt;name,"..")==0)return ;</div><div class="line">    char *fullpath=new char[256];</div><div class="line">    strcpy(fullpath,name);</div><div class="line">    int len=strlen(name);</div><div class="line">    fullpath[len-1]='\0';</div><div class="line">    strcat(fullpath,f-&gt;name);</div><div class="line">    if(f-&gt;attrib&amp;_A_SUBDIR) &#123;</div><div class="line">        strcat(fullpath,"/*");</div><div class="line">        ls_path(fullpath);</div><div class="line">    &#125; else &#123;</div><div class="line">        if(is_in_types(f-&gt;name)) &#123;</div><div class="line">            findtext(fullpath,text);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    delete fullpath;</div><div class="line">&#125;</div><div class="line">void ls_path(char * path) &#123;</div><div class="line">    struct _finddata_t f;</div><div class="line">    int p;</div><div class="line">    char *name=new char[260];</div><div class="line">    strcpy(name,path);</div><div class="line">    if((p=_findfirst(name, &amp;f))!=-1) &#123;</div><div class="line">        solve(name,&amp;f);</div><div class="line">        while(_findnext(p, &amp;f)==0) &#123;</div><div class="line">            solve(name,&amp;f);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    delete name;</div><div class="line">&#125;</div><div class="line">int strrncmp(char* a,const char* b,int n) &#123;//比较两字符串的最后n个字符</div><div class="line">    int len=strlen(a);</div><div class="line">    int j=0;</div><div class="line">    for(int i=len-n; i&lt;=len-1; i++) &#123;</div><div class="line">        if(a[i]!=b[j])return false;</div><div class="line">        j++;</div><div class="line">    &#125;</div><div class="line">    return j==n?true:false;</div><div class="line">&#125;</div><div class="line">bool is_in_types(char* filename) &#123;</div><div class="line">    for(int i=0; i&lt;types.size(); i++) &#123;</div><div class="line">        if(strrncmp(filename,types[i],strlen(types[i]))) &#123;</div><div class="line">            return true;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return false;</div><div class="line">&#125;</div><div class="line">bool cmp(const char* temp,const int len,const int s,const int d,const char* text) &#123;</div><div class="line">    int j=0;</div><div class="line">    for(int i=s;; i++,i%=len) &#123;</div><div class="line">        if(temp[i]!=text[j])return false;</div><div class="line">        if(i==d)break;</div><div class="line">        j++;</div><div class="line">    &#125;</div><div class="line">    return true;</div><div class="line">&#125;</div><div class="line">void findtext(char * filename,char* text) &#123;</div><div class="line">    FILE *f=fopen(filename,"r");</div><div class="line">    char c;</div><div class="line">    int linenum=0;</div><div class="line">    int len=strlen(text);</div><div class="line">    char* temp=new char[len];</div><div class="line">    int s=0,d=len-1;</div><div class="line">    while(c=fgetc(f),c!=EOF) &#123;</div><div class="line">        temp[d]=c;</div><div class="line">        if(cmp(temp,len,s,d,text))printf("文件名: %s \n行号: %d\n",filename,linenum+1);</div><div class="line">        if(c=='\n'||c=='\r'||c=='\r\n') &#123;</div><div class="line">            linenum++;</div><div class="line">        &#125;</div><div class="line">        d++;</div><div class="line">        d%=len;</div><div class="line">        s++;</div><div class="line">        s%=len;</div><div class="line">    &#125;</div><div class="line">    delete temp;</div><div class="line">    fclose(f);</div><div class="line">&#125;</div><div class="line">int main() &#123;</div><div class="line">    printf("**************************************\n");</div><div class="line">    printf("本程序在其所在文件夹中查找指定类型文件\n中是否有指定字符串，并输出所在行号。\n");</div><div class="line">    printf("              CopyRight:  maxuewei2\n");</div><div class="line">    printf("**************************************\n");</div><div class="line">    while(true) &#123;</div><div class="line">        types.clear();</div><div class="line">        printf("\n请输入要查找的字符串:\n");</div><div class="line">        while(gets(text),strcmp(text,"")==0);</div><div class="line">        printf("请输入文件类型，如‘txt’:(按两下ENTER开始查找)\n");</div><div class="line">        char t[30];</div><div class="line">        while(gets(t),strcmp(t,"")!=0) &#123;</div><div class="line">            char* tt=new char[30];</div><div class="line">            strcpy(tt,".");</div><div class="line">            strcat(tt,t);</div><div class="line">            types.push_back(tt);</div><div class="line">        &#125;</div><div class="line">        delete t;</div><div class="line">        printf("查找结果:\n");</div><div class="line">        ls_path("*");</div><div class="line">    &#125;</div><div class="line">    types.clear();</div><div class="line">    delete text;</div><div class="line">    getchar();</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="运行效果："><a href="#运行效果：" class="headerlink" title="运行效果："></a>运行效果：</h3><p><img src="/imgs/findstr.jpg" alt="xiaoguo"></p>
<ul>
<li><p>程序完成于2016.4.15</p>
</li>
<li><p>博客更新于2016.4.15</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/imgs/maxuewei2_avatar.png"
               alt="maxuewei2" />
          <p class="site-author-name" itemprop="name">maxuewei2</p>
          <p class="site-description motion-element" itemprop="description">做一个优雅的变态...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">25</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">maxuewei2</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  

  


</body>
</html>
