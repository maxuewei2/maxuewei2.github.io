

<!DOCTYPE html>
<html lang="zh-CN">
<head prefix="og: http://ogp.me/ns#">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta name="description" content="做一个优雅的变态...">
    <title>俄罗斯方块（Win32实现，Codeblocks+GCC编译） | maxuewei2</title>

    <!-- Open Graph -->
    <meta name="description" content="缘起：　　在玩Codeblocks自带的俄罗斯方块时觉得不错，然而有时间限制。所以想自己再写一个。

后来发现在设置中是可以取消时间限制的。。。Orz">
<meta property="og:type" content="article">
<meta property="og:title" content="俄罗斯方块（Win32实现，Codeblocks+GCC编译）">
<meta property="og:url" content="https://maxuewei2.github.io/2016/05/08/俄罗斯C++/index.html">
<meta property="og:site_name" content="maxuewei2">
<meta property="og:description" content="缘起：　　在玩Codeblocks自带的俄罗斯方块时觉得不错，然而有时间限制。所以想自己再写一个。

后来发现在设置中是可以取消时间限制的。。。Orz">
<meta property="og:image" content="https://maxuewei2.github.io/imgs/trisc++1.png">
<meta property="og:image" content="https://maxuewei2.github.io/imgs/trisc++2.png">
<meta property="og:updated_time" content="2016-11-05T08:19:08.197Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="俄罗斯方块（Win32实现，Codeblocks+GCC编译）">
<meta name="twitter:description" content="缘起：　　在玩Codeblocks自带的俄罗斯方块时觉得不错，然而有时间限制。所以想自己再写一个。

后来发现在设置中是可以取消时间限制的。。。Orz">
<meta name="twitter:image" content="https://maxuewei2.github.io/imgs/trisc++1.png">

    <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Person",
  "email": "mailto:undefined",
  "image": "/imgs/maxuewei2_avatar.png",
  "name": "maxuewei2",
  "url": "https://maxuewei2.github.io"
}
</script>
    <script>
    var algoliaEnabled = false;
    
</script>

    

    
    
        <link href="https://fonts.gmirror.org/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
    
    
    
        <!-- stylesheets list from config.yml -->
        
        <link rel="stylesheet" href="/css/aloha.css">
        
        <link rel="stylesheet" href="//cdn.bootcss.com/semantic-ui/2.2.4/semantic.min.css">
        
        <link rel="stylesheet" href="//cdn.bootcss.com/magnific-popup.js/1.1.0/magnific-popup.min.css">
        
    

</head>
<body id="body" style="margin-bottom: 0;" class="pushable">

    <div class="ui top fixed menu">
        <a class="item" id="menu-icon"><i class="sidebar icon"></i></a>
    </div>

    <div id="menu-sidebar" class="ui left vertical sidebar menu">

    <div id="sidebar-top">
        <div class="content">
            <h3>maxuewei2</h3>
        </div>
    </div>
    <div class="ui container sidebar-card">
    <div class="ui people shape content">
        <div class="active side">
            <div class="ui card">
                <div class="image">
                    <img class="ui medium bordered image" src="/images/avatar.jpg">
                </div>
                <div class="content">
                    <a class="header">maxuewei2</a>
                    
                        <div class="meta">
                            做一个优雅的变态
                        </div>
                    
                </div>
                <div class="extra content">
                    <div class="ui list">
                        
                        <div class="item">
                            <i class="marker icon" style="float: left"></i>
                            <div class="content">长春</div>
                        </div>
                        
                        
                    </div>

                </div>
                <div class="extra content">
                    <div class="ui list">
                        

                                <a href="https://github.com/maxuewei2"><i class="large github icon" style="float: left"></i></a>

                            

                                <a href="http://weibo.com/maxuewei2"><i class="large weibo icon" style="float: left"></i></a>

                            
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>

    
    

    

    
    <a href="/index.html" class="item" >
        <i class="home icon"></i>
        首页
    </a>

    
    

    

    
    <a href="/archives" class="item" >
        <i class="archive icon"></i>
        归档
    </a>

    
    

    

    
    <a href="/about" class="item" >
        <i class="user icon"></i>
        关于
    </a>

    

    
</div>

    <div class="pusher body-content">
        <div id="content" class="ui main container">
            <!--<div class="ui one column grid">-->
                <!--<div class="column">-->
                    <!--<div class="ui main container">-->
                        <div id="post-俄罗斯C++" class="ui main container article-type-post">

    

    <div class="ui divided grid">

        <div class="two column row" id="article-content">

            <div class="thirteen wide computer thirteen wide tablet sixteen wide mobile column">
                

<h1 class="ui header">
    
    俄罗斯方块（Win32实现，Codeblocks+GCC编译）
</h1>



                <div class="article-inner">

                    <div class="article-entry" itemprop="articleBody">
                        
                        <h3 id="&#x7F18;&#x8D77;&#xFF1A;"><a href="#&#x7F18;&#x8D77;&#xFF1A;" class="headerlink" title="&#x7F18;&#x8D77;&#xFF1A;"></a>&#x7F18;&#x8D77;&#xFF1A;</h3><p>&#x3000;&#x3000;&#x5728;&#x73A9;Codeblocks&#x81EA;&#x5E26;&#x7684;&#x4FC4;&#x7F57;&#x65AF;&#x65B9;&#x5757;&#x65F6;&#x89C9;&#x5F97;&#x4E0D;&#x9519;&#xFF0C;&#x7136;&#x800C;&#x6709;&#x65F6;&#x95F4;&#x9650;&#x5236;&#x3002;&#x6240;&#x4EE5;&#x60F3;&#x81EA;&#x5DF1;&#x518D;&#x5199;&#x4E00;&#x4E2A;&#x3002;</p>
<blockquote>
<p>&#x540E;&#x6765;&#x53D1;&#x73B0;&#x5728;&#x8BBE;&#x7F6E;&#x4E2D;&#x662F;&#x53EF;&#x4EE5;&#x53D6;&#x6D88;&#x65F6;&#x95F4;&#x9650;&#x5236;&#x7684;&#x3002;&#x3002;&#x3002;Orz</p>
</blockquote>
<a id="more"></a>
<h3 id="&#x7A0B;&#x5E8F;&#x6548;&#x679C;&#xFF1A;"><a href="#&#x7A0B;&#x5E8F;&#x6548;&#x679C;&#xFF1A;" class="headerlink" title="&#x7A0B;&#x5E8F;&#x6548;&#x679C;&#xFF1A;"></a>&#x7A0B;&#x5E8F;&#x6548;&#x679C;&#xFF1A;</h3><p><a class="magnific-img" href="/imgs/trisc++1.png"><img src="/imgs/trisc++1.png" alt="xiaoguo1" class="ui centered image"></a></p>
<h3 id="&#x4E3B;&#x8981;&#x5185;&#x5BB9;&#xFF1A;"><a href="#&#x4E3B;&#x8981;&#x5185;&#x5BB9;&#xFF1A;" class="headerlink" title="&#x4E3B;&#x8981;&#x5185;&#x5BB9;&#xFF1A;"></a>&#x4E3B;&#x8981;&#x5185;&#x5BB9;&#xFF1A;</h3><p>&#x3000;&#x3000;&#x7A0B;&#x5E8F;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;board&#x6570;&#x7EC4;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x8981;&#x663E;&#x793A;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x4E5F;&#x6709;&#x4E0D;&#x663E;&#x793A;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x4E0D;&#x663E;&#x793A;&#x7684;&#x90E8;&#x5206;&#x90FD;&#x5B58;&#x50A8;1&#x3002;</p>
<p>&#x3000;&#x3000;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p><a class="magnific-img" href="/imgs/trisc++2.png"><img src="/imgs/trisc++2.png" alt="neirong" class="ui centered image"></a>   &#x3000;&#x3000;&#x3000;&#x3000;</p>
<p>&#x3000;&#x3000;shape&#x91C7;&#x7528;4*4&#x6570;&#x7EC4;(shape)&#x4FDD;&#x5B58;&#x3002;&#x5982;&#xFF1A;</p>
<blockquote>
<p>0 0 0 0<br>0 1 0 0<br>1 1 1 0<br>0 0 0 0</p>
</blockquote>
<p>&#x3000;&#x3000;&#x53E6;&#x5916;&#x7528;&#x53D8;&#x91CF;row&#x548C;column&#x4FDD;&#x5B58;shape&#x6570;&#x7EC4;&#x5DE6;&#x4E0A;&#x89D2;&#x5728;board&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<p>&#x3000;&#x3000;&#x6BCF;&#x6B21;&#x4E0B;&#x843D;&#x6216;&#x5DE6;&#x53F3;&#x79FB;&#x52A8;&#xFF0C;&#x5148;&#x5BF9;row&#x548C;column&#x505A;&#x51FA;&#x6539;&#x53D8;&#xFF0C;&#x7136;&#x540E;&#x68C0;&#x6D4B;&#x5F53;&#x524D;row&#x548C;column&#x4E0B;&#xFF0C;shape&#x662F;&#x5426;&#x91CD;&#x5408;&#x4E86;&#x4E3A;1&#x7684;&#x683C;&#x5B50;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x91CD;&#x5408;&#xFF0C;&#x5C31;&#x8BF4;&#x660E;shape&#x51FA;&#x754C;&#x4E86;&#x6216;&#x8005;&#x5230;&#x8FBE;&#x4E0B;&#x843D;&#x6700;&#x4F4E;&#x70B9;&#xFF0C;&#x5219;&#x8981;&#x6062;&#x590D;row&#x548C;column&#x503C;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x4E0B;&#x843D;&#xFF0C;&#x8FD8;&#x8981;&#x5C06;shape&#x653E;&#x5728;board&#x4E0A;&#xFF0C;&#x5E76;&#x4EA7;&#x751F;&#x65B0;&#x7684;shape&#x3002;</p>
<p>&#x3000;&#x3000;&#x65CB;&#x8F6C;&#x65F6;&#xFF0C;&#x5148;&#x5BF9;shape&#x6570;&#x7EC4;&#x8FDB;&#x884C;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;&#xFF0C;&#x7136;&#x540E;&#x68C0;&#x6D4B;&#x91CD;&#x5408;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x91CD;&#x5408;&#xFF0C;&#x5219;&#x53CD;&#x5411;&#x65CB;&#x8F6C;&#x56DE;&#x6765;&#x3002;</p>
<p>&#x2002;<br>&#x2002;<br>&#x2002;<br>&#x2002;</p>
<h3 id="&#x4EE3;&#x7801;&#xFF1A;"><a href="#&#x4EE3;&#x7801;&#xFF1A;" class="headerlink" title="&#x4EE3;&#x7801;&#xFF1A;"></a>&#x4EE3;&#x7801;&#xFF1A;</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(UNICODE) &amp;&amp; !defined(_UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(_UNICODE) &amp;&amp; !defined(UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="comment">/*-----------------&#x5B8F;&#x5B9A;&#x4E49;--------------------------------------------------------*/</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WIDTH 180</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEIGHT 400</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LONG_SLEEP 300</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BKCOLOR RGB(238,238,238)<span class="comment">//&#x80CC;&#x666F;&#x8272;</span></span></div><div class="line"><span class="comment">/*-----------------&#x53D8;&#x91CF;----------------------------------------------------------*/</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> shapes[<span class="number">7</span>][<span class="number">4</span>][<span class="number">4</span>];<span class="comment">//&#x5B58;&#x50A8;7&#x4E2A;&#x5F62;&#x72B6;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> high_score[<span class="number">4</span>]= {<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>};<span class="comment">//&#x524D;&#x4E09;&#x4E2A;&#x5143;&#x7D20;&#x5B58;&#x50A8;&#x6700;&#x9AD8;&#x5206;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x5B58;&#x50A8;&#x6B64;&#x6B21;&#x5F97;&#x5206;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> **shape;<span class="comment">//&#x5F53;&#x524D;&#x5F62;&#x72B6;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> **board;</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> M=<span class="number">15</span>;<span class="comment">//&#x663E;&#x793A;&#x7684;&#x5217;&#x6570;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> N=<span class="number">30</span>;<span class="comment">//&#x663E;&#x793A;&#x7684;&#x884C;&#x6570;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> MM=M+<span class="number">8</span>;<span class="comment">//board&#x7684;&#x5217;&#x6570;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> NN=N+<span class="number">4</span>;<span class="comment">//board&#x7684;&#x884C;&#x6570;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> LEFT=<span class="number">4</span>;<span class="comment">//&#x663E;&#x793A;&#x7684;&#x6700;&#x5DE6;&#x4E00;&#x5217;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> RIGHT=LEFT+M<span class="number">-1</span>;<span class="comment">//&#x663E;&#x793A;&#x7684;&#x6700;&#x53F3;&#x4E00;&#x5217;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> TOP=<span class="number">0</span>;<span class="comment">//&#x663E;&#x793A;&#x7684;&#x6700;&#x4E0A;&#x4E00;&#x5217;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> BOTTOM=N<span class="number">-1</span>;<span class="comment">//&#x663E;&#x793A;&#x7684;&#x6700;&#x4E0B;&#x4E00;&#x5217;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> score=<span class="number">0</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> row=<span class="number">0</span>;<span class="comment">//&#x5F62;&#x72B6;&#x6240;&#x5728;&#x884C;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> column=MM/<span class="number">2</span>;<span class="comment">//&#x5F62;&#x72B6;&#x5750;&#x5728;&#x5217;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">bool</span> is_pause=<span class="literal">false</span>;</div><div class="line"><span class="keyword">static</span> HBRUSH grey_brush =CreateSolidBrush (RGB(<span class="number">210</span>,<span class="number">210</span>,<span class="number">210</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH white_brush =CreateSolidBrush (RGB(<span class="number">130</span>,<span class="number">130</span>,<span class="number">130</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH bk_brush =CreateSolidBrush (BKCOLOR);</div><div class="line"><span class="keyword">static</span> HPEN hPen = CreatePen(PS_SOLID,<span class="number">1</span>,RGB(<span class="number">147</span>,<span class="number">155</span>,<span class="number">166</span>));</div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> lattices_top=<span class="number">40</span>;<span class="comment">//&#x4E0A;&#x9762;&#x7559;&#x767D;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> lattices_left=<span class="number">20</span>;<span class="comment">//&#x5DE6;&#x4FA7;&#x7559;&#x767D;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> width=WIDTH/M;<span class="comment">//&#x6BCF;&#x4E2A;&#x683C;&#x5B50;&#x7684;&#x5BBD;&#x5EA6;</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> height=(HEIGHT-lattices_top)/N;<span class="comment">//&#x6BCF;&#x4E2A;&#x683C;&#x5B50;&#x7684;&#x9AD8;&#x5EA6;</span></div><div class="line"><span class="comment">/*-----------------&#x51FD;&#x6570;-----------------------------------------------------------*/</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_score</span><span class="params">()</span> </span>;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_is_lose</span><span class="params">()</span> </span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear_up</span><span class="params">()</span> </span>;<span class="comment">//&#x6D88;&#x9664;&#x6CA1;&#x6709;&#x7A7A;&#x683C;&#x5B50;&#x7684;&#x884C;</span></div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">down_thread_function</span><span class="params">(<span class="keyword">void</span> * args)</span> </span>;<span class="comment">//&#x5F62;&#x72B6;&#x4E0B;&#x843D;&#x8FDB;&#x7A0B;&#x8981;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">exit_game</span><span class="params">(HWND hwnd)</span> </span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">give_new_shape</span><span class="params">()</span> </span>;<span class="comment">//&#x968F;&#x673A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x5F62;&#x72B6;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">handle_key</span><span class="params">(HWND hwnd,WPARAM wParam)</span> </span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_down_thread</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//&#x521D;&#x59CB;&#x5316;&#x5F62;&#x72B6;&#x4E0B;&#x843D;&#x8FDB;&#x7A0B;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_game</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//&#x521D;&#x59CB;&#x5316;&#x6E38;&#x620F;&#x7A0B;&#x5E8F;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_play</span><span class="params">()</span> </span>;<span class="comment">//&#x521D;&#x59CB;&#x5316;&#x6E38;&#x620F;&#x6570;&#x636E;</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_legel</span><span class="params">()</span> </span>;<span class="comment">//&#x68C0;&#x6D4B;&#x5F62;&#x72B6;&#x5728;&#x5F53;&#x524D;&#x4F4D;&#x7F6E;&#x662F;&#x5426;&#x5408;&#x6CD5;&#xFF08;&#x5373;&#x662F;&#x5426;&#x91CD;&#x5408;&#x4E86;&#x975E;&#x7A7A;&#x7684;&#x683C;&#x5B50;&#xFF09;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>;<span class="comment">//&#x8BFB;&#x53D6;&#x6E38;&#x620F;&#x6700;&#x9AD8;&#x5206;&#x6570;&#x636E;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_shape</span><span class="params">()</span> </span>;<span class="comment">//&#x4ECE;&#x6587;&#x4EF6;&#x4E2D;&#x52A0;&#x8F7D;7&#x4E2A;&#x5F62;&#x72B6;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">lose_game</span><span class="params">(HWND hwnd)</span> </span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_down</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//&#x5F62;&#x72B6;&#x4E0B;&#x843D;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_lr</span><span class="params">(HWND hwnd,<span class="keyword">int</span> lr)</span> </span>;<span class="comment">//&#x5F62;&#x72B6;&#x5DE6;&#x53F3;&#x79FB;&#x52A8;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_lattice</span><span class="params">(HDC hdc,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> color)</span> </span>;<span class="comment">//&#x663E;&#x793A;&#x4E00;&#x4E2A;&#x683C;&#x5B50;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_UI</span><span class="params">(HDC hdc)</span> </span>;<span class="comment">//&#x753B;&#x754C;&#x9762;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">reset_rc</span><span class="params">()</span> </span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rerotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>;<span class="comment">//&#x987A;&#x65F6;&#x9488;&#x65CB;&#x8F6C;&#x4E00;&#x4E2A;&#x884C;&#x5217;&#x6570;&#x4E3A;mn&#x7684;&#x65B9;&#x9635;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>;<span class="comment">//&#x9006;&#x65F6;&#x9488;&#x65CB;&#x8F6C;&#x4E00;&#x4E2A;&#x884C;&#x5217;&#x6570;&#x4E3A;mn&#x7684;&#x65B9;&#x9635;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">rotate_shape</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//&#x65CB;&#x8F6C;&#x5F53;&#x524D;&#x5F62;&#x72B6;&#x5E76;&#x66F4;&#x65B0;&#x754C;&#x9762;</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">save_score</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//&#x4FDD;&#x5B58;&#x6700;&#x9AD8;&#x5206;&#x6570;&#x636E;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">shape_to_ground</span><span class="params">()</span> </span>;<span class="comment">//&#x5F53;&#x524D;&#x5F62;&#x72B6;&#x843D;&#x5730;&#x4E4B;&#x540E;&#xFF0C;&#x66F4;&#x65B0;board</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sort_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>;<span class="comment">//&#x5BF9;&#x6700;&#x9AD8;&#x5206;&#x548C;&#x6B64;&#x6B21;&#x5F97;&#x5206;&#x6392;&#x5E8F;&#xFF0C;&#x82E5;&#x521B;&#x9020;&#x65B0;&#x7EAA;&#x5F55;&#x5219;&#x8FD4;&#x56DE;true</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//&#x66F4;&#x65B0;&#x754C;&#x9762;&#xFF0C;&#x4EC5;&#x66F4;&#x65B0;Rect&#x533A;&#x57DF;&#xFF08;&#x5F62;&#x72B6;&#x6240;&#x5728;&#x7684;&#x90A3;&#x51E0;&#x884C;&#xFF09;&#x5185;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI_all</span><span class="params">(HWND hwnd)</span> </span>;<span class="comment">//&#x66F4;&#x65B0;&#x754C;&#x9762;&#xFF0C;&#x66F4;&#x65B0;&#x6574;&#x4E2A;&#x754C;&#x9762;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">write_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>;<span class="comment">//&#x5199;&#x6700;&#x9AD8;&#x5206;&#x6570;&#x636E;</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*  Declare Windows procedure  */</span></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/*  Make the class name into a global variable  */</span></div><div class="line">TCHAR szClassName[ ] = _T(<span class="string">&quot;Tris&quot;</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span> <span class="params">(HINSTANCE hThisInstance,</span></span></div><div class="line">                    HINSTANCE hPrevInstance,</div><div class="line">                    LPSTR lpszArgument,</div><div class="line">                    <span class="keyword">int</span> nCmdShow) {</div><div class="line">    HWND hwnd;               <span class="comment">/* This is the handle for our window */</span></div><div class="line">    MSG messages;            <span class="comment">/* Here messages to the application are saved */</span></div><div class="line">    WNDCLASSEX wincl;        <span class="comment">/* Data structure for the windowclass */</span></div><div class="line"></div><div class="line">    <span class="comment">/* The Window structure */</span></div><div class="line">    wincl.hInstance = hThisInstance;</div><div class="line">    wincl.lpszClassName = szClassName;</div><div class="line">    wincl.lpfnWndProc = WindowProcedure;      <span class="comment">/* This function is called by windows */</span></div><div class="line">    wincl.style = CS_DBLCLKS;                 <span class="comment">/* Catch double-clicks */</span></div><div class="line">    wincl.cbSize = <span class="keyword">sizeof</span> (WNDCLASSEX);</div><div class="line"></div><div class="line">    <span class="comment">/* Use default icon and mouse-pointer */</span></div><div class="line">    wincl.hIcon = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hIconSm = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hCursor = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW);</div><div class="line">    wincl.lpszMenuName = <span class="literal">NULL</span>;                 <span class="comment">/* No menu */</span></div><div class="line">    wincl.cbClsExtra = <span class="number">0</span>;                      <span class="comment">/* No extra bytes after the window class */</span></div><div class="line">    wincl.cbWndExtra = <span class="number">0</span>;                      <span class="comment">/* structure or the window instance */</span></div><div class="line">    <span class="comment">/* Use Windows&apos;s default colour as the background of the window */</span></div><div class="line">    wincl.hbrBackground =bk_brush;</div><div class="line">    <span class="comment">/* Register the window class, and if it fails quit the program */</span></div><div class="line">    <span class="keyword">if</span> (!RegisterClassEx (&amp;wincl))</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* The class is registered, let&apos;s create the program*/</span></div><div class="line">    hwnd = CreateWindowEx (</div><div class="line">               <span class="number">0</span>,                   <span class="comment">/* Extended possibilites for variation */</span></div><div class="line">               szClassName,         <span class="comment">/* Classname */</span></div><div class="line">               _T(<span class="string">&quot;Tris&quot;</span>),       <span class="comment">/* Title Text */</span></div><div class="line">               WS_OVERLAPPEDWINDOW, <span class="comment">/* default window */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* Windows decides the position */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* where the window ends up on the screen */</span></div><div class="line">               WIDTH+<span class="number">200</span>,                 <span class="comment">/* The programs width */</span></div><div class="line">               HEIGHT+<span class="number">70</span>,                 <span class="comment">/* and height in pixels */</span></div><div class="line">               HWND_DESKTOP,        <span class="comment">/* The window is a child-window to desktop */</span></div><div class="line">               <span class="literal">NULL</span>,                <span class="comment">/* No menu */</span></div><div class="line">               hThisInstance,       <span class="comment">/* Program Instance handler */</span></div><div class="line">               <span class="literal">NULL</span>                 <span class="comment">/* No Window Creation data */</span></div><div class="line">           );</div><div class="line"></div><div class="line">    <span class="comment">/* Make the window visible on the screen */</span></div><div class="line">    ShowWindow (hwnd, nCmdShow);</div><div class="line"></div><div class="line">    <span class="comment">/* Run the message loop. It will run until GetMessage() returns 0 */</span></div><div class="line">    <span class="keyword">while</span> (GetMessage (&amp;messages, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>)) {</div><div class="line">        <span class="comment">/* Translate virtual-key messages into character messages */</span></div><div class="line">        TranslateMessage(&amp;messages);</div><div class="line">        <span class="comment">/* Send message to WindowProcedure */</span></div><div class="line">        DispatchMessage(&amp;messages);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* The program return-value is 0 - The value that PostQuitMessage() gave */</span></div><div class="line">    <span class="keyword">return</span> messages.wParam;</div><div class="line">}</div><div class="line"><span class="comment">//&#x4ECE;&#x6587;&#x4EF6;&#x4E2D;&#x52A0;&#x8F7D;7&#x4E2A;&#x5F62;&#x72B6;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_shape</span><span class="params">()</span> </span>{</div><div class="line">    FILE* f=fopen(<span class="string">&quot;shapes.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>);</div><div class="line">    <span class="keyword">if</span>(f==<span class="literal">NULL</span>) {</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    }</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) {</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;<span class="number">4</span>; k++) {</div><div class="line">                <span class="keyword">if</span>(<span class="built_in">fscanf</span>(f,<span class="string">&quot;%d&quot;</span>,&amp;shapes[i][j][k])!=<span class="number">1</span>) {</div><div class="line">                    <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    fclose(f);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="comment">//&#x968F;&#x673A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x5F62;&#x72B6;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">give_new_shape</span><span class="params">()</span> </span>{</div><div class="line">    <span class="keyword">int</span> shape_num=rand()%<span class="number">7</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) {</div><div class="line">            shape[i][j]=shapes[shape_num][i][j];</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_score</span><span class="params">()</span> </span>{</div><div class="line">    score+=<span class="number">100</span>;</div><div class="line">}</div><div class="line"><span class="comment">//&#x6D88;&#x9664;&#x6CA1;&#x6709;&#x7A7A;&#x683C;&#x5B50;&#x7684;&#x884C;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear_up</span><span class="params">()</span> </span>{</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=row; i&lt;=row+<span class="number">3</span>; i++) {</div><div class="line">        <span class="keyword">if</span>(i&gt;BOTTOM)<span class="keyword">continue</span>;</div><div class="line">        <span class="keyword">bool</span> there_is_blank=<span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=LEFT; j&lt;=RIGHT; j++) {</div><div class="line">            <span class="keyword">if</span>(board[i][j]==<span class="number">0</span>) {</div><div class="line">                there_is_blank=<span class="literal">true</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">if</span>(!there_is_blank) {</div><div class="line">            add_score();</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> r=i; r&gt;=<span class="number">1</span>; r--) {</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> c=LEFT; c&lt;=RIGHT; c++) {</div><div class="line">                    board[r][c]=board[r<span class="number">-1</span>][c];</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//&#x68C0;&#x6D4B;&#x5F62;&#x72B6;&#x5728;&#x5F53;&#x524D;&#x4F4D;&#x7F6E;&#x662F;&#x5426;&#x5408;&#x6CD5;&#xFF08;&#x5373;&#x662F;&#x5426;&#x91CD;&#x5408;&#x4E86;&#x975E;&#x7A7A;&#x7684;&#x683C;&#x5B50;&#xFF09;</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_legel</span><span class="params">()</span> </span>{</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) {</div><div class="line">            <span class="keyword">if</span>(shape[i][j]==<span class="number">1</span>&amp;&amp;board[row+i][column+j]==<span class="number">1</span>) {</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">}</div><div class="line"><span class="comment">//&#x9006;&#x65F6;&#x9488;&#x65CB;&#x8F6C;&#x4E00;&#x4E2A;&#x884C;&#x5217;&#x6570;&#x4E3A;mn&#x7684;&#x65B9;&#x9635;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>{</div><div class="line">    <span class="keyword">int</span>** a=shape;</div><div class="line">    <span class="keyword">int</span> s=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> n=mn; n&gt;=<span class="number">1</span>; n-=<span class="number">2</span>) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n<span class="number">-1</span>; i++) {</div><div class="line">            <span class="keyword">int</span> t=a[s+i][s];</div><div class="line">            a[s+i][s]=a[s][s+n-i<span class="number">-1</span>];</div><div class="line">            a[s][s+n-i<span class="number">-1</span>]=a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>];</div><div class="line">            a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>]=a[s+n<span class="number">-1</span>][s+i];</div><div class="line">            a[s+n<span class="number">-1</span>][s+i]=t;</div><div class="line">        }</div><div class="line">        s++;</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//&#x987A;&#x65F6;&#x9488;&#x65CB;&#x8F6C;&#x4E00;&#x4E2A;&#x884C;&#x5217;&#x6570;&#x4E3A;mn&#x7684;&#x65B9;&#x9635;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rerotate_matrix</span><span class="params">(<span class="keyword">int</span> mn)</span> </span>{</div><div class="line">    <span class="keyword">int</span>** a=shape;</div><div class="line">    <span class="keyword">int</span> s=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> n=mn; n&gt;=<span class="number">1</span>; n-=<span class="number">2</span>) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n<span class="number">-1</span>; i++) {</div><div class="line">            <span class="keyword">int</span> t=a[s+i][s];</div><div class="line">            a[s+i][s]=a[s+n<span class="number">-1</span>][s+i];</div><div class="line">            a[s+n<span class="number">-1</span>][s+i]=a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>];</div><div class="line">            a[s+n-i<span class="number">-1</span>][s+n<span class="number">-1</span>]=a[s][s+n-i<span class="number">-1</span>];</div><div class="line">            a[s][s+n-i<span class="number">-1</span>]=t;</div><div class="line">        }</div><div class="line">        s++;</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//&#x663E;&#x793A;&#x4E00;&#x4E2A;&#x683C;&#x5B50;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_lattice</span><span class="params">(HDC hdc,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> color)</span> </span>{</div><div class="line">    <span class="keyword">if</span>(x&lt;TOP||x&gt;BOTTOM||y&lt;LEFT||y&gt;RIGHT) {</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    }</div><div class="line">    x-=TOP;</div><div class="line">    y-=LEFT;</div><div class="line">    <span class="keyword">int</span> left=lattices_left+y*width;</div><div class="line">    <span class="keyword">int</span> right=lattices_left+y*width+width;</div><div class="line">    <span class="keyword">int</span> top=lattices_top+x*height;</div><div class="line">    <span class="keyword">int</span> bottom=lattices_top+x*height+height;</div><div class="line">    MoveToEx (hdc,left,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,top) ;</div><div class="line">    MoveToEx (hdc,left,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,left,bottom) ;</div><div class="line">    MoveToEx (hdc,left,bottom, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,bottom) ;</div><div class="line">    MoveToEx (hdc,right,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,bottom) ;</div><div class="line">    SelectObject(hdc, grey_brush);</div><div class="line">    <span class="keyword">if</span>(color==<span class="number">0</span>) {</div><div class="line">        SelectObject(hdc, white_brush);</div><div class="line">    }</div><div class="line">    Rectangle(hdc,left,top,right,bottom);</div><div class="line">}</div><div class="line"><span class="comment">//&#x66F4;&#x65B0;&#x754C;&#x9762;&#xFF0C;&#x4EC5;&#x66F4;&#x65B0;Rect&#x533A;&#x57DF;&#xFF08;&#x5F62;&#x72B6;&#x6240;&#x5728;&#x7684;&#x90A3;&#x51E0;&#x884C;&#xFF09;&#x5185;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI</span><span class="params">(HWND hwnd)</span> </span>{</div><div class="line">    <span class="keyword">static</span> RECT rect;</div><div class="line">    rect.left=lattices_left;</div><div class="line">    rect.right=lattices_left+M*width+width;</div><div class="line">    rect.top=lattices_top+(row<span class="number">-1</span>)*height;</div><div class="line">    rect.bottom=lattices_top+(row+<span class="number">4</span>)*height;</div><div class="line">    InvalidateRect (hwnd,&amp;rect, <span class="literal">false</span>) ;</div><div class="line">}</div><div class="line"><span class="comment">//&#x66F4;&#x65B0;&#x754C;&#x9762;&#xFF0C;&#x66F4;&#x65B0;&#x6574;&#x4E2A;&#x754C;&#x9762;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_UI_all</span><span class="params">(HWND hwnd)</span> </span>{</div><div class="line">    InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">false</span>) ;</div><div class="line">}</div><div class="line"><span class="comment">//&#x753B;&#x754C;&#x9762;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_UI</span><span class="params">(HDC hdc)</span> </span>{</div><div class="line">    SetBkColor(hdc,BKCOLOR);</div><div class="line">    SelectObject(hdc,hPen);  <span class="comment">//&#x9009;&#x7528;&#x753B;&#x7B14;</span></div><div class="line">    <span class="keyword">char</span> score_str[<span class="number">20</span>];</div><div class="line">    <span class="built_in">sprintf</span>(score_str,<span class="string">&quot;Score:%d&quot;</span>,score);</div><div class="line">    TextOut(hdc,<span class="number">10</span>,<span class="number">10</span>,score_str,<span class="built_in">strlen</span>(score_str));</div><div class="line">    <span class="built_in">sprintf</span>(score_str,<span class="string">&quot;Highest Scores:&quot;</span>);</div><div class="line">    TextOut(hdc,WIDTH+<span class="number">50</span>,<span class="number">50</span>,score_str,<span class="built_in">strlen</span>(score_str));</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) {</div><div class="line">        <span class="built_in">sprintf</span>(score_str,<span class="string">&quot;%d&quot;</span>,high_score[i]);</div><div class="line">        TextOut(hdc,WIDTH+<span class="number">50</span>,<span class="number">50</span>+(i+<span class="number">1</span>)*<span class="number">20</span>,score_str,<span class="built_in">strlen</span>(score_str));</div><div class="line">    }</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=TOP; i&lt;=BOTTOM; i++) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=LEFT; j&lt;=RIGHT; j++) {</div><div class="line">            paint_lattice(hdc,i,j,board[i][j]);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) {</div><div class="line">            <span class="keyword">if</span>(shape[i][j]==<span class="number">1</span>)</div><div class="line">                paint_lattice(hdc,row+i,column+j,shape[i][j]);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//&#x65CB;&#x8F6C;&#x5F53;&#x524D;&#x5F62;&#x72B6;&#x5E76;&#x66F4;&#x65B0;&#x754C;&#x9762;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">rotate_shape</span><span class="params">(HWND hwnd)</span> </span>{</div><div class="line">    <span class="keyword">int</span> mn=<span class="number">4</span>;</div><div class="line">    rotate_matrix(mn);</div><div class="line">    <span class="keyword">if</span>(!is_legel()) {</div><div class="line">        rerotate_matrix(mn);</div><div class="line">    }</div><div class="line">    update_UI(hwnd);</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">reset_rc</span><span class="params">()</span> </span>{</div><div class="line">    row=<span class="number">0</span>;</div><div class="line">    column=MM/<span class="number">2</span><span class="number">-2</span>;</div><div class="line">}</div><div class="line"><span class="comment">//&#x8BFB;&#x53D6;&#x6E38;&#x620F;&#x6700;&#x9AD8;&#x5206;&#x6570;&#x636E;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>{</div><div class="line">    FILE* f=fopen(<span class="string">&quot;scores.txt&quot;</span>,<span class="string">&quot;r&quot;</span>);</div><div class="line">    <span class="keyword">if</span>(f==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="built_in">fscanf</span>(f,<span class="string">&quot;%d%d%d&quot;</span>,&amp;a[<span class="number">0</span>],&amp;a[<span class="number">1</span>],&amp;a[<span class="number">2</span>]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="comment">//&#x521D;&#x59CB;&#x5316;&#x6E38;&#x620F;&#x6570;&#x636E;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_play</span><span class="params">()</span> </span>{</div><div class="line">    load_scores(high_score);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;NN; i++) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;MM; j++) {</div><div class="line">            board[i][j]=<span class="number">0</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;LEFT; j++) {</div><div class="line">            board[i][j]=<span class="number">1</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=RIGHT+<span class="number">1</span>; j&lt;MM; j++) {</div><div class="line">            board[i][j]=<span class="number">1</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=BOTTOM+<span class="number">1</span>; i&lt;NN; i++) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;MM; j++) {</div><div class="line">            board[i][j]=<span class="number">1</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    reset_rc();</div><div class="line">    score=<span class="number">0</span>;</div><div class="line">    give_new_shape();</div><div class="line">    is_pause=<span class="literal">false</span>;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_is_lose</span><span class="params">()</span> </span>{</div><div class="line">    <span class="keyword">if</span>(row==<span class="number">0</span>)<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">}</div><div class="line"><span class="comment">//&#x5BF9;&#x6700;&#x9AD8;&#x5206;&#x548C;&#x6B64;&#x6B21;&#x5F97;&#x5206;&#x6392;&#x5E8F;&#xFF0C;&#x82E5;&#x521B;&#x9020;&#x65B0;&#x7EAA;&#x5F55;&#x5219;&#x8FD4;&#x56DE;true</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sort_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>{</div><div class="line">    <span class="keyword">int</span> temp=a[<span class="number">3</span>];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">3</span>; j++) {</div><div class="line">            <span class="keyword">if</span>(a[j]&lt;a[j+<span class="number">1</span>]) {</div><div class="line">                <span class="keyword">int</span> t=a[j];</div><div class="line">                a[j]=a[j+<span class="number">1</span>];</div><div class="line">                a[j+<span class="number">1</span>]=t;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">if</span>(temp&gt;a[<span class="number">3</span>])<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">}</div><div class="line"><span class="comment">//&#x5199;&#x6700;&#x9AD8;&#x5206;&#x6570;&#x636E;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">write_scores</span><span class="params">(<span class="keyword">int</span>* a)</span> </span>{</div><div class="line">    FILE* f=fopen(<span class="string">&quot;scores.txt&quot;</span>,<span class="string">&quot;w&quot;</span>);</div><div class="line">    <span class="keyword">if</span>(f==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="built_in">fprintf</span>(f,<span class="string">&quot;%d\n%d\n%d\n&quot;</span>,a[<span class="number">0</span>],a[<span class="number">1</span>],a[<span class="number">2</span>]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="comment">//&#x4FDD;&#x5B58;&#x6700;&#x9AD8;&#x5206;&#x6570;&#x636E;</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">save_score</span><span class="params">(HWND hwnd)</span> </span>{</div><div class="line">    high_score[<span class="number">3</span>]=score;</div><div class="line">    <span class="keyword">bool</span> made_record=sort_scores(high_score);</div><div class="line">    <span class="keyword">if</span>(write_scores(high_score)!=<span class="number">0</span>) {</div><div class="line">        MessageBox(hwnd,<span class="string">&quot;Write file error.Program will exit.&quot;</span>,<span class="string">&quot;Error&quot;</span>,<span class="literal">NULL</span>);</div><div class="line">        DestroyWindow(hwnd);</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> made_record;</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">lose_game</span><span class="params">(HWND hwnd)</span> </span>{</div><div class="line">    <span class="keyword">if</span>(is_pause)<span class="keyword">return</span> ;</div><div class="line">    is_pause=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">char</span> message[<span class="number">200</span>]=<span class="string">&quot;You lose the Game.\n&quot;</span>;</div><div class="line">    <span class="keyword">char</span> title[<span class="number">50</span>]=<span class="string">&quot;Game Over&quot;</span>;</div><div class="line">    <span class="keyword">if</span>(save_score(hwnd)) {</div><div class="line">        <span class="built_in">strcat</span>(message,<span class="string">&quot;You have made a new record.\n&quot;</span>);</div><div class="line">        <span class="keyword">char</span> score_str[<span class="number">100</span>];</div><div class="line">        <span class="built_in">sprintf</span>(score_str,<span class="string">&quot;The Highest Scores:\n%d\n%d\n%d\n&quot;</span>,high_score[<span class="number">0</span>],high_score[<span class="number">1</span>],high_score[<span class="number">2</span>]);</div><div class="line">        <span class="built_in">strcat</span>(message,score_str);</div><div class="line">    }</div><div class="line">    <span class="built_in">strcat</span>(message,<span class="string">&quot;\nPlay again?\n&quot;</span>);</div><div class="line">    <span class="keyword">if</span>(MessageBox(hwnd,message,title,MB_YESNO)==IDYES) {</div><div class="line">        init_play();</div><div class="line">        update_UI_all(hwnd);</div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">exit_game</span><span class="params">(HWND hwnd)</span> </span>{</div><div class="line">    is_pause=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">char</span> message[<span class="number">200</span>]=<span class="string">&quot;&quot;</span>;</div><div class="line">    <span class="keyword">char</span> title[<span class="number">50</span>]=<span class="string">&quot;Exit&quot;</span>;</div><div class="line">    <span class="keyword">if</span>(save_score(hwnd)) {</div><div class="line">        <span class="built_in">strcat</span>(message,<span class="string">&quot;You have made a new record.\n&quot;</span>);</div><div class="line">        <span class="keyword">char</span> score_str[<span class="number">100</span>];</div><div class="line">        <span class="built_in">sprintf</span>(score_str,<span class="string">&quot;The Highest Scores:\n%d\n%d\n%d\n&quot;</span>,high_score[<span class="number">0</span>],high_score[<span class="number">1</span>],high_score[<span class="number">2</span>]);</div><div class="line">        <span class="built_in">strcat</span>(message,score_str);</div><div class="line">        MessageBox(hwnd,message,title,<span class="literal">NULL</span>);</div><div class="line">    }</div><div class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">}</div><div class="line"><span class="comment">//&#x5F53;&#x524D;&#x5F62;&#x72B6;&#x843D;&#x5730;&#x4E4B;&#x540E;&#xFF0C;&#x66F4;&#x65B0;board</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">shape_to_ground</span><span class="params">()</span> </span>{</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) {</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) {</div><div class="line">            board[row+i][column+j]=shape[i][j]==<span class="number">1</span>?<span class="number">1</span>:board[row+i][column+j];</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//&#x5F62;&#x72B6;&#x4E0B;&#x843D;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_down</span><span class="params">(HWND hwnd)</span> </span>{</div><div class="line">    row++;</div><div class="line">    <span class="keyword">if</span>(!is_legel()) {</div><div class="line">        row--;</div><div class="line">        <span class="keyword">if</span>(check_is_lose()) {</div><div class="line">            lose_game(hwnd);</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        }</div><div class="line">        shape_to_ground();</div><div class="line">        clear_up();</div><div class="line">        update_UI_all(hwnd);</div><div class="line">        reset_rc();</div><div class="line">        give_new_shape();</div><div class="line">    }</div><div class="line">    update_UI(hwnd);</div><div class="line">}</div><div class="line"><span class="comment">//&#x8FDB;&#x7A0B;&#x53C2;&#x6570;&#x7ED3;&#x6784;&#x4F53;</span></div><div class="line"><span class="keyword">struct</span> thread_arg {</div><div class="line">    HWND arg_hwnd;</div><div class="line">};</div><div class="line"><span class="comment">//&#x5F62;&#x72B6;&#x4E0B;&#x843D;&#x8FDB;&#x7A0B;&#x8981;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;</span></div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">down_thread_function</span><span class="params">(<span class="keyword">void</span> * args)</span> </span>{</div><div class="line">    thread_arg *arg=(thread_arg*)args;</div><div class="line">    HWND dhwnd=arg-&gt;arg_hwnd;</div><div class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) {</div><div class="line">        <span class="keyword">if</span>(is_pause) {</div><div class="line">            Sleep(<span class="number">300</span>);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        }</div><div class="line">        move_down(dhwnd);</div><div class="line">        Sleep(LONG_SLEEP);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//&#x521D;&#x59CB;&#x5316;&#x5F62;&#x72B6;&#x4E0B;&#x843D;&#x8FDB;&#x7A0B;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_down_thread</span><span class="params">(HWND hwnd)</span> </span>{</div><div class="line">    <span class="keyword">int</span> ret;</div><div class="line">    <span class="keyword">pthread_t</span> t;</div><div class="line">    thread_arg *argp=<span class="keyword">new</span> thread_arg;</div><div class="line">    argp-&gt;arg_hwnd=hwnd;</div><div class="line">    ret=pthread_create(&amp;t,<span class="literal">NULL</span>,down_thread_function,argp);</div><div class="line">    <span class="keyword">delete</span> argp;</div><div class="line">    <span class="keyword">if</span>(ret!=<span class="number">0</span>) {</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="comment">//&#x521D;&#x59CB;&#x5316;&#x6E38;&#x620F;&#x7A0B;&#x5E8F;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_game</span><span class="params">(HWND hwnd)</span> </span>{</div><div class="line">    board=<span class="keyword">new</span> <span class="keyword">int</span>*[NN];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;NN; i++) {</div><div class="line">        board[i]=<span class="keyword">new</span> <span class="keyword">int</span>[MM];</div><div class="line">    }</div><div class="line">    shape=<span class="keyword">new</span> <span class="keyword">int</span>*[<span class="number">4</span>];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) {</div><div class="line">        shape[i]=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>];</div><div class="line">    }</div><div class="line">    srand(time(<span class="number">0</span>));</div><div class="line">    <span class="keyword">if</span>(load_shape()!=<span class="number">0</span>) {</div><div class="line">        MessageBox(hwnd,<span class="string">&quot;Read file error.Program will exit.&quot;</span>,<span class="string">&quot;Error&quot;</span>,<span class="literal">NULL</span>);</div><div class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">    }</div><div class="line">    init_play();</div><div class="line">    update_UI_all(hwnd);</div><div class="line">    <span class="keyword">if</span>(init_down_thread(hwnd)!=<span class="number">0</span>) {</div><div class="line">        MessageBox(hwnd,<span class="string">&quot;Thread error.Program will exit.&quot;</span>,<span class="string">&quot;Error&quot;</span>,<span class="literal">NULL</span>);</div><div class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="comment">//&#x5F62;&#x72B6;&#x5DE6;&#x53F3;&#x79FB;&#x52A8;</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">move_lr</span><span class="params">(HWND hwnd,<span class="keyword">int</span> lr)</span> </span>{</div><div class="line">    <span class="keyword">int</span> temp=column;</div><div class="line">    <span class="keyword">if</span>(lr==<span class="number">0</span>)column--;</div><div class="line">    <span class="keyword">else</span> {</div><div class="line">        column++;</div><div class="line">    }</div><div class="line">    <span class="keyword">if</span>(!is_legel()) {</div><div class="line">        column=temp;</div><div class="line">    }</div><div class="line">    update_UI(hwnd);</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">handle_key</span><span class="params">(HWND hwnd,WPARAM wParam)</span> </span>{</div><div class="line">    <span class="keyword">if</span>(wParam==VK_ESCAPE) {<span class="comment">//ESC&#x9000;&#x51FA;</span></div><div class="line">        exit_game(hwnd);</div><div class="line">    }</div><div class="line">    <span class="keyword">if</span>(wParam==VK_SPACE) {<span class="comment">//&#x7A7A;&#x683C;&#x6682;&#x505C;</span></div><div class="line">        is_pause=!is_pause;</div><div class="line">    }</div><div class="line">    <span class="keyword">if</span>(is_pause==<span class="literal">true</span>) {</div><div class="line">        Sleep(<span class="number">300</span>);</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    }</div><div class="line">    <span class="keyword">if</span>(wParam==VK_UP) {</div><div class="line">        rotate_shape(hwnd);</div><div class="line">    }</div><div class="line">    <span class="keyword">if</span>(wParam==VK_DOWN) {</div><div class="line">        move_down(hwnd);</div><div class="line">    }</div><div class="line">    <span class="keyword">if</span>(wParam==VK_LEFT) {</div><div class="line">        move_lr(hwnd,<span class="number">0</span>);</div><div class="line">    }</div><div class="line">    <span class="keyword">if</span>(wParam==VK_RIGHT) {</div><div class="line">        move_lr(hwnd,<span class="number">1</span>);</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="comment">/*  This function is called by the Windows function DispatchMessage()  */</span></div><div class="line">HWND hwnd;</div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span> </span>{</div><div class="line">    <span class="keyword">static</span> HDC hdc;</div><div class="line">    <span class="keyword">static</span> HDC hdcBuffer;</div><div class="line">    <span class="keyword">static</span> HBITMAP hBitMap;</div><div class="line">    <span class="keyword">static</span> PAINTSTRUCT ps ;</div><div class="line">    <span class="keyword">switch</span> (message) {                <span class="comment">/* handle the messages */</span></div><div class="line">    <span class="keyword">case</span> WM_CREATE:</div><div class="line">        init_game(hwnd);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_KEYDOWN:</div><div class="line">        handle_key(hwnd,wParam);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_DESTROY:</div><div class="line">        exit_game(hwnd);</div><div class="line">        PostQuitMessage (<span class="number">0</span>);       <span class="comment">/* send a WM_QUIT to the message queue */</span></div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_PAINT:</div><div class="line">        hdc = BeginPaint (hwnd, &amp;ps) ;</div><div class="line">        paint_UI(hdc);</div><div class="line">        EndPaint (hwnd, &amp;ps) ;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:                      <span class="comment">/* for messages that we don&apos;t deal with */</span></div><div class="line">        <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam);</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
<ul class="ui list">
<li><p>&#x7A0B;&#x5E8F;&#x5199;&#x4E8E;2016&#x5E74;&#x4E94;&#x4E00;&#x671F;&#x95F4;</p>
</li>
<li><p>&#x968F;&#x7B14;&#x5199;&#x4E8E;2016.5.8</p>
</li>
</ul>

                        
                    </div>

                    
                    
                    

                    <div class="description post-description">
    <span class="post-description-item">
        <time datetime="2016-05-08T05:08:59.000Z" itemprop="datePublished">2016-05-08</time>

    </span>
    <span class="post-description-item">
        

    <span>
        <i class="tags icon"></i>
    </span>

    
    <span class="ui tiny label">
        <a href="/tags/小游戏/">小游戏</a>
    </span>

    
    <span class="ui tiny label">
        <a href="/tags/Win32/">Win32</a>
    </span>

    

    </span>
</div>

                </div>
                
                <div id="pagination" class="nav-web ui text container pagination">

    <div class="ui stackable two column divided grid container">
        <div class="row">
            <div class="column nav-left">
                

                <a href="/2016/07/03/ChatRoom/" class="ui tiny button">

                    <i class="angle left icon"></i>
                    
                    聊天室（Java实现）
                    

                </a>

                
            </div>
            <div class="column nav-right">
                

                <a href="/2016/05/08/迷宫/" class="ui tiny button">
                    
                    Java迷宫游戏
                    
                    <i class="angle right icon"></i></a>
                
            </div>
        </div>
    </div>

</div>
                
            </div>

            
            <div class="three wide computer three wide tablet column">

                <div class="ui sticky article-toc" id="article-toc">
                    <!-- toc -->
                    <ol class="ui ordered list"><li><a href="#缘起："><span>缘起：</span></a></li><li><a href="#程序效果："><span>程序效果：</span></a></li><li><a href="#主要内容："><span>主要内容：</span></a></li><li><a href="#代码："><span>代码：</span></a></li></ol>
                </div>

            </div>
            

        </div>
    </div>
</div>


                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
        </div>
        <div class="ui vertical footer segment">
    <div class="ui center aligned container">
        <div class="ui inverted section divider"></div>
        &copy; 2016 <a href="/">maxuewei2</a>,
        Powered by <a href="https://github.com/henryhuang/hexo-theme-aloha" target="_blank">Aloha</a> and <a
                href="http://hexo.io/" target="_blank">Hexo</a>.
    </div>
</div>

    </div>




<!-- scripts list from theme config.yml -->

<script src="//cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>

<script src="//cdn.bootcss.com/semantic-ui/2.2.4/semantic.min.js"></script>

<script src="//cdn.bootcss.com/algoliasearch/3.18.1/algoliasearch.min.js"></script>

<script src="//cdn.bootcss.com/algoliasearch-helper-js/2.13.0/algoliasearch.helper.min.js"></script>

<script src="/js/semantic-ui-algolia.js"></script>

<script src="/js/aloha-events.js"></script>



</body>
</html>
