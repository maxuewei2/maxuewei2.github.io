<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="maxuewei2">
<meta property="og:url" content="http://maxuewei2.git.io/page/2/index.html">
<meta property="og:site_name" content="maxuewei2">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="maxuewei2">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://maxuewei2.git.io/page/2/"/>


  <title> maxuewei2 </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">maxuewei2</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Xlc Love Coding</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/12/FlappyBird/" itemprop="url">
                  Flappy Bird (Java实现)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-12T00:00:00+08:00" content="2016-04-12">
              2016-04-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="运行效果："><a href="#运行效果：" class="headerlink" title="运行效果："></a>运行效果：</h3><p><img src="/imgs/flappybird1.jpg" alt="效果"></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> bird;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.awt.Graphics;</div><div class="line"><span class="keyword">import</span> java.awt.Image;</div><div class="line"><span class="keyword">import</span> java.awt.Toolkit;</div><div class="line"><span class="keyword">import</span> java.awt.event.KeyAdapter;</div><div class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.BufferedWriter;</div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.FileReader;</div><div class="line"><span class="keyword">import</span> java.io.FileWriter;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.Random;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.swing.JFrame;</div><div class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</div><div class="line"><span class="keyword">import</span> javax.swing.JPanel;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span>  <span class="keyword">extends</span> <span class="title">JPanel</span>  </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> WIDTH=<span class="number">288</span>;</div><div class="line">    <span class="keyword">private</span>  <span class="keyword">int</span> HEIGHT=<span class="number">512</span>+<span class="number">112</span>;</div><div class="line"><span class="comment">//    Image img;</span></div><div class="line">    <span class="keyword">private</span>  Image bg,land,pipe_up,pipe_down,bird,score_h,score_t,score_n;</div><div class="line">    <span class="keyword">private</span>  <span class="keyword">int</span> y=<span class="number">300</span>,land_x=<span class="number">0</span>,pipe_x=<span class="number">200</span>,current_y=<span class="number">0</span>,time=<span class="number">0</span>,down=<span class="number">0</span>,bg_x=<span class="number">0</span>,t=<span class="number">0</span>,score=<span class="number">0</span>,yt=-<span class="number">1</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>, c = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] pipe_ys=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>];</div><div class="line">    <span class="keyword">private</span>  Image [] score_number=<span class="keyword">new</span> Image[<span class="number">10</span>];</div><div class="line">    <span class="keyword">private</span> Random random;</div><div class="line">    Bird()&#123;</div><div class="line">        getBestScores() ;</div><div class="line">        Toolkit tool = <span class="keyword">this</span>.getToolkit();</div><div class="line">        bg= tool.getImage(<span class="string">"images/bg_day.png"</span>);</div><div class="line">        land=tool.getImage(<span class="string">"images/land.png"</span>);</div><div class="line">        pipe_up= tool.getImage(<span class="string">"images/pipe_up.png"</span>);</div><div class="line">        pipe_down= tool.getImage(<span class="string">"images/pipe_down.png"</span>);</div><div class="line">        bird= tool.getImage(<span class="string">"images/bird0_01.png"</span>);</div><div class="line">        random = <span class="keyword">new</span> Random();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">9</span>;i++)&#123;</div><div class="line">        score_number[i]= tool.getImage(<span class="string">"images/number_score_0"</span>+i+<span class="string">".png"</span>);</div><div class="line">        &#125;</div><div class="line">        init();</div><div class="line">        <span class="keyword">this</span>.addKeyListener(</div><div class="line">                <span class="keyword">new</span> KeyAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> c = e.getKeyCode();</div><div class="line">                <span class="comment">//System.out.print(c);</span></div><div class="line"></div><div class="line">                <span class="keyword">switch</span> (c) &#123;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_LEFT :</div><div class="line"></div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_RIGHT :</div><div class="line"></div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_UP :</div><div class="line">                    System.exit(<span class="number">0</span>);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_DOWN :</div><div class="line"></div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_SPACE :</div><div class="line">                        down=<span class="number">0</span>;</div><div class="line">                        <span class="keyword">if</span>(time&lt;=<span class="number">0</span>)time=<span class="number">16</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                    <span class="keyword">default</span> :</div><div class="line">                        <span class="comment">// System.out.print("hey");</span></div><div class="line"></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">this</span>.setFocusable(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line">        y=<span class="number">300</span>;</div><div class="line">        land_x=<span class="number">0</span>;</div><div class="line">        pipe_x=<span class="number">200</span>;</div><div class="line">        current_y=<span class="number">0</span>;</div><div class="line">        time=<span class="number">0</span>;</div><div class="line">        down=<span class="number">0</span>;</div><div class="line">        bg_x=<span class="number">0</span>;</div><div class="line">        t=<span class="number">0</span>;</div><div class="line">        score=<span class="number">0</span>;</div><div class="line">        yt=-<span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">3</span>;i++)&#123;</div><div class="line">            pipe_ys[i]=-<span class="number">1</span>* Math.abs(random.nextInt()) % <span class="number">150</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get_Height</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> HEIGHT;&#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get_Width</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> WIDTH;&#125;</div><div class="line">    <span class="function"><span class="keyword">private</span>  <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</div><div class="line">            moveImg();</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">            Thread.sleep(<span class="number">10</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        moveBird();</div><div class="line">        repaint();</div><div class="line">        check();</div><div class="line">        t++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span>  <span class="title">moveBird</span><span class="params">()</span></span>&#123;</div><div class="line">        time--;</div><div class="line">        <span class="keyword">if</span>(t%<span class="number">1</span>==<span class="number">0</span>)&#123;<span class="keyword">if</span>(time&gt;<span class="number">0</span>)&#123;y-=<span class="number">4</span>;&#125;&#125;</div><div class="line">        <span class="keyword">if</span>(time&lt;=-<span class="number">5</span>&amp;&amp;y&lt;=<span class="number">512</span>-<span class="number">37</span>)&#123;<span class="keyword">if</span>(t%<span class="number">3</span>==<span class="number">0</span>)&#123;down+=<span class="number">1</span>;y+=down;&#125;&#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">moveImg</span><span class="params">()</span></span>&#123;</div><div class="line">        bg_x--;</div><div class="line">        <span class="keyword">if</span>(bg_x&lt;-<span class="number">288</span>)bg_x+=<span class="number">288</span>;</div><div class="line">        land_x-=<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(land_x&lt;-<span class="number">20</span>)land_x+=<span class="number">23</span>;</div><div class="line">        pipe_x-=<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(pipe_x&lt;=-<span class="number">52</span>)&#123;</div><div class="line">            pipe_x+=<span class="number">200</span>;</div><div class="line">            <span class="keyword">int</span> ran = Math.abs(random.nextInt()) % <span class="number">200</span>;</div><div class="line">            ran=-ran;</div><div class="line">            pipe_ys[current_y]=ran;</div><div class="line">            current_y++;</div><div class="line">            current_y%=<span class="number">4</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> temp=current_y;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">3</span>;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(<span class="number">80</span>+<span class="number">34</span>&gt;=pipe_x&amp;&amp;<span class="number">80</span>&lt;=pipe_x+<span class="number">52</span>)&#123;</div><div class="line">                <span class="keyword">if</span>(yt!=current_y)&#123;score++;yt=current_y;&#125;</div><div class="line">                <span class="keyword">if</span>(y&lt;=pipe_ys[temp]+<span class="number">320</span>||y+<span class="number">25</span>&gt;=pipe_ys[temp]+<span class="number">450</span>)&#123;</div><div class="line">                    gameOver();</div><div class="line">                init();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">gameOver</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (score &gt; a) &#123;</div><div class="line">            c = b;</div><div class="line">            b = a;</div><div class="line">            a = score;</div><div class="line">            save();</div><div class="line">            <span class="comment">//System.exit(0);</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (score &gt; b) &#123;</div><div class="line">            c = b;</div><div class="line">            b = score;</div><div class="line">            save();</div><div class="line">            <span class="comment">//System.exit(0);</span></div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (score &gt; c) &#123;</div><div class="line">            c = score;</div><div class="line">            save();</div><div class="line">            <span class="comment">//System.exit(0);</span></div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"GAME OVER!\n\nBEST SCORE:\n"</span>+a+<span class="string">"\n"</span>+b+<span class="string">"\n"</span>+c, <span class="string">"你死了(按任意键再来一次)"</span>,</div><div class="line">                JOptionPane.PLAIN_MESSAGE);</div><div class="line">        <span class="comment">//System.exit(0);</span></div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getBestScores</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        BufferedReader reader = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">"score.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            a = Integer.parseInt(reader.readLine());</div><div class="line">            b = Integer.parseInt(reader.readLine());</div><div class="line">            c = Integer.parseInt(reader.readLine());</div><div class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*String bestS = new String("Best Score: " + new Integer(a).toString()</span></div><div class="line">                + "   " + new Integer(b).toString() + "   "</div><div class="line">                + new Integer(c).toString());*/</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        BufferedWriter writer = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"score.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        String d = <span class="keyword">new</span> Integer(a).toString(), e = <span class="keyword">new</span> Integer(b).toString(),</div><div class="line">                f = <span class="keyword">new</span> Integer(c).toString();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            writer.write(d);</div><div class="line">            writer.newLine();</div><div class="line">            writer.write(e);</div><div class="line">            writer.newLine();</div><div class="line">            writer.write(f);</div><div class="line">            writer.flush();</div><div class="line">            writer.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException ev) &#123;</div><div class="line">            ev.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException ev) &#123;</div><div class="line">            ev.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showScore</span><span class="params">(Graphics g)</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> score_h=score/<span class="number">100</span>,score_t=score%<span class="number">100</span>/<span class="number">10</span>,score_n=score%<span class="number">10</span>;</div><div class="line">        <span class="keyword">if</span>(score_h!=<span class="number">0</span>)&#123;g.drawImage(score_number[score_h], <span class="number">80</span>,<span class="number">20</span>,<span class="keyword">this</span>);&#125;</div><div class="line">        g.drawImage(score_number[score_t], <span class="number">80</span>+<span class="number">20</span>,<span class="number">20</span>,<span class="keyword">this</span>);</div><div class="line">        g.drawImage(score_number[score_n], <span class="number">80</span>+<span class="number">20</span>+<span class="number">20</span>,<span class="number">20</span>,<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">(Graphics g)</span> </span>&#123;<span class="comment">//Component</span></div><div class="line">        <span class="keyword">super</span>.paintComponent(g);</div><div class="line">        <span class="comment">//g.drawLine(x,y,200,200);</span></div><div class="line">        g.drawImage(bg, bg_x,<span class="number">0</span>,<span class="keyword">this</span>);</div><div class="line">        g.drawImage(bg, bg_x+<span class="number">288</span>,<span class="number">0</span>,<span class="keyword">this</span>);</div><div class="line">        <span class="comment">//g.drawImage(land_1, landx_1, HEIGHT-land_1.getHeight(this), WIDTH,WIDTH*land_1.getHeight(this)/land_1.getWidth(this), this);</span></div><div class="line"></div><div class="line">        <span class="keyword">int</span> temp=current_y;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">3</span>;i++)&#123;</div><div class="line">        g.drawImage(pipe_down,pipe_x+i*<span class="number">200</span>,pipe_ys[temp],<span class="keyword">this</span>);</div><div class="line">        g.drawImage(pipe_up,pipe_x+i*<span class="number">200</span>,pipe_ys[temp]+<span class="number">450</span>,<span class="keyword">this</span>);</div><div class="line">        g.drawImage(bird,<span class="number">80</span>,y,<span class="keyword">this</span>);</div><div class="line">        temp++;</div><div class="line">        temp%=<span class="number">4</span>;</div><div class="line">        &#125;</div><div class="line">        g.drawImage(land, land_x,<span class="number">512</span>,<span class="keyword">this</span>);</div><div class="line">        showScore(g);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        JFrame frame = <span class="keyword">new</span> JFrame(<span class="string">"（按UP键退出）"</span>);</div><div class="line">        Bird b=<span class="keyword">new</span> Bird();</div><div class="line">        frame.getContentPane()</div><div class="line">                .add(b);</div><div class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</div><div class="line">        frame.setSize(b.get_Width(),b.get_Height());</div><div class="line">        frame.setLocation(<span class="number">200</span>, <span class="number">100</span>);</div><div class="line">        frame.setVisible(<span class="keyword">true</span>);</div><div class="line">        b.move();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="素材："><a href="#素材：" class="headerlink" title="素材："></a>素材：</h3><p>bg_day.png<br><img src="/imgs/bg_day.png" alt="bg"></p>
<p>bird0_01.png<br><img src="/imgs/bird0_01.png" alt="bg"></p>
<p>land.png<br><img src="/imgs/land.png" alt="bg"></p>
<p>pipe_up.png<br><img src="/imgs/pipe_up.png" alt="bg"></p>
<p>pipe_down.png<br><img src="/imgs/pipe_down.png" alt="bg"></p>
<p>number_score_00.png~number_score_09.png    (数字均为白色，图片背景为透明。为能够在博客中显示出来，特设置为灰色背景)</p>
<div style="background-color:rgb(200,200,200)"><br><img src="/imgs/number_score_00.png" alt="bg"><br><img src="/imgs/number_score_01.png" alt="bg"><br><img src="/imgs/number_score_02.png" alt="bg"><br><img src="/imgs/number_score_03.png" alt="bg"><br><img src="/imgs/number_score_04.png" alt="bg"><br><img src="/imgs/number_score_05.png" alt="bg"><br><img src="/imgs/number_score_06.png" alt="bg"><br><img src="/imgs/number_score_07.png" alt="bg"><br><img src="/imgs/number_score_08.png" alt="bg"><br><img src="/imgs/number_score_09.png" alt="bg"><br><br></div>




















<ul>
<li><p>程序写于大三上学期。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/22/局域网象棋/" itemprop="url">
                  局域网象棋游戏（C++实现，使用Socket，界面使用Win32，CodeBlocks+GCC编译）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-22T19:01:59+08:00" content="2016-03-22">
              2016-03-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <table>
<thead>
<tr>
<th>目录</th>
</tr>
</thead>
<tbody>
<tr>
<td>　　</td>
<td><a href="#chengguo">成果</a></td>
<td></td>
</tr>
<tr>
<td>　</td>
<td>　　　</td>
<td><a href="#xiaoguo">运行效果图</a></td>
</tr>
<tr>
<td>　　</td>
<td><a href="#guocheng">过程</a></td>
<td></td>
</tr>
<tr>
<td>　</td>
<td></td>
<td>　<a href="#liangduan">1. 首先的问题是下棋的两端应该是什么样的？</a></td>
</tr>
<tr>
<td></td>
<td></td>
<td>　　　　<a href="#cunchu">2. 接下来的问题是怎么表示，怎么存储？</a></td>
</tr>
<tr>
<td></td>
<td></td>
<td>　　<a href="#tongxin">3. 然后应该怎么通信呢？</a></td>
</tr>
<tr>
<td></td>
<td><a href="#daima">代码</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>　　　　<a href="#main">main.cpp</a></td>
</tr>
<tr>
<td></td>
<td></td>
<td>　　　　<a href="#chess">chinese_chess.h</a></td>
</tr>
<tr>
<td></td>
<td></td>
<td>　　　　<a href="#server">Server.h</a></td>
</tr>
<tr>
<td></td>
<td></td>
<td>　　　　<a href="#client">Client.h</a></td>
</tr>
<tr>
<td></td>
<td>　  <a href="#end">END</a></td>
<td></td>
</tr>
</tbody>
</table>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<p></p><h2 id="chengguo">成果</h2><p></p>
<h3 id="xiaoguo">运行效果图</h3>

<p>　　左边是在虚拟机里运行的，右边是在Host机上运行的。<br><img src="/imgs/xiangqi1.jpg" alt="chengguo"><br><img src="/imgs/xiangqi2.jpg" alt="chengguo"></p>
<p></p><h2 id="guocheng">过程</h2><br>　　记不起自己为什么要写这个象棋游戏的，大概是因为刚学了点儿Socket ，所以想用用，于是就写个局域网对战的象棋吧。。。<p></p>
<h3 id="liangduan">1.首先的问题是下棋的两端应该是什么样的？</h3>


<p>　　我希望下棋的两个人使用相同的程序。所以就不能像FTP一样，一个客户端，一个服务器端，而只能每个程序都是一样的，既是客户端（Client），又是服务器端（Server）。在通信时，己方的Client 向对方的Server 发送信息，对方的Client 向己方的Server 发送信息。两端都存储棋盘信息，通过通信保持棋盘信息的一致。</p>
<p>　　然后呢，应该是一端点击界面移子之后，应该能通知对方进行相同的移动。</p>
<p>　　综合以上两点，运行过程应该是这样的：</p>
<p>　　当在界面上点击棋子时，先判断当前是否轮到自己落子，如果是，则进行移动，更新界面，并通过Client 向对方Server 发送移动信息。对方Server 收到后，进行同样的移动，更新界面。</p>
<p>　　这里要求Server能随时接到对方发来的消息，所以Server的监听应该是一个额外的线程。</p>
<h3 id="cunchu">2.接下来的问题是怎么表示，怎么存储？</h3>

<p>　　棋盘，应该用二维数组存储比较好，数组坐标（以下所说的”数组坐标 “是指该二维数组中的一个(x,y)数对）对应棋盘坐标。那么数组里存储什么呢，一共有車、马、象、士、将、砲、卒七种棋子，那么设置一个棋子类作为基类，然后设置七个类继承棋子类？基类有一个move函数，每个子类重写该函数？但是移动似乎只是我程序的一小部分，这样似乎没必要。</p>
<p>　　那么存储整型数值？不同的数值代表不同的棋子？似乎可以。</p>
<p>　　那么就用7个数代替七种棋子，但是棋子有黑白色，要用一个数表示棋子类型（即是車、马或其他）和棋子颜色两个信息，那就用BLANK =8代表空子，黑方的車、马、象、士、将、砲、卒分别为1到7，白方的車、马、相、士、帅、炮、兵分别为9到15。</p>
<p>　　这样判断某数组坐标上棋子的颜色，就把其值与BLANK 比较，大于BLANK为白色，否则为黑色。</p>
<p>　　判断某数组坐标上棋子的类型，则将其值模BLANK 。</p>
<p>　　另外，因为下棋双方的视角是相反的，所以，棋盘在存储时应该是相反的，移动时的坐标也应该进行转换。</p>
<h3 id="tongxin">3.然后应该怎么通信呢？</h3><br>　　我希望这个程序打开后，就能找到对方，并确定谁是黑色，谁是白色。<br><br>　　也许可以让Client 在运行之后就对局域网进行端口扫描，然后给出正在运行此程序的IP 地址列表，让用户选择要连接到哪个，如果对方已经有了连接，则对方会拒绝此连接，如果对方没有连接，则对方程序会向对方用户提示该连接请求，如果，对方用户同意，则连接建立，否则依然是拒绝此连接。<br><br>　　但是，我没有采用以上所述方法（因为太复杂，我还是先做好主体工作吧=_=）。<br><br>　　所以在程序开始运行后，会让用户输入对方的IP 地址，然后Server 开始监听。之后Client 开始向对方发出连接请求。<br><br>　　Server 监听时，如果收到连接请求，就看对方的IP 地址是否是用户输入的IP 地址，如果不是，说明连接请求不是用户所希望的对方发送的，那就继续监听。<br><br>　　Client 请求连接时，如果对方同意了，就要开始确定自己的颜色了。<br><br>　　确定颜色这里困扰了我很久，最后采用的解决方法是这样的：<br>&gt;<br>　　　　核心思想就是谁先发出连接请求，谁就是黑色。<br>&gt;<br>　　　　也就是在Client 连接上对方之后，要判断Server 是不是已经连接了对方，如果Server 已连接，就说明是对方先发出的连接请求，那么对方就是黑色，自己就设为白色。如果Server 没有连接，就说明自己先连接上了对方，也就是自己是黑色。<br><br><br><br>　　以上就是编码前及编码时的大致想法。<br><br><br><h2 id="daima">代码</h2><br><h3 id="main">main.cpp</h3>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(UNICODE) &amp;&amp; !defined(_UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(_UNICODE) &amp;&amp; !defined(UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"chinese_chess.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Server.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Client.h"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WIDTH 400       <span class="comment">//界面宽度</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEIGHT 400      <span class="comment">//界面高度</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZERO_X 50       <span class="comment">//棋盘左边界</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZERO_Y 50       <span class="comment">//棋盘上边界</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PIECE_BKCOLOR    RGB(175,143,89)   <span class="comment">//棋子背景色</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PIECE_WH 30        <span class="comment">//棋盘每个格子的宽度和高度</span></span></div><div class="line"></div><div class="line">HWND hwnd;               <span class="comment">/* This is the handle for our window */</span></div><div class="line"><span class="keyword">char</span>* ots_ip;           <span class="comment">//存储对方IP地址的字符串</span></div><div class="line"><span class="keyword">int</span> port;</div><div class="line"><span class="keyword">bool</span> is_connect_alive=<span class="literal">false</span>;        <span class="comment">//是否连接到对方</span></div><div class="line">Board * chess_board;          <span class="comment">//棋盘</span></div><div class="line">Server *server;</div><div class="line">Client *client;</div><div class="line"><span class="keyword">int</span> chess_sx=<span class="number">-1</span>;        <span class="comment">//移动起始位置的数组坐标</span></div><div class="line"><span class="keyword">int</span> chess_sy=<span class="number">-1</span>;</div><div class="line"><span class="keyword">int</span> chess_dx=<span class="number">-1</span>;        <span class="comment">//移动目标位置的数组坐标</span></div><div class="line"><span class="keyword">int</span> chess_dy=<span class="number">-1</span>;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*  Declare Windows procedure  */</span></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/*  Make the class name into a global variable  */</span></div><div class="line">TCHAR szClassName[ ] = _T(<span class="string">"Chinese Chess"</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span> <span class="params">(HINSTANCE hThisInstance,</span></span></div><div class="line">                    HINSTANCE hPrevInstance,</div><div class="line">                    LPSTR lpszArgument,</div><div class="line">                    <span class="keyword">int</span> nCmdShow) &#123;</div><div class="line">    MSG messages;            <span class="comment">/* Here messages to the application are saved */</span></div><div class="line">    WNDCLASSEX wincl;        <span class="comment">/* Data structure for the windowclass */</span></div><div class="line"></div><div class="line">    <span class="comment">/* The Window structure */</span></div><div class="line">    wincl.hInstance = hThisInstance;</div><div class="line">    wincl.lpszClassName = szClassName;</div><div class="line">    wincl.lpfnWndProc = WindowProcedure;      <span class="comment">/* This function is called by windows */</span></div><div class="line">    wincl.style = CS_DBLCLKS;                 <span class="comment">/* Catch double-clicks */</span></div><div class="line">    wincl.cbSize = <span class="keyword">sizeof</span> (WNDCLASSEX);</div><div class="line"></div><div class="line">    <span class="comment">/* Use default icon and mouse-pointer */</span></div><div class="line">    wincl.hIcon = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hIconSm = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hCursor = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW);</div><div class="line">    wincl.lpszMenuName = <span class="literal">NULL</span>;                 <span class="comment">/* No menu */</span></div><div class="line">    wincl.cbClsExtra = <span class="number">0</span>;                      <span class="comment">/* No extra bytes after the window class */</span></div><div class="line">    wincl.cbWndExtra = <span class="number">0</span>;                      <span class="comment">/* structure or the window instance */</span></div><div class="line">    <span class="comment">/* Use Windows's default colour as the background of the window */</span></div><div class="line">    wincl.hbrBackground = (HBRUSH) COLOR_BACKGROUND;</div><div class="line"></div><div class="line">    <span class="comment">/* Register the window class, and if it fails quit the program */</span></div><div class="line">    <span class="keyword">if</span> (!RegisterClassEx (&amp;wincl))</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* The class is registered, let's create the program*/</span></div><div class="line">    hwnd = CreateWindowEx (</div><div class="line">               <span class="number">0</span>,                   <span class="comment">/* Extended possibilites for variation */</span></div><div class="line">               szClassName,         <span class="comment">/* Classname */</span></div><div class="line">               _T(<span class="string">"Chinese Chess"</span>),       <span class="comment">/* Title Text */</span></div><div class="line">               WS_OVERLAPPEDWINDOW, <span class="comment">/* default window */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* Windows decides the position */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* where the window ends up on the screen */</span></div><div class="line">               WIDTH,                 <span class="comment">/* The programs width */</span></div><div class="line">               HEIGHT,                 <span class="comment">/* and height in pixels */</span></div><div class="line">               HWND_DESKTOP,        <span class="comment">/* The window is a child-window to desktop */</span></div><div class="line">               <span class="literal">NULL</span>,                <span class="comment">/* No menu */</span></div><div class="line">               hThisInstance,       <span class="comment">/* Program Instance handler */</span></div><div class="line">               <span class="literal">NULL</span>                 <span class="comment">/* No Window Creation data */</span></div><div class="line">           );</div><div class="line"></div><div class="line">    <span class="comment">/* Make the window visible on the screen */</span></div><div class="line">    ShowWindow (hwnd, nCmdShow);</div><div class="line"></div><div class="line">    <span class="comment">/* Run the message loop. It will run until GetMessage() returns 0 */</span></div><div class="line">    <span class="keyword">while</span> (GetMessage (&amp;messages, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>)) &#123;</div><div class="line">        <span class="comment">/* Translate virtual-key messages into character messages */</span></div><div class="line">        TranslateMessage(&amp;messages);</div><div class="line">        <span class="comment">/* Send message to WindowProcedure */</span></div><div class="line">        DispatchMessage(&amp;messages);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/* The program return-value is 0 - The value that PostQuitMessage() gave */</span></div><div class="line">    <span class="keyword">return</span> messages.wParam;</div><div class="line">&#125;</div><div class="line"><span class="comment">//把数组坐标转换为界面坐标</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">xy_to_pixel</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span>*pixelx,<span class="keyword">int</span> *pixely)</span> </span>&#123;</div><div class="line">    *pixely=x*PIECE_WH+ZERO_Y;</div><div class="line">    *pixelx=y*PIECE_WH+ZERO_X;</div><div class="line">&#125;</div><div class="line"><span class="comment">//把界面坐标转换为数组坐标</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">pixel_to_xy</span><span class="params">(<span class="keyword">int</span> pixelx,<span class="keyword">int</span> pixely,<span class="keyword">int</span>*x,<span class="keyword">int</span> *y)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> r=PIECE_WH/<span class="number">2</span>;</div><div class="line">    *y=(pixelx-(ZERO_X-r))/PIECE_WH;</div><div class="line">    *x=(pixely-(ZERO_Y-r))/PIECE_WH;</div><div class="line">&#125;</div><div class="line"><span class="comment">//以数组坐标画线</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw_line</span><span class="params">(HDC hdc,<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> psx,psy,pdx,pdy;</div><div class="line">    xy_to_pixel(sx,sy,&amp;psx,&amp;psy);</div><div class="line">    xy_to_pixel(dx,dy,&amp;pdx,&amp;pdy);</div><div class="line">    MoveToEx (hdc, psx,psy, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc, pdx, pdy) ;</div><div class="line">&#125;</div><div class="line"><span class="comment">//以数组坐标画棋子</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_piece</span><span class="params">(HDC hdc,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> color,<span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> HBRUSH  piece_brush =CreateSolidBrush (PIECE_BKCOLOR);    <span class="comment">//棋子的背景色</span></div><div class="line">    <span class="keyword">if</span>(type==<span class="number">0</span>||color==BLANK)<span class="keyword">return</span> ;</div><div class="line">    <span class="keyword">int</span> px,py;</div><div class="line">    xy_to_pixel(x,y,&amp;px,&amp;py);</div><div class="line">    <span class="keyword">int</span> r=PIECE_WH/<span class="number">2</span>;</div><div class="line">    SelectObject (hdc,piece_brush ) ;</div><div class="line">    Ellipse(hdc,px-r,py-r,px+r,py+r);</div><div class="line">    <span class="keyword">char</span> *text=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">5</span>];</div><div class="line">    <span class="keyword">switch</span>(type) &#123;</div><div class="line">    <span class="keyword">case</span> JU:</div><div class="line">        <span class="built_in">strcpy</span>(text,<span class="string">"車"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> MA:</div><div class="line">        <span class="built_in">strcpy</span>(text,<span class="string">"马"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> XIANG:</div><div class="line">        <span class="keyword">if</span>(color==BLACK)<span class="built_in">strcpy</span>(text,<span class="string">"象"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">strcpy</span>(text,<span class="string">"相"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> SHI:</div><div class="line">        <span class="built_in">strcpy</span>(text,<span class="string">"士"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> JIANG:</div><div class="line">        <span class="keyword">if</span>(color==BLACK)<span class="built_in">strcpy</span>(text,<span class="string">"将"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">strcpy</span>(text,<span class="string">"帅"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> PAO:</div><div class="line">        <span class="keyword">if</span>(color==BLACK)<span class="built_in">strcpy</span>(text,<span class="string">"砲"</span>);</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="built_in">strcpy</span>(text,<span class="string">"炮"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> ZU:</div><div class="line">        <span class="keyword">if</span>(color==BLACK)<span class="built_in">strcpy</span>(text,<span class="string">"卒"</span>);</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="built_in">strcpy</span>(text,<span class="string">"兵"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">        <span class="built_in">strcpy</span>(text,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">    SetBkColor(hdc,PIECE_BKCOLOR);<span class="comment">//设置文字背景色</span></div><div class="line">    <span class="keyword">if</span>(color==BLACK) &#123;</div><div class="line">        SetTextColor(hdc,RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));       <span class="comment">//设置文字颜色</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        SetTextColor(hdc,RGB(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>));</div><div class="line">    &#125;</div><div class="line">    TextOut (hdc, px-r/<span class="number">2</span>, py-r/<span class="number">2</span>,text , <span class="built_in">strlen</span>(<span class="string">"马"</span>)) ;</div><div class="line">    <span class="keyword">delete</span> text;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">main_listen</span><span class="params">(<span class="keyword">void</span> *)</span> </span>&#123;</div><div class="line">    server-&gt;listen_message();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//创建线程，使server开始监听</span></div><div class="line"><span class="function"><span class="keyword">bool</span>  <span class="title">start_listen</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">pthread_t</span> listen_p;</div><div class="line">    <span class="keyword">int</span> ret;</div><div class="line">    ret= pthread_create( &amp;listen_p,  <span class="literal">NULL</span>, main_listen,<span class="literal">NULL</span> ); <span class="comment">//</span></div><div class="line">    <span class="keyword">if</span>( ret != <span class="number">0</span> ) &#123; <span class="comment">//创建线程成功返回0</span></div><div class="line">        <span class="comment">//printf("pthread_create error:error_code=%d\n",ret );</span></div><div class="line">        handle_error(THREAD_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">chess_connect</span><span class="params">(<span class="keyword">void</span> *)</span> </span>&#123;</div><div class="line">    server=<span class="keyword">new</span> Server();<span class="comment">//创建Server对象</span></div><div class="line">    client=<span class="keyword">new</span> Client(); <span class="comment">//创建Client对象，</span></div><div class="line">    start_listen();             <span class="comment">//创建线程，server开始监听</span></div><div class="line">    <span class="comment">//Sleep(100);</span></div><div class="line">    client-&gt;connect_to_ots();  <span class="comment">//client开始连接对方server，连接成功后返回</span></div><div class="line">    InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">pthread_t</span> connect_p;</div><div class="line">    <span class="keyword">int</span> ret;</div><div class="line">    ret= pthread_create( &amp;connect_p,  <span class="literal">NULL</span>, chess_connect,<span class="literal">NULL</span>); <span class="comment">//</span></div><div class="line">    <span class="keyword">if</span>( ret != <span class="number">0</span> ) &#123; <span class="comment">//创建线程成功返回0</span></div><div class="line">        <span class="comment">//printf("pthread_create error:error_code=%d\n",ret );</span></div><div class="line">        handle_error(THREAD_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*  This function is called by the Windows function DispatchMessage()  */</span></div><div class="line"></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> POINT mouse;</div><div class="line">    <span class="keyword">static</span> HDC hdc;</div><div class="line">    <span class="keyword">static</span> PAINTSTRUCT ps ;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> iofip=<span class="number">0</span>;     <span class="comment">//index of ots_ip</span></div><div class="line">    <span class="keyword">switch</span> (message) &#123;                <span class="comment">/* handle the messages */</span></div><div class="line">    <span class="keyword">case</span> WM_CREATE: &#123;</div><div class="line">        port=<span class="number">35536</span>;</div><div class="line">        ots_ip=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">20</span>];</div><div class="line">        <span class="built_in">strcpy</span>(ots_ip,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_KEYDOWN:<span class="comment">//识别按键，显示输入的内容（对方IP地址）</span></div><div class="line">        <span class="keyword">if</span>(wParam==<span class="number">13</span>) &#123;<span class="comment">//如果是ENTER，则初始化server、client，并开始连接，连接成功后初始化board</span></div><div class="line">            init();</div><div class="line">            Sleep(<span class="number">100</span>);</div><div class="line">            InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(wParam==VK_BACK) &#123;<span class="comment">//删除键</span></div><div class="line">            <span class="keyword">if</span>(iofip==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">            iofip--;</div><div class="line">            ots_ip[iofip]=<span class="string">'\0'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(wParam&lt;<span class="number">106</span>&amp;&amp;wParam&gt;<span class="number">95</span>) &#123;<span class="comment">//小键盘数字键</span></div><div class="line">            wParam-=<span class="number">48</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(wParam&lt;<span class="number">58</span>&amp;&amp;wParam&gt;<span class="number">47</span>) &#123;<span class="comment">//主键盘数字键</span></div><div class="line">            ots_ip[iofip]=<span class="string">'0'</span><span class="number">-48</span>+wParam;</div><div class="line">            iofip++;</div><div class="line">            ots_ip[iofip]=<span class="string">'\0'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(wParam==<span class="number">110</span>||wParam==<span class="number">229</span>) &#123;<span class="comment">//小数点键，小键盘110，主键盘229</span></div><div class="line">            ots_ip[iofip]=<span class="string">'.'</span>;</div><div class="line">            iofip++;</div><div class="line">            ots_ip[iofip]=<span class="string">'\0'</span>;</div><div class="line">        &#125;</div><div class="line">        InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_PAINT: &#123;</div><div class="line">        hdc=BeginPaint (hwnd,&amp;ps) ;</div><div class="line">        SetBkColor(hdc,RGB(<span class="number">200</span>,<span class="number">200</span>,<span class="number">200</span>));</div><div class="line">        <span class="keyword">if</span>(chess_board==<span class="literal">NULL</span>) &#123;<span class="comment">//显示输入的IP地址</span></div><div class="line">            <span class="keyword">char</span> tip[<span class="number">20</span>]=<span class="string">"请输入对方IP地址："</span>;</div><div class="line">            Rectangle(hdc,WIDTH/<span class="number">5</span><span class="number">-20</span>,HEIGHT/<span class="number">2</span><span class="number">-10</span>,WIDTH/<span class="number">5</span>*<span class="number">4</span>,HEIGHT/<span class="number">2</span>+<span class="number">20</span>);</div><div class="line">            TextOut(hdc,WIDTH/<span class="number">5</span>,HEIGHT/<span class="number">2</span><span class="number">-50</span>,tip,<span class="built_in">strlen</span>(tip));</div><div class="line">            TextOut(hdc,WIDTH/<span class="number">5</span>,HEIGHT/<span class="number">2</span>,ots_ip,<span class="built_in">strlen</span>(ots_ip));</div><div class="line">            <span class="keyword">if</span>(server!=<span class="literal">NULL</span>) &#123;             <span class="comment">//board==NULL而server!=NULL表示正在连接过程中</span></div><div class="line">                <span class="keyword">char</span> tip[<span class="number">20</span>]=<span class="string">"正在连接......"</span>;</div><div class="line">                TextOut(hdc,WIDTH/<span class="number">5</span>,HEIGHT/<span class="number">2</span>+<span class="number">50</span>,tip,<span class="built_in">strlen</span>(tip));</div><div class="line">            &#125;</div><div class="line">            EndPaint(hwnd,&amp;ps);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">char</span> text[<span class="number">10</span>]=<span class="string">"你的颜色:"</span>;</div><div class="line">        <span class="keyword">if</span>(chess_board-&gt;get_color()==BLACK) &#123;</div><div class="line">            <span class="built_in">strcat</span>(text,<span class="string">" 黑"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">strcat</span>(text,<span class="string">" 白"</span>);</div><div class="line">        &#125;</div><div class="line">        TextOut (hdc, <span class="number">0</span>, <span class="number">0</span>,text , <span class="built_in">strlen</span>(text)) ;</div><div class="line">        <span class="keyword">int</span> M=chess_board-&gt;get_M();</div><div class="line">        <span class="keyword">int</span> N=chess_board-&gt;get_N();</div><div class="line">        <span class="comment">//画棋盘</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;M; i++) &#123;</div><div class="line">            draw_line(hdc,i,<span class="number">0</span>,i,N<span class="number">-1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">            draw_line(hdc,<span class="number">0</span>,i,N/<span class="number">2</span>,i);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">            draw_line(hdc,N/<span class="number">2</span>+<span class="number">1</span>,i,N,i);</div><div class="line">        &#125;</div><div class="line">        draw_line(hdc,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>);</div><div class="line">        draw_line(hdc,<span class="number">0</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>);</div><div class="line">        draw_line(hdc,<span class="number">9</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">5</span>);</div><div class="line">        draw_line(hdc,<span class="number">7</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">5</span>);</div><div class="line">        draw_line(hdc,<span class="number">4</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>);</div><div class="line">        draw_line(hdc,<span class="number">4</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">8</span>);</div><div class="line">        <span class="comment">//画棋子</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;M; i++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">                paint_piece(hdc,i,j,chess_board-&gt;get_color(i,j),chess_board-&gt;get_type(i,j));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        EndPaint(hwnd,&amp;ps);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_LBUTTONUP: &#123;</div><div class="line">        <span class="keyword">if</span>(chess_board==<span class="literal">NULL</span>)<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">if</span>(!chess_board-&gt;is_my_turn())<span class="keyword">break</span>;<span class="comment">//当前没轮到自己下棋</span></div><div class="line">        GetCursorPos(&amp;mouse);<span class="comment">//获取鼠标的屏幕坐标</span></div><div class="line">        ScreenToClient(hwnd,&amp;mouse);<span class="comment">//转换为界面坐标</span></div><div class="line">        <span class="keyword">int</span> x,y;</div><div class="line">        pixel_to_xy(mouse.x,mouse.y,&amp;x,&amp;y);<span class="comment">//转换为数组坐标</span></div><div class="line">        <span class="keyword">if</span>(chess_board-&gt;get_color(x,y)==chess_board-&gt;get_color()) &#123;<span class="comment">//点击的是自己的棋子</span></div><div class="line">            chess_sx=x;</div><div class="line">            chess_sy=y;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(chess_sx==<span class="number">-1</span>||chess_sy==<span class="number">-1</span>) &#123;<span class="comment">//起始坐标未赋值且点击的不是自己的棋子，则break</span></div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        chess_dx=x;</div><div class="line">        chess_dy=y;</div><div class="line">        <span class="keyword">if</span>(chess_board-&gt;my_move_piece(chess_sx,chess_sy,chess_dx,chess_dy)) &#123; <span class="comment">//如果移动棋子合法</span></div><div class="line">            client-&gt;send_message(<span class="string">"move"</span>,chess_sx,chess_sy,chess_dx,chess_dy);   <span class="comment">//向对方发送移子信息</span></div><div class="line">            InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">if</span>(chess_board-&gt;get_is_win()==WIN) &#123;</div><div class="line"></div><div class="line">                chess_board-&gt;init();<span class="comment">//重新初始化棋盘，重下一盘</span></div><div class="line">                MessageBox(hwnd,<span class="string">"你赢了"</span>,<span class="string">"获胜！"</span>,<span class="literal">NULL</span>);</div><div class="line">                InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        chess_sx=<span class="number">-1</span>;</div><div class="line">        chess_sy=<span class="number">-1</span>;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">case</span> WM_DESTROY:</div><div class="line">        <span class="keyword">if</span>(server!=<span class="literal">NULL</span>)server-&gt;close();</div><div class="line">        <span class="keyword">if</span>(client!=<span class="literal">NULL</span>)client-&gt;close();</div><div class="line">        PostQuitMessage (<span class="number">0</span>);       <span class="comment">/* send a WM_QUIT to the message queue */</span></div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:                      <span class="comment">/* for messages that we don't deal with */</span></div><div class="line">        <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="chess">chinese_chess.h</h3>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CHINESE_CHESS_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CHINESE_CHESS_H_INCLUDED</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> JU 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MA 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> XIANG 3</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SHI 4</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> JIANG 5</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PAO 6</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ZU 7</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BLANK 8 <span class="comment">//空子</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BLACK -1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WHITE 1</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WIN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LOSE -1</span></div><div class="line"><span class="keyword">class</span> Board &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">bool</span> turn;   <span class="comment">//是否轮到自己下棋</span></div><div class="line">    <span class="keyword">int</span> color;  <span class="comment">//自己的颜色</span></div><div class="line">    <span class="keyword">int</span> M,N;        <span class="comment">//棋盘行数、列数</span></div><div class="line">    <span class="keyword">int</span> **b;    <span class="comment">//二维数组</span></div><div class="line">    <span class="keyword">int</span> is_win;     <span class="comment">//是否胜利</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_out</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;<span class="comment">//坐标是否出界</span></div><div class="line">        <span class="keyword">return</span> x&gt;M||y&gt;N||x&lt;<span class="number">0</span>||y&lt;<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_same_color</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;<span class="comment">//源坐标与目的坐标是否是同一颜色</span></div><div class="line">        <span class="keyword">return</span> get_color(sx,sy)==get_color(dx,dy);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap_num</span><span class="params">(<span class="keyword">int</span> &amp; num1,<span class="keyword">int</span>&amp; num2)</span> </span>&#123;<span class="comment">//交换两个数</span></div><div class="line">        num1+=num2;</div><div class="line">        num2=num1-num2;</div><div class="line">        num1=num1-num2;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_abs</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;<span class="comment">//取得绝对值</span></div><div class="line">        <span class="keyword">return</span> num&gt;=<span class="number">0</span>?num:-num;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">num_of_not_blank_betweenn</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;<span class="comment">//返回在起始坐标和目的坐标之间棋子的个数</span></div><div class="line">        <span class="keyword">if</span>(!(sx==dx||sy==dy))<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        <span class="keyword">int</span> num=<span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>(sy&gt;dy)swap_num(sy,dy);</div><div class="line">        <span class="keyword">if</span>(sx&gt;dx)swap_num(sx,dx);</div><div class="line">        <span class="keyword">if</span>(sx==dx) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=sy+<span class="number">1</span>; i&lt;dy; i++) &#123;</div><div class="line">                <span class="keyword">if</span>(b[sx][i]!=BLANK)num++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(sy==dy) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=sx+<span class="number">1</span>; i&lt;dx; i++) &#123;</div><div class="line">                <span class="keyword">if</span>(b[i][sy]!=BLANK)num++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> num;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_JU</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> num_of_not_blank_betweenn(sx,sy,dx,dy)==<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_MA</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> x=dx-sx,y=dy-sy;</div><div class="line">        <span class="keyword">if</span>(get_abs(x)==<span class="number">2</span>&amp;&amp;get_abs(y)==<span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">if</span>(get_color(sx+x/<span class="number">2</span>,sy)==BLANK)<span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//硌马蹄检测</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(get_abs(x)==<span class="number">1</span>&amp;&amp;get_abs(y)==<span class="number">2</span>) &#123;</div><div class="line">            <span class="keyword">if</span>(get_color(sx,sy+y/<span class="number">2</span>)==BLANK)<span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//硌马蹄检测</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_XIANG</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> x=dx-sx,y=dy-sy;</div><div class="line">        <span class="keyword">if</span>(!(get_abs(x)==<span class="number">2</span>&amp;&amp;get_abs(y)==<span class="number">2</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(get_color(sx+x/<span class="number">2</span>,sy+y/<span class="number">2</span>)==BLANK)<span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//硌象蹄检测</span></div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_SHI</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> x=dx-sx,y=dy-sy;</div><div class="line">        <span class="keyword">if</span>(!(get_abs(x)==<span class="number">1</span>&amp;&amp;get_abs(y)==<span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(dx&lt;<span class="number">7</span>)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(dy&lt;<span class="number">3</span>||dy&gt;<span class="number">5</span>)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_JIANG</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> x=dx-sx,y=dy-sy;</div><div class="line">        <span class="keyword">if</span>(!((get_abs(x)==<span class="number">1</span>&amp;&amp;get_abs(y)==<span class="number">0</span>)||(get_abs(x)==<span class="number">0</span>&amp;&amp;get_abs(y)==<span class="number">1</span>))) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(dx&lt;<span class="number">7</span>)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(dy&lt;<span class="number">3</span>||dy&gt;<span class="number">5</span>)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;<span class="comment">//明将检测</span></div><div class="line">            <span class="keyword">if</span>(get_type(i,dy)==JIANG) &#123;</div><div class="line">                <span class="keyword">if</span>(num_of_not_blank_betweenn(dx,dy,i,dy)==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_PAO</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> n=get_color(dx,dy)==BLANK?<span class="number">0</span>:<span class="number">1</span>;</div><div class="line">        <span class="keyword">return</span> num_of_not_blank_betweenn(sx,sy,dx,dy)==n;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move_ZU</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(dx&gt;sx)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">int</span> x=dx-sx,y=dy-sy;</div><div class="line">        <span class="keyword">if</span>(get_abs(x)+get_abs(y)!=<span class="number">1</span>)<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(sx&gt;<span class="number">4</span>&amp;&amp;get_abs(x)!=<span class="number">1</span>)<span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//过河前只能向前走</span></div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_correct_move</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(sx==dx&amp;&amp;sy==dy) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(is_out(sx,sy)||is_out(dx,dy)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(get_color(sx,sy)!=color) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(is_same_color(sx,sy,dx,dy)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">switch</span>(get_type(sx,sy)) &#123;</div><div class="line">        <span class="keyword">case</span> JU:</div><div class="line">            <span class="keyword">return</span> is_correct_move_JU(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> MA:</div><div class="line">            <span class="keyword">return</span> is_correct_move_MA(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> XIANG:</div><div class="line">            <span class="keyword">return</span> is_correct_move_XIANG(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> SHI:</div><div class="line">            <span class="keyword">return</span> is_correct_move_SHI(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> JIANG:</div><div class="line">            <span class="keyword">return</span> is_correct_move_JIANG(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> PAO:</div><div class="line">            <span class="keyword">return</span> is_correct_move_PAO(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">case</span> ZU:</div><div class="line">            <span class="keyword">return</span> is_correct_move_ZU(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">move_s_to_d</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123; <span class="comment">//移动操作</span></div><div class="line">        <span class="keyword">if</span>(get_type(dx,dy)==JIANG) &#123;    <span class="comment">//如果目的棋子是将</span></div><div class="line">            <span class="keyword">if</span>(get_color(dx,dy)==color)set_win(LOSE);<span class="comment">//如果是自己的将，则输</span></div><div class="line">            <span class="keyword">else</span> set_win(WIN);<span class="comment">//如果是对方的将，则赢</span></div><div class="line">        &#125;</div><div class="line">        b[dx][dy]=b[sx][sy];</div><div class="line">        b[sx][sy]=BLANK;</div><div class="line">        change_turn();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init_pieces</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;M; i+=M<span class="number">-1</span>) &#123;<span class="comment">//第一行和最后一行（即车马象士将士象马车）</span></div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> index=<span class="number">0</span>; index&lt;N; index++) &#123;</div><div class="line">                <span class="keyword">if</span>(index&lt;N/<span class="number">2</span>+<span class="number">1</span>)b[i][index]=index+<span class="number">1</span>;</div><div class="line">                <span class="keyword">else</span> b[i][index]=N-index;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//卒所在的行</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> index=<span class="number">0</span>; index&lt;N; index+=<span class="number">2</span>) &#123;</div><div class="line">            b[<span class="number">3</span>][index]=ZU;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> index=<span class="number">0</span>; index&lt;N; index+=<span class="number">2</span>) &#123;</div><div class="line">            b[<span class="number">6</span>][index]=ZU;</div><div class="line">        &#125;</div><div class="line">        b[<span class="number">2</span>][<span class="number">1</span>]=PAO;</div><div class="line">        b[M<span class="number">-1</span><span class="number">-2</span>][<span class="number">1</span>]=PAO;</div><div class="line">        b[<span class="number">2</span>][N<span class="number">-1</span><span class="number">-1</span>]=PAO;</div><div class="line">        b[M<span class="number">-1</span><span class="number">-2</span>][N<span class="number">-1</span><span class="number">-1</span>]=PAO;</div><div class="line">        <span class="keyword">int</span> s,d;<span class="comment">//存储起始行和终点行</span></div><div class="line">        <span class="keyword">if</span>(color==BLACK) &#123;</div><div class="line">            s=<span class="number">0</span>;<span class="comment">//从0行到M/2行，即棋盘上半部分</span></div><div class="line">            d=M/<span class="number">2</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            s=M/<span class="number">2</span>;<span class="comment">//棋盘下半部分</span></div><div class="line">            d=M;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//从s行到d行，把非BLANK的值加BLANK，使小于BLANK的代表黑色棋，大于BLANK的代表白色棋</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> index=s; index&lt;d; index++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">                <span class="keyword">if</span>(b[index][j]!=BLANK) &#123;</div><div class="line">                    b[index][j]+=BLANK;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Board(<span class="keyword">int</span> c) &#123;</div><div class="line">        color=c;</div><div class="line">        M=<span class="number">10</span>;</div><div class="line">        N=<span class="number">9</span>;</div><div class="line">        b=<span class="keyword">new</span> <span class="keyword">int</span>*[M];</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;M; i++) &#123;</div><div class="line">            b[i]=<span class="keyword">new</span> <span class="keyword">int</span>[N];</div><div class="line">        &#125;</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;<span class="comment">//棋盘初始化</span></div><div class="line">        is_win=<span class="number">0</span>;</div><div class="line">        turn=color==BLACK?<span class="literal">true</span>:<span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;M; i++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">                b[i][j]=BLANK;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        init_pieces();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_M</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> M;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_N</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> N;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_color</span><span class="params">()</span> </span>&#123;<span class="comment">//获取己方的颜色</span></div><div class="line">        <span class="keyword">return</span> color;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_color</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;<span class="comment">//获取棋盘某一坐标上棋子的颜色</span></div><div class="line">        <span class="keyword">return</span> b[x][y]&gt;BLANK?WHITE:b[x][y]&lt;BLANK?BLACK:BLANK;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_type</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;<span class="comment">//获取棋子类型（空、车、马、象、士、将、炮、卒）</span></div><div class="line">        <span class="keyword">return</span> b[x][y]!=BLANK?b[x][y]%BLANK:BLANK;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_win</span><span class="params">(<span class="keyword">int</span> is)</span> </span>&#123;</div><div class="line">        is_win=is;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_is_win</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> is_win;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">change_turn</span><span class="params">()</span> </span>&#123;</div><div class="line">        turn=turn==<span class="literal">true</span>?<span class="literal">false</span>:<span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_my_turn</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> turn;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">othside_move_piece</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;<span class="comment">//对方移子</span></div><div class="line">        sx=M<span class="number">-1</span>-sx;<span class="comment">//先进行坐标转换，因对方视角与己方相反</span></div><div class="line">        sy=N<span class="number">-1</span>-sy;</div><div class="line">        dx=M<span class="number">-1</span>-dx;</div><div class="line">        dy=N<span class="number">-1</span>-dy;</div><div class="line">        move_s_to_d(sx,sy,dx,dy);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">my_move_piece</span><span class="params">(<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;       <span class="comment">//己方主动移子</span></div><div class="line">        <span class="keyword">if</span>(!is_correct_move(sx,sy,dx,dy))<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        move_s_to_d(sx,sy,dx,dy);</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// CHINESE_CHESS_H_INCLUDED</span></span></div></pre></td></tr></table></figure>
<h3 id="server">Server.h</h3>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> SERVER_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SERVER_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winsock2.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">"chinese_chess.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INIT_ERROR 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BIND_ERROR 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LISTEN_ERROR 3</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CONNECT_ERROR 4</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SEND_ERROR 5</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ACCEPT_ERROR 6</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ALIVE_ERROR 7</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> THREAD_ERROR 8</span></div><div class="line"><span class="keyword">int</span> error_num;</div><div class="line"><span class="keyword">extern</span> HWND hwnd;</div><div class="line"><span class="keyword">extern</span> Board* chess_board;</div><div class="line"><span class="keyword">extern</span> <span class="keyword">char</span>* ots_ip;</div><div class="line"><span class="keyword">extern</span> <span class="keyword">int</span> port;</div><div class="line"><span class="keyword">extern</span> <span class="keyword">bool</span> is_connect_alive;</div><div class="line"></div><div class="line"><span class="comment">//线程参数结构体</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> server_args &#123;</div><div class="line">    SOCKET* Com_Sock;</div><div class="line">    <span class="keyword">char</span> * rebuf;</div><div class="line">&#125; server_args;</div><div class="line"><span class="comment">//校验检测，与客户端的添加校验是相反操作</span></div><div class="line"><span class="comment">//最后一位之前的所有字符相加取模后，如果等于最后一个字符，则校验通过</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">server_check</span><span class="params">(<span class="keyword">char</span> * r)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(r);</div><div class="line">    len--;</div><div class="line">    <span class="keyword">int</span> s=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        s+=r[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(r[len]==(s%<span class="number">5</span>+<span class="string">'0'</span>)) &#123;</div><div class="line">        r[len]=<span class="string">'\0'</span>;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//错误处理，is_tell控制是否显示错误信息，is_exit控制是否退出程序</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">handle_error</span><span class="params">(<span class="keyword">int</span> err,<span class="keyword">bool</span> is_tell,<span class="keyword">bool</span> is_exit)</span> </span>&#123;</div><div class="line">    error_num=err;</div><div class="line">    <span class="keyword">if</span>(!is_tell)<span class="keyword">return</span> error_num;</div><div class="line">    <span class="keyword">char</span> error[<span class="number">30</span>]=<span class="string">""</span>;</div><div class="line">    <span class="keyword">switch</span>(error_num) &#123;</div><div class="line">    <span class="keyword">case</span> INIT_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"初始化错误"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> BIND_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"绑定端口错误"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> LISTEN_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"监听错误"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> ACCEPT_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"接受连接错误"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> CONNECT_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"无法连接"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> ALIVE_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"连接已断开"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> THREAD_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"线程无法创建"</span>);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> SEND_ERROR:</div><div class="line">        <span class="built_in">strcpy</span>(error,<span class="string">"发送错误"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span> error_message[<span class="number">50</span>];</div><div class="line">    <span class="built_in">strcpy</span>(error_message,<span class="string">"错误："</span>);</div><div class="line">    <span class="built_in">strcat</span>(error_message,error);</div><div class="line">    <span class="keyword">if</span>(is_exit)<span class="built_in">strcat</span>(error_message,<span class="string">"\n程序将退出。"</span>);</div><div class="line">    MessageBox(hwnd,error_message,<span class="string">"错误"</span>,MB_OK);</div><div class="line">    <span class="keyword">if</span>(is_exit)<span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> error_num;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">handle_message</span><span class="params">(<span class="keyword">void</span>*ar)</span> </span>&#123;</div><div class="line">    server_args * serarg=(server_args * )ar;</div><div class="line">    <span class="keyword">char</span> *recv=serarg-&gt;rebuf;</div><div class="line">    SOCKET* CommandSock=serarg-&gt;Com_Sock;</div><div class="line">    <span class="keyword">if</span>(server_check(recv)) &#123;<span class="comment">//校验通过发送okok（OK），不通过发送noto（NOTOK）</span></div><div class="line">        send(*CommandSock,<span class="string">"okok"</span>,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        send(*CommandSock,<span class="string">"noto"</span>,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">        <span class="keyword">return</span> ar;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">strncmp</span>(recv,<span class="string">"move"</span>,<span class="number">4</span>)==<span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">char</span> * pch;</div><div class="line">        <span class="comment">//将recvBuf以逗号拆分</span></div><div class="line">        pch = strtok (recv,<span class="string">","</span>);</div><div class="line">        pch = strtok (<span class="literal">NULL</span>,<span class="string">","</span>);</div><div class="line">        <span class="keyword">int</span> xys[<span class="number">4</span>];</div><div class="line">        <span class="keyword">int</span> index=<span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (pch != <span class="literal">NULL</span>) &#123;</div><div class="line">            xys[index]=atoi(pch);<span class="comment">//char* 转换为int</span></div><div class="line">            index++;</div><div class="line">            pch = strtok (<span class="literal">NULL</span>, <span class="string">","</span>);</div><div class="line">        &#125;</div><div class="line">        chess_board-&gt;othside_move_piece(xys[<span class="number">0</span>],xys[<span class="number">1</span>],xys[<span class="number">2</span>],xys[<span class="number">3</span>]);</div><div class="line">        <span class="keyword">if</span>(chess_board-&gt;get_is_win()==LOSE) &#123;</div><div class="line">            chess_board-&gt;init();<span class="comment">//如果输了，则重新初始化棋盘，再下一盘</span></div><div class="line">            MessageBox(hwnd,<span class="string">"你输了"</span>,<span class="string">"失败！"</span>,<span class="literal">NULL</span>);</div><div class="line">        &#125;</div><div class="line">        InvalidateRect(hwnd,<span class="literal">NULL</span>,<span class="literal">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">delete</span> recv;</div><div class="line">&#125;</div><div class="line"><span class="keyword">class</span> Server &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    SOCKET Server_Sock;</div><div class="line">    SOCKADDR_IN server_addr;</div><div class="line">    SOCKADDR_IN client_addr;</div><div class="line">    <span class="keyword">char</span> recvBuf[<span class="number">20</span>];</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Server() &#123;</div><div class="line">        WSADATA wsa;</div><div class="line">        <span class="comment">/*初始化socket资源*/</span></div><div class="line">        <span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">1</span>,<span class="number">1</span>),&amp;wsa) != <span class="number">0</span>) &#123;</div><div class="line">            handle_error(INIT_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>((Server_Sock = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>))==<span class="number">-1</span>) &#123;</div><div class="line">            handle_error(INIT_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        ZeroMemory((<span class="keyword">char</span> *)&amp;server_addr,<span class="keyword">sizeof</span>(server_addr));</div><div class="line">        server_addr.sin_family = AF_INET;</div><div class="line">        server_addr.sin_port = htons(port);           <span class="comment">/*本地监听端口*/</span></div><div class="line">        server_addr.sin_addr.s_addr = htonl(INADDR_ANY); <span class="comment">/*有IP*/</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span>(bind(Server_Sock,(<span class="keyword">struct</span> sockaddr *)&amp;server_addr,<span class="keyword">sizeof</span>(server_addr))==<span class="number">-1</span>) &#123;</div><div class="line">            handle_error(BIND_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(listen(Server_Sock,<span class="number">5</span>)==<span class="number">-1</span>) &#123; <span class="comment">//其中第二个参数代表能够接收的最多的连接数</span></div><div class="line">            handle_error(LISTEN_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">strcpy</span>(recvBuf,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">listen_message</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> len=<span class="keyword">sizeof</span>(SOCKADDR);</div><div class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</div><div class="line">            SOCKET Command_Sock  = accept(Server_Sock, (SOCKADDR*)&amp;client_addr,&amp;len);</div><div class="line">            <span class="keyword">if</span>(Command_Sock == INVALID_SOCKET) &#123;</div><div class="line">                closesocket(Command_Sock);</div><div class="line">                handle_error(ACCEPT_ERROR,<span class="literal">false</span>,<span class="literal">false</span>);</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(client_addr.sin_addr.s_addr!=inet_addr(ots_ip)) &#123;<span class="comment">//如果接收的socket不是预期的对方的，则发送wron，继续等待</span></div><div class="line">                send(Command_Sock,<span class="string">"wron"</span>,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">                closesocket(Command_Sock);</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            send(Command_Sock,<span class="string">"righ"</span>,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">            is_connect_alive=<span class="literal">true</span>;</div><div class="line">            <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</div><div class="line">                <span class="keyword">if</span>(recv(Command_Sock,recvBuf,<span class="number">20</span>,<span class="number">0</span>)&lt;=<span class="number">0</span>) &#123;<span class="comment">//recv返回小于等于0的值，则连接已断开</span></div><div class="line">                    handle_error(ALIVE_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">                    closesocket(Command_Sock);</div><div class="line">                    close();</div><div class="line">                    <span class="keyword">return</span> ;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">char</span> *rbuf=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">20</span>];</div><div class="line">                <span class="built_in">strcpy</span>(rbuf,recvBuf);</div><div class="line">                server_args serarg;</div><div class="line">                serarg.Com_Sock=&amp;Command_Sock;</div><div class="line">                serarg.rebuf=rbuf;</div><div class="line">                <span class="keyword">pthread_t</span> handle_m;</div><div class="line">                <span class="keyword">int</span> ret;</div><div class="line">                ret= pthread_create( &amp;handle_m,  <span class="literal">NULL</span>, handle_message,&amp;serarg); <span class="comment">//</span></div><div class="line">                <span class="keyword">if</span>( ret != <span class="number">0</span> ) &#123; <span class="comment">//创建线程成功返回0</span></div><div class="line">                    <span class="comment">// printf("pthread_create error:error_code=%d\n",ret );</span></div><div class="line">                    handle_error(THREAD_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">                    <span class="keyword">return</span> ;</div><div class="line">                &#125;</div><div class="line">                <span class="built_in">strcpy</span>(recvBuf,<span class="string">""</span>);</div><div class="line">            &#125;</div><div class="line">            closesocket(Command_Sock);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</div><div class="line">        closesocket(Server_Sock);</div><div class="line">        WSACleanup();</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// SERVER_H_INCLUDED</span></span></div></pre></td></tr></table></figure>
<h3 id="client">Client.h</h3>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CLIENT_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CLIENT_H_INCLUDED</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winsock2.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">"chinese_chess.h"</span></span></div><div class="line"></div><div class="line"><span class="comment">//为字符串添加校验信息，对所有字符求和，模5之后转化为字符放在字符串最后</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">client_check</span><span class="params">(<span class="keyword">char</span>* r)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(r);</div><div class="line">    <span class="keyword">int</span> s=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">        s+=r[i];</div><div class="line">    &#125;</div><div class="line">    r[len]=s%<span class="number">5</span>+<span class="string">'0'</span>;</div><div class="line">    r[len+<span class="number">1</span>]=<span class="string">'\0'</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">class</span> Client &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    SOCKET Client_Sock;</div><div class="line">    SOCKADDR_IN server_addr;</div><div class="line">    <span class="keyword">char</span> sendBuf[<span class="number">20</span>];</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Client() &#123;</div><div class="line">        WSADATA wsa;</div><div class="line">        <span class="comment">/*初始化socket资源*/</span></div><div class="line">        <span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">1</span>,<span class="number">1</span>),&amp;wsa) != <span class="number">0</span>) &#123;</div><div class="line">            handle_error(INIT_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;   <span class="comment">//代表失败</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>((Client_Sock = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>))==<span class="number">-1</span>) &#123;</div><div class="line">            handle_error(INIT_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            <span class="keyword">return</span>;   <span class="comment">//代表失败</span></div><div class="line">        &#125;</div><div class="line">        server_addr.sin_addr.S_un.S_addr=inet_addr(ots_ip);</div><div class="line">        server_addr.sin_family=AF_INET;</div><div class="line">        server_addr.sin_port=htons(port);</div><div class="line">        <span class="built_in">strcpy</span>(sendBuf,<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">connect_to_ots</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span>(connect(Client_Sock,(SOCKADDR*)&amp;server_addr,<span class="keyword">sizeof</span>(SOCKADDR)) ==<span class="number">-1</span>) &#123;</div><div class="line">            handle_error(CONNECT_ERROR,<span class="literal">false</span>,<span class="literal">false</span>);</div><div class="line">            Sleep(<span class="number">100</span>);</div><div class="line">            <span class="comment">//printf( "%d ", WSAGetLastError());</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">char</span> rec[<span class="number">5</span>];</div><div class="line">        recv(Client_Sock,rec,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">strncmp</span>(rec,<span class="string">"wron"</span>,<span class="number">4</span>)==<span class="number">0</span>) &#123;  <span class="comment">//收到wrong，说明对方所输入的IP不是己方IP</span></div><div class="line">            MessageBox(hwnd,<span class="string">"对方输入的IP不是你\n程序将退出"</span>,<span class="string">"错误"</span>,<span class="literal">NULL</span>);</div><div class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//谁先连接谁是黑色</span></div><div class="line">        <span class="comment">//如果server已经收到连接，则说明是对方先连接自己，则自己应为白色，否则自己是黑色</span></div><div class="line">        <span class="keyword">if</span>(is_connect_alive) &#123;</div><div class="line">            chess_board=<span class="keyword">new</span> Board(WHITE);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            chess_board=<span class="keyword">new</span> Board(BLACK);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</div><div class="line">        closesocket(Client_Sock);</div><div class="line">        WSACleanup();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">send_message</span><span class="params">(<span class="keyword">char</span> * message)</span> </span>&#123;</div><div class="line">        <span class="built_in">strcpy</span>(sendBuf,message);</div><div class="line">        client_check(sendBuf);</div><div class="line">        <span class="keyword">int</span> len;</div><div class="line">        <span class="keyword">int</span> try_time=<span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</div><div class="line">            len=send(Client_Sock,sendBuf,<span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">            <span class="keyword">if</span>(len!=(<span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>)) &#123;</div><div class="line">                handle_error(SEND_ERROR,<span class="literal">false</span>,<span class="literal">false</span>);</div><div class="line">                <span class="comment">//printf( "%d ", WSAGetLastError());</span></div><div class="line">            &#125;</div><div class="line">            <span class="keyword">char</span> rec[<span class="number">5</span>];</div><div class="line">            recv(Client_Sock,rec,<span class="number">4</span>,<span class="number">0</span>);</div><div class="line">            <span class="keyword">if</span>(<span class="built_in">strncmp</span>(rec,<span class="string">"okok"</span>,<span class="number">4</span>)==<span class="number">0</span>) &#123;<span class="comment">//收到OK说明数据已经正确被对方收到</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(try_time&gt;<span class="number">20</span>) &#123;   <span class="comment">//尝试20次，数据仍无法正确送达，则退出</span></div><div class="line">                handle_error(SEND_ERROR,<span class="literal">true</span>,<span class="literal">true</span>);</div><div class="line">            &#125;</div><div class="line">            try_time++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> len;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">send_message</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> * message,<span class="keyword">int</span> sx,<span class="keyword">int</span> sy,<span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">char</span>* message_temp=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">20</span>];</div><div class="line">        <span class="built_in">sprintf</span>(message_temp,<span class="string">"%s,%d,%d,%d,%d,"</span>,message,sx,sy,dx,dy);</div><div class="line">        <span class="keyword">int</span> len=send_message(message_temp);</div><div class="line">        <span class="keyword">delete</span> message_temp;</div><div class="line">        <span class="keyword">return</span> len;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// CLIENT_H_INCLUDED</span></span></div></pre></td></tr></table></figure>
<ul>
<li>该程序从3.15晚开始，用了四天的空闲时间。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/20/Shell实现/" itemprop="url">
                  Shell（C++实现，CodeBlocks+GCC编译）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-20T00:00:00+08:00" content="2016-03-20">
              2016-03-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p>　　只实现了login 、cd 、ls 、cat 四个命令。而且只能在 Windows 下运行。</p>
<p><img src="/imgs/shell1.jpg" alt="shell"></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"shell.h"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">com_to_int</span><span class="params">(<span class="keyword">int</span> com_num,<span class="keyword">char</span> * command,<span class="keyword">char</span>** coms)</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> COM_NUM=<span class="number">5</span>;</div><div class="line">    <span class="keyword">char</span> command[MAX_LENGTH_OF_COMMAND];</div><div class="line">    <span class="keyword">char</span> *coms[COM_NUM]=&#123;<span class="string">"login"</span>,<span class="string">"ls"</span>,<span class="string">"cd"</span>,<span class="string">"cat"</span>,<span class="string">"exit"</span>&#125;;</div><div class="line">    <span class="keyword">int</span> (*func_ptrs[COM_NUM])(<span class="keyword">char</span> *)=&#123;login,ls,cd,cat,shellexit&#125;;</div><div class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%s%s%s%s%s"</span>,<span class="string">"["</span>,USER_NAME,<span class="string">" "</span>,GLOBLE_PATH,<span class="string">"]"</span>);</div><div class="line">        gets(command);</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(command,<span class="string">""</span>)==<span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//printf("command: %s\n",command);</span></div><div class="line">        <span class="comment">//printf("command: %s\n",command);</span></div><div class="line">        <span class="keyword">int</span> i;</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;COM_NUM;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(<span class="built_in">strncmp</span>(coms[i],command,<span class="built_in">strlen</span>(coms[i]))==<span class="number">0</span>)&#123;</div><div class="line">                func_ptrs[i](command);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(i==COM_NUM)&#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"command not found.\n"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    cd(<span class="string">"C:/0"</span>);</div><div class="line">    ls(GLOBLE_PATH);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//shell.h</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> SHELL_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SHELL_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;io.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LENGTH_OF_PATH 256</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LENGTH_OF_USERNAME 50</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LENGTH_OF_COMMAND 50</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LENGTH_OF_LINE 256</span></div><div class="line"><span class="keyword">char</span> GLOBLE_PATH[MAX_LENGTH_OF_PATH]= &#123;<span class="string">'C'</span>,<span class="string">':'</span>,<span class="string">'/'</span>,<span class="string">'0'</span>,<span class="string">'\0'</span>&#125;;</div><div class="line"><span class="keyword">char</span> USER_NAME[MAX_LENGTH_OF_USERNAME]= &#123;<span class="string">'g'</span>,<span class="string">'u'</span>,<span class="string">'e'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'\0'</span>&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">login</span><span class="params">(<span class="keyword">char</span> * command)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"user name:"</span>);</div><div class="line">    <span class="keyword">char</span> username[MAX_LENGTH_OF_USERNAME];</div><div class="line">    gets(username);</div><div class="line">    FILE * pwd;</div><div class="line">    pwd = fopen (<span class="string">"pwd"</span>,<span class="string">"r"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (pwd!=<span class="literal">NULL</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">char</span> line[MAX_LENGTH_OF_LINE];</div><div class="line">        <span class="keyword">while</span> (!feof(pwd))</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span>(fgets(line,MAX_LENGTH_OF_LINE,pwd)!=<span class="literal">NULL</span>)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">char</span> * name=strtok(line,<span class="string">" "</span>);</div><div class="line">                <span class="comment">//printf("%s\n",name);</span></div><div class="line">                <span class="keyword">if</span>(<span class="built_in">strcmp</span>(name,username)==<span class="number">0</span>)</div><div class="line">                &#123;</div><div class="line">                    <span class="keyword">char</span> password[MAX_LENGTH_OF_USERNAME];</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"password:"</span>);</div><div class="line">                    gets(password);</div><div class="line">                    <span class="keyword">char</span> * pasw=strtok(<span class="literal">NULL</span>,<span class="string">" \n\r"</span>);</div><div class="line">                    <span class="comment">//printf("file password:%s\n",pasw);</span></div><div class="line">                    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(pasw,password)==<span class="number">0</span>)</div><div class="line">                    &#123;</div><div class="line">                        <span class="built_in">strcpy</span>(USER_NAME,username);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">else</span></div><div class="line">                    &#123;</div><div class="line">                        <span class="built_in">printf</span>(<span class="string">"wrong password.\n"</span>);</div><div class="line">                    &#125;</div><div class="line">                    fclose (pwd);</div><div class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"user not exist.\n"</span>);</div><div class="line">        fclose (pwd);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"login error.pwd file not exist or not able to open.\n"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">shellexit</span><span class="params">(<span class="keyword">char</span> * command)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cat_file</span><span class="params">(<span class="keyword">char</span> * file_path)</span></span></div><div class="line">&#123;</div><div class="line">    FILE* f=fopen(file_path,<span class="string">"r"</span>);</div><div class="line">    <span class="keyword">if</span>(f==<span class="literal">NULL</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"file does not exist.\n"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span> line[MAX_LENGTH_OF_LINE];</div><div class="line">    <span class="keyword">while</span>(!feof(f))</div><div class="line">    &#123;</div><div class="line">        fgets(line,MAX_LENGTH_OF_LINE,f);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">strlen</span>(line);i++)&#123;</div><div class="line">            <span class="keyword">if</span>(line[i]==<span class="string">'\0'</span>)<span class="keyword">break</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%c"</span>,line[i]);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cat</span><span class="params">(<span class="keyword">char</span> * command)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">char</span> * path=strtok(command,<span class="string">" "</span>);</div><div class="line">    path=strtok(<span class="literal">NULL</span>,<span class="string">" "</span>);</div><div class="line">    <span class="comment">//printf("path:%s",path);</span></div><div class="line">    cat_file(path);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cd_path</span><span class="params">(<span class="keyword">char</span> *path)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">struct</span> <span class="keyword">_finddata_t</span> f;</div><div class="line">    <span class="keyword">int</span> p;</div><div class="line">    <span class="comment">//printf("1");</span></div><div class="line">    <span class="comment">/* FILE * pFile;</span></div><div class="line">    pFile = fopen (path,"r");</div><div class="line">    if (pFile!=NULL)</div><div class="line">    &#123;      printf("2");</div><div class="line">    &#125;printf("3");*/</div><div class="line">    <span class="keyword">if</span>((p=_findfirst(path, &amp;f))!=<span class="number">-1</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="comment">//printf("%d",p);</span></div><div class="line">        <span class="comment">//printf("2");</span></div><div class="line">        <span class="comment">//printf(" %d ",f.attrib);</span></div><div class="line">        <span class="keyword">if</span>(f.attrib&amp;_A_SUBDIR)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//printf("4");</span></div><div class="line">            <span class="built_in">strcpy</span>(GLOBLE_PATH,path);</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"destination path is not a folder.\n"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"destination not exist.\n"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cd</span><span class="params">(<span class="keyword">char</span> * command)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">char</span> * path=strtok(command,<span class="string">" "</span>);</div><div class="line">    path=strtok(<span class="literal">NULL</span>,<span class="string">" "</span>);</div><div class="line">    <span class="comment">//printf("path:%s",path);</span></div><div class="line">    cd_path(path);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ls_path</span><span class="params">(<span class="keyword">char</span> * path)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">struct</span> <span class="keyword">_finddata_t</span> f;</div><div class="line">    <span class="keyword">int</span> p;</div><div class="line">    <span class="keyword">char</span> name[MAX_LENGTH_OF_PATH];</div><div class="line">    <span class="built_in">strcpy</span>(name,path);</div><div class="line">    <span class="built_in">strcat</span>(name,<span class="string">"/*"</span>);</div><div class="line">    <span class="comment">//printf("1");</span></div><div class="line">    <span class="keyword">if</span>((p=_findfirst(name, &amp;f))!=<span class="number">-1</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="comment">//read(p,filename,)</span></div><div class="line">        <span class="comment">//printf("2");</span></div><div class="line">        <span class="built_in">printf</span>(f.name);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">        <span class="keyword">while</span>(_findnext(p, &amp;f)==<span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">printf</span>(f.name);</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">char</span> * command)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">char</span> * path=strtok(command,<span class="string">" "</span>);</div><div class="line">    path=strtok(<span class="literal">NULL</span>,<span class="string">" "</span>);</div><div class="line">    <span class="comment">//printf("path:%s",path);</span></div><div class="line">    <span class="keyword">if</span>(path==<span class="literal">NULL</span>||<span class="built_in">strcmp</span>(path,<span class="string">""</span>)==<span class="number">0</span>)</div><div class="line">    &#123;</div><div class="line">        ls_path(GLOBLE_PATH);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        ls_path(path);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// SHELL_H_INCLUDED</span></span></div></pre></td></tr></table></figure>
<h3 id="外部资源文件："><a href="#外部资源文件：" class="headerlink" title="外部资源文件："></a>外部资源文件：</h3><p>pwd（login 命令使用）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ma 123456</div><div class="line">xue 123456</div><div class="line">wei 123456</div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于大三下学期，2016年3月。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/20/socket服务端和客户端/" itemprop="url">
                  Socket服务端和客户端（C++，CodeBlocks+GCC编译）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-20T00:00:00+08:00" content="2016-03-20">
              2016-03-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"j_socket.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> port=<span class="number">21</span>;</div><div class="line">j_server* ser;</div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">main_listen</span><span class="params">( <span class="keyword">void</span>* args)</span></span></div><div class="line">&#123;</div><div class="line">    ser=<span class="keyword">new</span> j_server(port);</div><div class="line">    ser-&gt;j_listen();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">pthread_t</span> listen_p;</div><div class="line">    <span class="keyword">int</span> ret;</div><div class="line">    ret= pthread_create( &amp;listen_p, <span class="literal">NULL</span>, main_listen, <span class="literal">NULL</span> ); <span class="comment">//参数：创建的线程id，线程参数，线程运行函数的起始地址，运行函数的参数</span></div><div class="line">    <span class="keyword">if</span>( ret != <span class="number">0</span> ) <span class="comment">//创建线程成功返回0</span></div><div class="line">    &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"pthread_create error:error_code=%d\n"</span>,ret );</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span> j_client* cli;</div><div class="line">    cli =<span class="keyword">new</span> j_client(<span class="string">"127.0.0.1"</span>,port);</div><div class="line">    cli-&gt;j_send();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//j_socket.h</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> J_SOCKET_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> J_SOCKET_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winsock2.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INIT_ERROR 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BIND_ERROR 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LISTEN_ERROR 3</span></div><div class="line"><span class="keyword">struct</span> rec_args&#123;</div><div class="line"><span class="keyword">int</span> * l;</div><div class="line">SOCKET* s;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">receive</span><span class="params">( <span class="keyword">void</span>* args)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">char</span> recvBuf[<span class="number">512</span>];</div><div class="line">    rec_args *a=(rec_args*)args;</div><div class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)</div><div class="line">    &#123;</div><div class="line">        recv(*(a-&gt;s),recvBuf,<span class="number">512</span>,<span class="number">0</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"receive message: %s\n"</span>,recvBuf);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"111111\n"</span>);</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(recvBuf,<span class="string">"end"</span>)==<span class="number">0</span>)&#123;<span class="keyword">break</span>;&#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    closesocket(*(a-&gt;s));</div><div class="line">    (*(a-&gt;l))--;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"22222\n"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">class</span> j_server</div><div class="line">&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    SOCKET Server_Sock;</div><div class="line">    SOCKADDR_IN server_addr;</div><div class="line">    SOCKADDR_IN client_addr;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> max_num;</div><div class="line">    <span class="keyword">int</span> link_num=<span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> error_num;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    j_server(<span class="keyword">int</span> port)</div><div class="line">    &#123;</div><div class="line">        WSADATA wsa;</div><div class="line">        <span class="comment">/*初始化socket资源*/</span></div><div class="line">        <span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">1</span>,<span class="number">1</span>),&amp;wsa) != <span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            error_num=INIT_ERROR;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>((Server_Sock = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>))==<span class="number">-1</span>)</div><div class="line">        &#123;</div><div class="line">            error_num=INIT_ERROR;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        ZeroMemory((<span class="keyword">char</span> *)&amp;server_addr,<span class="keyword">sizeof</span>(server_addr));</div><div class="line">        server_addr.sin_family = AF_INET;</div><div class="line">        server_addr.sin_port = htons(port);           <span class="comment">/*本地监听端口*/</span></div><div class="line">        server_addr.sin_addr.s_addr = htonl(INADDR_ANY); <span class="comment">/*有IP*/</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span>(bind(Server_Sock,(<span class="keyword">struct</span> sockaddr *)&amp;server_addr,<span class="keyword">sizeof</span>(server_addr))==<span class="number">-1</span>)</div><div class="line">        &#123;</div><div class="line">            error_num=BIND_ERROR;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(listen(Server_Sock,<span class="number">5</span>)==<span class="number">-1</span>) <span class="comment">//其中第二个参数代表能够接收的最多的连接数</span></div><div class="line">        &#123;</div><div class="line">            error_num=LISTEN_ERROR;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        max_num=<span class="number">20</span>;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">j_listen</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> len=<span class="keyword">sizeof</span>(SOCKADDR);</div><div class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span>(link_num&gt;max_num)</div><div class="line">            &#123;</div><div class="line">                Sleep(<span class="number">100</span>);</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            SOCKET Command_Sock  = accept(Server_Sock, (SOCKADDR*)&amp;client_addr,&amp;len);</div><div class="line">            <span class="keyword">if</span>(Command_Sock == INVALID_SOCKET)</div><div class="line">            &#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"accept error !"</span>);</div><div class="line">                closesocket(Command_Sock);</div><div class="line">            &#125;</div><div class="line">            link_num++;</div><div class="line">            <span class="keyword">pthread_t</span> listen_p;</div><div class="line">            <span class="keyword">int</span> ret;</div><div class="line">            rec_args a;</div><div class="line">            a.l=&amp;link_num;</div><div class="line">            a.s=&amp;Command_Sock;</div><div class="line">            ret= pthread_create( &amp;listen_p,  <span class="literal">NULL</span>, receive,(<span class="keyword">void</span> *)&amp;a  ); <span class="comment">//参数：创建的线程id，线程参数，线程运行函数的起始地址，运行函数的参数</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;;</div><div class="line"><span class="keyword">class</span> j_client</div><div class="line">&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    SOCKET Client_Sock;</div><div class="line">    SOCKADDR_IN server_addr;</div><div class="line">    <span class="keyword">char</span> sendBuf[<span class="number">512</span>];</div><div class="line">    <span class="keyword">int</span> error_num;</div><div class="line"><span class="keyword">public</span>:</div><div class="line"></div><div class="line">    j_client(<span class="keyword">char</span> * server_addr_str,<span class="keyword">int</span> port)</div><div class="line">    &#123;</div><div class="line">        WSADATA wsa;</div><div class="line">        <span class="comment">/*初始化socket资源*/</span></div><div class="line">        <span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">1</span>,<span class="number">1</span>),&amp;wsa) != <span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            error_num=INIT_ERROR;</div><div class="line">            <span class="keyword">return</span>;   <span class="comment">//代表失败</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>((Client_Sock = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>))==<span class="number">-1</span>)</div><div class="line">        &#123;</div><div class="line">            error_num=INIT_ERROR;</div><div class="line">            <span class="keyword">return</span>;   <span class="comment">//代表失败</span></div><div class="line">        &#125;</div><div class="line">        server_addr.sin_addr.S_un.S_addr=inet_addr(server_addr_str);</div><div class="line">        server_addr.sin_family=AF_INET;</div><div class="line">        server_addr.sin_port=htons(port);</div><div class="line">        <span class="keyword">if</span>(connect(Client_Sock,(SOCKADDR*)&amp;server_addr,<span class="keyword">sizeof</span>(SOCKADDR)) ==<span class="number">-1</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"connect error !"</span>);</div><div class="line">            <span class="comment">//printf( "%d ", WSAGetLastError());</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">j_send</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"input message:  "</span>);</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>,sendBuf);</div><div class="line">            <span class="keyword">if</span>(send(Client_Sock,sendBuf,<span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>,<span class="number">0</span>)!=(<span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>))</div><div class="line">            &#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"send error !"</span>);</div><div class="line">                <span class="comment">//printf( "%d ", WSAGetLastError());</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">j_close</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        closesocket(Client_Sock);</div><div class="line">        WSACleanup();</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// J_SOCKET_H_INCLUDED</span></span></div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/15/Glines游戏/" itemprop="url">
                  GLine游戏（Win32GUI实现，CodeBlocks+GCC编译）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-15T00:00:00+08:00" content="2016-03-15">
              2016-03-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="游戏规则："><a href="#游戏规则：" class="headerlink" title="游戏规则："></a>游戏规则：</h3><p>在10X10的棋盘上有五种颜色的棋子。</p>
<p>点击一个棋子，再点击一个空格子，如果两者之间有一条路径的话，棋子会移动到空格子内。</p>
<p>每移动一次，棋盘上会增加三个棋子，其位置和颜色都是随机的。</p>
<p>当横向、竖向或斜向有五个或以上棋子有相同颜色时，这些棋子会消去。</p>
<p>当棋盘上没有空格子时，游戏结束。</p>
<p>得分为消去得棋子的个数。</p>
<h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p><img src="/imgs/glines.jpg" alt="xiaoguo"></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><h4 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//main.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(UNICODE) &amp;&amp; !defined(_UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(_UNICODE) &amp;&amp; !defined(UNICODE)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNICODE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"matrix.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"matrix.cpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BKCOLOR RGB(200,200,200)</span></div><div class="line"><span class="keyword">int</span> score=<span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> WIDTH=<span class="number">400</span>;</div><div class="line"><span class="keyword">int</span> HEIGHT=<span class="number">440</span>;</div><div class="line">Matrix ma;</div><div class="line"><span class="keyword">int</span> width=<span class="number">40</span>;<span class="comment">//WIDTH/ma.getN();</span></div><div class="line"><span class="keyword">int</span> height=<span class="number">40</span>;<span class="comment">//HEIGHT/ma.getN();</span></div><div class="line">PAINTSTRUCT ps ;</div><div class="line"><span class="keyword">static</span> HBRUSH  red_brush =CreateSolidBrush (RGB(<span class="number">230</span>,<span class="number">90</span>,<span class="number">90</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH  green_brush =CreateSolidBrush (RGB(<span class="number">90</span>,<span class="number">230</span>,<span class="number">90</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH  blue_brush =CreateSolidBrush (RGB(<span class="number">90</span>,<span class="number">90</span>,<span class="number">230</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH  yellow_brush =CreateSolidBrush (RGB(<span class="number">230</span>,<span class="number">230</span>,<span class="number">90</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH  purple_brush =CreateSolidBrush (RGB(<span class="number">230</span>,<span class="number">90</span>,<span class="number">230</span>));</div><div class="line"><span class="keyword">static</span> HBRUSH  white_brush =CreateSolidBrush (BKCOLOR);</div><div class="line">Point * s_lattice=<span class="keyword">new</span> Point(<span class="number">0</span>,<span class="number">0</span>),*d_lattice=<span class="keyword">new</span> Point(<span class="number">0</span>,<span class="number">0</span>);</div><div class="line"><span class="keyword">bool</span> paint_path=<span class="literal">false</span>;</div><div class="line"><span class="keyword">int</span> path_color=<span class="number">0</span>;</div><div class="line">Point* sou=<span class="keyword">new</span> Point();</div><div class="line">Point* dest=<span class="keyword">new</span> Point();</div><div class="line">Point* mouse=<span class="keyword">new</span> Point(<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">Point *position=<span class="keyword">new</span> Point(<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">Link&lt;Point *&gt;* path;</div><div class="line">HBRUSH hBrush ;</div><div class="line">HDC hdc;</div><div class="line">POINT pc;</div><div class="line">RECT client_rect;</div><div class="line"><span class="keyword">int</span> score_height;</div><div class="line"></div><div class="line"><span class="comment">/*  Declare Windows procedure  */</span></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/*  Make the class name into a global variable  */</span></div><div class="line">TCHAR szClassName[ ] = _T(<span class="string">"Game"</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span> <span class="params">(HINSTANCE hThisInstance,</span></span></div><div class="line">                    HINSTANCE hPrevInstance,</div><div class="line">                    LPSTR lpszArgument,</div><div class="line">                    <span class="keyword">int</span> nCmdShow) &#123;</div><div class="line">    HWND hwnd;               <span class="comment">/* This is the handle for our window */</span></div><div class="line">    MSG messages;            <span class="comment">/* Here messages to the application are saved */</span></div><div class="line">    WNDCLASSEX wincl;        <span class="comment">/* Data structure for the windowclass */</span></div><div class="line"></div><div class="line">    <span class="comment">/* The Window structure */</span></div><div class="line">    wincl.hInstance = hThisInstance;</div><div class="line">    wincl.lpszClassName = szClassName;</div><div class="line">    wincl.lpfnWndProc = WindowProcedure;      <span class="comment">/* This function is called by windows */</span></div><div class="line">    wincl.style = CS_DBLCLKS;                 <span class="comment">/* Catch double-clicks */</span></div><div class="line">    wincl.cbSize = <span class="keyword">sizeof</span> (WNDCLASSEX);</div><div class="line"></div><div class="line">    <span class="comment">/* Use default icon and mouse-pointer */</span></div><div class="line">    wincl.hIcon = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hIconSm = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION);</div><div class="line">    wincl.hCursor = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW);</div><div class="line">    wincl.lpszMenuName = <span class="literal">NULL</span>;                 <span class="comment">/* No menu */</span></div><div class="line">    wincl.cbClsExtra = <span class="number">0</span>;                      <span class="comment">/* No extra bytes after the window class */</span></div><div class="line">    wincl.cbWndExtra = <span class="number">0</span>;                      <span class="comment">/* structure or the window instance */</span></div><div class="line">    <span class="comment">/* Use Windows's default colour as the background of the window */</span></div><div class="line">    wincl.hbrBackground = (HBRUSH) COLOR_BACKGROUND;</div><div class="line"></div><div class="line">    <span class="comment">/* Register the window class, and if it fails quit the program */</span></div><div class="line">    <span class="keyword">if</span> (!RegisterClassEx (&amp;wincl))</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* The class is registered, let's create the program*/</span></div><div class="line">    hwnd = CreateWindowEx (</div><div class="line">               <span class="number">0</span>,                   <span class="comment">/* Extended possibilites for variation */</span></div><div class="line">               szClassName,         <span class="comment">/* Classname */</span></div><div class="line">               _T(<span class="string">"GLine"</span>),       <span class="comment">/* Title Text */</span></div><div class="line">               WS_OVERLAPPEDWINDOW, <span class="comment">/* default window */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* Windows decides the position */</span></div><div class="line">               CW_USEDEFAULT,       <span class="comment">/* where the window ends up on the screen */</span></div><div class="line">               WIDTH,                 <span class="comment">/* The programs width */</span></div><div class="line">               HEIGHT,                 <span class="comment">/* and height in pixels */</span></div><div class="line">               HWND_DESKTOP,        <span class="comment">/* The window is a child-window to desktop */</span></div><div class="line">               <span class="literal">NULL</span>,                <span class="comment">/* No menu */</span></div><div class="line">               hThisInstance,       <span class="comment">/* Program Instance handler */</span></div><div class="line">               <span class="literal">NULL</span>                 <span class="comment">/* No Window Creation data */</span></div><div class="line">           );</div><div class="line"></div><div class="line">    <span class="comment">/* Make the window visible on the screen */</span></div><div class="line">    ShowWindow (hwnd, nCmdShow);</div><div class="line"></div><div class="line">    <span class="comment">/* Run the message loop. It will run until GetMessage() returns 0 */</span></div><div class="line">    <span class="keyword">while</span> (GetMessage (&amp;messages, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>)) &#123;</div><div class="line">        <span class="comment">/* Translate virtual-key messages into character messages */</span></div><div class="line">        TranslateMessage(&amp;messages);</div><div class="line">        <span class="comment">/* Send message to WindowProcedure */</span></div><div class="line">        DispatchMessage(&amp;messages);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/* The program return-value is 0 - The value that PostQuitMessage() gave */</span></div><div class="line">    <span class="keyword">return</span> messages.wParam;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">select_brush</span><span class="params">(<span class="keyword">int</span> color,HDC hdc)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span>(color) &#123;</div><div class="line">    <span class="keyword">case</span> RED:</div><div class="line">        SelectObject (hdc, red_brush);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> GREEN:</div><div class="line">        SelectObject (hdc, green_brush);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> BLUE:</div><div class="line">        SelectObject (hdc, blue_brush);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> YELLOW:</div><div class="line">        SelectObject (hdc, yellow_brush);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> PURPLE:</div><div class="line">        SelectObject (hdc, purple_brush);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">        SelectObject (hdc, white_brush);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> color;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">paint_lattice</span><span class="params">(Point * p,HDC hdc,<span class="keyword">int</span> color)</span> </span>&#123; <span class="comment">//-1 original color</span></div><div class="line">    <span class="keyword">int</span> left=p-&gt;y*width;</div><div class="line">    <span class="keyword">int</span> right=(p-&gt;y+<span class="number">1</span>)*width;</div><div class="line">    <span class="keyword">int</span> top=p-&gt;x*height+score_height;</div><div class="line">    <span class="keyword">int</span> bottom=(p-&gt;x+<span class="number">1</span>)*height+score_height;</div><div class="line">    MoveToEx (hdc,left,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,top) ;</div><div class="line">    MoveToEx (hdc,left,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,left,bottom) ;</div><div class="line">    MoveToEx (hdc,right,top, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,bottom) ;</div><div class="line">    MoveToEx (hdc,left,bottom, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc,right,bottom) ;</div><div class="line">    <span class="keyword">int</span> paint_color;</div><div class="line">    <span class="keyword">if</span>(color!=<span class="number">-1</span>) &#123;</div><div class="line">        paint_color=select_brush(color,hdc);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        paint_color=select_brush(ma.get_color(p),hdc);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(paint_color!=BLANK)Ellipse (hdc,left+<span class="number">3</span>,top+<span class="number">3</span>,right<span class="number">-3</span>,bottom<span class="number">-3</span>) ;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">mouse_to_position</span><span class="params">()</span> </span>&#123;</div><div class="line">    position-&gt;x=(mouse-&gt;y-score_height)/height;</div><div class="line">    position-&gt;y=mouse-&gt;x/width;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">char</span> *<span class="title">get_score_string</span><span class="params">(<span class="keyword">char</span>* content)</span></span>&#123;</div><div class="line">    <span class="keyword">char</span> *message=<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">50</span>];</div><div class="line">    <span class="built_in">sprintf</span> (message, <span class="string">"%s  %d ."</span>,content,score);</div><div class="line">    <span class="keyword">return</span> message;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">show_score</span><span class="params">(HWND hwnd,<span class="keyword">char</span>* content,<span class="keyword">char</span>* title)</span> </span>&#123;</div><div class="line">    MessageBox(hwnd,get_score_string(content),title,<span class="literal">NULL</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">after_show_path</span><span class="params">(HWND hwnd)</span> </span>&#123;</div><div class="line">    ma.set_flag(dest,ma.get_color(sou));</div><div class="line">    ma.set_blank(sou);</div><div class="line">    ma.random_set(<span class="number">2</span>);</div><div class="line">    ma.eliminate(score);</div><div class="line">    InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">    <span class="keyword">if</span>(ma.is_all_not_blank()) &#123;</div><div class="line">        show_score(hwnd,<span class="string">"GAME OVER.Your score is"</span>,<span class="string">"你输了"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">struct</span> args &#123;</div><div class="line">    HWND hwnd;</div><div class="line">    HDC hdc;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">void</span>* <span class="title">show_path</span><span class="params">(<span class="keyword">void</span>* ar)</span> </span>&#123;</div><div class="line">    path=<span class="keyword">new</span> Link&lt;Point *&gt;();</div><div class="line">    ma.get_path(sou,dest,path);</div><div class="line">    <span class="keyword">struct</span> args* arg=(<span class="keyword">struct</span> args*) ar;</div><div class="line">    HWND hwnd=arg-&gt;hwnd;</div><div class="line">    HDC hdc=arg-&gt;hdc;</div><div class="line">    <span class="keyword">if</span>(path-&gt;get_first()==<span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//path-&gt;show_link();</span></div><div class="line">    path-&gt;seek_to_first();</div><div class="line">    Point* node=path-&gt;get_first();</div><div class="line">    path_color=ma.get_color(node);</div><div class="line">    s_lattice=node;</div><div class="line">    paint_path=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">while</span>((node=path-&gt;get_next())!=<span class="literal">NULL</span>) &#123;</div><div class="line">        d_lattice=node;</div><div class="line">        InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">        Sleep(<span class="number">300</span>);</div><div class="line">    &#125;</div><div class="line">    paint_path=<span class="literal">false</span>;</div><div class="line">    after_show_path(hwnd);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_GUI</span><span class="params">(HWND hwnd,HDC hdc)</span> </span>&#123;</div><div class="line">    SetBkColor(hdc,BKCOLOR);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;ma.getN(); i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;ma.getN(); j++) &#123;</div><div class="line">            Point* p=<span class="keyword">new</span> Point(i,j);</div><div class="line">            paint_lattice(p,hdc,<span class="number">-1</span>);</div><div class="line">            <span class="keyword">delete</span> p;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">char</span> * score=get_score_string(<span class="string">"You Score: "</span>);</div><div class="line">    TextOut(hdc,<span class="number">0</span>,score_height/<span class="number">4</span>,score,<span class="built_in">strlen</span>(score));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sou_dest</span><span class="params">(HWND hwnd,HDC hdc)</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">pthread_t</span> show_path_pth;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> ret;</div><div class="line">    mouse_to_position();</div><div class="line">    <span class="keyword">if</span>(sou!=<span class="literal">NULL</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(ma.get_color(position)==BLANK) &#123;</div><div class="line">            *dest=*position;</div><div class="line">            <span class="keyword">struct</span> args arg;</div><div class="line">            arg.hdc=hdc;</div><div class="line">            arg.hwnd=hwnd;</div><div class="line">            ret= pthread_create( &amp;show_path_pth, <span class="literal">NULL</span>, &amp;show_path, &amp;arg ); <span class="comment">//参数：创建的线程id，线程参数，线程运行函数的起始地址，运行函数的参数</span></div><div class="line">            <span class="keyword">if</span>( ret != <span class="number">0</span> ) &#123; <span class="comment">//创建线程成功返回0</span></div><div class="line">                <span class="built_in">printf</span>(<span class="string">"pthread_create error:error_code=%d\n"</span>,ret );</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            *sou=*position;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span>(ma.get_color(position)!=BLANK) &#123;</div><div class="line">            *sou=*position;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*  This function is called by the Windows function DispatchMessage()  */</span></div><div class="line"></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProcedure</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span> (message) &#123;                <span class="comment">/* handle the messages */</span></div><div class="line">    <span class="keyword">case</span> WM_CREATE: &#123;</div><div class="line">        ma.init();</div><div class="line">        GetClientRect (hwnd, &amp;client_rect) ;</div><div class="line">        WIDTH=client_rect.right-client_rect.left ;</div><div class="line">        HEIGHT=client_rect.bottom-client_rect.top ;</div><div class="line">        score_height=HEIGHT/<span class="number">10</span>;</div><div class="line">        width=WIDTH/ma.getN();</div><div class="line">        height=(HEIGHT-score_height)/ma.getN();</div><div class="line">        InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_DESTROY:</div><div class="line">        PostQuitMessage (<span class="number">0</span>);       <span class="comment">/* send a WM_QUIT to the message queue */</span></div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_LBUTTONUP: &#123;</div><div class="line">        GetCursorPos(&amp;pc);</div><div class="line">        ScreenToClient(hwnd,&amp;pc);</div><div class="line">        mouse-&gt;x=pc.x;</div><div class="line">        mouse-&gt;y=pc.y;</div><div class="line">        sou_dest(hwnd,hdc);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_RBUTTONUP: &#123;</div><div class="line">        show_score(hwnd,<span class="string">""</span>,<span class="string">"得分"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> WM_PAINT: &#123;</div><div class="line">        hdc = BeginPaint (hwnd, &amp;ps) ;</div><div class="line">        init_GUI(hwnd,hdc);</div><div class="line">        <span class="keyword">if</span>(paint_path) &#123;</div><div class="line">            paint_lattice(s_lattice,hdc,BLANK);</div><div class="line">            paint_lattice(d_lattice,hdc,path_color);</div><div class="line">        &#125;</div><div class="line">        EndPaint (hwnd, &amp;ps) ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:                      <span class="comment">/* for messages that we don't deal with */</span></div><div class="line">        <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="matrix-h"><a href="#matrix-h" class="headerlink" title="matrix.h"></a>matrix.h</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//matrix.h</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MATRIX_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MATRIX_H_INCLUDED</span></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span>  once</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BLANK 0</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RED 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> GREEN 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BLUE 3</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> YELLOW 4</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PURPLE 5</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Point &#123;</div><div class="line"><span class="keyword">private</span> :</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">    Point(<span class="keyword">int</span> xx,<span class="keyword">int</span> yy);</div><div class="line">    Point();</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> ==(Point p);</div><div class="line">    Point&amp; <span class="keyword">operator</span> =(Point p);</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">class</span> node &#123;</div><div class="line"><span class="keyword">public</span> :</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">    node* father;</div><div class="line">    node();</div><div class="line">    node(<span class="keyword">int</span> xx,<span class="keyword">int</span> yy,node* f);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">class</span> LinkNode &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    T po;</div><div class="line">    LinkNode* next;</div><div class="line">    LinkNode(T  pp);</div><div class="line">    LinkNode&amp; <span class="keyword">operator</span>=(LinkNode nn);</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show_node</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">class</span> Link &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    LinkNode&lt;T&gt;* head=<span class="literal">NULL</span>;</div><div class="line">    LinkNode&lt;T&gt;* p=<span class="literal">NULL</span>;</div><div class="line">    LinkNode&lt;T&gt;* tail=<span class="literal">NULL</span>;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> Matrix;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">seek_to_first</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">T <span class="title">get_first</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">T <span class="title">remove_first</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">T <span class="title">get_next</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add_to_first</span><span class="params">(T t)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add_to_last</span><span class="params">(T t)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show_link</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">class</span> Matrix &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> N=<span class="number">10</span>;</div><div class="line">    <span class="keyword">int</span> COLOR_NUM=<span class="number">5</span>;</div><div class="line">    <span class="keyword">int</span>** matrix;</div><div class="line">    <span class="keyword">int</span> max_random_set_num=<span class="number">5</span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_random_num</span><span class="params">(<span class="keyword">int</span> x)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print_matrix</span><span class="params">()</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">random_set_one</span><span class="params">()</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_out</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getN</span><span class="params">()</span> </span>;</div><div class="line">    Matrix() ;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_flag</span><span class="params">(Point* p,<span class="keyword">int</span> color)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_blank</span><span class="params">(Point* p)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_in_que</span><span class="params">(<span class="keyword">int</span>** in,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_path</span><span class="params">(Point *s,Point* dest,Link&lt;Point *&gt; *&amp;l)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">random_set</span><span class="params">(<span class="keyword">int</span> n)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_color</span><span class="params">(Point *p)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_color</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sget_color</span><span class="params">(<span class="keyword">int</span> dir,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> n,<span class="keyword">int</span> color)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test_line</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> dir,<span class="keyword">int</span> &amp;score)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">eliminate</span><span class="params">(<span class="keyword">int</span> &amp; score)</span> </span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_all_not_blank</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// MATRIX_H_INCLUDED</span></span></div></pre></td></tr></table></figure>
<h4 id="matrix-cpp"><a href="#matrix-cpp" class="headerlink" title="matrix.cpp"></a>matrix.cpp</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//matrix.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"matrix.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"></div><div class="line">Point::Point(<span class="keyword">int</span> xx,<span class="keyword">int</span> yy) &#123;</div><div class="line">    x=xx;</div><div class="line">    y=yy;</div><div class="line">&#125;</div><div class="line">Point::Point() &#123;&#125;</div><div class="line"><span class="keyword">bool</span> Point::<span class="keyword">operator</span> ==(Point p) &#123;</div><div class="line">    <span class="keyword">return</span> x==p.x&amp;y==p.y;</div><div class="line">&#125;</div><div class="line">Point&amp; Point::<span class="keyword">operator</span> =(Point p) &#123;</div><div class="line">    x=p.x;</div><div class="line">    y=p.y;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Point::show() &#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"(%d,%d)-&gt;"</span>,x,y);</div><div class="line">&#125;</div><div class="line"></div><div class="line">node::node() &#123;&#125;</div><div class="line">node::node(<span class="keyword">int</span> xx,<span class="keyword">int</span> yy,node* f) &#123;</div><div class="line">    x=xx;</div><div class="line">    y=yy;</div><div class="line">    father=f;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line">LinkNode&lt;T&gt;::LinkNode(T  pp) &#123;</div><div class="line">    po=pp;</div><div class="line">    next=<span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line">LinkNode&lt;T&gt;&amp; LinkNode&lt;T&gt;::<span class="keyword">operator</span>=(LinkNode&lt;T&gt; nn) &#123;</div><div class="line">    po=nn.p;</div><div class="line">    next=nn.next;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">void</span> LinkNode&lt;T&gt;::show_node() &#123;</div><div class="line">    po-&gt;show();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">void</span> Link&lt;T&gt;::seek_to_first() &#123;</div><div class="line">    p=head;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line">T Link&lt;T&gt;::get_first() &#123;</div><div class="line">    <span class="keyword">return</span> head==<span class="literal">NULL</span>?<span class="literal">NULL</span>:head-&gt;po;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line">T Link&lt;T&gt;::remove_first() &#123;</div><div class="line">    <span class="keyword">if</span>(head==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    T *temp=&amp;(head-&gt;po);</div><div class="line">    head=head-&gt;next;</div><div class="line">    <span class="keyword">return</span> *temp;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line">T Link&lt;T&gt;::get_next() &#123;</div><div class="line">    <span class="keyword">if</span>(p==tail)<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(p==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span>(p-&gt;next==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    p=p-&gt;next;</div><div class="line">    <span class="keyword">return</span> p-&gt;po;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">void</span> Link&lt;T&gt;::add_to_first(T t) &#123;</div><div class="line">    LinkNode&lt;T&gt;* x=<span class="keyword">new</span> LinkNode&lt;T&gt;(t);</div><div class="line">    x-&gt;next=head;</div><div class="line">    head=x;</div><div class="line">    <span class="keyword">if</span>(tail=<span class="literal">NULL</span>) &#123;</div><div class="line">        tail=head;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">void</span> Link&lt;T&gt;::add_to_last(T t) &#123;</div><div class="line">    LinkNode&lt;T&gt;* x=<span class="keyword">new</span> LinkNode&lt;T&gt;(t);</div><div class="line">    <span class="keyword">if</span>(head==<span class="literal">NULL</span>) &#123;</div><div class="line">        head=x;</div><div class="line">        x-&gt;next=<span class="literal">NULL</span>;</div><div class="line">        tail=x;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    tail-&gt;next=x;</div><div class="line">    x-&gt;next=<span class="literal">NULL</span>;</div><div class="line">    tail=x;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">void</span> Link&lt;T&gt;::show_link() &#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"show_link:\n"</span>);</div><div class="line">    p=head;</div><div class="line">    <span class="keyword">while</span>(p!=<span class="literal">NULL</span>) &#123;</div><div class="line">        p-&gt;show_node();</div><div class="line">        p=p-&gt;next;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">int</span> Matrix::get_random_num(<span class="keyword">int</span> x) &#123;</div><div class="line">    <span class="keyword">int</span> n=rand()%x;</div><div class="line">    <span class="keyword">return</span> n;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Matrix::print_matrix() &#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"matrix:\n"</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d"</span>,matrix[i][j]);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">bool</span> Matrix::random_set_one() &#123;</div><div class="line">    <span class="keyword">int</span> x=get_random_num(N),y=get_random_num(N);</div><div class="line">    <span class="keyword">if</span>(matrix[x][y]!=BLANK) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    Point *p=<span class="keyword">new</span> Point(x,y);</div><div class="line">    set_flag(p,get_random_num(COLOR_NUM)+<span class="number">1</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">bool</span> Matrix::is_out(<span class="keyword">int</span> x,<span class="keyword">int</span> y) &#123;</div><div class="line">    <span class="keyword">return</span> x&lt;<span class="number">0</span>|x&gt;=N|y&lt;<span class="number">0</span>|y&gt;=N;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">int</span> Matrix::getN() &#123;</div><div class="line">    <span class="keyword">return</span> N;</div><div class="line">&#125;</div><div class="line">Matrix::Matrix() &#123;</div><div class="line">    matrix=<span class="keyword">new</span> <span class="keyword">int</span>*[N];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        matrix[i]=<span class="keyword">new</span> <span class="keyword">int</span>[N];</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">            matrix[i][j]=BLANK;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    srand(time(<span class="number">0</span>));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Matrix::init() &#123;</div><div class="line">    random_set(N*N/<span class="number">4</span>);</div><div class="line">    <span class="comment">//print_matrix();</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Matrix::set_flag(Point* p,<span class="keyword">int</span> color) &#123;</div><div class="line">    matrix[p-&gt;x][p-&gt;y]=color;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Matrix::set_blank(Point* p) &#123;</div><div class="line">    matrix[p-&gt;x][p-&gt;y]=BLANK;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">bool</span> Matrix::is_in_que(<span class="keyword">int</span>** in,<span class="keyword">int</span> x,<span class="keyword">int</span> y) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Matrix::get_path(Point *s,Point* dest,Link&lt;Point *&gt; *&amp;l) &#123;</div><div class="line">    <span class="keyword">if</span>(!(get_color(s)!=BLANK&amp;&amp;get_color(dest)==BLANK))<span class="keyword">return</span> ;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> xc[<span class="number">4</span>]= &#123;<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> yc[<span class="number">4</span>]= &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</div><div class="line">    <span class="keyword">int</span> xt,yt;</div><div class="line">    Link&lt;node*&gt; que;</div><div class="line">    node* temp=<span class="keyword">new</span> node(s-&gt;x,s-&gt;y,<span class="literal">NULL</span>);</div><div class="line">    que.add_to_last(temp);</div><div class="line">    node* dest_node;</div><div class="line">    <span class="keyword">bool</span> flag=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">bool</span>** in=<span class="keyword">new</span> <span class="keyword">bool</span>*[N];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        in[i]=<span class="keyword">new</span> <span class="keyword">bool</span>[N];</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">            in[i][j]=<span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    in[temp-&gt;x][temp-&gt;y]=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">while</span>(flag&amp;&amp;que.get_first()!=<span class="literal">NULL</span>) &#123;</div><div class="line">        temp=que.remove_first();</div><div class="line">        <span class="keyword">if</span>(temp==<span class="literal">NULL</span>) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</div><div class="line">            xt=temp-&gt;x+xc[i];</div><div class="line">            yt=temp-&gt;y+yc[i];</div><div class="line">            <span class="keyword">if</span>((!is_out(xt,yt))&amp;&amp;(!in[xt][yt])) &#123;</div><div class="line">                node* new_node=<span class="keyword">new</span> node(xt,yt,temp);</div><div class="line">                <span class="keyword">if</span>(xt==dest-&gt;x&amp;&amp;yt==dest-&gt;y) &#123;</div><div class="line">                    dest_node=new_node;</div><div class="line">                    flag=<span class="literal">false</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(get_color(xt,yt)==BLANK) &#123;</div><div class="line">                    in[xt][yt]=<span class="literal">true</span>;</div><div class="line">                    que.add_to_last(new_node);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(flag) &#123;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    node *n=dest_node;</div><div class="line">    <span class="keyword">while</span>(n!=<span class="literal">NULL</span>) &#123;</div><div class="line">        Point *lp=<span class="keyword">new</span> Point(n-&gt;x,n-&gt;y);</div><div class="line">        l-&gt;add_to_first(lp);</div><div class="line">        n=n-&gt;father;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Matrix::random_set(<span class="keyword">int</span> n) &#123;</div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line">    srand(time(<span class="number">0</span>));</div><div class="line">    <span class="keyword">int</span> try_time=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(i&lt;n&amp;&amp;try_time&lt;N*N*N) &#123;</div><div class="line">        try_time++;</div><div class="line">        <span class="keyword">if</span>(random_set_one()) &#123;</div><div class="line">            i++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Matrix::get_color(Point *p) &#123;</div><div class="line">    <span class="keyword">return</span> matrix[p-&gt;x][p-&gt;y];</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Matrix::get_color(<span class="keyword">int</span> x,<span class="keyword">int</span> y) &#123;</div><div class="line">    <span class="keyword">return</span> matrix[x][y];</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Matrix::sget_color(<span class="keyword">int</span> dir,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> n,<span class="keyword">int</span> color) &#123;</div><div class="line">    <span class="keyword">switch</span>(dir) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">        y+=n;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">        x+=n;</div><div class="line">        y+=n;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">        x+=n;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> <span class="number">3</span>:</div><div class="line">        x+=n;</div><div class="line">        y-=n;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(is_out(x,y)) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(color!=<span class="number">-1</span>) &#123;</div><div class="line">        matrix[x][y]=color;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> get_color(x,y);</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Matrix::test_line(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> dir,<span class="keyword">int</span> &amp;score) &#123;</div><div class="line">    <span class="keyword">int</span> color=get_color(x,y);</div><div class="line">    <span class="keyword">if</span>(color==BLANK)<span class="keyword">return</span> ;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;<span class="number">5</span>; k++) &#123;</div><div class="line">        <span class="keyword">if</span>(sget_color(dir,x,y,k,<span class="number">-1</span>)!=color) &#123;</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> k=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>( ;; k++) &#123;</div><div class="line">        <span class="keyword">if</span>(sget_color(dir,x,y,k,<span class="number">-1</span>)!=color)<span class="keyword">break</span>;</div><div class="line">        sget_color(dir,x,y,k,BLANK);</div><div class="line">    &#125;</div><div class="line">    score+=k;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Matrix::eliminate(<span class="keyword">int</span> &amp; score) &#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;<span class="number">4</span>; k++) &#123;</div><div class="line">                test_line(i,j,k,score);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">bool</span> Matrix::is_all_not_blank() &#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</div><div class="line">            <span class="keyword">if</span>(matrix[i][j]==BLANK) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="旧函数"><a href="#旧函数" class="headerlink" title="旧函数:"></a>旧函数:</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    int tree(node * n,node* father,Point* dest,node * temp)</span></div><div class="line"><span class="comment">//    &#123;</span></div><div class="line"><span class="comment">//        static int xc[4]= &#123;-1,1,0,0&#125;;</span></div><div class="line"><span class="comment">//        static int yc[4]= &#123;0,0,-1,1&#125;;</span></div><div class="line"><span class="comment">//        if(n==NULL)</span></div><div class="line"><span class="comment">//        &#123;</span></div><div class="line"><span class="comment">//            return -1;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        printf("n:(%d,%d)  ",n-&gt;x,n-&gt;y);</span></div><div class="line"><span class="comment">//        n-&gt;father=father;</span></div><div class="line"><span class="comment">//        int xt,yt;</span></div><div class="line"><span class="comment">//        Link&lt;Point *&gt; nei;</span></div><div class="line"><span class="comment">//        printf("neis:  ");</span></div><div class="line"><span class="comment">//        for(int i=0; i&lt;4; i++)</span></div><div class="line"><span class="comment">//        &#123;</span></div><div class="line"><span class="comment">//            xt=n-&gt;x+xc[i];</span></div><div class="line"><span class="comment">//            yt=n-&gt;y+yc[i];</span></div><div class="line"><span class="comment">//            if((!is_out(xt,yt))&amp;&amp;nn[xt][yt].father==NULL&amp;&amp;nn[xt][yt].father==temp)</span></div><div class="line"><span class="comment">//            &#123;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//                if(xt==dest-&gt;x&amp;&amp;yt==dest-&gt;y)</span></div><div class="line"><span class="comment">//                &#123;</span></div><div class="line"><span class="comment">//                    printf("(%d,%d) ",xt,yt);</span></div><div class="line"><span class="comment">//                    nn[xt][yt].father=n;</span></div><div class="line"><span class="comment">//                    return 0;</span></div><div class="line"><span class="comment">//                &#125;</span></div><div class="line"><span class="comment">//                if(get_color(xt,yt)==BLANK)</span></div><div class="line"><span class="comment">//                &#123;</span></div><div class="line"><span class="comment">//                    printf("(%d,%d) ",xt,yt);</span></div><div class="line"><span class="comment">//                    Point *ptemp=new Point(xt,yt);</span></div><div class="line"><span class="comment">//                    nei.add_to_first(ptemp);</span></div><div class="line"><span class="comment">//                    nn[xt][yt].father=n;</span></div><div class="line"><span class="comment">//                &#125;</span></div><div class="line"><span class="comment">//            &#125;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        printf("\n");</span></div><div class="line"><span class="comment">//        nei.seek_to_first();</span></div><div class="line"><span class="comment">//        Point *pp;</span></div><div class="line"><span class="comment">//        if((pp=nei.get_first())!=NULL)&#123;</span></div><div class="line"><span class="comment">//            if(tree(&amp;nn[pp-&gt;x][pp-&gt;y],n,dest,temp)==0)return 0;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        while((pp=nei.get_next())!=NULL)&#123;</span></div><div class="line"><span class="comment">//            if(tree(&amp;nn[pp-&gt;x][pp-&gt;y],n,dest,temp)==0)return 0;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        return 1;</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//    void get_path(Point *s,Point* dest,Link&lt;Point *&gt; *&amp;l)</span></div><div class="line"><span class="comment">//    &#123;</span></div><div class="line"><span class="comment">//        printf("1\n");</span></div><div class="line"><span class="comment">//        node* temp=new node;</span></div><div class="line"><span class="comment">//        tree(&amp;nn[s-&gt;x][s-&gt;y],temp,dest,temp);</span></div><div class="line"><span class="comment">//        printf("\n\nfathers:\n");</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//         for(int i=0; i&lt;N; i++)</span></div><div class="line"><span class="comment">//        &#123;</span></div><div class="line"><span class="comment">//            for(int j=0; j&lt;N; j++)</span></div><div class="line"><span class="comment">//            &#123;</span></div><div class="line"><span class="comment">//                if(nn[i][j].father!=NULL)&#123;</span></div><div class="line"><span class="comment">//                    printf("(%d",nn[i][j].x);</span></div><div class="line"><span class="comment">//                    printf(",%d)",nn[i][j].y);</span></div><div class="line"><span class="comment">//                    printf("-&gt;(%d",nn[i][j].father-&gt;x);</span></div><div class="line"><span class="comment">//                    printf(",%d)\n",nn[i][j].father-&gt;y);</span></div><div class="line"><span class="comment">//                &#125;</span></div><div class="line"><span class="comment">//            &#125;</span></div><div class="line"><span class="comment">//            printf("\n");</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//        node* n=&amp;nn[dest-&gt;x][dest-&gt;y];</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//        while(n!=temp)</span></div><div class="line"><span class="comment">//        &#123;</span></div><div class="line"><span class="comment">//            Point *lp=new Point(n-&gt;x,n-&gt;y);</span></div><div class="line"><span class="comment">//            l-&gt;add_to_first(lp);</span></div><div class="line"><span class="comment">//            n=n-&gt;father;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        printf("3\n");</span></div><div class="line"><span class="comment">//    &#125;</span></div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于大三下学期，2016年3月。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/13/抓鼠标的猫/" itemprop="url">
                  抓鼠标的猫（Win32实现，Codeblocks+GCC编译）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-13T23:13:59+08:00" content="2016-03-13">
              2016-03-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p>猫的眼睛一直跟着鼠标移动：</p>
<p><img src="/imgs/cat1.jpg" alt="cat"></p>
<p>鼠标经过猫的右脚附近时，猫会抓住鼠标。（未使用Hook）<br><img src="/imgs/cat2.jpg" alt="cat"></p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//main.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="comment">//#include &lt;iostream&gt;</span></div><div class="line"><span class="comment">//using namespace std;</span></div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span> </span>;</div><div class="line"><span class="keyword">double</span> WIDTH=<span class="number">410</span>,HEIGHT=<span class="number">430</span>;</div><div class="line"><span class="keyword">double</span> px=<span class="number">0.0</span>,py=<span class="number">0.0</span>;</div><div class="line"><span class="keyword">double</span> ppx=<span class="number">0.0</span>,ppy=<span class="number">0.0</span>;</div><div class="line">POINT sp;</div><div class="line"><span class="keyword">int</span> cat=<span class="number">0</span>;</div><div class="line"><span class="keyword">double</span> width,height;</div><div class="line">PAINTSTRUCT ps ;</div><div class="line">RECT rect ;</div><div class="line">POINT pts[<span class="number">3</span>];</div><div class="line"><span class="keyword">double</span> left_eye_px=<span class="number">0.0</span>,right_eye_px=<span class="number">0.0</span>;</div><div class="line"><span class="keyword">double</span> eye_py=<span class="number">0.0</span>;</div><div class="line"><span class="keyword">double</span> eye_r=<span class="number">0.0</span>;</div><div class="line"><span class="keyword">double</span> k=<span class="number">0.0</span>;</div><div class="line"><span class="keyword">double</span> ball_hr=<span class="number">0.0</span>;<span class="comment">//半径</span></div><div class="line"><span class="keyword">double</span> deltax=<span class="number">0.0</span>;</div><div class="line">POINT p,pp;</div><div class="line"><span class="keyword">int</span> initGraph=<span class="number">1</span>;</div><div class="line">LPPOINT catp;</div><div class="line">RECT eye_rect;</div><div class="line">HBRUSH  gray_brush =CreateSolidBrush (RGB(<span class="number">180</span>,<span class="number">180</span>,<span class="number">180</span>));</div><div class="line">HBRUSH  white_brush =CreateSolidBrush (RGB(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>));</div><div class="line">HBRUSH  black_brush =CreateSolidBrush (RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">drawRound</span><span class="params">(HDC hdc,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> r)</span>    <span class="comment">//r 直径</span></span></div><div class="line">&#123;</div><div class="line">    Ellipse(hdc,x-r/<span class="number">2</span>,y-r/<span class="number">2</span>,x+r/<span class="number">2</span>,y+r/<span class="number">2</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> WINAPI <span class="title">WinMain</span> <span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance,</span></span></div><div class="line">                    PSTR szCmdLine, <span class="keyword">int</span> iCmdShow)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">static</span> TCHAR szAppName[] = TEXT (<span class="string">"HelloWin"</span>) ;</div><div class="line">    HWND         hwnd ;</div><div class="line">    MSG          msg ;</div><div class="line">    WNDCLASS     wndclass ;</div><div class="line">    wndclass.style         = CS_HREDRAW | CS_VREDRAW ;</div><div class="line">    wndclass.lpfnWndProc   = WndProc ;</div><div class="line">    wndclass.cbClsExtra    = <span class="number">0</span> ;</div><div class="line">    wndclass.cbWndExtra    = <span class="number">0</span> ;</div><div class="line">    wndclass.hInstance     = hInstance ;</div><div class="line">    wndclass.hIcon         = LoadIcon (<span class="literal">NULL</span>, IDI_APPLICATION) ;</div><div class="line">    wndclass.hCursor       = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW) ;</div><div class="line">    wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) ;</div><div class="line">    wndclass.lpszMenuName  = <span class="literal">NULL</span> ;</div><div class="line">    wndclass.lpszClassName = szAppName ;</div><div class="line">    <span class="keyword">if</span> (!RegisterClass (&amp;wndclass))</div><div class="line">    &#123;</div><div class="line">        MessageBox (<span class="literal">NULL</span>, TEXT (<span class="string">"This program requires Windows NT!"</span>),</div><div class="line">                    szAppName, MB_ICONERROR) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    &#125;</div><div class="line">    hwnd = CreateWindow (szAppName,                  <span class="comment">// window class name</span></div><div class="line">                         TEXT (<span class="string">"Mouse Hook"</span>), <span class="comment">// window caption</span></div><div class="line">                         WS_OVERLAPPEDWINDOW,        <span class="comment">// window style</span></div><div class="line">                         CW_USEDEFAULT,              <span class="comment">// initial x position</span></div><div class="line">                         CW_USEDEFAULT,              <span class="comment">// initial y position</span></div><div class="line">                         WIDTH,              <span class="comment">// initial x size</span></div><div class="line">                         HEIGHT,              <span class="comment">// initial y size</span></div><div class="line">                         <span class="literal">NULL</span>,                       <span class="comment">// parent window handle</span></div><div class="line">                         <span class="literal">NULL</span>,                       <span class="comment">// window menu handle</span></div><div class="line">                         hInstance,                  <span class="comment">// program instance handle</span></div><div class="line">                         <span class="literal">NULL</span>) ;                     <span class="comment">// creation parameters</span></div><div class="line">    ShowWindow (hwnd, iCmdShow) ;</div><div class="line">    UpdateWindow (hwnd) ;</div><div class="line">    <span class="keyword">while</span> (GetMessage (&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</div><div class="line">    &#123;</div><div class="line">        TranslateMessage (&amp;msg) ;</div><div class="line">        DispatchMessage (&amp;msg) ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> msg.wParam ;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">init</span><span class="params">(HWND hwnd)</span></span></div><div class="line">&#123;</div><div class="line">    GetClientRect (hwnd, &amp;rect) ;</div><div class="line">    width=rect.right-rect.left ;</div><div class="line">    height=rect.bottom-rect.top ;</div><div class="line">    left_eye_px=width*<span class="number">3</span>/<span class="number">8</span>-height/<span class="number">16</span>;</div><div class="line">    right_eye_px=width*<span class="number">5</span>/<span class="number">8</span>+height/<span class="number">16</span>;</div><div class="line">    eye_py=height*<span class="number">5</span>/<span class="number">10</span>-height/<span class="number">16</span>;</div><div class="line">    eye_r=height/<span class="number">8</span>;</div><div class="line">    ball_hr=eye_r/<span class="number">8</span>;<span class="comment">//半径</span></div><div class="line">    px=left_eye_px;</div><div class="line">    py=eye_py;</div><div class="line">    ppx=right_eye_px;</div><div class="line">    ppy=eye_py;</div><div class="line">    eye_rect.left=left_eye_px-eye_r/<span class="number">2</span>;</div><div class="line">    eye_rect.right=right_eye_px+eye_r/<span class="number">2</span>;</div><div class="line">    eye_rect.top=eye_py-eye_r/<span class="number">2</span>;</div><div class="line">    eye_rect.bottom=eye_py+eye_r/<span class="number">2</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">drawHand</span><span class="params">(HDC hdc)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">/**&lt; 画嘴 */</span></div><div class="line">    <span class="keyword">if</span>(cat==<span class="number">0</span>)</div><div class="line">    &#123;</div><div class="line">        MoveToEx (hdc, width/<span class="number">4</span>+width/<span class="number">10</span>,height/<span class="number">48</span>*<span class="number">33</span>, <span class="literal">NULL</span>) ;</div><div class="line">        LineTo (hdc, width*<span class="number">3</span>/<span class="number">4</span>-width/<span class="number">10</span>, height/<span class="number">48</span>*<span class="number">33</span>) ;</div><div class="line">        SelectObject (hdc,gray_brush ) ;</div><div class="line">        Ellipse(hdc,width/<span class="number">4</span>-width/<span class="number">20</span>,height/<span class="number">4</span>*<span class="number">3</span>,width/<span class="number">4</span>+width/<span class="number">20</span>,height*<span class="number">1.1</span>);<span class="comment">//左胳膊</span></div><div class="line">        Ellipse(hdc,width/<span class="number">4</span>*<span class="number">3</span>-width/<span class="number">20</span>,height/<span class="number">4</span>*<span class="number">3</span>,width/<span class="number">4</span>*<span class="number">3</span>+width/<span class="number">20</span>,height*<span class="number">1.1</span>);<span class="comment">//右胳膊</span></div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    SelectObject (hdc, gray_brush) ;</div><div class="line">    Ellipse(hdc,width/<span class="number">4</span>*<span class="number">3</span>-width/<span class="number">20</span>,height/<span class="number">4</span>*<span class="number">3</span>,width/<span class="number">4</span>*<span class="number">3</span>+width/<span class="number">20</span>,height*<span class="number">1.1</span>);<span class="comment">//右胳膊</span></div><div class="line">    Ellipse(hdc,width/<span class="number">4</span>-width/<span class="number">20</span>,height-height/<span class="number">4</span>,width/<span class="number">4</span>+width/<span class="number">20</span>,height);<span class="comment">//左胳膊</span></div><div class="line">    <span class="comment">/**&lt; 画脚掌 */</span></div><div class="line">    Ellipse(hdc,width/<span class="number">4</span>-width/<span class="number">12</span>,height-height/<span class="number">7</span>,width/<span class="number">4</span>+width/<span class="number">12</span>,height);</div><div class="line">    MoveToEx (hdc, width/<span class="number">4</span>-width/<span class="number">15</span>,height-height/<span class="number">9</span>, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc, width/<span class="number">4</span>-width/<span class="number">16</span>, height-height/<span class="number">15</span>) ;</div><div class="line">    MoveToEx (hdc, width/<span class="number">4</span>,height-height/<span class="number">7</span>, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc, width/<span class="number">4</span>, height-height/<span class="number">16</span>) ;</div><div class="line">    MoveToEx (hdc, width/<span class="number">4</span>+width/<span class="number">15</span>,height-height/<span class="number">9</span>, <span class="literal">NULL</span>) ;</div><div class="line">    LineTo (hdc, width/<span class="number">4</span>+width/<span class="number">16</span>, height-height/<span class="number">15</span>) ;</div><div class="line">    Arc( hdc, width/<span class="number">4</span>-width/<span class="number">18</span>, height-height/<span class="number">16</span>,width/<span class="number">4</span>+width/<span class="number">18</span>, height,width/<span class="number">4</span>+width/<span class="number">16</span>, height,width/<span class="number">4</span>-width/<span class="number">16</span>, height);</div><div class="line">    <span class="comment">/**&lt; 画嘴 */</span></div><div class="line">    Arc( hdc, width*<span class="number">1</span>/<span class="number">4</span>+width/<span class="number">10</span>,  height/<span class="number">48</span>*<span class="number">27</span>,width*<span class="number">3</span>/<span class="number">4</span>-width/<span class="number">10</span>, height/<span class="number">48</span>*<span class="number">33</span>,width*<span class="number">1</span>/<span class="number">4</span>, height/<span class="number">48</span>*<span class="number">30</span>, width*<span class="number">3</span>/<span class="number">4</span>, height/<span class="number">48</span>*<span class="number">30</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">LRESULT CALLBACK <span class="title">WndProc</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span></div><div class="line">&#123;</div><div class="line">    POINT pc;</div><div class="line">    HDC hdc;</div><div class="line">    <span class="keyword">switch</span> (message)</div><div class="line">    &#123;</div><div class="line">    <span class="keyword">case</span> WM_CREATE:</div><div class="line">        init(hwnd);</div><div class="line">        initGraph =<span class="number">1</span>;</div><div class="line">        InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    <span class="keyword">case</span> WM_SIZE:</div><div class="line">        init(hwnd);</div><div class="line">        initGraph =<span class="number">1</span>;</div><div class="line">        InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">case</span> WM_MOVE:</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">case</span> WM_LBUTTONDOWN:</div><div class="line">        GetCursorPos(&amp;pc);</div><div class="line">        <span class="keyword">if</span>(pc.x==sp.x&amp;&amp;pc.y==sp.y)</div><div class="line">        &#123;</div><div class="line">            cat=<span class="number">0</span>;</div><div class="line">            SetCursorPos(sp.x,sp.y-height/<span class="number">2</span>);</div><div class="line">            ReleaseCapture () ;</div><div class="line">            initGraph=<span class="number">1</span>;</div><div class="line">            InvalidateRect (hwnd,<span class="literal">NULL</span>,  <span class="literal">true</span>) ;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    <span class="keyword">case</span> WM_MOUSEMOVE:</div><div class="line">        <span class="keyword">if</span>(cat==<span class="number">1</span>)</div><div class="line">        &#123;</div><div class="line">            SetCursorPos(sp.x,sp.y);</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        GetCursorPos(&amp;p);</div><div class="line">        pp=p;</div><div class="line">        ScreenToClient(hwnd,&amp;pp);</div><div class="line">        <span class="keyword">if</span>((pp.x&gt;width/<span class="number">4</span>-width/<span class="number">12</span>)&amp;&amp;(pp.x&lt;width/<span class="number">4</span>+width/<span class="number">12</span>)&amp;&amp;(pp.y&gt;height-height/<span class="number">7</span>)&amp;&amp;(pp.y&lt;height))</div><div class="line">        &#123;</div><div class="line">            SetCapture (hwnd) ;</div><div class="line">            sp.x=width/<span class="number">4</span>;</div><div class="line">            sp.y=height-height/<span class="number">14</span>;</div><div class="line">            ClientToScreen(hwnd,&amp;sp);</div><div class="line">            cat=<span class="number">1</span>;</div><div class="line">            initGraph=<span class="number">1</span>;</div><div class="line">            InvalidateRect (hwnd,<span class="literal">NULL</span>, <span class="literal">true</span>) ;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        k=<span class="number">999.0</span>;</div><div class="line">        <span class="keyword">if</span>(pp.x-left_eye_px!=<span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            k=(pp.y-eye_py)/(pp.x-left_eye_px);</div><div class="line">        &#125;</div><div class="line">        deltax=(ball_hr/<span class="number">4</span>)/(<span class="number">1</span>+k*k);</div><div class="line">        deltax=<span class="built_in">sqrt</span>(deltax);</div><div class="line">        <span class="keyword">if</span>(!(pp.x&gt;left_eye_px))</div><div class="line">        &#123;</div><div class="line">            deltax=(<span class="number">-1.0</span>)*deltax;</div><div class="line">        &#125;</div><div class="line">        px=left_eye_px+deltax*<span class="number">8</span>;</div><div class="line">        deltax=(ball_hr/<span class="number">4</span>)/(<span class="number">1</span>+<span class="number">1</span>/(k*k));</div><div class="line">        deltax=<span class="built_in">sqrt</span>(deltax);</div><div class="line">        <span class="keyword">if</span>(!(pp.y&gt;eye_py))</div><div class="line">        &#123;</div><div class="line">            deltax=(<span class="number">-1.0</span>)*deltax;</div><div class="line">        &#125;</div><div class="line">        py=eye_py+deltax*<span class="number">8</span>;</div><div class="line">        k=<span class="number">999.0</span>;</div><div class="line">        <span class="keyword">if</span>(pp.x-right_eye_px!=<span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            k=(pp.y-eye_py)/(pp.x-right_eye_px);</div><div class="line">        &#125;</div><div class="line">        deltax=(ball_hr/<span class="number">4</span>)/(<span class="number">1</span>+k*k);</div><div class="line">        deltax=<span class="built_in">sqrt</span>(deltax);</div><div class="line">        <span class="keyword">if</span>(!(pp.x&gt;right_eye_px))</div><div class="line">        &#123;</div><div class="line">            deltax=(<span class="number">-1.0</span>)*deltax;</div><div class="line">        &#125;</div><div class="line">        ppx=right_eye_px+deltax*<span class="number">8</span>;</div><div class="line">        deltax=(ball_hr/<span class="number">4</span>)/(<span class="number">1</span>+<span class="number">1</span>/(k*k));</div><div class="line">        deltax=<span class="built_in">sqrt</span>(deltax);</div><div class="line">        <span class="keyword">if</span>(!(pp.y&gt;eye_py))</div><div class="line">        &#123;</div><div class="line">            deltax=(<span class="number">-1.0</span>)*deltax;</div><div class="line">        &#125;</div><div class="line">        ppy=eye_py+deltax*<span class="number">8</span>;</div><div class="line">        InvalidateRect (hwnd, &amp;eye_rect, <span class="literal">false</span>) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    <span class="keyword">case</span> WM_PAINT:</div><div class="line">        hdc=BeginPaint (hwnd,&amp;ps) ;</div><div class="line">        <span class="keyword">if</span>(initGraph==<span class="number">1</span>)</div><div class="line">        &#123;</div><div class="line">            SelectObject (hdc, gray_brush) ;</div><div class="line">            Ellipse(hdc,width/<span class="number">6</span>,height/<span class="number">2</span>,width-width/<span class="number">6</span>,height*<span class="number">3</span>/<span class="number">2</span>);<span class="comment">//身体</span></div><div class="line">            <span class="comment">/**&lt; 画脸 */</span></div><div class="line">            Ellipse(hdc,<span class="number">0</span>,height/<span class="number">4</span>,width*<span class="number">20</span>/<span class="number">20</span>,height*<span class="number">3</span>/<span class="number">4</span>);</div><div class="line">            <span class="comment">/**&lt; 画耳朵 */</span></div><div class="line">            pts[<span class="number">0</span>].x =width/<span class="number">4</span>;</div><div class="line">            pts[<span class="number">0</span>].y =height/<span class="number">10</span>;</div><div class="line">            pts[<span class="number">1</span>].x =width/<span class="number">8</span>;</div><div class="line">            pts[<span class="number">1</span>].y =height/<span class="number">9</span>*<span class="number">3</span>;</div><div class="line">            pts[<span class="number">2</span>].x =width/<span class="number">8</span>*<span class="number">3</span>;</div><div class="line">            pts[<span class="number">2</span>].y =height/<span class="number">33</span>*<span class="number">9</span>;</div><div class="line">            Polygon (hdc, pts, <span class="number">3</span>) ;</div><div class="line">            pts[<span class="number">0</span>].x =width/<span class="number">4</span>*<span class="number">3</span>;</div><div class="line">            pts[<span class="number">0</span>].y =height/<span class="number">10</span>;</div><div class="line">            pts[<span class="number">1</span>].x =width/<span class="number">8</span>*<span class="number">7</span>;</div><div class="line">            pts[<span class="number">1</span>].y =height/<span class="number">9</span>*<span class="number">3</span>;</div><div class="line">            pts[<span class="number">2</span>].x =width/<span class="number">8</span>*<span class="number">5</span>;</div><div class="line">            pts[<span class="number">2</span>].y =height/<span class="number">33</span>*<span class="number">9</span>;</div><div class="line">            Polygon (hdc, pts, <span class="number">3</span>) ;</div><div class="line">            <span class="comment">/**&lt; 画胡子 */</span></div><div class="line">            MoveToEx (hdc, <span class="number">0</span>, height/<span class="number">48</span>*<span class="number">27</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">2</span>,height/<span class="number">48</span>*<span class="number">27</span>) ;</div><div class="line">            MoveToEx (hdc, <span class="number">0</span>, height/<span class="number">48</span>*<span class="number">30</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">2</span>,height/<span class="number">48</span>*<span class="number">30</span>) ;</div><div class="line">            MoveToEx (hdc, <span class="number">0</span>, height/<span class="number">48</span>*<span class="number">33</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">2</span>,height/<span class="number">48</span>*<span class="number">33</span>) ;</div><div class="line">            MoveToEx (hdc, width, height/<span class="number">48</span>*<span class="number">27</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">6</span>,height/<span class="number">48</span>*<span class="number">27</span>) ;</div><div class="line">            MoveToEx (hdc, width, height/<span class="number">48</span>*<span class="number">30</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">6</span>,height/<span class="number">48</span>*<span class="number">30</span>) ;</div><div class="line">            MoveToEx (hdc, width, height/<span class="number">48</span>*<span class="number">33</span>, <span class="literal">NULL</span>) ;</div><div class="line">            LineTo (hdc, width/<span class="number">8</span>*<span class="number">6</span>,height/<span class="number">48</span>*<span class="number">33</span>) ;</div><div class="line">            drawHand(hdc);</div><div class="line">            initGraph=<span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/**&lt; 画眼睛 */</span></div><div class="line">        SelectObject (hdc, white_brush) ;</div><div class="line">        drawRound(hdc,left_eye_px,eye_py,eye_r);</div><div class="line">        drawRound(hdc,right_eye_px,eye_py,eye_r);</div><div class="line">        SelectObject (hdc, black_brush) ;</div><div class="line">        drawRound(hdc,px,py,ball_hr*<span class="number">2</span>);</div><div class="line">        drawRound(hdc,ppx,ppy,ball_hr*<span class="number">2</span>);</div><div class="line">        EndPaint (hwnd, &amp;ps) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    <span class="keyword">case</span> WM_DESTROY:</div><div class="line">        PostQuitMessage (<span class="number">0</span>) ;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam) ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于大三上学期，Windows程序设计 课程考核作业。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/13/科学计算器Java/" itemprop="url">
                  科学计算器（JAVA实现）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-13T23:13:59+08:00" content="2016-03-13">
              2016-03-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前记："><a href="#前记：" class="headerlink" title="前记：　　"></a>前记：　　</h3><p>　　大二学 Java 的时候写的，现在贴上来，只为留念。</p>
<p>　　再翻代码，自己看着都头疼。一重重的 if 嵌套，当时写得费劲，现在看着更费劲。</p>
<h3 id="代码思想："><a href="#代码思想：" class="headerlink" title="代码思想："></a>代码思想：</h3><p>　　代码的大致思想是这样：</p>
<p>　　　　首先定义一个算式字符串。然后用户通过键盘或鼠标点击按钮输入字符，添加到算式字符串末尾。在每次用户输入字符之后，先判断该字符是否符合算式语法规则（如加号后不能再跟加号），不符合语法规则的字符不添加到算式字符串末尾。如果用户输入了等号，则进行计算并将计算结果显示出来。</p>
<p>　　　　其中计算过程如下：<br>&gt;<br>　　　　首先将字符串转化为两个链表，一个存储浮点数，一个存储运算符。<br>&gt;<br>　　　　如 <code>3 + 2*4 - 4/2</code><br>&gt;<br>　　　　会被转换为两个链表：<br><code>3 2 4 4 2</code><br><code>+ * - /</code><br>&gt;<br>之后循环以下过程：<br>&gt;<br>　　　　　　在运算符链表中找到运算优先级最高的一个运算符（若有多个，取第一个）。假设其下标为 i（如在上例中，i = 1 ），然后在浮点数链表中找到下标为 i 和 i+1 的项，进行相应运算后，删除这两项，并把结果插入该位置。在运算符链表中删除该运算符。<br>&gt;<br>如上例中，执行一次运算后，链表为：<br><code>3 8 4 2</code><br><code>+ - /</code><br>&gt;<br>循环进行到浮点数链表中只有一个项目（也即操作符链表为空）。该项目即为算式计算结果。</p>
<p>　　经测试，程序能进行浮点数科学计算。能进行负数计算，如 <code>3--3</code> 。但是计算 <code>3---3</code> 时会出现异常。</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码：　　"></a>代码：　　</h3><p>Calculator.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mycalculator;</div><div class="line"><span class="comment">/*</span></div><div class="line"> *</div><div class="line"> * 计算3---3  会有异常</div><div class="line"> *</div><div class="line"> *</div><div class="line"> *</div><div class="line"> * */</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.*;</div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calculator</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span>, <span class="title">KeyListener</span>,</span></div><div class="line">        <span class="title">MouseListener</span> &#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> WIDTH = <span class="number">440</span>, HEIGHT = <span class="number">350</span>;</div><div class="line">    GridLayout gridLayout = <span class="keyword">new</span> GridLayout(<span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>); <span class="comment">// 勿忘初始化 不初始化不会报错，但面板是空的</span></div><div class="line">    BorderLayout borderLayout = <span class="keyword">new</span> BorderLayout();</div><div class="line">    FlowLayout flowLayout = <span class="keyword">new</span> FlowLayout();</div><div class="line">    Container container;</div><div class="line">    <span class="comment">// Container cont;</span></div><div class="line">    JPanel panel, buttonPanel;</div><div class="line">    JButton[] buttons;</div><div class="line">    String[] name;</div><div class="line">    JTextField textField;</div><div class="line">    <span class="keyword">boolean</span> cleared = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Calculator</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"Calculator"</span>);</div><div class="line">        container = getContentPane();</div><div class="line">        <span class="comment">// Cont = getContentPane();</span></div><div class="line">        <span class="comment">// Cont.setLayout(borderLayout);</span></div><div class="line">        buttonPanel = <span class="keyword">new</span> JPanel();</div><div class="line">        panel = <span class="keyword">new</span> JPanel();</div><div class="line">        <span class="comment">// container = new Container();</span></div><div class="line">        <span class="comment">// Cont.add(container, borderLayout.CENTER);</span></div><div class="line">        <span class="comment">// panel.setSize(380,380);</span></div><div class="line">        buttonPanel.setLayout(gridLayout);</div><div class="line">        textField = <span class="keyword">new</span> JTextField(<span class="number">15</span>);</div><div class="line">        textField.setFont(textField.getFont().deriveFont(Font.BOLD,</div><div class="line">                (<span class="keyword">float</span>) <span class="number">32.0</span>));</div><div class="line">        textField.setEditable(<span class="keyword">false</span>);</div><div class="line">        textField.setHorizontalAlignment(JTextField.RIGHT);</div><div class="line">        textField.setBackground(Color.GRAY);</div><div class="line">        textField.setForeground(Color.WHITE);</div><div class="line">        panel.add(textField);</div><div class="line">        <span class="comment">// textField.setSize(getBounds().width,getBounds().height/3);</span></div><div class="line">        <span class="comment">// textField.setFont(textField.getFont().deriveFont(99));</span></div><div class="line">        <span class="comment">/*</span></div><div class="line">         * container.setLayout(borderLayout); container.add(textField,</div><div class="line">         * borderLayout.NORTH); container.add(cont, borderLayout.CENTER);</div><div class="line">         */</div><div class="line">        container.setLayout(borderLayout);</div><div class="line">        <span class="comment">// container.add(textField);</span></div><div class="line">        container.add(panel, borderLayout.NORTH);</div><div class="line">        container.add(buttonPanel, borderLayout.CENTER);</div><div class="line">        <span class="comment">// container.setSize(getBounds().width,getBounds().height);</span></div><div class="line">        <span class="comment">// cont.setSize(getBounds().width,getBounds().height/3*2);</span></div><div class="line">        buttons = <span class="keyword">new</span> JButton[<span class="number">16</span>];</div><div class="line">        name = <span class="keyword">new</span> String[] &#123; <span class="string">"7"</span>, <span class="string">"8"</span>, <span class="string">"9"</span>, <span class="string">"/"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>, <span class="string">"6"</span>, <span class="string">"*"</span>, <span class="string">"1"</span>, <span class="string">"2"</span>,</div><div class="line">                <span class="string">"3"</span>, <span class="string">"-"</span>, <span class="string">"0"</span>, <span class="string">"."</span>, <span class="string">"="</span>, <span class="string">"+"</span> &#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt;= <span class="number">15</span>; index++) &#123;</div><div class="line">            buttons[index] = <span class="keyword">new</span> JButton(name[index]);</div><div class="line">            buttons[index].addActionListener(<span class="keyword">this</span>);</div><div class="line">            buttons[index].setBackground(Color.GRAY);</div><div class="line">            buttons[index].setForeground(Color.WHITE);</div><div class="line">            buttons[index].addKeyListener(<span class="keyword">this</span>);</div><div class="line">            buttons[index].addMouseListener(<span class="keyword">this</span>);</div><div class="line">            buttons[index].setFont(buttons[index].getFont().deriveFont(</div><div class="line">                    Font.BOLD, (<span class="keyword">float</span>) <span class="number">32.0</span>));</div><div class="line">            <span class="comment">// buttons[index].setSize(200, 200);</span></div><div class="line">            buttonPanel.add(buttons[index]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">this</span>.addKeyListener(<span class="keyword">this</span>);</div><div class="line">        setSize(WIDTH, HEIGHT);</div><div class="line">        Toolkit kit = Toolkit.getDefaultToolkit(); <span class="comment">// 定义工具包</span></div><div class="line">        Dimension screenSize = kit.getScreenSize(); <span class="comment">// 获取屏幕的尺寸</span></div><div class="line">        <span class="keyword">int</span> screenWidth = screenSize.width; <span class="comment">// 获取屏幕的宽</span></div><div class="line">        <span class="keyword">int</span> screenHeight = screenSize.height; <span class="comment">// 获取屏幕的高</span></div><div class="line">        setLocation(screenWidth / <span class="number">2</span> - WIDTH / <span class="number">2</span>, screenHeight / <span class="number">2</span> - HEIGHT / <span class="number">2</span>);<span class="comment">// 设置窗口居中显示</span></div><div class="line">        <span class="comment">// setLocation(600, 250);</span></div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">        setFocusable(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function">String <span class="title">calculate</span><span class="params">(String str)</span> </span>&#123;</div><div class="line">        String result = <span class="string">"Wrong Expression"</span>;</div><div class="line">        String temp = <span class="string">""</span>;</div><div class="line">        <span class="keyword">if</span> (str.charAt(<span class="number">0</span>) != <span class="string">'-'</span></div><div class="line">                &amp;&amp; !(str.charAt(<span class="number">0</span>) &lt;= <span class="string">'9'</span> &amp;&amp; str.charAt(<span class="number">0</span>) &gt;= <span class="string">'0'</span>)) &#123;</div><div class="line">            <span class="keyword">return</span> result;</div><div class="line">        &#125;</div><div class="line">        LinkedList&lt;Double&gt; list = <span class="keyword">new</span> LinkedList&lt;Double&gt;();</div><div class="line">        LinkedList&lt;Character&gt; optList = <span class="keyword">new</span> LinkedList&lt;Character&gt;();</div><div class="line">        Double doubleTemp;</div><div class="line">        <span class="keyword">boolean</span> isFormerOpt = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt;= str.length() - <span class="number">1</span>; index++) &#123;</div><div class="line">            <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</div><div class="line">                isFormerOpt = <span class="keyword">true</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">if</span> (str.charAt(index - <span class="number">1</span>) &gt; <span class="string">'9'</span> || str.charAt(index - <span class="number">1</span>) &lt; <span class="string">'0'</span>) &#123;</div><div class="line">                    isFormerOpt = <span class="keyword">true</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    isFormerOpt = <span class="keyword">false</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (str.charAt(index) != <span class="string">'+'</span> &amp;&amp; str.charAt(index) != <span class="string">'*'</span></div><div class="line">                    &amp;&amp; str.charAt(index) != <span class="string">'/'</span></div><div class="line">                    &amp;&amp; (!(str.charAt(index) == <span class="string">'-'</span> &amp;&amp; isFormerOpt == <span class="keyword">false</span>))) &#123;</div><div class="line">                temp += str.charAt(index);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                doubleTemp = <span class="keyword">new</span> Double(temp);</div><div class="line">                list.add(doubleTemp);</div><div class="line">                temp = <span class="string">""</span>;</div><div class="line">                optList.add(str.charAt(index));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        doubleTemp = <span class="keyword">new</span> Double(temp);</div><div class="line">        list.add(doubleTemp);</div><div class="line">        temp = <span class="string">""</span>;</div><div class="line">        <span class="comment">/*</span></div><div class="line">         * for (int index = 0; index &lt;= list.size() - 1; index++) &#123;</div><div class="line">         * System.out.println(list.get(index)); &#125; for (int index = 0; index &lt;=</div><div class="line">         * optList.size() - 1; index++) &#123;</div><div class="line">         * System.out.println(optList.get(index)); &#125;</div><div class="line">         */</div><div class="line">        <span class="keyword">boolean</span> isThereHigherOpt = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">while</span> (isThereHigherOpt == <span class="keyword">true</span>) &#123;</div><div class="line">            <span class="comment">/*</span></div><div class="line">             * for (Iterator&lt;Character&gt; it = optList.iterator(); it.hasNext();)</div><div class="line">             * &#123; if (it.next() == '*' || it.next() == '/') &#123; isThereHigherOpt =</div><div class="line">             * true; int index = optList.indexOf(it.next());</div><div class="line">             *</div><div class="line">             * break; &#125; &#125;</div><div class="line">             */</div><div class="line">            isThereHigherOpt = <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt;= optList.size() - <span class="number">1</span>; index++) &#123;</div><div class="line">                <span class="keyword">if</span> (optList.get(index) == <span class="string">'*'</span>) &#123;</div><div class="line">                    Double t = list.get(index) * list.get(index + <span class="number">1</span>);</div><div class="line">                    list.remove(index + <span class="number">1</span>);</div><div class="line">                    list.set(index, t);</div><div class="line">                    optList.remove(index);</div><div class="line">                    isThereHigherOpt = <span class="keyword">true</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (optList.get(index) == <span class="string">'/'</span>) &#123;</div><div class="line">                    Double t = list.get(index) / list.get(index + <span class="number">1</span>);</div><div class="line">                    list.remove(index + <span class="number">1</span>);</div><div class="line">                    list.set(index, t);</div><div class="line">                    optList.remove(index);</div><div class="line">                    isThereHigherOpt = <span class="keyword">true</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">while</span> (optList.isEmpty() == <span class="keyword">false</span>) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt;= optList.size() - <span class="number">1</span>; index++) &#123;</div><div class="line">                <span class="keyword">if</span> (optList.get(index) == <span class="string">'+'</span>) &#123;</div><div class="line">                    Double t = list.get(index) + list.get(index + <span class="number">1</span>);</div><div class="line">                    list.remove(index + <span class="number">1</span>);</div><div class="line">                    list.set(index, t);</div><div class="line">                    optList.remove(index);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (optList.get(index) == <span class="string">'-'</span>) &#123;</div><div class="line">                    Double t = list.get(index) + <span class="number">0.0</span> - list.get(index + <span class="number">1</span>);</div><div class="line">                    list.remove(index + <span class="number">1</span>);</div><div class="line">                    list.set(index, t);</div><div class="line">                    optList.remove(index);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*</span></div><div class="line">         * System.out.println("/////////////////////////////////"); for (int</div><div class="line">         * index = 0; index &lt;= optList.size() - 1; index++) &#123; //</div><div class="line">         * System.out.println(index); System.out.println(list.get(index));</div><div class="line">         * System.out.println(optList.get(index));</div><div class="line">         * System.out.println(list.get(index + 1)); &#125;</div><div class="line">         */</div><div class="line">        <span class="keyword">if</span> (list.size() == <span class="number">1</span>) &#123;</div><div class="line">            result = list.get(<span class="number">0</span>).toString();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addText</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (cleared == <span class="keyword">true</span> &amp;&amp; ((ch &lt;= <span class="string">'9'</span> &amp;&amp; ch &gt;= <span class="string">'0'</span>))) &#123;</div><div class="line">            textField.setText(<span class="string">""</span>);</div><div class="line">            cleared = <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        String str = textField.getText();</div><div class="line">        <span class="keyword">if</span> (ch != <span class="string">'='</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (str.length() &gt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">if</span> (str.charAt(str.length() - <span class="number">1</span>) &lt;= <span class="string">'9'</span></div><div class="line">                        &amp;&amp; str.charAt(str.length() - <span class="number">1</span>) &gt;= <span class="string">'0'</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (ch != <span class="string">'.'</span>) &#123;</div><div class="line">                        textField.setText(str + ch);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="keyword">boolean</span> isTherePoint = <span class="keyword">false</span>;</div><div class="line">                        <span class="keyword">int</span> i = str.length() - <span class="number">1</span>;</div><div class="line">                        <span class="keyword">while</span> (i &gt;= <span class="number">0</span>) &#123;</div><div class="line">                            <span class="keyword">if</span> (str.charAt(i) == <span class="string">'*'</span> || str.charAt(i) == <span class="string">'/'</span></div><div class="line">                                    || str.charAt(i) == <span class="string">'+'</span></div><div class="line">                                    || str.charAt(i) == <span class="string">'-'</span>) &#123;</div><div class="line">                                <span class="keyword">break</span>;</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">if</span> (str.charAt(i) == <span class="string">'.'</span>) &#123;</div><div class="line">                                isTherePoint = <span class="keyword">true</span>;</div><div class="line">                                <span class="keyword">break</span>;</div><div class="line">                            &#125;</div><div class="line">                            i--;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">if</span> (isTherePoint == <span class="keyword">false</span>) &#123;</div><div class="line">                            textField.setText(str + ch);</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">if</span> ((ch &lt;= <span class="string">'9'</span> &amp;&amp; ch &gt;= <span class="string">'0'</span>) || ch == <span class="string">'-'</span>) &#123;</div><div class="line">                        textField.setText(str + ch);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">if</span> (ch == <span class="string">'-'</span> || (ch &lt;= <span class="string">'9'</span> &amp;&amp; ch &gt;= <span class="string">'0'</span>))</div><div class="line">                    textField.setText(str + ch);</div><div class="line">            &#125;</div><div class="line">            cleared = <span class="keyword">false</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (cleared == <span class="keyword">true</span>) &#123;</div><div class="line">                textField.setText(<span class="string">""</span>);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                str = textField.getText();</div><div class="line">                <span class="comment">//System.out.println(str);</span></div><div class="line">                textField.setText(<span class="string">""</span>);</div><div class="line">                <span class="keyword">if</span> (str.length() &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (str.charAt(str.length() - <span class="number">1</span>) &lt;= <span class="string">'9'</span></div><div class="line">                            &amp;&amp; str.charAt(str.length() - <span class="number">1</span>) &gt;= <span class="string">'0'</span>) &#123;</div><div class="line">                        textField.setText(calculate(str));</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        textField.setText(<span class="string">"Wrong Expression"</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            cleared = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent event)</span> </span>&#123;</div><div class="line">        Object source = event.getSource();</div><div class="line">        <span class="keyword">if</span> (source.getClass() == JButton.class) &#123;</div><div class="line">            JButton button = (JButton) source;</div><div class="line">            <span class="keyword">char</span> ch = button.getText().charAt(<span class="number">0</span>);</div><div class="line">            addText(ch);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyReleased</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyTyped</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">        <span class="keyword">char</span> ch = e.getKeyChar();</div><div class="line">        <span class="keyword">if</span> (ch == <span class="string">' '</span>) &#123;</div><div class="line">            System.exit(EXIT_ON_CLOSE);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (ch == KeyEvent.VK_ENTER) &#123;</div><div class="line">            buttons[<span class="number">14</span>].setBackground(Color.LIGHT_GRAY);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= name.length - <span class="number">1</span>; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (i != <span class="number">14</span>) &#123;</div><div class="line">                    buttons[i].setBackground(Color.GRAY);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            addText(<span class="string">'='</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt;= name.length - <span class="number">1</span>; index++) &#123;</div><div class="line">            <span class="keyword">if</span> (ch == name[index].charAt(<span class="number">0</span>)) &#123;</div><div class="line">                <span class="comment">// System.out.println(ch);</span></div><div class="line">                buttons[index].setBackground(Color.LIGHT_GRAY);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= name.length - <span class="number">1</span>; i++) &#123;</div><div class="line">                    <span class="keyword">if</span> (i != index) &#123;</div><div class="line">                        buttons[i].setBackground(Color.GRAY);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                addText(ch);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseClicked</span><span class="params">(MouseEvent event)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseEntered</span><span class="params">(MouseEvent event)</span> </span>&#123;</div><div class="line">        Object source = event.getSource();</div><div class="line">        <span class="keyword">if</span> (source.getClass() == JButton.class) &#123;</div><div class="line">            JButton button = (JButton) source;</div><div class="line">            <span class="comment">// System.out.println("hey");</span></div><div class="line">            button.setBackground(Color.LIGHT_GRAY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mousePressed</span><span class="params">(MouseEvent event)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseReleased</span><span class="params">(MouseEvent event)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mouseExited</span><span class="params">(MouseEvent event)</span> </span>&#123;</div><div class="line">        Object source = event.getSource();</div><div class="line">        <span class="keyword">if</span> (source.getClass() == JButton.class) &#123;</div><div class="line">            JButton button = (JButton) source;</div><div class="line">            <span class="comment">// System.out.println("hey");</span></div><div class="line">            button.setBackground(Color.GRAY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Calculator c = <span class="keyword">new</span> Calculator();</div><div class="line">        <span class="comment">// c.addKeyListener(c);</span></div><div class="line">        c.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="程序运行效果："><a href="#程序运行效果：" class="headerlink" title="程序运行效果："></a>程序运行效果：</h3><p>计算9/3-1*2+-1</p>
<p><img src="/imgs/caljava1.jpg" alt="xiaoguo"></p>
<p>结果：<br><img src="/imgs/caljava2.jpg" alt="xiaoguo"></p>
<ul>
<li><p>随笔写于2016.4.8。</p>
</li>
<li><p>程序写于大二下学期，Java程序设计 课程期间。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/13/爬虫/" itemprop="url">
                  爬虫（Java实现）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-13T23:12:59+08:00" content="2016-03-13">
              2016-03-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h3><p>使用了htmlparser库。</p>
<h4 id="运行过程："><a href="#运行过程：" class="headerlink" title="运行过程："></a>运行过程：</h4><p>　　　　从某个网址开始，摘取网页中的链接，并通过广度搜索，对这些链接递归执行上述操作。</p>
<p>　　　　在以上过程中把网址存入数据库中。以防止搜索中出现环路。</p>
<p>　　　　但是，程序经常进入某个网站后，会一直扫描其中的二级域名。</p>
<p>　　　　于是数据库中会出现这种情况：<br>&gt;<br>jack.art.com<br>han.art.com<br>bob.art.com<br>alice.art.com<br>rose.art.com<br>…<br>…</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Robot.java</span></div><div class="line"><span class="keyword">package</span> robot;</div><div class="line"><span class="keyword">import</span> java.net.*;</div><div class="line"><span class="keyword">import</span> java.sql.SQLException;</div><div class="line"><span class="keyword">import</span> java.util.Random;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.htmlparser.*;</div><div class="line"><span class="keyword">import</span> org.htmlparser.filters.TagNameFilter;</div><div class="line"><span class="keyword">import</span> org.htmlparser.tags.LinkTag;</div><div class="line"><span class="keyword">import</span> org.htmlparser.util.NodeList;</div><div class="line"><span class="keyword">import</span> org.htmlparser.util.ParserException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> mydb.DB;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Robot</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ff=<span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> num=<span class="number">0</span>;</div><div class="line">    <span class="comment">//DB db;</span></div><div class="line">    Robot() <span class="keyword">throws</span> MalformedURLException, SQLException&#123;</div><div class="line">        DB.getConnect(<span class="string">"localhost"</span>,<span class="string">"3306"</span>,<span class="string">"robot"</span>,<span class="string">"root"</span>,<span class="string">"142365"</span>);</div><div class="line">        DB.getSta();</div><div class="line">        String url0=<span class="string">"http://www.youku.com"</span>;<span class="comment">//"http://localhost";</span></div><div class="line">     <span class="comment">/*  DB.rs= DB.s.executeQuery("select count(*) from urls");</span></div><div class="line">        if(DB.rs.next())</div><div class="line">        &#123;int n=DB.rs.getInt(1);</div><div class="line">        System.out.println(n ); </div><div class="line">        Random random = new Random();</div><div class="line"></div><div class="line">        int ran = random.nextInt();</div><div class="line">        ran%=n;</div><div class="line">        ran=ran&gt;0?ran:-ran;</div><div class="line">        System.out.println(ran ); </div><div class="line">        DB.rs= DB.s.executeQuery("select * from urls");</div><div class="line">        int x=0;</div><div class="line">        while(DB.rs.next()&amp;&amp;x&lt;ran)&#123;</div><div class="line">             </div><div class="line">                  System.out.println(DB.rs.getString(1)+"000" ); url0=DB.rs.getString(1);</div><div class="line">                  </div><div class="line">              x++;</div><div class="line">        &#125;</div><div class="line">       </div><div class="line">        &#125;*/</div><div class="line">        <span class="comment">//catchHref("http://localhost",num);</span></div><div class="line">        catchHref(url0,num);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEndLegal</span><span class="params">(String str)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(str.endsWith(<span class="string">"php"</span>)||str.endsWith(<span class="string">"net/"</span>)||str.endsWith(<span class="string">"com/"</span>)||str.endsWith(<span class="string">"cn/"</span>)||str.endsWith(<span class="string">"gov/"</span>)||str.endsWith(<span class="string">"edu/"</span>)||str.endsWith(<span class="string">"org/"</span>)||str.endsWith(<span class="string">"net"</span>)||str.endsWith(<span class="string">"com"</span>)||str.endsWith(<span class="string">"cn"</span>)||str.endsWith(<span class="string">"gov"</span>)||str.endsWith(<span class="string">"edu"</span>)||str.endsWith(<span class="string">"org"</span>))&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">catchHref</span><span class="params">(String hreft ,<span class="keyword">int</span> num)</span> <span class="keyword">throws</span> MalformedURLException </span>&#123;</div><div class="line">        Parser     parser =<span class="keyword">null</span>;</div><div class="line">        NodeList nodelist=<span class="keyword">null</span>;</div><div class="line">        String href = <span class="string">"http://www.baidu.com"</span>;</div><div class="line">        <span class="comment">//db=new DB();</span></div><div class="line">        <span class="keyword">if</span>(ff!=<span class="number">0</span>)</div><div class="line">        <span class="keyword">if</span> (!(hreft.startsWith(<span class="string">"http"</span>)&amp;&amp;isEndLegal(hreft)&amp;&amp;!isInDatabase(hreft))) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        ff=<span class="number">1</span>;</div><div class="line">        add(hreft);</div><div class="line">        </div><div class="line">            System.out.println(num);</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                parser = <span class="keyword">new</span> Parser(hreft);</div><div class="line">                <span class="keyword">if</span>(parser==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125; <span class="keyword">catch</span> (ParserException e) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                <span class="comment">//e.printStackTrace();</span></div><div class="line">            &#125;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                nodelist = parser.parse(<span class="keyword">null</span>);</div><div class="line">            &#125; <span class="keyword">catch</span> (ParserException e1) &#123;</div><div class="line">                e1.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(nodelist==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            NodeFilter filter = <span class="keyword">new</span> TagNameFilter(<span class="string">"A"</span>);</div><div class="line">            <span class="keyword">if</span>(filter==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            nodelist = nodelist.extractAllNodesThatMatch(filter, <span class="keyword">true</span>);</div><div class="line">            <span class="keyword">if</span>(nodelist==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodelist.size(); i++) &#123;</div><div class="line">                LinkTag link = (LinkTag) nodelist.elementAt(i);</div><div class="line">                href = link.getAttribute(<span class="string">"href"</span>);</div><div class="line">                <span class="keyword">if</span>(href==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                System.out.println(href );</div><div class="line">                catchHref(href,num);</div><div class="line">                </div><div class="line">            &#125;</div><div class="line">            num++;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(String str)</span></span>&#123;</div><div class="line">        </div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            DB.s.execute(<span class="string">"insert into urls2(url)values('"</span>+str+<span class="string">"');"</span>);</div><div class="line">            DB.commit();</div><div class="line">            System.out.println(<span class="string">"add"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">            <span class="comment">//e.printStackTrace();return ;</span></div><div class="line">            <span class="comment">//JOptionPane.showMessageDialog(null, "数据库添加失败");</span></div><div class="line">            <span class="comment">//System.exit(-1);</span></div><div class="line">            </div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isInDatabase</span><span class="params">(String str)</span></span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            DB.rs= DB.s.executeQuery(<span class="string">"select * from urls where url like'"</span>+str+<span class="string">"%';"</span>);</div><div class="line">            <span class="keyword">if</span>(DB.rs.next())&#123;System.out.println(DB.rs);<span class="keyword">return</span> <span class="keyword">true</span>;&#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"数据库查找失败"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">            <span class="keyword">throws</span> MalformedURLException, ParserException, SQLException &#123;</div><div class="line">        Robot robot = <span class="keyword">new</span> Robot();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//DB.java</span></div><div class="line"><span class="keyword">package</span> mydb;</div><div class="line"><span class="keyword">import</span> java.sql.*;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="comment">//import com.mysql.jdbc.Driver;</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DB</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection conn = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResultSet rs = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Statement s = <span class="keyword">null</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DB</span><span class="params">()</span> </span>&#123;</div><div class="line">        conn = <span class="keyword">null</span>;</div><div class="line">        s = <span class="keyword">null</span>;</div><div class="line">        rs=<span class="keyword">null</span>;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    <span class="comment">/*</span></div><div class="line">    String getResult(ResultSet rs) &#123;</div><div class="line">        String str = "Book\t\tOwnerID\tOwnerName\n";</div><div class="line">        // System.out.println("\nno\tname\tsex\tsalary");</div><div class="line">        try &#123;</div><div class="line">            while (rs.next()) &#123;</div><div class="line">                StringBuilder builder = new StringBuilder(rs.getString(1));</div><div class="line">                builder.append("\t\t");</div><div class="line">                builder.append(rs.getString(2));</div><div class="line">                builder.append("\t");</div><div class="line">                builder.append(rs.getString(3));</div><div class="line">                builder.append("\n");</div><div class="line">                str += builder.toString();</div><div class="line">            &#125;</div><div class="line">        &#125; catch (Throwable e) &#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        // System.out.println();</div><div class="line">        return str;</div><div class="line">    &#125;*/</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnect</span><span class="params">(String IP,String port,String database,String user,String password)</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// Class.forName("org.gjt.mm.mysql.Driver").newInstance();</span></div><div class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e1) &#123;</div><div class="line">            e1.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"数据库包未找到"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125; <span class="comment">// .newInstance();</span></div><div class="line">        </div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            conn = DriverManager.getConnection(</div><div class="line">                    <span class="string">"jdbc:mysql://"</span>+IP+<span class="string">":"</span>+port+<span class="string">"/"</span>+database+<span class="string">"?useUnicode=true&amp;characterEncoding=utf8"</span>, user,</div><div class="line">                    password);<span class="comment">//autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=utf8</span></div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e1) &#123;</div><div class="line">            e1.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"数据库无法连接"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            conn.setAutoCommit(<span class="keyword">false</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e1) &#123;</div><div class="line"></div><div class="line">            e1.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> conn;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Statement <span class="title">getSta</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            s = conn.createStatement();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e1) &#123;</div><div class="line"></div><div class="line">            e1.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"无法建立数据库语句"</span>);</div><div class="line">            System.exit(-<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> s;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span>    <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">commit</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            conn.commit();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line"></div><div class="line">            e.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"对数据库更改无法应用"</span>);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeConnect</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            rs.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"数据库结果集无法关闭"</span>);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            s.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line"></div><div class="line">            e.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"数据库语句无法关闭"</span>);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            conn.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line"></div><div class="line">            e.printStackTrace();</div><div class="line">            JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"与数据库的连接无法关闭"</span>);</div><div class="line">        &#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">        try &#123; // perform a clean shutdown</div><div class="line">            DriverManager.getConnection("jdbc:derby:;shutdown=true");</div><div class="line"></div><div class="line">        &#125; catch (SQLException se) &#123;</div><div class="line"></div><div class="line">            if (((se.getErrorCode() == 50000)</div><div class="line">                    &amp;&amp; ("XJ015".equals(se.getSQLState())))) &#123;</div><div class="line">                // we got the expected exception</div><div class="line">                System.out.println("Derby shut down normally");</div><div class="line">                // Note that for single database shutdown, the expected</div><div class="line">                // SQL state is "08006", and the error code is 45000.</div><div class="line">            &#125; else &#123;</div><div class="line">                System.err.println("Derby did not shut down normally");</div><div class="line">                // JOptionPane.showMessageDialog(null, "数据库关闭错误");</div><div class="line">                se.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;*/</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于大三上学期。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/13/贪吃蛇/" itemprop="url">
                  贪吃蛇（C++实现，VC6.0编译，使用了EasyX图形库）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-13T23:12:59+08:00" content="2016-03-13">
              2016-03-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p><img src="/imgs/tanchishecpp.jpg" alt="效果1"><br><img src="/imgs/tanchishecpp1.jpg" alt="效果2"></p>
<p>&ensp;<br>&ensp;<br>&ensp;<br>&ensp;</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//main.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;fstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;graphics.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;conio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;mmsystem.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"Winmm.lib"</span>)</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> IMGWIDTH 20</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> IMGHEIGHT 20</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WIDTH 1100</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEIGHT 650</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UP 72</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DOWN 80</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LEFT 75</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RIGHT 77</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADUP    <span class="meta-string">"headup.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADDOWN  <span class="meta-string">"headdown.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADLEFT  <span class="meta-string">"headleft.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADRIGHT <span class="meta-string">"headright.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BODYLR <span class="meta-string">"bodylr.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BODYUD <span class="meta-string">"bodyud.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TAILL <span class="meta-string">"taill.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TAILR <span class="meta-string">"tailr.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TAILU <span class="meta-string">"tailu.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TAILD <span class="meta-string">"taild.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WALL <span class="meta-string">"wall.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FOOD <span class="meta-string">"food.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> GAMEOVER <span class="meta-string">"gameover.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SNAKE <span class="meta-string">"snake.jpg"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> L 60   <span class="comment">//左</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> U 80   <span class="comment">//上</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> R 900  <span class="comment">//右</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> D 600  <span class="comment">//下</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">IMAGE wallimg;</div><div class="line"><span class="keyword">int</span> score=<span class="number">0</span>,grade=<span class="number">1</span>,rec[<span class="number">4</span>];</div><div class="line"><span class="keyword">class</span> Food;</div><div class="line"><span class="keyword">class</span> BodyNode&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    IMAGE img;</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">    BodyNode* next;</div><div class="line">    BodyNode()&#123;&#125;</div><div class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> Body;</div><div class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(Body&amp; snake,Food&amp; food)</span></span>;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    BodyNode(<span class="keyword">char</span>* str,<span class="keyword">int</span> X,<span class="keyword">int</span> Y)&#123;</div><div class="line">        x=X;</div><div class="line">        y=Y;</div><div class="line">        loadimage(&amp;img, _T(str));</div><div class="line">        next=<span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">    BodyNode(BodyNode&amp; bodynode)&#123;</div><div class="line">        x=bodynode.x;</div><div class="line">        y=bodynode.y;</div><div class="line">        next=bodynode.next;</div><div class="line">        img=bodynode.img;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">class</span> Body&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    BodyNode* head;</div><div class="line">    BodyNode* tail;</div><div class="line">    <span class="keyword">int</span> length;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(Body&amp; snake,Food&amp; food)</span></span>;</div><div class="line">    Body()&#123;</div><div class="line">        head=<span class="keyword">new</span> BodyNode(HEADRIGHT,L+(<span class="number">10</span>*(IMGWIDTH)),U+(<span class="number">10</span>*(IMGHEIGHT)));</div><div class="line">        head-&gt;next=<span class="keyword">new</span> BodyNode(BODYLR,head-&gt;x-head-&gt;img.getwidth(),head-&gt;y);</div><div class="line">        head-&gt;next-&gt;next=<span class="keyword">new</span> BodyNode(TAILR,head-&gt;next-&gt;x-head-&gt;img.getwidth(),head-&gt;y);</div><div class="line">        tail=head-&gt;next-&gt;next;</div><div class="line">        length=<span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Length</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> length;&#125;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsDead</span><span class="params">()</span></span>&#123;</div><div class="line">        BodyNode* p=head-&gt;next;</div><div class="line">        <span class="keyword">while</span>(p!=<span class="literal">NULL</span>)&#123;</div><div class="line">            <span class="keyword">if</span>(head-&gt;x==p-&gt;x&amp;&amp;head-&gt;y==p-&gt;y)&#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">            p=p-&gt;next;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Move</span><span class="params">(<span class="keyword">int</span> dir)</span></span>&#123;     <span class="comment">//1 上 2下  3左 4 右</span></div><div class="line">        BodyNode* p=head-&gt;next;</div><div class="line">        <span class="keyword">int</span> tempx=head-&gt;x,tempy=head-&gt;y,temp_x,temp_y;</div><div class="line">        <span class="keyword">while</span>(p!=tail-&gt;next)&#123;</div><div class="line">            temp_x=p-&gt;x;</div><div class="line">            temp_y=p-&gt;y;</div><div class="line">            p-&gt;x=tempx;;</div><div class="line">            p-&gt;y=tempy;</div><div class="line">            tempx=temp_x;</div><div class="line">            tempy=temp_y;</div><div class="line">            p=p-&gt;next;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(dir==<span class="number">1</span>)&#123;</div><div class="line">            loadimage(&amp;(head-&gt;img), _T(HEADUP));</div><div class="line">            head-&gt;y=head-&gt;next-&gt;y-head-&gt;img.getheight();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(dir==<span class="number">2</span>)&#123;</div><div class="line">            loadimage(&amp;(head-&gt;img), _T(HEADDOWN));</div><div class="line">            head-&gt;y=head-&gt;next-&gt;y+head-&gt;img.getheight();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(dir==<span class="number">3</span>)&#123;</div><div class="line">            loadimage(&amp;(head-&gt;img), _T(HEADLEFT));</div><div class="line">            head-&gt;x=head-&gt;next-&gt;x-head-&gt;img.getwidth();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(dir==<span class="number">4</span>)&#123;</div><div class="line">            loadimage(&amp;(head-&gt;img), _T(HEADRIGHT));</div><div class="line">            head-&gt;x=head-&gt;next-&gt;x+head-&gt;img.getwidth();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>((head-&gt;x+head-&gt;img.getwidth())&gt;R)&#123;head-&gt;x=L;&#125;</div><div class="line">        <span class="keyword">if</span>(head-&gt;x&lt;L)&#123;head-&gt;x=R-head-&gt;img.getwidth();&#125;</div><div class="line">        <span class="keyword">if</span>((head-&gt;y+head-&gt;img.getheight())&gt;D)&#123;head-&gt;y=U;&#125;</div><div class="line">        <span class="keyword">if</span>(head-&gt;y&lt;U)&#123;head-&gt;y=D-head-&gt;img.getheight();&#125;</div><div class="line">        p=head;</div><div class="line">        <span class="keyword">while</span>(p-&gt;next!=tail)&#123;</div><div class="line">            p=p-&gt;next;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;x-tail-&gt;x&gt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILR));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;x-tail-&gt;x&lt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILL));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;y-tail-&gt;y&gt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILD));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;y-tail-&gt;y&lt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILU));&#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Grow</span><span class="params">()</span></span>&#123;</div><div class="line">        BodyNode*p=head;</div><div class="line">        <span class="keyword">while</span>(p-&gt;next!=tail)&#123;</div><div class="line">            p=p-&gt;next;</div><div class="line">        &#125;</div><div class="line">        tail-&gt;img=p-&gt;img;</div><div class="line">        tail-&gt;next=<span class="keyword">new</span> BodyNode(&amp;(TAILL[<span class="number">0</span>]),tail-&gt;x-(p-&gt;x-tail-&gt;x),tail-&gt;y-(p-&gt;y-tail-&gt;y));</div><div class="line"></div><div class="line">        tail=tail-&gt;next;</div><div class="line">        <span class="keyword">if</span>(p-&gt;x-tail-&gt;x&gt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILR));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;x-tail-&gt;x&lt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILL));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;y-tail-&gt;y&gt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILD));&#125;</div><div class="line">        <span class="keyword">if</span>(p-&gt;y-tail-&gt;y&lt;<span class="number">0</span>)&#123;loadimage(&amp;(tail-&gt;img), _T(TAILU));&#125;</div><div class="line">        tail-&gt;next=<span class="literal">NULL</span>;</div><div class="line">        length++;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Show</span><span class="params">()</span></span>&#123;</div><div class="line">        BodyNode* p=head;</div><div class="line">        <span class="keyword">while</span>(p!=<span class="literal">NULL</span>)&#123;</div><div class="line">            putimage(p-&gt;x, p-&gt;y, &amp;(p-&gt;img));</div><div class="line">            p=p-&gt;next;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">class</span> Food&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">    IMAGE rat;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(Body&amp; snake,Food&amp; food)</span></span>;</div><div class="line">    Food()&#123;</div><div class="line">        x=<span class="number">400</span>;</div><div class="line">        y=<span class="number">300</span>;</div><div class="line">        loadimage(&amp;(rat), _T(FOOD));</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">givefood</span><span class="params">(Body&amp; snake)</span></span>&#123;</div><div class="line">        srand((<span class="keyword">unsigned</span>)time(<span class="number">0</span>));</div><div class="line">        <span class="keyword">while</span>(check(snake,*<span class="keyword">this</span>)==<span class="literal">true</span>)&#123;</div><div class="line">            x=<span class="number">0</span>;y=<span class="number">0</span>;</div><div class="line">            <span class="keyword">while</span>(!(x&gt;L&amp;&amp;y&gt;U))&#123;</div><div class="line">                x= rand()%<span class="number">900</span>;</div><div class="line">                y= rand()%<span class="number">600</span>;</div><div class="line">            &#125;</div><div class="line">            x=x-(x%<span class="number">20</span>);</div><div class="line">            y=y-(y%<span class="number">20</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Show</span><span class="params">()</span></span>&#123;</div><div class="line">        putimage(x,y,&amp;(rat));</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">showgame</span><span class="params">(Body&amp; snake,Food food)</span></span>&#123;</div><div class="line"></div><div class="line">    cleardevice();</div><div class="line">    BeginBatchDraw();</div><div class="line">    setbkcolor(RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));    <span class="comment">//设置背景色</span></div><div class="line">    setcolor(YELLOW);         <span class="comment">//设置绘图色</span></div><div class="line">    outtextxy((WIDTH/<span class="number">2</span>)<span class="number">-80</span>, <span class="number">10</span>, <span class="string">"贪吃蛇"</span>);</div><div class="line">    outtextxy(L+<span class="number">300</span>, U-IMGHEIGHT<span class="number">-20</span>, <span class="string">"按空格 暂停"</span>);</div><div class="line">    outtextxy(R+IMGWIDTH+<span class="number">20</span>, U+IMGHEIGHT+<span class="number">20</span>, <span class="string">"最高记录："</span>);</div><div class="line"><span class="keyword">char</span> rec1[<span class="number">10</span>];<span class="comment">//,rec2[10],rec3[10];</span></div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> index=<span class="number">0</span>;index&lt;=<span class="number">2</span>;index++)&#123;</div><div class="line">    <span class="built_in">sprintf</span>(rec1, <span class="string">"%d"</span>,rec[index]);</div><div class="line">    outtextxy(R+IMGWIDTH+<span class="number">20</span>, U+IMGHEIGHT+<span class="number">20</span>+(index+<span class="number">1</span>)*<span class="number">30</span>, rec1);</div><div class="line">&#125;</div><div class="line">    <span class="keyword">int</span> i,j;</div><div class="line">    <span class="keyword">for</span>(i=L-IMGWIDTH;i&lt;=R;i=i+IMGWIDTH)&#123;</div><div class="line">        j=U-IMGHEIGHT;</div><div class="line">        putimage(i,j,&amp;(wallimg));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(j=U;j&lt;=D;j=j+IMGHEIGHT)&#123;</div><div class="line">        i=L-IMGWIDTH;</div><div class="line">        putimage(i,j,&amp;(wallimg));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(j=U;j&lt;=D;j=j+IMGHEIGHT)&#123;</div><div class="line">        i=R;</div><div class="line">        putimage(i,j,&amp;(wallimg));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(i=L-IMGWIDTH;i&lt;=R;i=i+IMGWIDTH)&#123;</div><div class="line">        j=D;</div><div class="line">        putimage(i,j,&amp;(wallimg));</div><div class="line">    &#125;</div><div class="line">    outtextxy(L<span class="number">-10</span>, U-IMGHEIGHT<span class="number">-20</span>, <span class="string">"得分:"</span>);</div><div class="line">    <span class="keyword">char</span> s[<span class="number">10</span>];</div><div class="line">    <span class="built_in">sprintf</span>(s, <span class="string">"%d"</span>,score);</div><div class="line">    outtextxy(L+<span class="number">60</span>, U-IMGHEIGHT<span class="number">-20</span>, s);</div><div class="line">             outtextxy(L+<span class="number">120</span>, U-IMGHEIGHT<span class="number">-20</span>, <span class="string">"长度:"</span>);</div><div class="line">             <span class="keyword">char</span> l[<span class="number">10</span>];</div><div class="line">             <span class="built_in">sprintf</span>(l, <span class="string">"%d"</span>,snake.Length());</div><div class="line">             outtextxy(L+<span class="number">180</span>, U-IMGHEIGHT<span class="number">-20</span>, l);</div><div class="line"></div><div class="line">             snake.Show();</div><div class="line"></div><div class="line">             food.Show();</div><div class="line">             FlushBatchDraw();</div><div class="line">             Sleep(<span class="number">50</span>*grade);</div><div class="line"></div><div class="line">             <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(Body&amp; snake,Food&amp; food)</span></span>&#123;</div><div class="line">    BodyNode* pl=snake.head;</div><div class="line">    <span class="keyword">bool</span> flag=<span class="literal">false</span>;</div><div class="line">    <span class="keyword">while</span>(pl!=snake.tail-&gt;next)&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>((pl-&gt;x==food.x)&amp;&amp;(pl-&gt;y==food.y))&#123;flag=<span class="literal">true</span>;<span class="keyword">break</span>;&#125;</div><div class="line"></div><div class="line">        pl=pl-&gt;next;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> flag;</div><div class="line">&#125;</div><div class="line"><span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(LPVOID IpParameter)</span></span></div><div class="line">&#123;</div><div class="line">    mciSendString(<span class="string">"play yeah.mp3 repeat"</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);<span class="comment">//播放</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">menu</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">//cleardevice();</span></div><div class="line">    outtextxy((WIDTH/<span class="number">2</span>)<span class="number">-80</span>, <span class="number">120</span>, <span class="string">"贪吃蛇"</span>);</div><div class="line">    outtextxy((WIDTH/<span class="number">2</span>)<span class="number">-180</span>, <span class="number">230</span>, <span class="string">"按↑和↓选择难度"</span>);</div><div class="line">    outtextxy((WIDTH/<span class="number">2</span>)<span class="number">-180</span>, <span class="number">250</span>, <span class="string">"按空格键确定选择"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">record</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="function">fstream <span class="title">f1</span><span class="params">(<span class="string">"record.txt"</span>)</span></span>;   <span class="comment">//打开文件，若文件不存在就创建它</span></div><div class="line">    <span class="keyword">if</span>(!f1) <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="comment">//int a=0,b=0,c=0;</span></div><div class="line">    f1&gt;&gt;rec[<span class="number">0</span>]&gt;&gt;rec[<span class="number">1</span>]&gt;&gt;rec[<span class="number">2</span>];</div><div class="line"></div><div class="line">    f1.close();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">saverecord</span><span class="params">()</span></span>&#123;</div><div class="line">    system(<span class="string">"del record.txt "</span>);</div><div class="line">    <span class="function">ofstream <span class="title">f1</span><span class="params">(<span class="string">"record.txt"</span>)</span></span>;   <span class="comment">//打开文件，若文件不存在就创建它</span></div><div class="line">    <span class="keyword">if</span>(!f1) <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="keyword">int</span> flag=<span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> temp;</div><div class="line">    rec[<span class="number">3</span>]=score;</div><div class="line">    <span class="keyword">while</span>(flag==<span class="number">1</span>)&#123;</div><div class="line">        flag=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">2</span>;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(rec[i]&lt;rec[i+<span class="number">1</span>])&#123;</div><div class="line">                flag=<span class="number">1</span>;</div><div class="line">                temp=rec[i];</div><div class="line">                rec[i]=rec[i+<span class="number">1</span>];</div><div class="line">                rec[i+<span class="number">1</span>]=temp;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    f1&lt;&lt;rec[<span class="number">0</span>]&lt;&lt;<span class="string">"\n"</span>&lt;&lt;rec[<span class="number">1</span>]&lt;&lt;<span class="string">"\n"</span>&lt;&lt;rec[<span class="number">2</span>];</div><div class="line"></div><div class="line">    f1.close();</div><div class="line">    <span class="keyword">if</span>(score!=rec[<span class="number">3</span>])&#123;</div><div class="line">    settextstyle(<span class="number">50</span>, <span class="number">0</span>, _T(<span class="string">"宋体"</span>));</div><div class="line">    outtextxy(WIDTH/<span class="number">2</span>-(<span class="number">50</span>*<span class="number">5</span>),U+<span class="number">40</span>, <span class="string">"恭喜你创造了新纪录！"</span>);</div><div class="line">&#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">3</span>;i++)&#123;</div><div class="line">    rec[i]=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    record();</div><div class="line">    IMAGE snakeimg;</div><div class="line"></div><div class="line">    HANDLE hThread1;</div><div class="line">    hThread1 = CreateThread(<span class="literal">NULL</span>,<span class="number">0</span>,Fun1Proc,<span class="literal">NULL</span>,<span class="number">0</span>,<span class="literal">NULL</span>);</div><div class="line">    <span class="keyword">char</span> key;</div><div class="line">    <span class="keyword">int</span> movekey=<span class="number">4</span>;</div><div class="line">    <span class="keyword">int</span> movekeyold=movekey;</div><div class="line">    initgraph(WIDTH,HEIGHT);</div><div class="line">    <span class="keyword">char</span> temp=<span class="number">0</span>,choose;</div><div class="line">    <span class="keyword">while</span>(temp!=<span class="string">' '</span>)&#123;</div><div class="line">            cleardevice();</div><div class="line">        <span class="keyword">if</span>(kbhit())&#123;</div><div class="line">            choose=getch();</div><div class="line">            fflush(<span class="built_in">stdin</span>);</div><div class="line">            <span class="keyword">switch</span>(choose)&#123;</div><div class="line">            <span class="keyword">case</span> UP:&#123;</div><div class="line">                grade++;</div><div class="line">                    &#125;;<span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> DOWN:&#123;</div><div class="line">                grade--;</div><div class="line">                      &#125;;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(grade==<span class="number">4</span>)&#123;grade=<span class="number">3</span>;&#125;</div><div class="line">        <span class="keyword">if</span>(grade==<span class="number">0</span>)&#123;grade=<span class="number">1</span>;&#125;</div><div class="line">        outtextxy(<span class="number">420</span>,<span class="number">350</span>,<span class="string">"简单"</span>);</div><div class="line">        outtextxy(<span class="number">420</span>,<span class="number">380</span>,<span class="string">"中等"</span>);</div><div class="line">        outtextxy(<span class="number">420</span>,<span class="number">410</span>,<span class="string">"难"</span>);</div><div class="line">    <span class="comment">//    cleardevice();</span></div><div class="line">        menu();</div><div class="line">        outtextxy(<span class="number">300</span>,<span class="number">300</span>,<span class="string">"请选择难度："</span>);</div><div class="line">        <span class="keyword">if</span>(grade==<span class="number">3</span>)&#123;</div><div class="line">        outtextxy(<span class="number">390</span>,<span class="number">350</span>,<span class="string">"→"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(grade==<span class="number">2</span>)&#123;</div><div class="line">        outtextxy(<span class="number">390</span>,<span class="number">380</span>,<span class="string">"→"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(grade==<span class="number">1</span>)&#123;</div><div class="line">        outtextxy(<span class="number">390</span>,<span class="number">410</span>,<span class="string">"→"</span>);</div><div class="line">        &#125;</div><div class="line">        temp=getch();</div><div class="line">                &#125;</div><div class="line">    loadimage(&amp;(wallimg), _T(WALL));</div><div class="line">    Body snake;</div><div class="line">                Food food;</div><div class="line">                showgame(snake,food);</div><div class="line">                <span class="keyword">while</span>(snake.IsDead()==<span class="literal">false</span>)&#123;</div><div class="line">                <span class="keyword">while</span>(snake.IsDead()==<span class="literal">false</span>&amp;&amp;(!kbhit()))&#123;</div><div class="line"></div><div class="line">                    <span class="keyword">if</span>(movekey==<span class="number">1</span>&amp;&amp;movekeyold==<span class="number">2</span>||movekey==<span class="number">2</span>&amp;&amp;movekeyold==<span class="number">1</span>||movekey==<span class="number">3</span>&amp;&amp;movekeyold==<span class="number">4</span>||movekey==<span class="number">4</span>&amp;&amp;movekeyold==<span class="number">3</span>)&#123;</div><div class="line">                        movekey=movekeyold;&#125;</div><div class="line">                    movekeyold=movekey;</div><div class="line">                    snake.Move(movekey);</div><div class="line">                    showgame(snake,food);</div><div class="line">                    <span class="keyword">if</span>(check(snake,food)==<span class="literal">true</span>)&#123;</div><div class="line">                        mciSendString(<span class="string">"play yeah.wav"</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);<span class="comment">//播放</span></div><div class="line">                        <span class="built_in">cout</span>&lt;&lt;<span class="string">'\a'</span>;</div><div class="line">                        score+=<span class="number">10</span>;</div><div class="line">                        food.givefood(snake);</div><div class="line">                        snake.Grow();</div><div class="line">                        snake.Grow();</div><div class="line">                        snake.Grow();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                    <span class="keyword">if</span>(kbhit())&#123;</div><div class="line">                        key=getch();</div><div class="line">                        <span class="keyword">switch</span>(key)&#123;</div><div class="line">                        <span class="keyword">case</span> UP:&#123;movekey=<span class="number">1</span>;</div><div class="line">                                &#125;;<span class="keyword">break</span>;</div><div class="line">                        <span class="keyword">case</span> DOWN:&#123;movekey=<span class="number">2</span>;</div><div class="line">                                  &#125;;<span class="keyword">break</span>;</div><div class="line">                        <span class="keyword">case</span> LEFT:&#123;movekey=<span class="number">3</span>;</div><div class="line">                                  &#125;;<span class="keyword">break</span>;</div><div class="line">                        <span class="keyword">case</span> RIGHT:&#123;movekey=<span class="number">4</span>;</div><div class="line">                                   &#125;;<span class="keyword">break</span>;</div><div class="line">                        <span class="keyword">case</span> <span class="string">' '</span>:&#123;<span class="keyword">int</span> t=<span class="number">0</span>;</div><div class="line">                            <span class="keyword">while</span>(t==<span class="number">0</span>)&#123;</div><div class="line">                                <span class="keyword">if</span>(kbhit())&#123;</div><div class="line">                                    key=getch();</div><div class="line">                                    <span class="keyword">if</span>(key==<span class="string">' '</span>)&#123;</div><div class="line">                                        t=<span class="number">1</span>;</div><div class="line">                                    &#125;</div><div class="line">                                &#125;</div><div class="line">                            &#125;</div><div class="line">                                 &#125;;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                CloseHandle(hThread1);</div><div class="line">                BeginBatchDraw();</div><div class="line">                showgame(snake,food);</div><div class="line">                IMAGE gameoverimg;</div><div class="line">                loadimage(&amp;(gameoverimg), _T(GAMEOVER));</div><div class="line">                putimage(WIDTH/<span class="number">2</span>-(gameoverimg.getwidth()/<span class="number">2</span>),HEIGHT/<span class="number">2</span>-(gameoverimg.getheight()/<span class="number">2</span>),&amp;(gameoverimg));</div><div class="line"></div><div class="line">                saverecord();</div><div class="line">                    FlushBatchDraw();</div><div class="line">                <span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">                &#123;</div><div class="line">                    Sleep(<span class="number">3000</span>);</div><div class="line">                &#125;</div><div class="line">                saverecord();</div><div class="line">                <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> &ensp;<br> &ensp;<br> &ensp;<br> &ensp;</p>
<h3 id="素材："><a href="#素材：" class="headerlink" title="素材："></a>素材：</h3><p>wall.jpg</p>
<p><img src="/imgs/wall.jpg" alt="wall"></p>
<p>tailu.jpg<br><img src="/imgs/tailu.jpg" alt="wall"></p>
<p>tailr.jpg<br><img src="/imgs/tailr.jpg" alt="wall"></p>
<p>taill.jpg<br><img src="/imgs/taill.jpg" alt="wall"></p>
<p>taild.jpg<br><img src="/imgs/taild.jpg" alt="wall"></p>
<p>headup.jpg<br><img src="/imgs/headup.jpg" alt="wall"></p>
<p>headright.jpg<br><img src="/imgs/headright.jpg" alt="wall"></p>
<p>headleft.jpg</p>
<p><img src="/imgs/headleft.jpg" alt="wall"></p>
<p>headdown.jpg</p>
<p><img src="/imgs/headdown.jpg" alt="wall"></p>
<p>food.jpg</p>
<p><img src="/imgs/food.jpg" alt="wall"></p>
<p>bodylr.jpg</p>
<p><img src="/imgs/bodylr.jpg" alt="wall"></p>
<p>gameover.jpg</p>
<p><img src="/imgs/gameover.jpg" alt="wall"></p>
<p>&ensp;<br>record.txt 内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">330</div><div class="line">140</div><div class="line">110</div></pre></td></tr></table></figure>
<p>yeah.mp3 ：游戏背景音乐。</p>
<p>yeah.wav ：蛇吃到食物时的哔声。</p>
<p>&ensp;<br>&ensp;</p>
<ul>
<li><p>程序写于大二上学期。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/13/贪吃蛇Java/" itemprop="url">
                  贪吃蛇（Java实现）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-13T23:12:59+08:00" content="2016-03-13">
              2016-03-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="程序效果："><a href="#程序效果：" class="headerlink" title="程序效果："></a>程序效果：</h3><p><img src="/imgs/tanchishejava.jpg" alt="xiaoguo"></p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Snake.java</span></div><div class="line"><span class="keyword">package</span> snake;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.swing.*;</div><div class="line"><span class="keyword">import</span> java.awt.*;</div><div class="line"><span class="keyword">import</span> java.awt.event.*;</div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.BufferedWriter;</div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.FileReader;</div><div class="line"><span class="keyword">import</span> java.io.FileWriter;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"><span class="keyword">import</span> java.util.LinkedList;</div><div class="line"><span class="keyword">import</span> java.util.Random;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">go</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    Snake s;</div><div class="line">    Random random;</div><div class="line">    <span class="keyword">int</span> foodX = <span class="number">15</span>, foodY = <span class="number">15</span>;</div><div class="line"><span class="keyword">int</span> N;</div><div class="line">    go(Snake snake) &#123;</div><div class="line">        s = snake;</div><div class="line">        random = <span class="keyword">new</span> Random();</div><div class="line">        N=s.N;</div><div class="line">    &#125;</div><div class="line">    <span class="function">Point <span class="title">getFood</span><span class="params">()</span> </span>&#123;</div><div class="line">        Point p = <span class="keyword">new</span> Point();</div><div class="line">        Iterator&lt;Point&gt; it = s.list.iterator();</div><div class="line">        Point temp = it.next();</div><div class="line">        <span class="keyword">boolean</span> isFoodinBody = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">while</span> (isFoodinBody) &#123;</div><div class="line">            foodX = Math.abs(random.nextInt()) % N;</div><div class="line">            foodY = Math.abs(random.nextInt()) % N;</div><div class="line">            isFoodinBody = <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">while</span> (it.hasNext()) &#123;</div><div class="line">                temp = (Point) it.next();</div><div class="line">                <span class="keyword">if</span> (foodX == temp.x &amp;&amp; temp.y == foodY) &#123;</div><div class="line">                    isFoodinBody = <span class="keyword">true</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> p;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            Point first = s.list.getFirst();</div><div class="line">            <span class="keyword">int</span> x = first.x, y = first.y;</div><div class="line">            <span class="keyword">int</span> gotfood = <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span> (foodX == x &amp;&amp; foodY == y) &#123;</div><div class="line">                <span class="keyword">if</span> (!s.isDead) &#123;</div><div class="line">                    s.SCORE += <span class="number">100</span>;</div><div class="line">                    s.scoreField.setText(<span class="string">"SCORE:  "</span>+<span class="keyword">new</span> Integer(s.SCORE).toString());</div><div class="line">                    s.list.add(s.list.getLast());</div><div class="line">                &#125;</div><div class="line">                gotfood = <span class="number">1</span>;</div><div class="line">                foodX = Math.abs(random.nextInt()) % N;</div><div class="line">                foodY = Math.abs(random.nextInt()) % N;</div><div class="line">                s.bs[foodX][foodY].setBackground(Color.PINK);</div><div class="line"></div><div class="line">            &#125;</div><div class="line">            Iterator&lt;Point&gt; it = s.list.iterator();</div><div class="line">            Point temp = it.next();</div><div class="line">            <span class="keyword">while</span> (it.hasNext()) &#123;</div><div class="line">                temp = (Point) it.next();</div><div class="line">                <span class="keyword">if</span> (temp.x == x &amp;&amp; temp.y == y) &#123;</div><div class="line"></div><div class="line"></div><div class="line">                    s.gameOver();</div><div class="line"></div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (gotfood == <span class="number">1</span> &amp;&amp; foodX == temp.x &amp;&amp; temp.y == foodY) &#123;</div><div class="line">                    Point food = getFood();</div><div class="line">                    foodX = food.x;</div><div class="line">                    foodY = food.y;</div><div class="line">                    s.bs[foodX][foodY].setBackground(Color.PINK);</div><div class="line">                    gotfood=<span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">switch</span> (s.dir) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="number">2</span> :</div><div class="line">                    y =( (y - <span class="number">1</span>)+N )% N;</div><div class="line">                    <span class="comment">/*if (y == -1)</span></div><div class="line">                        y = 29;*/</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">0</span> :</div><div class="line">                    y = (y + <span class="number">1</span>) % N;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">3</span> :</div><div class="line">                    x = ((x - <span class="number">1</span>)+N) % N;</div><div class="line">                    <span class="comment">/*if (x == -1)</span></div><div class="line">                        x = 29;*/</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">1</span> :</div><div class="line">                    x = (x + <span class="number">1</span>) % N;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            Point head = <span class="keyword">new</span> Point(x, y);</div><div class="line">            s.bs[x][y].setBackground(Color.LIGHT_GRAY);</div><div class="line"></div><div class="line">            s.list.addFirst(head);</div><div class="line">            Point lastP = s.list.removeLast();</div><div class="line">            s.bs[lastP.x][lastP.y].setBackground(Color.GRAY);</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                Thread.sleep(<span class="number">100</span>);</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">/*</span></div><div class="line">             * for (int i = 0; i &lt;= list.size() - 1; i++) &#123; System.out.print(</div><div class="line">             * "(" + list.get(i).x + "," + list.get(i).y + ")  ");</div><div class="line">             *</div><div class="line">             * &#125;</div><div class="line">             */</div><div class="line">            <span class="comment">// System.out.println();</span></div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Snake</span> <span class="keyword">extends</span> <span class="title">JFrame</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">6494984874207734357L</span>;</div><div class="line">    <span class="keyword">int</span> N = <span class="number">30</span>;</div><div class="line">    <span class="keyword">int</span> dir = <span class="number">0</span>;<span class="comment">// 0 右 1下 2左 3上</span></div><div class="line">    <span class="keyword">int</span> SCORE = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> a=<span class="number">0</span>,b=<span class="number">0</span>,c=<span class="number">0</span>;</div><div class="line">    <span class="keyword">boolean</span> isDead = <span class="keyword">false</span>;</div><div class="line">    JButton[][] bs = <span class="keyword">new</span> JButton[N][N];</div><div class="line">    JPanel panel,scorePanel;</div><div class="line">    JTextField scoreField,bestScoreField;</div><div class="line">    LinkedList&lt;Point&gt; list;</div><div class="line">    Snake() &#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"Snake"</span>);</div><div class="line">        Container container = getContentPane();</div><div class="line">        container.setLayout(<span class="keyword">new</span> BorderLayout());</div><div class="line">        scorePanel = <span class="keyword">new</span> JPanel();</div><div class="line">        scorePanel .setLayout(<span class="keyword">new</span> BorderLayout());</div><div class="line">        scoreField = <span class="keyword">new</span> JTextField(<span class="number">20</span>);</div><div class="line">        bestScoreField= <span class="keyword">new</span> JTextField(<span class="number">50</span>);</div><div class="line">        bestScoreField.setText(getBestScores());</div><div class="line">        bestScoreField.setEditable(<span class="keyword">false</span>);</div><div class="line">        scoreField.setText(<span class="string">"SCORE:  "</span>+<span class="keyword">new</span> Integer(SCORE).toString());</div><div class="line">        scoreField.setEditable(<span class="keyword">false</span>);</div><div class="line">        scorePanel.add(scoreField,BorderLayout.WEST);</div><div class="line">        scorePanel.add(bestScoreField,BorderLayout.EAST);</div><div class="line">        container.add(scorePanel, BorderLayout.NORTH);</div><div class="line">        panel = <span class="keyword">new</span> JPanel();</div><div class="line">        panel.setLayout(<span class="keyword">new</span> GridLayout(N, N));</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N - <span class="number">1</span>; i++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= N - <span class="number">1</span>; j++) &#123;</div><div class="line">                bs[i][j] = <span class="keyword">new</span> JButton();</div><div class="line">                bs[i][j].setBackground(Color.GRAY);</div><div class="line">                panel.add(bs[i][j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        container.add(panel, BorderLayout.CENTER);</div><div class="line">        list = <span class="keyword">new</span> LinkedList&lt;Point&gt;();</div><div class="line"></div><div class="line">        list.add(<span class="keyword">new</span> Point(<span class="number">15</span>, <span class="number">15</span>));</div><div class="line">        list.add(<span class="keyword">new</span> Point(<span class="number">15</span>, <span class="number">14</span>));</div><div class="line">        list.add(<span class="keyword">new</span> Point(<span class="number">15</span>, <span class="number">13</span>));</div><div class="line">        list.add(<span class="keyword">new</span> Point(<span class="number">15</span>, <span class="number">12</span>));</div><div class="line">        list.add(<span class="keyword">new</span> Point(<span class="number">15</span>, <span class="number">11</span>));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= list.size() - <span class="number">1</span>; i++) &#123;</div><div class="line">            bs[list.get(i).x][list.get(i).y].setBackground(Color.LIGHT_GRAY);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*for (int i = 0; i &lt;= list.size() - 1; i++) &#123;</span></div><div class="line">            System.out.print("(" + list.get(i).x + "," + list.get(i).y + ")  ");</div><div class="line"></div><div class="line">        &#125;*/</div><div class="line">        <span class="comment">/*System.out.println();*/</span></div><div class="line"></div><div class="line">        <span class="keyword">this</span>.addKeyListener(<span class="keyword">new</span> KeyAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span> </span>&#123;</div><div class="line">                <span class="keyword">int</span> c = e.getKeyCode();</div><div class="line">                <span class="comment">//System.out.print(c);</span></div><div class="line">                <span class="keyword">int</span> dir1 = dir;</div><div class="line">                <span class="keyword">switch</span> (c) &#123;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_LEFT :</div><div class="line">                        dir1 = <span class="number">2</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_RIGHT :</div><div class="line">                        dir1 = <span class="number">0</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_UP :</div><div class="line">                        dir1 = <span class="number">3</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> KeyEvent.VK_DOWN :</div><div class="line">                        dir1 = <span class="number">1</span>;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">default</span> :</div><div class="line">                        System.out.print(<span class="string">"hey"</span>);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (!(dir1 - dir == -<span class="number">2</span> | dir1 - dir == <span class="number">2</span>))</div><div class="line">                    dir = dir1;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">this</span>.setFocusable(<span class="keyword">true</span>);</div><div class="line">        setLocation(<span class="number">200</span>, <span class="number">10</span>);</div><div class="line">        setSize(<span class="number">800</span>, <span class="number">700</span>);</div><div class="line">        setVisible(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function">String <span class="title">getBestScores</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        BufferedReader reader=<span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            reader=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">"score.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">        a=Integer.parseInt(reader.readLine());</div><div class="line">        b=Integer.parseInt(reader.readLine());</div><div class="line">        c=Integer.parseInt(reader.readLine());</div><div class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        String bestS=<span class="keyword">new</span> String(<span class="string">"Best Score: "</span>+<span class="keyword">new</span> Integer(a).toString()+<span class="string">"   "</span>+<span class="keyword">new</span> Integer(b).toString()+<span class="string">"   "</span>+<span class="keyword">new</span> Integer(c).toString());</div><div class="line">        <span class="keyword">return</span> bestS;</div><div class="line">    &#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">gameOver</span><span class="params">()</span></span>&#123;</div><div class="line">    isDead = <span class="keyword">true</span>;</div><div class="line">    JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">"你死了~~~."</span>, <span class="string">"GAME OVER"</span>,</div><div class="line">            JOptionPane.PLAIN_MESSAGE);</div><div class="line">    <span class="keyword">if</span>(SCORE&gt;a)&#123;c=b;b=a;a=SCORE;save();System.exit(<span class="number">0</span>);&#125;</div><div class="line">    <span class="keyword">if</span>(SCORE&gt;b)&#123;c=b;b=SCORE;save();System.exit(<span class="number">0</span>);&#125;</div><div class="line">    <span class="keyword">if</span>(SCORE&gt;c)&#123;c=SCORE;save();System.exit(<span class="number">0</span>);&#125;</div><div class="line">    System.exit(<span class="number">0</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">save</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line">    BufferedWriter writer=<span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            writer=<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"score.txt"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    String d=<span class="keyword">new</span> Integer(a).toString(),e=<span class="keyword">new</span> Integer(b).toString(),f=<span class="keyword">new</span> Integer(c).toString();</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        writer.write(d);</div><div class="line">        writer.newLine();</div><div class="line">        writer.write(e);</div><div class="line">        writer.newLine();</div><div class="line">        writer.write(f);</div><div class="line">        writer.flush();</div><div class="line">        writer.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException ev) &#123;</div><div class="line">        ev.printStackTrace();</div><div class="line">    &#125; <span class="keyword">catch</span> (IOException ev) &#123;</div><div class="line">        ev.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Snake snake = <span class="keyword">new</span> Snake();</div><div class="line">        snake.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</div><div class="line">        Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> go(snake));</div><div class="line">        thread.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>程序写于大三上学期。</p>
</li>
<li><p>2016.4.12更新博客。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="maxuewei2" />
          <p class="site-author-name" itemprop="name">maxuewei2</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">25</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">maxuewei2</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


</body>
</html>
